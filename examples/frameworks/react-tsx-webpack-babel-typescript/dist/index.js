/*! For license information please see index.js.LICENSE.txt */
(()=>{"use strict";var e={305:(e,t,n)=>{var i=n(328),r=n(810),s=n(483);function a(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=Symbol.for("react.element"),l=Symbol.for("react.transitional.element"),c=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),p=Symbol.for("react.provider"),f=Symbol.for("react.consumer"),m=Symbol.for("react.context"),g=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),y=Symbol.for("react.suspense_list"),b=Symbol.for("react.memo"),x=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var _=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var w=Symbol.for("react.memo_cache_sentinel"),S=Symbol.iterator;function M(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=S&&e[S]||e["@@iterator"])?e:null}Symbol.for("react.client.reference");var E,T=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,A=Object.assign;function C(e){if(void 0===E)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);E=t&&t[1]||""}return"\n"+E+e}var R=!1;function P(e,t){if(!e||R)return"";R=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var i={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(e){var i=e}Reflect.construct(e,[],n)}else{try{n.call()}catch(e){i=e}e.call(n.prototype)}}else{try{throw Error()}catch(e){i=e}(n=e())&&"function"==typeof n.catch&&n.catch((function(){}))}}catch(e){if(e&&i&&"string"==typeof e.stack)return[e.stack,i.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var r=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");r&&r.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});try{var s=i.DetermineComponentFrameRoot(),a=s[0],o=s[1];if(a&&o){var l=a.split("\n"),c=o.split("\n");for(r=i=0;i<l.length&&!l[i].includes("DetermineComponentFrameRoot");)i++;for(;r<c.length&&!c[r].includes("DetermineComponentFrameRoot");)r++;if(i===l.length||r===c.length)for(i=l.length-1,r=c.length-1;1<=i&&0<=r&&l[i]!==c[r];)r--;for(;1<=i&&0<=r;i--,r--)if(l[i]!==c[r]){if(1!==i||1!==r)do{if(i--,0>--r||l[i]!==c[r]){var u="\n"+l[i].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=i&&0<=r);break}}}finally{R=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?C(n):""}function k(e){switch(e.tag){case 26:case 27:case 5:return C(e.type);case 16:return C("Lazy");case 13:return C("Suspense");case 19:return C("SuspenseList");case 0:case 15:return P(e.type,!1);case 11:return P(e.type.render,!1);case 1:return P(e.type,!0);default:return""}}function I(e){try{var t="";do{t+=k(e),e=e.return}while(e);return t}catch(e){return"\nError generating stack: "+e.message+"\n"+e.stack}}function O(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function L(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function N(e){if(O(e)!==e)throw Error(a(188))}function D(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=O(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var s=r.alternate;if(null===s){if(null!==(i=r.return)){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return N(r),e;if(s===i)return N(r),t;s=s.sibling}throw Error(a(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,l=r.child;l;){if(l===n){o=!0,n=r,i=s;break}if(l===i){o=!0,i=r,n=s;break}l=l.sibling}if(!o){for(l=s.child;l;){if(l===n){o=!0,n=s,i=r;break}if(l===i){o=!0,i=s,n=r;break}l=l.sibling}if(!o)throw Error(a(189))}}if(n.alternate!==i)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?z(e):null}function z(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=z(e)))return t;e=e.sibling}return null}var U=Array.isArray,F=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,B={pending:!1,data:null,method:null,action:null},V=[],j=-1;function H(e){return{current:e}}function G(e){0>j||(e.current=V[j],V[j]=null,j--)}function W(e,t){j++,V[j]=e.current,e.current=t}var X=H(null),q=H(null),Y=H(null),$=H(null),Z={$$typeof:m,Provider:null,Consumer:null,_currentValue:null,_currentValue2:null,_threadCount:0};function K(e,t){switch(W(Y,t),W(q,e),W(X,null),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)&&(t=t.namespaceURI)?Yu(t):0;break;default:if(t=(e=8===e?t.parentNode:t).tagName,e=e.namespaceURI)t=$u(e=Yu(e),t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}G(X),W(X,t)}function J(){G(X),G(q),G(Y)}function Q(e){null!==e.memoizedState&&W($,e);var t=X.current,n=$u(t,e.type);t!==n&&(W(q,e),W(X,n))}function ee(e){q.current===e&&(G(X),G(q)),$.current===e&&(G($),Z._currentValue=null)}var te=Object.prototype.hasOwnProperty,ne=i.unstable_scheduleCallback,ie=i.unstable_cancelCallback,re=i.unstable_shouldYield,se=i.unstable_requestPaint,ae=i.unstable_now,oe=i.unstable_getCurrentPriorityLevel,le=i.unstable_ImmediatePriority,ce=i.unstable_UserBlockingPriority,ue=i.unstable_NormalPriority,he=i.unstable_LowPriority,de=i.unstable_IdlePriority,pe=i.log,fe=i.unstable_setDisableYieldValue,me=null,ge=null;function ve(e){if("function"==typeof pe&&fe(e),ge&&"function"==typeof ge.setStrictMode)try{ge.setStrictMode(me,e)}catch(e){}}var ye=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(be(e)/xe|0)|0},be=Math.log,xe=Math.LN2,_e=128,we=4194304;function Se(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194176&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Me(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes;e=e.pingedLanes;var s=134217727&n;return 0!==s?0!=(n=s&~r)?i=Se(n):0!=(e&=s)&&(i=Se(e)):0!=(n&=~r)?i=Se(n):0!==e&&(i=Se(e)),0===i?0:0===t||t===i||t&r||!((r=i&-i)>=(e=t&-t)||32===r&&4194176&e)?i:t}function Ee(e,t){switch(e){case 1:case 2:case 4:case 8:return t+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Te(e,t){return e.errorRecoveryDisabledLanes&t?0:0!=(e=-536870913&e.pendingLanes)?e:536870912&e?536870912:0}function Ae(){var e=_e;return!(4194176&(_e<<=1))&&(_e=128),e}function Ce(){var e=we;return!(62914560&(we<<=1))&&(we=4194304),e}function Re(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Pe(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var i=31-ye(t);e.entangledLanes|=t,e.entanglements[i]=1073741824|e.entanglements[i]|4194218&n}function ke(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-ye(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}function Ie(e){return 2<(e&=-e)?8<e?134217727&e?32:268435456:8:2}function Oe(){var e=F.p;return 0!==e?e:void 0===(e=window.event)?32:Xh(e.type)}var Le=Math.random().toString(36).slice(2),Ne="__reactFiber$"+Le,De="__reactProps$"+Le,ze="__reactContainer$"+Le,Ue="__reactEvents$"+Le,Fe="__reactListeners$"+Le,Be="__reactHandles$"+Le,Ve="__reactResources$"+Le,je="__reactMarker$"+Le;function He(e){delete e[Ne],delete e[De],delete e[Ue],delete e[Fe],delete e[Be]}function Ge(e){var t=e[Ne];if(t)return t;for(var n=e.parentNode;n;){if(t=n[ze]||n[Ne]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ah(e);null!==e;){if(n=e[Ne])return n;e=ah(e)}return t}n=(e=n).parentNode}return null}function We(e){if(e=e[Ne]||e[ze]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function Xe(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(a(33))}function qe(e){var t=e[Ve];return t||(t=e[Ve]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function Ye(e){e[je]=!0}var $e=new Set,Ze={};function Ke(e,t){Je(e,t),Je(e+"Capture",t)}function Je(e,t){for(Ze[e]=t,e=0;e<t.length;e++)$e.add(t[e])}var Qe=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),et=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),tt={},nt={};function it(e,t,n){if(r=t,te.call(nt,r)||!te.call(tt,r)&&(et.test(r)?nt[r]=!0:(tt[r]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var i=t.toLowerCase().slice(0,5);if("data-"!==i&&"aria-"!==i)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var r}function rt(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function st(e,t,n,i){if(null===i)e.removeAttribute(n);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+i)}}function at(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function ot(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function lt(e){e._valueTracker||(e._valueTracker=function(e){var t=ot(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var r=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function ct(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=ot(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function ut(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var ht=/[\n"\\]/g;function dt(e){return e.replace(ht,(function(e){return"\\"+e.charCodeAt(0).toString(16)+" "}))}function pt(e,t,n,i,r,s,a,o){e.name="",null!=a&&"function"!=typeof a&&"symbol"!=typeof a&&"boolean"!=typeof a?e.type=a:e.removeAttribute("type"),null!=t?"number"===a?(0===t&&""===e.value||e.value!=t)&&(e.value=""+at(t)):e.value!==""+at(t)&&(e.value=""+at(t)):"submit"!==a&&"reset"!==a||e.removeAttribute("value"),null!=t?mt(e,a,at(t)):null!=n?mt(e,a,at(n)):null!=i&&e.removeAttribute("value"),null==r&&null!=s&&(e.defaultChecked=!!s),null!=r&&(e.checked=r&&"function"!=typeof r&&"symbol"!=typeof r),null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o?e.name=""+at(o):e.removeAttribute("name")}function ft(e,t,n,i,r,s,a,o){if(null!=s&&"function"!=typeof s&&"symbol"!=typeof s&&"boolean"!=typeof s&&(e.type=s),null!=t||null!=n){if(("submit"===s||"reset"===s)&&null==t)return;n=null!=n?""+at(n):"",t=null!=t?""+at(t):n,o||t===e.value||(e.value=t),e.defaultValue=t}i="function"!=typeof(i=null!=i?i:r)&&"symbol"!=typeof i&&!!i,e.checked=o?e.checked:!!i,e.defaultChecked=!!i,null!=a&&"function"!=typeof a&&"symbol"!=typeof a&&"boolean"!=typeof a&&(e.name=a)}function mt(e,t,n){"number"===t&&ut(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function gt(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+at(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function vt(e,t,n){null==t||((t=""+at(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+at(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function yt(e,t,n,i){if(null==t){if(null!=i){if(null!=n)throw Error(a(92));if(U(i)){if(1<i.length)throw Error(a(93));i=i[0]}n=i}null==n&&(n=""),t=n}n=at(t),e.defaultValue=n,(i=e.textContent)===n&&""!==i&&null!==i&&(e.value=i)}function bt(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var xt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function _t(e,t,n){var i=0===t.indexOf("--");null==n||"boolean"==typeof n||""===n?i?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":i?e.setProperty(t,n):"number"!=typeof n||0===n||xt.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function wt(e,t,n){if(null!=t&&"object"!=typeof t)throw Error(a(62));if(e=e.style,null!=n){for(var i in n)!n.hasOwnProperty(i)||null!=t&&t.hasOwnProperty(i)||(0===i.indexOf("--")?e.setProperty(i,""):"float"===i?e.cssFloat="":e[i]="");for(var r in t)i=t[r],t.hasOwnProperty(r)&&n[r]!==i&&_t(e,r,i)}else for(var s in t)t.hasOwnProperty(s)&&_t(e,s,t[s])}function St(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Mt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Et=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Tt(e){return Et.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var At=null;function Ct(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Rt=null,Pt=null;function kt(e){var t=We(e);if(t&&(e=t.stateNode)){var n=e[De]||null;e:switch(e=t.stateNode,t.type){case"input":if(pt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+dt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=i[De]||null;if(!r)throw Error(a(90));pt(i,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name)}}for(t=0;t<n.length;t++)(i=n[t]).form===e.form&&ct(i)}break e;case"textarea":vt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&gt(e,!!n.multiple,t,!1)}}}var It=!1;function Ot(e,t,n){if(It)return e(t,n);It=!0;try{return e(t)}finally{if(It=!1,(null!==Rt||null!==Pt)&&(Dc(),Rt&&(t=Rt,e=Pt,Pt=Rt=null,kt(t),e)))for(t=0;t<e.length;t++)kt(e[t])}}function Lt(e,t){var n=e.stateNode;if(null===n)return null;var i=n[De]||null;if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(a(231,t,typeof n));return n}var Nt=!1;if(Qe)try{var Dt={};Object.defineProperty(Dt,"passive",{get:function(){Nt=!0}}),window.addEventListener("test",Dt,Dt),window.removeEventListener("test",Dt,Dt)}catch(e){Nt=!1}var zt=null,Ut=null,Ft=null;function Bt(){if(Ft)return Ft;var e,t,n=Ut,i=n.length,r="value"in zt?zt.value:zt.textContent,s=r.length;for(e=0;e<i&&n[e]===r[e];e++);var a=i-e;for(t=1;t<=a&&n[i-t]===r[s-t];t++);return Ft=r.slice(e,1<t?1-t:void 0)}function Vt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function jt(){return!0}function Ht(){return!1}function Gt(e){function t(t,n,i,r,s){for(var a in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?jt:Ht,this.isPropagationStopped=Ht,this}return A(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=jt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=jt)},persist:function(){},isPersistent:jt}),t}var Wt,Xt,qt,Yt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},$t=Gt(Yt),Zt=A({},Yt,{view:0,detail:0}),Kt=Gt(Zt),Jt=A({},Zt,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:un,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==qt&&(qt&&"mousemove"===e.type?(Wt=e.screenX-qt.screenX,Xt=e.screenY-qt.screenY):Xt=Wt=0,qt=e),Wt)},movementY:function(e){return"movementY"in e?e.movementY:Xt}}),Qt=Gt(Jt),en=Gt(A({},Jt,{dataTransfer:0})),tn=Gt(A({},Zt,{relatedTarget:0})),nn=Gt(A({},Yt,{animationName:0,elapsedTime:0,pseudoElement:0})),rn=Gt(A({},Yt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),sn=Gt(A({},Yt,{data:0})),an={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},on={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ln={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function cn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=ln[e])&&!!t[e]}function un(){return cn}var hn=Gt(A({},Zt,{key:function(e){if(e.key){var t=an[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Vt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?on[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:un,charCode:function(e){return"keypress"===e.type?Vt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Vt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),dn=Gt(A({},Jt,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),pn=Gt(A({},Zt,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:un})),fn=Gt(A({},Yt,{propertyName:0,elapsedTime:0,pseudoElement:0})),mn=Gt(A({},Jt,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),gn=Gt(A({},Yt,{newState:0,oldState:0})),vn=[9,13,27,32],yn=Qe&&"CompositionEvent"in window,bn=null;Qe&&"documentMode"in document&&(bn=document.documentMode);var xn=Qe&&"TextEvent"in window&&!bn,_n=Qe&&(!yn||bn&&8<bn&&11>=bn),wn=String.fromCharCode(32),Sn=!1;function Mn(e,t){switch(e){case"keyup":return-1!==vn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function En(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Tn=!1,An={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Cn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!An[e.type]:"textarea"===t}function Rn(e,t,n,i){Rt?Pt?Pt.push(i):Pt=[i]:Rt=i,0<(t=Ou(t,"onChange")).length&&(n=new $t("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Pn=null,kn=null;function In(e){Eu(e,0)}function On(e){if(ct(Xe(e)))return e}function Ln(e,t){if("change"===e)return t}var Nn=!1;if(Qe){var Dn;if(Qe){var zn="oninput"in document;if(!zn){var Un=document.createElement("div");Un.setAttribute("oninput","return;"),zn="function"==typeof Un.oninput}Dn=zn}else Dn=!1;Nn=Dn&&(!document.documentMode||9<document.documentMode)}function Fn(){Pn&&(Pn.detachEvent("onpropertychange",Bn),kn=Pn=null)}function Bn(e){if("value"===e.propertyName&&On(kn)){var t=[];Rn(t,kn,e,Ct(e)),Ot(In,t)}}function Vn(e,t,n){"focusin"===e?(Fn(),kn=n,(Pn=t).attachEvent("onpropertychange",Bn)):"focusout"===e&&Fn()}function jn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return On(kn)}function Hn(e,t){if("click"===e)return On(t)}function Gn(e,t){if("input"===e||"change"===e)return On(t)}var Wn="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function Xn(e,t){if(Wn(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!te.call(t,r)||!Wn(e[r],t[r]))return!1}return!0}function qn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Yn(e,t){var n,i=qn(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=qn(i)}}function $n(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?$n(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function Zn(){for(var e=window,t=ut();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=ut((e=t.contentWindow).document)}return t}function Kn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function Jn(e){var t=Zn(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&$n(n.ownerDocument.documentElement,n)){if(null!==i&&Kn(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=void 0===i.end?s:Math.min(i.end,r),!e.extend&&s>i&&(r=i,i=s,s=r),r=Yn(n,s);var a=Yn(n,i);r&&a&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),s>i?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Qn=Qe&&"documentMode"in document&&11>=document.documentMode,ei=null,ti=null,ni=null,ii=!1;function ri(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;ii||null==ei||ei!==ut(i)||(i="selectionStart"in(i=ei)&&Kn(i)?{start:i.selectionStart,end:i.selectionEnd}:{anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},ni&&Xn(ni,i)||(ni=i,0<(i=Ou(ti,"onSelect")).length&&(t=new $t("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=ei)))}function si(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var ai={animationend:si("Animation","AnimationEnd"),animationiteration:si("Animation","AnimationIteration"),animationstart:si("Animation","AnimationStart"),transitionrun:si("Transition","TransitionRun"),transitionstart:si("Transition","TransitionStart"),transitioncancel:si("Transition","TransitionCancel"),transitionend:si("Transition","TransitionEnd")},oi={},li={};function ci(e){if(oi[e])return oi[e];if(!ai[e])return e;var t,n=ai[e];for(t in n)if(n.hasOwnProperty(t)&&t in li)return oi[e]=n[t];return e}Qe&&(li=document.createElement("div").style,"AnimationEvent"in window||(delete ai.animationend.animation,delete ai.animationiteration.animation,delete ai.animationstart.animation),"TransitionEvent"in window||delete ai.transitionend.transition);var ui=ci("animationend"),hi=ci("animationiteration"),di=ci("animationstart"),pi=ci("transitionrun"),fi=ci("transitionstart"),mi=ci("transitioncancel"),gi=ci("transitionend"),vi=new Map,yi="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function bi(e,t){vi.set(e,t),Ke(t,[e])}var xi=[],_i=0,wi=0;function Si(){for(var e=_i,t=wi=_i=0;t<e;){var n=xi[t];xi[t++]=null;var i=xi[t];xi[t++]=null;var r=xi[t];xi[t++]=null;var s=xi[t];if(xi[t++]=null,null!==i&&null!==r){var a=i.pending;null===a?r.next=r:(r.next=a.next,a.next=r),i.pending=r}0!==s&&Ai(n,r,s)}}function Mi(e,t,n,i){xi[_i++]=e,xi[_i++]=t,xi[_i++]=n,xi[_i++]=i,wi|=i,e.lanes|=i,null!==(e=e.alternate)&&(e.lanes|=i)}function Ei(e,t,n,i){return Mi(e,t,n,i),Ci(e)}function Ti(e,t){return Mi(e,null,null,t),Ci(e)}function Ai(e,t,n){e.lanes|=n;var i=e.alternate;null!==i&&(i.lanes|=n);for(var r=!1,s=e.return;null!==s;)s.childLanes|=n,null!==(i=s.alternate)&&(i.childLanes|=n),22===s.tag&&(null===(e=s.stateNode)||1&e._visibility||(r=!0)),e=s,s=s.return;r&&null!==t&&3===e.tag&&(s=e.stateNode,r=31-ye(n),null===(e=(s=s.hiddenUpdates)[r])?s[r]=[t]:e.push(t),t.lane=536870912|n)}function Ci(e){ou();for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Ri={},Pi=new WeakMap;function ki(e,t){if("object"==typeof e&&null!==e){var n=Pi.get(e);"string"!=typeof n&&(n=I(t),Pi.set(e,n))}else n=I(t);return{value:e,source:t,stack:n}}var Ii=[],Oi=0,Li=null,Ni=0,Di=[],zi=0,Ui=null,Fi=1,Bi="";function Vi(e,t){Ii[Oi++]=Ni,Ii[Oi++]=Li,Li=e,Ni=t}function ji(e,t,n){Di[zi++]=Fi,Di[zi++]=Bi,Di[zi++]=Ui,Ui=e;var i=Fi;e=Bi;var r=32-ye(i)-1;i&=~(1<<r),n+=1;var s=32-ye(t)+r;if(30<s){var a=r-r%5;s=(i&(1<<a)-1).toString(32),i>>=a,r-=a,Fi=1<<32-ye(t)+r|n<<r|i,Bi=s+e}else Fi=1<<s|n<<r|i,Bi=e}function Hi(e){null!==e.return&&(Vi(e,1),ji(e,1,0))}function Gi(e){for(;e===Li;)Li=Ii[--Oi],Ii[Oi]=null,Ni=Ii[--Oi],Ii[Oi]=null;for(;e===Ui;)Ui=Di[--zi],Di[zi]=null,Bi=Di[--zi],Di[zi]=null,Fi=Di[--zi],Di[zi]=null}var Wi=null,Xi=null,qi=!1,Yi=null,$i=!1,Zi=Error(a(519));function Ki(e){throw nr(ki(Error(a(418,"")),e)),Zi}function Ji(e){var t=e.stateNode,n=e.type,i=e.memoizedProps;switch(t[Ne]=e,t[De]=i,n){case"dialog":Tu("cancel",t),Tu("close",t);break;case"iframe":case"object":case"embed":Tu("load",t);break;case"video":case"audio":for(n=0;n<Su.length;n++)Tu(Su[n],t);break;case"source":Tu("error",t);break;case"img":case"image":case"link":Tu("error",t),Tu("load",t);break;case"details":Tu("toggle",t);break;case"input":Tu("invalid",t),ft(t,i.value,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name,!0),lt(t);break;case"select":Tu("invalid",t);break;case"textarea":Tu("invalid",t),yt(t,i.value,i.defaultValue,i.children),lt(t)}"string"!=typeof(n=i.children)&&"number"!=typeof n&&"bigint"!=typeof n||t.textContent===""+n||!0===i.suppressHydrationWarning||Fu(t.textContent,n)?(null!=i.popover&&(Tu("beforetoggle",t),Tu("toggle",t)),null!=i.onScroll&&Tu("scroll",t),null!=i.onScrollEnd&&Tu("scrollend",t),null!=i.onClick&&(t.onclick=Bu),t=!0):t=!1,t||Ki(e)}function Qi(e){for(Wi=e.return;Wi;)switch(Wi.tag){case 3:case 27:return void($i=!0);case 5:case 13:return void($i=!1);default:Wi=Wi.return}}function er(e){if(e!==Wi)return!1;if(!qi)return Qi(e),qi=!0,!1;var t,n=!1;if((t=3!==e.tag&&27!==e.tag)&&((t=5===e.tag)&&(t=!("form"!==(t=e.type)&&"button"!==t)||Zu(e.type,e.memoizedProps)),t=!t),t&&(n=!0),n&&Xi&&Ki(e),Qi(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType)if("/$"===(t=e.data)){if(0===n){Xi=sh(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++;e=e.nextSibling}Xi=null}}else Xi=Wi?sh(e.stateNode.nextSibling):null;return!0}function tr(){Xi=Wi=null,qi=!1}function nr(e){null===Yi?Yi=[e]:Yi.push(e)}var ir=Error(a(460)),rr=Error(a(474)),sr={then:function(){}};function ar(e){return"fulfilled"===(e=e.status)||"rejected"===e}function or(){}function lr(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(or,or),t=n),t.status){case"fulfilled":return t.value;case"rejected":if((e=t.reason)===ir)throw Error(a(483));throw e;default:if("string"==typeof t.status)t.then(or,or);else{if(null!==(e=Jl)&&100<e.shellSuspendCounter)throw Error(a(482));(e=t).status="pending",e.then((function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}}),(function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}}))}switch(t.status){case"fulfilled":return t.value;case"rejected":if((e=t.reason)===ir)throw Error(a(483));throw e}throw cr=t,ir}}var cr=null;function ur(){if(null===cr)throw Error(a(459));var e=cr;return cr=null,e}var hr=null,dr=0;function pr(e){var t=dr;return dr+=1,null===hr&&(hr=[]),lr(hr,e,t)}function fr(e,t,n,i){e=i.props.ref,n.ref=void 0!==e?e:null}function mr(e,t){if(t.$$typeof===o)throw Error(a(525));throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function gr(e){return(0,e._init)(e._payload)}function vr(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function r(e,t){return(e=Ll(e,t)).index=0,e.sibling=null,e}function s(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=33554434,n):i:(t.flags|=33554434,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=33554434),t}function h(e,t,n,i){return null===t||6!==t.tag?((t=Fl(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function d(e,t,n,i){var s=n.type;return s===u?f(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===s||"object"==typeof s&&null!==s&&s.$$typeof===x&&gr(s)===t.type)?(fr(e,0,i=r(t,n.props),n),i.return=e,i):(fr(e,0,i=Dl(n.type,n.key,n.props,null,e.mode,i),n),i.return=e,i)}function p(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Bl(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function f(e,t,n,i,s){return null===t||7!==t.tag?((t=zl(n,e.mode,i,s)).return=e,t):((t=r(t,n)).return=e,t)}function g(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t||"bigint"==typeof t)return(t=Fl(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case l:return fr(e,0,n=Dl(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case c:return(t=Bl(t,e.mode,n)).return=e,t;case x:return g(e,t=(0,t._init)(t._payload),n)}if(U(t)||M(t))return(t=zl(t,e.mode,n,null)).return=e,t;if("function"==typeof t.then)return g(e,pr(t),n);if(t.$$typeof===m)return g(e,go(e,t,n),n);mr(e,t)}return null}function v(e,t,n,i){var r=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n||"bigint"==typeof n)return null!==r?null:h(e,t,""+n,i);if("object"==typeof n&&null!==n){switch(n.$$typeof){case l:return n.key===r?d(e,t,n,i):null;case c:return n.key===r?p(e,t,n,i):null;case x:return v(e,t,n=(r=n._init)(n._payload),i)}if(U(n)||M(n))return null!==r?null:f(e,t,n,i,null);if("function"==typeof n.then)return v(e,t,pr(n),i);if(n.$$typeof===m)return v(e,t,go(e,n,i),i);mr(e,n)}return null}function y(e,t,n,i,r){if("string"==typeof i&&""!==i||"number"==typeof i||"bigint"==typeof i)return h(t,e=e.get(n)||null,""+i,r);if("object"==typeof i&&null!==i){switch(i.$$typeof){case l:return d(t,e=e.get(null===i.key?n:i.key)||null,i,r);case c:return p(t,e=e.get(null===i.key?n:i.key)||null,i,r);case x:return y(e,t,n,i=(0,i._init)(i._payload),r)}if(U(i)||M(i))return f(t,e=e.get(n)||null,i,r,null);if("function"==typeof i.then)return y(e,t,n,pr(i),r);if(i.$$typeof===m)return y(e,t,n,go(t,i,r),r);mr(t,i)}return null}function b(h,d,p,f){if("object"==typeof p&&null!==p&&p.type===u&&null===p.key&&(p=p.props.children),"object"==typeof p&&null!==p){switch(p.$$typeof){case l:e:{for(var _=p.key,w=d;null!==w;){if(w.key===_){if((_=p.type)===u){if(7===w.tag){n(h,w.sibling),(d=r(w,p.props.children)).return=h,h=d;break e}}else if(w.elementType===_||"object"==typeof _&&null!==_&&_.$$typeof===x&&gr(_)===w.type){n(h,w.sibling),fr(h,0,d=r(w,p.props),p),d.return=h,h=d;break e}n(h,w);break}t(h,w),w=w.sibling}p.type===u?((d=zl(p.props.children,h.mode,f,p.key)).return=h,h=d):(fr(h,0,f=Dl(p.type,p.key,p.props,null,h.mode,f),p),f.return=h,h=f)}return o(h);case c:e:{for(w=p.key;null!==d;){if(d.key===w){if(4===d.tag&&d.stateNode.containerInfo===p.containerInfo&&d.stateNode.implementation===p.implementation){n(h,d.sibling),(d=r(d,p.children||[])).return=h,h=d;break e}n(h,d);break}t(h,d),d=d.sibling}(d=Bl(p,h.mode,f)).return=h,h=d}return o(h);case x:return b(h,d,p=(w=p._init)(p._payload),f)}if(U(p))return function(r,a,o,l){for(var c=null,u=null,h=a,d=a=0,p=null;null!==h&&d<o.length;d++){h.index>d?(p=h,h=null):p=h.sibling;var f=v(r,h,o[d],l);if(null===f){null===h&&(h=p);break}e&&h&&null===f.alternate&&t(r,h),a=s(f,a,d),null===u?c=f:u.sibling=f,u=f,h=p}if(d===o.length)return n(r,h),qi&&Vi(r,d),c;if(null===h){for(;d<o.length;d++)null!==(h=g(r,o[d],l))&&(a=s(h,a,d),null===u?c=h:u.sibling=h,u=h);return qi&&Vi(r,d),c}for(h=i(h);d<o.length;d++)null!==(p=y(h,r,d,o[d],l))&&(e&&null!==p.alternate&&h.delete(null===p.key?d:p.key),a=s(p,a,d),null===u?c=p:u.sibling=p,u=p);return e&&h.forEach((function(e){return t(r,e)})),qi&&Vi(r,d),c}(h,d,p,f);if(M(p)){if("function"!=typeof(w=M(p)))throw Error(a(150));return function(r,o,l,c){if(null==l)throw Error(a(151));for(var u=null,h=null,d=o,p=o=0,f=null,m=l.next();null!==d&&!m.done;p++,m=l.next()){d.index>p?(f=d,d=null):f=d.sibling;var b=v(r,d,m.value,c);if(null===b){null===d&&(d=f);break}e&&d&&null===b.alternate&&t(r,d),o=s(b,o,p),null===h?u=b:h.sibling=b,h=b,d=f}if(m.done)return n(r,d),qi&&Vi(r,p),u;if(null===d){for(;!m.done;p++,m=l.next())null!==(m=g(r,m.value,c))&&(o=s(m,o,p),null===h?u=m:h.sibling=m,h=m);return qi&&Vi(r,p),u}for(d=i(d);!m.done;p++,m=l.next())null!==(m=y(d,r,p,m.value,c))&&(e&&null!==m.alternate&&d.delete(null===m.key?p:m.key),o=s(m,o,p),null===h?u=m:h.sibling=m,h=m);return e&&d.forEach((function(e){return t(r,e)})),qi&&Vi(r,p),u}(h,d,p=w.call(p),f)}if("function"==typeof p.then)return b(h,d,pr(p),f);if(p.$$typeof===m)return b(h,d,go(h,p,f),f);mr(h,p)}return"string"==typeof p&&""!==p||"number"==typeof p||"bigint"==typeof p?(p=""+p,null!==d&&6===d.tag?(n(h,d.sibling),(d=r(d,p)).return=h,h=d):(n(h,d),(d=Fl(p,h.mode,f)).return=h,h=d),o(h)):n(h,d)}return function(e,t,n,i){try{dr=0;var r=b(e,t,n,i);return hr=null,r}catch(t){if(t===ir)throw t;var s=Il(29,t,null,e.mode);return s.lanes=i,s.return=e,s}}}var yr=vr(!0),br=vr(!1),xr=H(null),_r=H(0);function wr(e,t){W(_r,e=rc),W(xr,t),rc=e|t.baseLanes}function Sr(){W(_r,rc),W(xr,xr.current)}function Mr(){rc=_r.current,G(xr),G(_r)}var Er=H(null),Tr=null;function Ar(e){var t=e.alternate;W(kr,1&kr.current),W(Er,e),null===Tr&&(null===t||null!==xr.current||null!==t.memoizedState)&&(Tr=e)}function Cr(e){if(22===e.tag){if(W(kr,kr.current),W(Er,e),null===Tr){var t=e.alternate;null!==t&&null!==t.memoizedState&&(Tr=e)}}else Rr()}function Rr(){W(kr,kr.current),W(Er,Er.current)}function Pr(e){G(Er),Tr===e&&(Tr=null),G(kr)}var kr=H(0);function Ir(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Or="undefined"!=typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach((function(e){return e()}))}},Lr=i.unstable_scheduleCallback,Nr=i.unstable_NormalPriority,Dr={$$typeof:m,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function zr(){return{controller:new Or,data:new Map,refCount:0}}function Ur(e){e.refCount--,0===e.refCount&&Lr(Nr,(function(){e.controller.abort()}))}var Fr=null,Br=0,Vr=0,jr=null;function Hr(){if(null!==Fr&&0==--Br){null!==jr&&(jr.status="fulfilled");var e=Fr;Fr=null,Vr=0,jr=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Gr=T.S;T.S=function(e,t){"object"==typeof t&&null!==t&&"function"==typeof t.then&&function(e,t){if(null===Fr){var n=Fr=[];Br=0,Vr=yu(),jr={status:"pending",value:void 0,then:function(e){n.push(e)}}}Br++,t.then(Hr,Hr)}(0,t),null!==Gr&&Gr(e,t)};var Wr=H(null);function Xr(){var e=Wr.current;return null!==e?e:Jl.pooledCache}function qr(e,t){W(Wr,null===t?Wr.current:t.pool)}function Yr(){var e=Xr();return null===e?null:{parent:Dr._currentValue,pool:e}}var $r=0,Zr=null,Kr=null,Jr=null,Qr=!1,es=!1,ts=!1,ns=0,is=0,rs=null,ss=0;function as(){throw Error(a(321))}function os(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Wn(e[n],t[n]))return!1;return!0}function ls(e,t,n,i,r,s){return $r=s,Zr=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,T.H=null===e||null===e.memoizedState?_a:wa,ts=!1,e=n(i,r),ts=!1,es&&(e=us(t,n,i,r)),cs(),e}function cs(){T.H=xa;var e=null!==Kr&&null!==Kr.next;if($r=0,Jr=Kr=Zr=null,Qr=!1,is=0,rs=null,e)throw Error(a(300))}function us(e,t,n,i){Zr=e;var r=0;do{if(es&&(rs=null),is=0,es=!1,25<=r)throw Error(a(301));r+=1,Jr=Kr=null,e.updateQueue=null,T.H=Sa;var s=t(n,i)}while(es);return s}function hs(){var e=T.H,t=e.useState()[0];return t="function"==typeof t.then?vs(t):t,e=e.useState()[0],(null!==Kr?Kr.memoizedState:null)!==e&&(Zr.flags|=1024),t}function ds(){var e=0!==ns;return ns=0,e}function ps(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function fs(e){if(Qr){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}Qr=!1}$r=0,Jr=Kr=Zr=null,es=!1,is=ns=0,rs=null}function ms(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Jr?Zr.memoizedState=Jr=e:Jr=Jr.next=e,Jr}function gs(){if(null===Kr){var e=Zr.alternate;e=null!==e?e.memoizedState:null}else e=Kr.next;var t=null===Jr?Zr.memoizedState:Jr.next;if(null!==t)Jr=t,Kr=e;else{if(null===e){if(null===Zr.alternate)throw Error(a(467));throw Error(a(310))}e={memoizedState:(Kr=e).memoizedState,baseState:Kr.baseState,baseQueue:Kr.baseQueue,queue:Kr.queue,next:null},null===Jr?Zr.memoizedState=Jr=e:Jr=Jr.next=e}return Jr}function vs(e){var t=is;return is+=1,null===rs&&(rs=[]),e=lr(rs,e,t),t=Zr,null===(null===Jr?t.memoizedState:Jr.next)&&(t=t.alternate,T.H=null===t||null===t.memoizedState?_a:wa),e}function ys(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return vs(e);if(e.$$typeof===m)return mo(e)}throw Error(a(438,String(e)))}function bs(e){var t=null,n=Zr.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var i=Zr.alternate;null!==i&&null!==(i=i.updateQueue)&&null!=(i=i.memoCache)&&(t={data:i.data.map((function(e){return e.slice()})),index:0})}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},Zr.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),i=0;i<e;i++)n[i]=w;return t.index++,n}function xs(e,t){return"function"==typeof t?t(e):t}function _s(e){return ws(gs(),Kr,e)}function ws(e,t,n){var i=e.queue;if(null===i)throw Error(a(311));i.lastRenderedReducer=n;var r=e.baseQueue,s=i.pending;if(null!==s){if(null!==r){var o=r.next;r.next=s.next,s.next=o}t.baseQueue=r=s,i.pending=null}if(s=e.baseState,null===r)e.memoizedState=s;else{var l=o=null,c=null,u=t=r.next,h=!1;do{var d=-536870913&u.lane;if(d!==u.lane?(ec&d)===d:($r&d)===d){var p=u.revertLane;if(0===p)null!==c&&(c=c.next={lane:0,revertLane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),d===Vr&&(h=!0);else{if(($r&p)===p){u=u.next,p===Vr&&(h=!0);continue}d={lane:0,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=d,o=s):c=c.next=d,Zr.lanes|=p,ac|=p}d=u.action,ts&&n(s,d),s=u.hasEagerState?u.eagerState:n(s,d)}else p={lane:d,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=p,o=s):c=c.next=p,Zr.lanes|=d,ac|=d;u=u.next}while(null!==u&&u!==t);if(null===c?o=s:c.next=l,!Wn(s,e.memoizedState)&&(La=!0,h&&null!==(n=jr)))throw n;e.memoizedState=s,e.baseState=o,e.baseQueue=c,i.lastRenderedState=s}return null===r&&(i.lanes=0),[e.memoizedState,i.dispatch]}function Ss(e){var t=gs(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,s=t.memoizedState;if(null!==r){n.pending=null;var o=r=r.next;do{s=e(s,o.action),o=o.next}while(o!==r);Wn(s,t.memoizedState)||(La=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,i]}function Ms(e,t,n){var i=Zr,r=gs(),s=qi;if(s){if(void 0===n)throw Error(a(407));n=n()}else n=t();var o=!Wn((Kr||r).memoizedState,n);if(o&&(r.memoizedState=n,La=!0),r=r.queue,$s(As.bind(null,i,r,e),[e]),r.getSnapshot!==t||o||null!==Jr&&1&Jr.memoizedState.tag){if(i.flags|=2048,Gs(9,Ts.bind(null,i,r,n,t),{destroy:void 0},null),null===Jl)throw Error(a(349));s||60&$r||Es(i,t,n)}return n}function Es(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=Zr.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},Zr.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ts(e,t,n,i){t.value=n,t.getSnapshot=i,Cs(t)&&Rs(e)}function As(e,t,n){return n((function(){Cs(t)&&Rs(e)}))}function Cs(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Wn(e,n)}catch(e){return!0}}function Rs(e){var t=Ti(e,2);null!==t&&Ac(t,0,2)}function Ps(e){var t=ms();if("function"==typeof e){var n=e;e=n(),ts&&(ve(!0),n(),ve(!1))}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:xs,lastRenderedState:e},t}function ks(e,t,n,i){return e.baseState=n,ws(e,Kr,"function"==typeof i?i:xs)}function Is(e,t,n,i,r){if(va(e))throw Error(a(485));if(null!==(e=t.action)){var s={payload:r,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){s.listeners.push(e)}};null!==T.T?n(!0):s.isTransition=!1,i(s),null===(n=t.pending)?(s.next=t.pending=s,Os(t,s)):(s.next=n.next,t.pending=n.next=s)}}function Os(e,t){var n=t.action,i=t.payload,r=e.state;if(t.isTransition){var s=T.T,a={};T.T=a;try{var o=n(r,i),l=T.S;null!==l&&l(a,o),Ls(e,t,o)}catch(n){Ds(e,t,n)}finally{T.T=s}}else try{Ls(e,t,s=n(r,i))}catch(n){Ds(e,t,n)}}function Ls(e,t,n){null!==n&&"object"==typeof n&&"function"==typeof n.then?n.then((function(n){Ns(e,t,n)}),(function(n){return Ds(e,t,n)})):Ns(e,t,n)}function Ns(e,t,n){t.status="fulfilled",t.value=n,zs(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,Os(e,n)))}function Ds(e,t,n){var i=e.pending;if(e.pending=null,null!==i){i=i.next;do{t.status="rejected",t.reason=n,zs(t),t=t.next}while(t!==i)}e.action=null}function zs(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Us(e,t){return t}function Fs(e,t){if(qi){var n=Jl.formState;if(null!==n){e:{var i=Zr;if(qi){if(Xi){t:{for(var r=Xi,s=$i;8!==r.nodeType;){if(!s){r=null;break t}if(null===(r=sh(r.nextSibling))){r=null;break t}}r="F!"===(s=r.data)||"F"===s?r:null}if(r){Xi=sh(r.nextSibling),i="F!"===r.data;break e}}Ki(i)}i=!1}i&&(t=n[0])}}return(n=ms()).memoizedState=n.baseState=t,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Us,lastRenderedState:t},n.queue=i,n=ma.bind(null,Zr,i),i.dispatch=n,i=Ps(!1),s=ga.bind(null,Zr,!1,i.queue),r={state:t,dispatch:null,action:e,pending:null},(i=ms()).queue=r,n=Is.bind(null,Zr,r,s,n),r.dispatch=n,i.memoizedState=e,[t,n,!1]}function Bs(e){return Vs(gs(),Kr,e)}function Vs(e,t,n){t=ws(e,t,Us)[0],e=_s(xs)[0],t="object"==typeof t&&null!==t&&"function"==typeof t.then?vs(t):t;var i=gs(),r=i.queue,s=r.dispatch;return n!==i.memoizedState&&(Zr.flags|=2048,Gs(9,js.bind(null,r,n),{destroy:void 0},null)),[t,s,e]}function js(e,t){e.action=t}function Hs(e){var t=gs(),n=Kr;if(null!==n)return Vs(t,n,e);gs(),t=t.memoizedState;var i=(n=gs()).queue.dispatch;return n.memoizedState=e,[t,i,!1]}function Gs(e,t,n,i){return e={tag:e,create:t,inst:n,deps:i,next:null},null===(t=Zr.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},Zr.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Ws(){return gs().memoizedState}function Xs(e,t,n,i){var r=ms();Zr.flags|=e,r.memoizedState=Gs(1|t,n,{destroy:void 0},void 0===i?null:i)}function qs(e,t,n,i){var r=gs();i=void 0===i?null:i;var s=r.memoizedState.inst;null!==Kr&&null!==i&&os(i,Kr.memoizedState.deps)?r.memoizedState=Gs(t,n,s,i):(Zr.flags|=e,r.memoizedState=Gs(1|t,n,s,i))}function Ys(e,t){Xs(8390656,8,e,t)}function $s(e,t){qs(2048,8,e,t)}function Zs(e,t){return qs(4,2,e,t)}function Ks(e,t){return qs(4,4,e,t)}function Js(e,t){if("function"==typeof t){e=e();var n=t(e);return function(){"function"==typeof n?n():t(null)}}if(null!=t)return e=e(),t.current=e,function(){t.current=null}}function Qs(e,t,n){n=null!=n?n.concat([e]):null,qs(4,4,Js.bind(null,t,e),n)}function ea(){}function ta(e,t){var n=gs();t=void 0===t?null:t;var i=n.memoizedState;return null!==t&&os(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function na(e,t){var n=gs();t=void 0===t?null:t;var i=n.memoizedState;return null!==t&&os(t,i[1])?i[0]:(i=e(),ts&&(ve(!0),e(),ve(!1)),n.memoizedState=[i,t],i)}function ia(e,t,n){return void 0===n||1073741824&$r?e.memoizedState=t:(e.memoizedState=n,e=Tc(),Zr.lanes|=e,ac|=e,n)}function ra(e,t,n,i){return Wn(n,t)?n:null!==xr.current?(e=ia(e,n,i),Wn(e,t)||(La=!0),e):42&$r?(e=Tc(),Zr.lanes|=e,ac|=e,t):(La=!0,e.memoizedState=n)}function sa(e,t,n,i,r){var s=F.p;F.p=0!==s&&8>s?s:8;var a,o,l,c=T.T,u={};T.T=u,ga(e,!1,t,n);try{var h=r(),d=T.S;if(null!==d&&d(u,h),null!==h&&"object"==typeof h&&"function"==typeof h.then){var p=(a=i,o=[],l={status:"pending",value:null,reason:null,then:function(e){o.push(e)}},h.then((function(){l.status="fulfilled",l.value=a;for(var e=0;e<o.length;e++)(0,o[e])(a)}),(function(e){for(l.status="rejected",l.reason=e,e=0;e<o.length;e++)(0,o[e])(void 0)})),l);ma(e,t,p)}else ma(e,t,i)}catch(n){ma(e,t,{then:function(){},status:"rejected",reason:n})}finally{F.p=s,T.T=c}}function aa(){}function oa(e,t,n,i){if(5!==e.tag)throw Error(a(476));var r=la(e).queue;sa(e,r,t,B,null===n?aa:function(){return ca(e),n(i)})}function la(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:B,baseState:B,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xs,lastRenderedState:B},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xs,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function ca(e){ma(e,la(e).next.queue,{})}function ua(){var e=mo(Z);return null!==e?e:B}function ha(){return gs().memoizedState}function da(){return gs().memoizedState}function pa(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Ec(),i=wo(t,e=_o(n),n);return null!==i&&(Ac(i,0,n),So(i,t,n)),t={cache:zr()},void(e.payload=t)}t=t.return}}function fa(e,t,n){var i=Ec();n={lane:i,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},va(e)?ya(t,n):null!==(n=Ei(e,t,n,i))&&(Ac(n,0,i),ba(n,t,i))}function ma(e,t,n){var i=Ec(),r={lane:i,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(va(e))ya(t,r);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=s(a,n);if(r.hasEagerState=!0,r.eagerState=o,Wn(o,a))return Mi(e,t,r,0),void(null===Jl&&Si())}catch(e){}null!==(n=Ei(e,t,r,i))&&(Ac(n,0,i),ba(n,t,i))}}function ga(e,t,n,i){if(i={lane:2,revertLane:yu(),action:i,hasEagerState:!1,eagerState:null,next:null},va(e)){if(t)throw Error(a(479))}else null!==(t=Ei(e,n,i,2))&&Ac(t,0,2)}function va(e){var t=e.alternate;return e===Zr||null!==t&&t===Zr}function ya(e,t){es=Qr=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function ba(e,t,n){if(4194176&n){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,ke(e,n)}}var xa={readContext:mo,use:ys,useCallback:as,useContext:as,useEffect:as,useImperativeHandle:as,useLayoutEffect:as,useInsertionEffect:as,useMemo:as,useReducer:as,useRef:as,useState:as,useDebugValue:as,useDeferredValue:as,useTransition:as,useSyncExternalStore:as,useId:as};xa.useCacheRefresh=as,xa.useMemoCache=as,xa.useHostTransitionStatus=as,xa.useFormState=as,xa.useActionState=as,xa.useOptimistic=as;var _a={readContext:mo,use:ys,useCallback:function(e,t){return ms().memoizedState=[e,void 0===t?null:t],e},useContext:mo,useEffect:Ys,useImperativeHandle:function(e,t,n){n=null!=n?n.concat([e]):null,Xs(4194308,4,Js.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Xs(4194308,4,e,t)},useInsertionEffect:function(e,t){Xs(4,2,e,t)},useMemo:function(e,t){var n=ms();t=void 0===t?null:t;var i=e();return ts&&(ve(!0),e(),ve(!1)),n.memoizedState=[i,t],i},useReducer:function(e,t,n){var i=ms();if(void 0!==n){var r=n(t);ts&&(ve(!0),n(t),ve(!1))}else r=t;return i.memoizedState=i.baseState=r,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:r},i.queue=e,e=e.dispatch=fa.bind(null,Zr,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},ms().memoizedState=e},useState:function(e){var t=(e=Ps(e)).queue,n=ma.bind(null,Zr,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:ea,useDeferredValue:function(e,t){return ia(ms(),e,t)},useTransition:function(){var e=Ps(!1);return e=sa.bind(null,Zr,e.queue,!0,!1),ms().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var i=Zr,r=ms();if(qi){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Jl)throw Error(a(349));60&ec||Es(i,t,n)}r.memoizedState=n;var s={value:n,getSnapshot:t};return r.queue=s,Ys(As.bind(null,i,s,e),[e]),i.flags|=2048,Gs(9,Ts.bind(null,i,s,n,t),{destroy:void 0},null),n},useId:function(){var e=ms(),t=Jl.identifierPrefix;if(qi){var n=Bi;t=":"+t+"R"+(n=(Fi&~(1<<32-ye(Fi)-1)).toString(32)+n),0<(n=ns++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ss++).toString(32)+":";return e.memoizedState=t},useCacheRefresh:function(){return ms().memoizedState=pa.bind(null,Zr)}};_a.useMemoCache=bs,_a.useHostTransitionStatus=ua,_a.useFormState=Fs,_a.useActionState=Fs,_a.useOptimistic=function(e){var t=ms();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=ga.bind(null,Zr,!0,n),n.dispatch=t,[e,t]};var wa={readContext:mo,use:ys,useCallback:ta,useContext:mo,useEffect:$s,useImperativeHandle:Qs,useInsertionEffect:Zs,useLayoutEffect:Ks,useMemo:na,useReducer:_s,useRef:Ws,useState:function(){return _s(xs)},useDebugValue:ea,useDeferredValue:function(e,t){return ra(gs(),Kr.memoizedState,e,t)},useTransition:function(){var e=_s(xs)[0],t=gs().memoizedState;return["boolean"==typeof e?e:vs(e),t]},useSyncExternalStore:Ms,useId:ha};wa.useCacheRefresh=da,wa.useMemoCache=bs,wa.useHostTransitionStatus=ua,wa.useFormState=Bs,wa.useActionState=Bs,wa.useOptimistic=function(e,t){return ks(gs(),0,e,t)};var Sa={readContext:mo,use:ys,useCallback:ta,useContext:mo,useEffect:$s,useImperativeHandle:Qs,useInsertionEffect:Zs,useLayoutEffect:Ks,useMemo:na,useReducer:Ss,useRef:Ws,useState:function(){return Ss(xs)},useDebugValue:ea,useDeferredValue:function(e,t){var n=gs();return null===Kr?ia(n,e,t):ra(n,Kr.memoizedState,e,t)},useTransition:function(){var e=Ss(xs)[0],t=gs().memoizedState;return["boolean"==typeof e?e:vs(e),t]},useSyncExternalStore:Ms,useId:ha};Sa.useCacheRefresh=da,Sa.useMemoCache=bs,Sa.useHostTransitionStatus=ua,Sa.useFormState=Hs,Sa.useActionState=Hs,Sa.useOptimistic=function(e,t){var n=gs();return null!==Kr?ks(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])};var Ma="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function Ea(e){Ma(e)}function Ta(e){console.error(e)}function Aa(e){Ma(e)}function Ca(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(e){setTimeout((function(){throw e}))}}function Ra(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(e){setTimeout((function(){throw e}))}}function Pa(e,t,n){return(n=_o(n)).tag=3,n.payload={element:null},n.callback=function(){Ca(e,t)},n}function ka(e){return(e=_o(e)).tag=3,e}function Ia(e,t,n,i){var r=n.type.getDerivedStateFromError;if("function"==typeof r){var s=i.value;e.payload=function(){return r(s)},e.callback=function(){Ra(t,n,i)}}var a=n.stateNode;null!==a&&"function"==typeof a.componentDidCatch&&(e.callback=function(){Ra(t,n,i),"function"!=typeof r&&(null===vc?vc=new Set([this]):vc.add(this));var e=i.stack;this.componentDidCatch(i.value,{componentStack:null!==e?e:""})})}var Oa=Error(a(461)),La=!1;function Na(e,t,n,i){t.child=null===e?br(t,null,n,i):yr(t,e.child,n,i)}function Da(e,t,n,i,r){n=n.render;var s=t.ref;if("ref"in i){var a={};for(var o in i)"ref"!==o&&(a[o]=i[o])}else a=i;return fo(t,r),i=ls(e,t,n,a,s,r),o=ds(),null===e||La?(qi&&o&&Hi(t),t.flags|=1,Na(e,t,i,r),t.child):(ps(e,t,r),no(e,t,r))}function za(e,t,n,i,r){if(null===e){var s=n.type;return"function"!=typeof s||Ol(s)||void 0!==s.defaultProps||null!==n.compare?((e=Dl(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,Ua(e,t,s,i,r))}if(s=e.child,!(e.lanes&r)){var a=s.memoizedProps;if((n=null!==(n=n.compare)?n:Xn)(a,i)&&e.ref===t.ref)return no(e,t,r)}return t.flags|=1,(e=Ll(s,i)).ref=t.ref,e.return=t,t.child=e}function Ua(e,t,n,i,r){if(null!==e){var s=e.memoizedProps;if(Xn(s,i)&&e.ref===t.ref){if(La=!1,t.pendingProps=i=s,!(e.lanes&r))return t.lanes=e.lanes,no(e,t,r);131072&e.flags&&(La=!0)}}return ja(e,t,n,i,r)}function Fa(e,t,n){var i=t.pendingProps,r=i.children,s=!!(2&t.stateNode._pendingVisibility),a=null!==e?e.memoizedState:null;if(Va(e,t),"hidden"===i.mode||s){if(128&t.flags){if(n=null!==a?a.baseLanes|n:n,null!==e){for(i=t.child=e.child,r=0;null!==i;)r=r|i.lanes|i.childLanes,i=i.sibling;t.childLanes=r&~n}else t.childLanes=0,t.child=null;return Ba(e,t,n)}if(!(536870912&n))return t.lanes=t.childLanes=536870912,Ba(e,t,null!==a?a.baseLanes|n:n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&qr(0,null!==a?a.cachePool:null),null!==a?wr(t,a):Sr(),Cr(t)}else null!==a?(qr(0,a.cachePool),wr(t,a),Rr(),t.memoizedState=null):(null!==e&&qr(0,null),Sr(),Rr());return Na(e,t,r,n),t.child}function Ba(e,t,n){var i=Xr();return i=null===i?null:{parent:Dr._currentValue,pool:i},t.memoizedState={baseLanes:n,cachePool:i},null!==e&&qr(0,null),Sr(),Cr(t),null}function Va(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=2097664);else{if("function"!=typeof n&&"object"!=typeof n)throw Error(a(284));null!==e&&e.ref===n||(t.flags|=2097664)}}function ja(e,t,n,i,r){return fo(t,r),n=ls(e,t,n,i,void 0,r),i=ds(),null===e||La?(qi&&i&&Hi(t),t.flags|=1,Na(e,t,n,r),t.child):(ps(e,t,r),no(e,t,r))}function Ha(e,t,n,i,r,s){return fo(t,s),n=us(t,i,n,r),cs(),i=ds(),null===e||La?(qi&&i&&Hi(t),t.flags|=1,Na(e,t,n,s),t.child):(ps(e,t,s),no(e,t,s))}function Ga(e,t,n,i,r){if(fo(t,r),null===t.stateNode){var s=Ri,a=n.contextType;"object"==typeof a&&null!==a&&(s=mo(a)),s=new n(i,s),t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,s.updater=ko,t.stateNode=s,s._reactInternals=t,(s=t.stateNode).props=i,s.state=t.memoizedState,s.refs={},bo(t),a=n.contextType,s.context="object"==typeof a&&null!==a?mo(a):Ri,s.state=t.memoizedState,"function"==typeof(a=n.getDerivedStateFromProps)&&(Po(t,n,a,i),s.state=t.memoizedState),"function"==typeof n.getDerivedStateFromProps||"function"==typeof s.getSnapshotBeforeUpdate||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||(a=s.state,"function"==typeof s.componentWillMount&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount(),a!==s.state&&ko.enqueueReplaceState(s,s.state,null),Ao(t,i,s,r),To(),s.state=t.memoizedState),"function"==typeof s.componentDidMount&&(t.flags|=4194308),i=!0}else if(null===e){s=t.stateNode;var o=t.memoizedProps,l=Lo(n,o);s.props=l;var c=s.context,u=n.contextType;a=Ri,"object"==typeof u&&null!==u&&(a=mo(u));var h=n.getDerivedStateFromProps;u="function"==typeof h||"function"==typeof s.getSnapshotBeforeUpdate,o=t.pendingProps!==o,u||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(o||c!==a)&&Oo(t,s,i,a),yo=!1;var d=t.memoizedState;s.state=d,Ao(t,i,s,r),To(),c=t.memoizedState,o||d!==c||yo?("function"==typeof h&&(Po(t,n,h,i),c=t.memoizedState),(l=yo||Io(t,n,l,i,d,c,a))?(u||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||("function"==typeof s.componentWillMount&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"==typeof s.componentDidMount&&(t.flags|=4194308)):("function"==typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=c),s.props=i,s.state=c,s.context=a,i=l):("function"==typeof s.componentDidMount&&(t.flags|=4194308),i=!1)}else{s=t.stateNode,xo(e,t),u=Lo(n,a=t.memoizedProps),s.props=u,h=t.pendingProps,d=s.context,c=n.contextType,l=Ri,"object"==typeof c&&null!==c&&(l=mo(c)),(c="function"==typeof(o=n.getDerivedStateFromProps)||"function"==typeof s.getSnapshotBeforeUpdate)||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(a!==h||d!==l)&&Oo(t,s,i,l),yo=!1,d=t.memoizedState,s.state=d,Ao(t,i,s,r),To();var p=t.memoizedState;a!==h||d!==p||yo?("function"==typeof o&&(Po(t,n,o,i),p=t.memoizedState),(u=yo||Io(t,n,u,i,d,p,l)||!1)?(c||"function"!=typeof s.UNSAFE_componentWillUpdate&&"function"!=typeof s.componentWillUpdate||("function"==typeof s.componentWillUpdate&&s.componentWillUpdate(i,p,l),"function"==typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(i,p,l)),"function"==typeof s.componentDidUpdate&&(t.flags|=4),"function"==typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof s.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=p),s.props=i,s.state=p,s.context=l,i=u):("function"!=typeof s.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),i=!1)}return s=i,Va(e,t),i=!!(128&t.flags),s||i?(s=t.stateNode,n=i&&"function"!=typeof n.getDerivedStateFromError?null:s.render(),t.flags|=1,null!==e&&i?(t.child=yr(t,e.child,null,r),t.child=yr(t,null,n,r)):Na(e,t,n,r),t.memoizedState=s.state,e=t.child):e=no(e,t,r),e}function Wa(e,t,n,i){return tr(),t.flags|=256,Na(e,t,n,i),t.child}var Xa={dehydrated:null,treeContext:null,retryLane:0};function qa(e){return{baseLanes:e,cachePool:Yr()}}function Ya(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=cc),e}function $a(e,t,n){var i,r=t.pendingProps,s=!1,o=!!(128&t.flags);if((i=o)||(i=(null===e||null!==e.memoizedState)&&!!(2&kr.current)),i&&(s=!0,t.flags&=-129),i=!!(32&t.flags),t.flags&=-33,null===e){if(qi){if(s?Ar(t):Rr(),qi){var l,c=Xi;if(l=c){e:{for(l=c,c=$i;8!==l.nodeType;){if(!c){c=null;break e}if(null===(l=sh(l.nextSibling))){c=null;break e}}c=l}null!==c?(t.memoizedState={dehydrated:c,treeContext:null!==Ui?{id:Fi,overflow:Bi}:null,retryLane:536870912},(l=Il(18,null,null,0)).stateNode=c,l.return=t,t.child=l,Wi=t,Xi=null,l=!0):l=!1}l||Ki(t)}if(null!==(c=t.memoizedState)&&null!==(c=c.dehydrated))return"$!"===c.data?t.lanes=16:t.lanes=536870912,null;Pr(t)}return c=r.children,r=r.fallback,s?(Rr(),c=Ka({mode:"hidden",children:c},s=t.mode),r=zl(r,s,n,null),c.return=t,r.return=t,c.sibling=r,t.child=c,(s=t.child).memoizedState=qa(n),s.childLanes=Ya(e,i,n),t.memoizedState=Xa,r):(Ar(t),Za(t,c))}if(null!==(l=e.memoizedState)&&null!==(c=l.dehydrated)){if(o)256&t.flags?(Ar(t),t.flags&=-257,t=Ja(e,t,n)):null!==t.memoizedState?(Rr(),t.child=e.child,t.flags|=128,t=null):(Rr(),s=r.fallback,c=t.mode,r=Ka({mode:"visible",children:r.children},c),(s=zl(s,c,n,null)).flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,yr(t,e.child,null,n),(r=t.child).memoizedState=qa(n),r.childLanes=Ya(e,i,n),t.memoizedState=Xa,t=s);else if(Ar(t),"$!"===c.data){if(i=c.nextSibling&&c.nextSibling.dataset)var u=i.dgst;i=u,(r=Error(a(419))).stack="",r.digest=i,nr({value:r,source:null,stack:null}),t=Ja(e,t,n)}else if(i=!!(n&e.childLanes),La||i){if(null!==(i=Jl)){if(42&(r=n&-n))r=1;else switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=64;break;case 268435456:r=134217728;break;default:r=0}if(0!==(r=r&(i.suspendedLanes|n)?0:r)&&r!==l.retryLane)throw l.retryLane=r,Ti(e,r),Ac(i,0,r),Oa}"$?"===c.data||Hc(),t=Ja(e,t,n)}else"$?"===c.data?(t.flags|=128,t.child=e.child,t=su.bind(null,e),c._reactRetry=t,t=null):(e=l.treeContext,Xi=sh(c.nextSibling),Wi=t,qi=!0,Yi=null,$i=!1,null!==e&&(Di[zi++]=Fi,Di[zi++]=Bi,Di[zi++]=Ui,Fi=e.id,Bi=e.overflow,Ui=t),(t=Za(t,r.children)).flags|=4096);return t}return s?(Rr(),s=r.fallback,c=t.mode,u=(l=e.child).sibling,(r=Ll(l,{mode:"hidden",children:r.children})).subtreeFlags=31457280&l.subtreeFlags,null!==u?s=Ll(u,s):(s=zl(s,c,n,null)).flags|=2,s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,null===(c=e.child.memoizedState)?c=qa(n):(null!==(l=c.cachePool)?(u=Dr._currentValue,l=l.parent!==u?{parent:u,pool:u}:l):l=Yr(),c={baseLanes:c.baseLanes|n,cachePool:l}),s.memoizedState=c,s.childLanes=Ya(e,i,n),t.memoizedState=Xa,r):(Ar(t),e=(n=e.child).sibling,(n=Ll(n,{mode:"visible",children:r.children})).return=t,n.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=n,t.memoizedState=null,n)}function Za(e,t){return(t=Ka({mode:"visible",children:t},e.mode)).return=e,e.child=t}function Ka(e,t){return Ul(e,t,0,null)}function Ja(e,t,n){return yr(t,e.child,null,n),(e=Za(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Qa(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),ho(e.return,t,n)}function eo(e,t,n,i,r){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function to(e,t,n){var i=t.pendingProps,r=i.revealOrder,s=i.tail;if(Na(e,t,i.children,n),2&(i=kr.current))i=1&i|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Qa(e,n,t);else if(19===e.tag)Qa(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}switch(W(kr,i),r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===Ir(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),eo(t,!1,r,n,s);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===Ir(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}eo(t,!0,n,null,s);break;case"together":eo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function no(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),ac|=t.lanes,!(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Ll(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Ll(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function io(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)La=!0;else{if(!(e.lanes&n||128&t.flags))return La=!1,function(e,t,n){switch(t.tag){case 3:K(t,t.stateNode.containerInfo),co(0,Dr,e.memoizedState.cache),tr();break;case 27:case 5:Q(t);break;case 4:K(t,t.stateNode.containerInfo);break;case 10:co(0,t.type,t.memoizedProps.value);break;case 13:var i=t.memoizedState;if(null!==i)return null!==i.dehydrated?(Ar(t),t.flags|=128,null):n&t.child.childLanes?$a(e,t,n):(Ar(t),null!==(e=no(e,t,n))?e.sibling:null);Ar(t);break;case 19:if(i=!!(n&t.childLanes),128&e.flags){if(i)return to(e,t,n);t.flags|=128}var r=t.memoizedState;if(null!==r&&(r.rendering=null,r.tail=null,r.lastEffect=null),W(kr,kr.current),i)break;return null;case 22:case 23:return t.lanes=0,Fa(e,t,n);case 24:co(0,Dr,e.memoizedState.cache)}return no(e,t,n)}(e,t,n);La=!!(131072&e.flags)}else La=!1,qi&&1048576&t.flags&&ji(t,Ni,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var i=t.elementType,r=i._init;if(i=r(i._payload),t.type=i,"function"!=typeof i){if(null!=i){if((r=i.$$typeof)===g){t.tag=11,t=Da(null,t,i,e,n);break e}if(r===b){t.tag=14,t=za(null,t,i,e,n);break e}}throw Error(a(306,i,""))}Ol(i)?(e=Lo(i,e),t.tag=1,t=Ga(null,t,i,e,n)):(t.tag=0,t=ja(null,t,i,e,n))}return t;case 0:return ja(e,t,t.type,t.pendingProps,n);case 1:return Ga(e,t,i=t.type,r=Lo(i,t.pendingProps),n);case 3:e:{if(K(t,t.stateNode.containerInfo),null===e)throw Error(a(387));var s=t.pendingProps;i=(r=t.memoizedState).element,xo(e,t),Ao(t,s,null,n);var o=t.memoizedState;if(s=o.cache,co(0,Dr,s),s!==r.cache&&po(t,Dr,n),To(),s=o.element,r.isDehydrated){if(r={element:s,isDehydrated:!1,cache:o.cache},t.updateQueue.baseState=r,t.memoizedState=r,256&t.flags){t=Wa(e,t,s,n);break e}if(s!==i){nr(i=ki(Error(a(424)),t)),t=Wa(e,t,s,n);break e}for(Xi=sh(t.stateNode.containerInfo.firstChild),Wi=t,qi=!0,Yi=null,$i=!0,n=br(t,null,s,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(tr(),s===i){t=no(e,t,n);break e}Na(e,t,s,n)}t=t.child}return t;case 26:return Va(e,t),null===e?(n=fh(t.type,null,t.pendingProps,null))?t.memoizedState=n:qi||(n=t.type,e=t.pendingProps,(i=qu(Y.current).createElement(n))[Ne]=t,i[De]=e,Hu(i,n,e),Ye(i),t.stateNode=i):t.memoizedState=fh(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return Q(t),null===e&&qi&&(i=t.stateNode=oh(t.type,t.pendingProps,Y.current),Wi=t,$i=!0,Xi=sh(i.firstChild)),i=t.pendingProps.children,null!==e||qi?Na(e,t,i,n):t.child=yr(t,null,i,n),Va(e,t),t.child;case 5:return null===e&&qi&&((r=i=Xi)&&(i=function(e,t,n,i){for(;1===e.nodeType;){var r=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!i&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(i){if(!e[je])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(s=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(s!==r.rel||e.getAttribute("href")!==(null==r.href?null:r.href)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin)||e.getAttribute("title")!==(null==r.title?null:r.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((s=e.getAttribute("src"))!==(null==r.src?null:r.src)||e.getAttribute("type")!==(null==r.type?null:r.type)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin))&&s&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var s=null==r.name?null:""+r.name;if("hidden"===r.type&&e.getAttribute("name")===s)return e}if(null===(e=sh(e.nextSibling)))break}return null}(i,t.type,t.pendingProps,$i),null!==i?(t.stateNode=i,Wi=t,Xi=sh(i.firstChild),$i=!1,r=!0):r=!1),r||Ki(t)),Q(t),r=t.type,s=t.pendingProps,o=null!==e?e.memoizedProps:null,i=s.children,Zu(r,s)?i=null:null!==o&&Zu(r,o)&&(t.flags|=32),null!==t.memoizedState&&(r=ls(e,t,hs,null,null,n),Z._currentValue=r,La&&null!==e&&e.memoizedState.memoizedState!==r&&po(t,Z,n)),Va(e,t),Na(e,t,i,n),t.child;case 6:return null===e&&qi&&((e=n=Xi)&&(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=sh(e.nextSibling)))return null}return e}(n,t.pendingProps,$i),null!==n?(t.stateNode=n,Wi=t,Xi=null,e=!0):e=!1),e||Ki(t)),null;case 13:return $a(e,t,n);case 4:return K(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=yr(t,null,i,n):Na(e,t,i,n),t.child;case 11:return Da(e,t,t.type,t.pendingProps,n);case 7:return Na(e,t,t.pendingProps,n),t.child;case 8:case 12:return Na(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type,r=t.pendingProps,s=t.memoizedProps,co(0,i,o=r.value),null!==s)if(Wn(s.value,o)){if(s.children===r.children){t=no(e,t,n);break e}}else po(t,i,n);Na(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type._context,i=t.pendingProps.children,fo(t,n),i=i(r=mo(r)),t.flags|=1,Na(e,t,i,n),t.child;case 14:return za(e,t,t.type,t.pendingProps,n);case 15:return Ua(e,t,t.type,t.pendingProps,n);case 19:return to(e,t,n);case 22:return Fa(e,t,n);case 24:return fo(t,n),i=mo(Dr),null===e?(null===(r=Xr())&&(r=Jl,s=zr(),r.pooledCache=s,s.refCount++,null!==s&&(r.pooledCacheLanes|=n),r=s),t.memoizedState={parent:i,cache:r},bo(t),co(0,Dr,r)):(!!(e.lanes&n)&&(xo(e,t),Ao(t,null,null,n),To()),r=e.memoizedState,s=t.memoizedState,r.parent!==i?(r={parent:i,cache:i},t.memoizedState=r,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=r),co(0,Dr,i)):(i=s.cache,co(0,Dr,i),i!==r.cache&&po(t,Dr,n))),Na(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(a(156,t.tag))}var ro=H(null),so=null,ao=null,oo=null;function lo(){oo=ao=so=null}function co(e,t,n){W(ro,t._currentValue),t._currentValue=n}function uo(e){e._currentValue=ro.current,G(ro)}function ho(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function po(e,t,n){var i=e.child;for(null!==i&&(i.return=e);null!==i;){var r=i.dependencies;if(null!==r)for(var s=i.child,o=r.firstContext;null!==o;){if(o.context===t){if(1===i.tag){(o=_o(n&-n)).tag=2;var l=i.updateQueue;if(null!==l){var c=(l=l.shared).pending;null===c?o.next=o:(o.next=c.next,c.next=o),l.pending=o}}i.lanes|=n,null!==(o=i.alternate)&&(o.lanes|=n),ho(i.return,n,e),r.lanes|=n;break}o=o.next}else if(10===i.tag)s=i.type===e.type?null:i.child;else if(18===i.tag){if(null===(s=i.return))throw Error(a(341));s.lanes|=n,null!==(r=s.alternate)&&(r.lanes|=n),ho(s,n,e),s=i.sibling}else s=i.child;if(null!==s)s.return=i;else for(s=i;null!==s;){if(s===e){s=null;break}if(null!==(i=s.sibling)){i.return=s.return,s=i;break}s=s.return}i=s}}function fo(e,t){so=e,oo=ao=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(!!(e.lanes&t)&&(La=!0),e.firstContext=null)}function mo(e){return vo(so,e)}function go(e,t,n){return null===so&&fo(e,n),vo(e,t)}function vo(e,t){var n=t._currentValue;if(oo!==t)if(t={context:t,memoizedValue:n,next:null},null===ao){if(null===e)throw Error(a(308));ao=t,e.dependencies={lanes:0,firstContext:t}}else ao=ao.next=t;return n}var yo=!1;function bo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function xo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function _o(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function wo(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,2&Kl){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,t=Ci(e),Ai(e,null,n),t}return Mi(e,i,t,n),Ci(e)}function So(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194176&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,ke(e,n)}}function Mo(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var a={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===s?r=s=a:s=s.next=a,n=n.next}while(null!==n);null===s?r=s=t:s=s.next=t}else r=s=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,callbacks:i.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var Eo=!1;function To(){if(Eo&&null!==jr)throw jr}function Ao(e,t,n,i){Eo=!1;var r=e.updateQueue;yo=!1;var s=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(null!==o){r.shared.pending=null;var l=o,c=l.next;l.next=null,null===a?s=c:a.next=c,a=l;var u=e.alternate;null!==u&&(o=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l)}if(null!==s){var h=r.baseState;for(a=0,u=c=l=null,o=s;;){var d=-536870913&o.lane,p=d!==o.lane;if(p?(ec&d)===d:(i&d)===d){0!==d&&d===Vr&&(Eo=!0),null!==u&&(u=u.next={lane:0,tag:o.tag,payload:o.payload,callback:null,next:null});e:{var f=e,m=o;d=t;var g=n;switch(m.tag){case 1:if("function"==typeof(f=m.payload)){h=f.call(g,h,d);break e}h=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(d="function"==typeof(f=m.payload)?f.call(g,h,d):f))break e;h=A({},h,d);break e;case 2:yo=!0}}null!==(d=o.callback)&&(e.flags|=64,p&&(e.flags|=8192),null===(p=r.callbacks)?r.callbacks=[d]:p.push(d))}else p={lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=p,l=h):u=u.next=p,a|=d;if(null===(o=o.next)){if(null===(o=r.shared.pending))break;o=(p=o).next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}null===u&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null===s&&(r.shared.lanes=0),ac|=a,e.lanes=a,e.memoizedState=h}}function Co(e,t){if("function"!=typeof e)throw Error(a(191,e));e.call(t)}function Ro(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)Co(n[e],t)}function Po(e,t,n,i){n=null==(n=n(i,t=e.memoizedState))?t:A({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ko={isMounted:function(e){return!!(e=e._reactInternals)&&O(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=Ec(),r=_o(i);r.payload=t,null!=n&&(r.callback=n),null!==(t=wo(e,r,i))&&(Ac(t,0,i),So(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=Ec(),r=_o(i);r.tag=1,r.payload=t,null!=n&&(r.callback=n),null!==(t=wo(e,r,i))&&(Ac(t,0,i),So(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Ec(),i=_o(n);i.tag=2,null!=t&&(i.callback=t),null!==(t=wo(e,i,n))&&(Ac(t,0,n),So(t,e,n))}};function Io(e,t,n,i,r,s,a){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,s,a):!(t.prototype&&t.prototype.isPureReactComponent&&Xn(n,i)&&Xn(r,s))}function Oo(e,t,n,i){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&ko.enqueueReplaceState(t,t.state,null)}function Lo(e,t){var n=t;if("ref"in t)for(var i in n={},t)"ref"!==i&&(n[i]=t[i]);if(e=e.defaultProps)for(var r in n===t&&(n=A({},n)),e)void 0===n[r]&&(n[r]=e[r]);return n}var No=!1,Do=!1,zo=!1,Uo="function"==typeof WeakSet?WeakSet:Set,Fo=null;function Bo(e,t){t.props=Lo(e.type,e.memoizedProps),t.state=e.memoizedState,t.componentWillUnmount()}function Vo(e,t){try{var n=e.ref;if(null!==n){var i=e.stateNode;switch(e.tag){case 26:case 27:case 5:var r=i;break;default:r=i}"function"==typeof n?e.refCleanup=n(r):n.current=r}}catch(n){tu(e,t,n)}}function jo(e,t){var n=e.ref,i=e.refCleanup;if(null!==n)if("function"==typeof i)try{i()}catch(n){tu(e,t,n)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"==typeof n)try{n(null)}catch(n){tu(e,t,n)}else n.current=null}function Ho(e,t,n){try{n()}catch(n){tu(e,t,n)}}var Go=!1;function Wo(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var s=r.inst,a=s.destroy;void 0!==a&&(s.destroy=void 0,Ho(t,n,a))}r=r.next}while(r!==i)}}function Xo(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create,r=n.inst;i=i(),r.destroy=i}n=n.next}while(n!==t)}}function qo(e,t){try{Xo(t,e)}catch(t){tu(e,e.return,t)}}function Yo(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{Ro(t,n)}catch(t){tu(e,e.return,t)}}}function $o(e){var t=e.type,n=e.memoizedProps,i=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&i.focus();break e;case"img":n.src&&(i.src=n.src)}}catch(t){tu(e,e.return,t)}}function Zo(e,t,n){var i=n.flags;switch(n.tag){case 0:case 11:case 15:pl(e,n),4&i&&qo(n,5);break;case 1:if(pl(e,n),4&i)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(e){tu(n,n.return,e)}else{var r=Lo(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(r,t,e.__reactInternalSnapshotBeforeUpdate)}catch(e){tu(n,n.return,e)}}64&i&&Yo(n),512&i&&Vo(n,n.return);break;case 3:if(pl(e,n),64&i&&null!==(i=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:e=n.child.stateNode}try{Ro(i,e)}catch(e){tu(n,n.return,e)}}break;case 26:pl(e,n),512&i&&Vo(n,n.return);break;case 27:case 5:pl(e,n),null===t&&4&i&&$o(n),512&i&&Vo(n,n.return);break;case 12:default:pl(e,n);break;case 13:pl(e,n),4&i&&al(e,n);break;case 22:if(!(r=null!==n.memoizedState||No)){t=null!==t&&null!==t.memoizedState||Do;var s=No,a=Do;No=r,(Do=t)&&!a?ml(e,n,!!(8772&n.subtreeFlags)):pl(e,n),No=s,Do=a}512&i&&("manual"===n.memoizedProps.mode?Vo(n,n.return):jo(n,n.return))}}function Ko(e){var t=e.alternate;null!==t&&(e.alternate=null,Ko(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&null!==(t=e.stateNode)&&He(t),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Jo(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag||4===e.tag}function Qo(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Jo(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&27!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function el(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Bu));else if(4!==i&&27!==i&&null!==(e=e.child))for(el(e,t,n),e=e.sibling;null!==e;)el(e,t,n),e=e.sibling}function tl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&27!==i&&null!==(e=e.child))for(tl(e,t,n),e=e.sibling;null!==e;)tl(e,t,n),e=e.sibling}var nl=null,il=!1;function rl(e,t,n){for(n=n.child;null!==n;)sl(e,t,n),n=n.sibling}function sl(e,t,n){if(ge&&"function"==typeof ge.onCommitFiberUnmount)try{ge.onCommitFiberUnmount(me,n)}catch(e){}switch(n.tag){case 26:Do||jo(n,t),rl(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:Do||jo(n,t);var i=nl,r=il;for(nl=n.stateNode,rl(e,t,n),e=(n=n.stateNode).attributes;e.length;)n.removeAttributeNode(e[0]);He(n),nl=i,il=r;break;case 5:Do||jo(n,t);case 6:i=nl,r=il,nl=null,rl(e,t,n),il=r,null!==(nl=i)&&(il?(e=nl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):nl.removeChild(n.stateNode));break;case 18:null!==nl&&(il?(e=nl,n=n.stateNode,8===e.nodeType?ih(e.parentNode,n):1===e.nodeType&&ih(e,n),ud(e)):ih(nl,n.stateNode));break;case 4:i=nl,r=il,nl=n.stateNode.containerInfo,il=!0,rl(e,t,n),nl=i,il=r;break;case 0:case 11:case 14:case 15:if(!Do&&null!==(i=n.updateQueue)&&null!==(i=i.lastEffect)){r=i=i.next;do{var s=r.tag,a=r.inst,o=a.destroy;void 0!==o&&(2&s||4&s)&&(a.destroy=void 0,Ho(n,t,o)),r=r.next}while(r!==i)}rl(e,t,n);break;case 1:if(!Do&&(jo(n,t),"function"==typeof(i=n.stateNode).componentWillUnmount))try{Bo(n,i)}catch(e){tu(n,t,e)}rl(e,t,n);break;case 21:rl(e,t,n);break;case 22:jo(n,t),Do=(i=Do)||null!==n.memoizedState,rl(e,t,n),Do=i;break;default:rl(e,t,n)}}function al(e,t){if(null===t.memoizedState&&null!==(e=t.alternate)&&null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))try{ud(e)}catch(e){tu(t,t.return,e)}}function ol(e,t){var n=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new Uo),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new Uo),t;default:throw Error(a(435,e.tag))}}(e);t.forEach((function(t){var i=au.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}function ll(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var s=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 27:case 5:nl=l.stateNode,il=!1;break e;case 3:case 4:nl=l.stateNode.containerInfo,il=!0;break e}l=l.return}if(null===nl)throw Error(a(160));sl(s,o,r),nl=null,il=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(e){tu(r,t,e)}}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)ul(t,e),t=t.sibling}var cl=null;function ul(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ll(t,e),hl(e),4&i){try{Wo(3,e,e.return),Xo(3,e)}catch(t){tu(e,e.return,t)}try{Wo(5,e,e.return)}catch(t){tu(e,e.return,t)}}break;case 1:ll(t,e),hl(e),512&i&&null!==n&&jo(n,n.return),64&i&&No&&null!==(e=e.updateQueue)&&null!==(i=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?i:n.concat(i));break;case 26:var r=cl;if(ll(t,e),hl(e),512&i&&null!==n&&jo(n,n.return),4&i)if(t=null!==n?n.memoizedState:null,i=e.memoizedState,null===n)if(null===i)if(null===e.stateNode){e:{i=e.type,n=e.memoizedProps,t=r.ownerDocument||r;t:switch(i){case"title":(!(r=t.getElementsByTagName("title")[0])||r[je]||r[Ne]||"http://www.w3.org/2000/svg"===r.namespaceURI||r.hasAttribute("itemprop"))&&(r=t.createElement(i),t.head.insertBefore(r,t.querySelector("head > title"))),Hu(r,i,n),r[Ne]=e,Ye(r),i=r;break e;case"link":var s=Eh("link","href",t).get(i+(n.href||""));if(s)for(var o=0;o<s.length;o++)if((r=s[o]).getAttribute("href")===(null==n.href?null:n.href)&&r.getAttribute("rel")===(null==n.rel?null:n.rel)&&r.getAttribute("title")===(null==n.title?null:n.title)&&r.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){s.splice(o,1);break t}Hu(r=t.createElement(i),i,n),t.head.appendChild(r);break;case"meta":if(s=Eh("meta","content",t).get(i+(n.content||"")))for(o=0;o<s.length;o++)if((r=s[o]).getAttribute("content")===(null==n.content?null:""+n.content)&&r.getAttribute("name")===(null==n.name?null:n.name)&&r.getAttribute("property")===(null==n.property?null:n.property)&&r.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&r.getAttribute("charset")===(null==n.charSet?null:n.charSet)){s.splice(o,1);break t}Hu(r=t.createElement(i),i,n),t.head.appendChild(r);break;default:throw Error(a(468,i))}r[Ne]=e,Ye(r),i=r}e.stateNode=i}else Th(r,e.type,e.stateNode);else e.stateNode=xh(r,i,e.memoizedProps);else if(t!==i)null===t?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):t.count--,null===i?Th(r,e.type,e.stateNode):xh(r,i,e.memoizedProps);else if(null===i&&null!==e.stateNode)try{var l=e.stateNode,c=e.memoizedProps;Gu(l,e.type,n.memoizedProps,c),l[De]=c}catch(t){tu(e,e.return,t)}break;case 27:if(4&i&&null===e.alternate){for(r=e.stateNode,s=e.memoizedProps,o=r.firstChild;o;){var u=o.nextSibling,h=o.nodeName;o[je]||"HEAD"===h||"BODY"===h||"SCRIPT"===h||"STYLE"===h||"LINK"===h&&"stylesheet"===o.rel.toLowerCase()||r.removeChild(o),o=u}for(o=e.type,u=r.attributes;u.length;)r.removeAttributeNode(u[0]);Hu(r,o,s),r[Ne]=e,r[De]=s}case 5:if(ll(t,e),hl(e),512&i&&null!==n&&jo(n,n.return),32&e.flags){t=e.stateNode;try{bt(t,"")}catch(t){tu(e,e.return,t)}}if(4&i&&null!=(t=e.stateNode)){r=e.memoizedProps,n=null!==n?n.memoizedProps:r,s=e.type;try{Gu(t,s,n,r),t[De]=r}catch(t){tu(e,e.return,t)}}1024&i&&(zo=!0);break;case 6:if(ll(t,e),hl(e),4&i){if(null===e.stateNode)throw Error(a(162));i=e.stateNode,n=e.memoizedProps;try{i.nodeValue=n}catch(t){tu(e,e.return,t)}}break;case 3:if(Mh=null,r=cl,cl=uh(t.containerInfo),ll(t,e),cl=r,hl(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{ud(t.containerInfo)}catch(t){tu(e,e.return,t)}zo&&(zo=!1,dl(e));break;case 4:i=cl,cl=uh(e.stateNode.containerInfo),ll(t,e),hl(e),cl=i;break;case 13:ll(t,e),hl(e),8192&e.child.flags&&null!==e.memoizedState!=(null!==n&&null!==n.memoizedState)&&(fc=ae()),4&i&&null!==(i=e.updateQueue)&&(e.updateQueue=null,ol(e,i));break;case 22:512&i&&null!==n&&jo(n,n.return),l=null!==e.memoizedState,c=null!==n&&null!==n.memoizedState;var d=No,p=Do;if(No=d||l,Do=p||c,ll(t,e),Do=p,No=d,hl(e),(t=e.stateNode)._current=e,t._visibility&=-3,t._visibility|=2&t._pendingVisibility,8192&i&&(t._visibility=l?-2&t._visibility:1|t._visibility,l&&(t=No||Do,null===n||c||t||fl(e)),null===e.memoizedProps||"manual"!==e.memoizedProps.mode))e:for(n=null,t=e;;){if(5===t.tag||26===t.tag||27===t.tag){if(null===n){n=t;try{r=t.stateNode,l?"function"==typeof(s=r.style).setProperty?s.setProperty("display","none","important"):s.display="none":(o=t.stateNode,h=null!=(u=t.memoizedProps.style)&&u.hasOwnProperty("display")?u.display:null,o.style.display=null==h||"boolean"==typeof h?"":(""+h).trim())}catch(t){tu(e,e.return,t)}}}else if(6===t.tag){if(null===n)try{t.stateNode.nodeValue=l?"":t.memoizedProps}catch(t){tu(e,e.return,t)}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&i&&null!==(i=e.updateQueue)&&null!==(n=i.retryQueue)&&(i.retryQueue=null,ol(e,n));break;case 19:ll(t,e),hl(e),4&i&&null!==(i=e.updateQueue)&&(e.updateQueue=null,ol(e,i));break;case 21:break;default:ll(t,e),hl(e)}}function hl(e){var t=e.flags;if(2&t){try{if(27!==e.tag){e:{for(var n=e.return;null!==n;){if(Jo(n)){var i=n;break e}n=n.return}throw Error(a(160))}switch(i.tag){case 27:var r=i.stateNode;tl(e,Qo(e),r);break;case 5:var s=i.stateNode;32&i.flags&&(bt(s,""),i.flags&=-33),tl(e,Qo(e),s);break;case 3:case 4:var o=i.stateNode.containerInfo;el(e,Qo(e),o);break;default:throw Error(a(161))}}}catch(t){tu(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function dl(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;dl(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function pl(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)Zo(e,t.alternate,t),t=t.sibling}function fl(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:Wo(4,t,t.return),fl(t);break;case 1:jo(t,t.return);var n=t.stateNode;if("function"==typeof n.componentWillUnmount){var i=t,r=t.return;try{Bo(i,n)}catch(e){tu(i,r,e)}}fl(t);break;case 26:case 27:case 5:jo(t,t.return),fl(t);break;case 22:jo(t,t.return),null===t.memoizedState&&fl(t);break;default:fl(t)}e=e.sibling}}function ml(e,t,n){for(n=n&&!!(8772&t.subtreeFlags),t=t.child;null!==t;){var i=t.alternate,r=e,s=t,a=s.flags;switch(s.tag){case 0:case 11:case 15:ml(r,s,n),qo(s,4);break;case 1:if(ml(r,s,n),"function"==typeof(r=s.stateNode).componentDidMount)try{r.componentDidMount()}catch(e){tu(s,s.return,e)}if(null!==(i=s.updateQueue)){var o=i.shared.hiddenCallbacks;if(null!==o)for(i.shared.hiddenCallbacks=null,i=0;i<o.length;i++)Co(o[i],r)}n&&64&a&&Yo(s),Vo(s,s.return);break;case 26:case 27:case 5:ml(r,s,n),n&&null===i&&4&a&&$o(s),Vo(s,s.return);break;case 12:default:ml(r,s,n);break;case 13:ml(r,s,n),n&&4&a&&al(r,s);break;case 22:null===s.memoizedState&&ml(r,s,n),Vo(s,s.return)}t=t.sibling}}function gl(e,t){try{Xo(t,e)}catch(t){tu(e,e.return,t)}}function vl(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Ur(n))}function yl(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Ur(e))}function bl(e,t,n,i){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)xl(e,t,n,i),t=t.sibling}function xl(e,t,n,i){var r=t.flags;switch(t.tag){case 0:case 11:case 15:bl(e,t,n,i),2048&r&&gl(t,9);break;case 3:bl(e,t,n,i),2048&r&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Ur(e)));break;case 23:break;case 22:var s=t.stateNode;null!==t.memoizedState?4&s._visibility?bl(e,t,n,i):wl(e,t):4&s._visibility?bl(e,t,n,i):(s._visibility|=4,_l(e,t,n,i,!!(10256&t.subtreeFlags))),2048&r&&vl(t.alternate,t);break;case 24:bl(e,t,n,i),2048&r&&yl(t.alternate,t);break;default:bl(e,t,n,i)}}function _l(e,t,n,i,r){for(r=r&&!!(10256&t.subtreeFlags),t=t.child;null!==t;){var s=e,a=t,o=n,l=i,c=a.flags;switch(a.tag){case 0:case 11:case 15:_l(s,a,o,l,r),gl(a,8);break;case 23:break;case 22:var u=a.stateNode;null!==a.memoizedState?4&u._visibility?_l(s,a,o,l,r):wl(s,a):(u._visibility|=4,_l(s,a,o,l,r)),r&&2048&c&&vl(a.alternate,a);break;case 24:_l(s,a,o,l,r),r&&2048&c&&yl(a.alternate,a);break;default:_l(s,a,o,l,r)}t=t.sibling}}function wl(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,i=t,r=i.flags;switch(i.tag){case 22:wl(n,i),2048&r&&vl(i.alternate,i);break;case 24:wl(n,i),2048&r&&yl(i.alternate,i);break;default:wl(n,i)}t=t.sibling}}var Sl=8192;function Ml(e){if(e.subtreeFlags&Sl)for(e=e.child;null!==e;)El(e),e=e.sibling}function El(e){switch(e.tag){case 26:Ml(e),e.flags&Sl&&null!==e.memoizedState&&function(e,t,n){if(null===Ch)throw Error(a(475));var i=Ch;if(!("stylesheet"!==t.type||"string"==typeof n.media&&!1===matchMedia(n.media).matches||4&t.state.loading)){if(null===t.instance){var r=mh(n.href),s=e.querySelector(gh(r));if(s)return null!==(e=s._p)&&"object"==typeof e&&"function"==typeof e.then&&(i.count++,i=Ph.bind(i),e.then(i,i)),t.state.loading|=4,t.instance=s,void Ye(s);s=e.ownerDocument||e,n=vh(n),(r=lh.get(r))&&wh(n,r),Ye(s=s.createElement("link"));var o=s;o._p=new Promise((function(e,t){o.onload=e,o.onerror=t})),Hu(s,"link",n),t.instance=s}null===i.stylesheets&&(i.stylesheets=new Map),i.stylesheets.set(t,e),(e=t.state.preload)&&!(3&t.state.loading)&&(i.count++,t=Ph.bind(i),e.addEventListener("load",t),e.addEventListener("error",t))}}(cl,e.memoizedState,e.memoizedProps);break;case 5:default:Ml(e);break;case 3:case 4:var t=cl;cl=uh(e.stateNode.containerInfo),Ml(e),cl=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=Sl,Sl=16777216,Ml(e),Sl=t):Ml(e))}}function Tl(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Al(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var i=t[n];Fo=i,Pl(i,e)}Tl(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)Cl(e),e=e.sibling}function Cl(e){switch(e.tag){case 0:case 11:case 15:Al(e),2048&e.flags&&Wo(9,e,e.return);break;case 22:var t=e.stateNode;null!==e.memoizedState&&4&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-5,Rl(e)):Al(e);break;default:Al(e)}}function Rl(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var i=t[n];Fo=i,Pl(i,e)}Tl(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:Wo(8,t,t.return),Rl(t);break;case 22:4&(n=t.stateNode)._visibility&&(n._visibility&=-5,Rl(t));break;default:Rl(t)}e=e.sibling}}function Pl(e,t){for(;null!==Fo;){var n=Fo;switch(n.tag){case 0:case 11:case 15:Wo(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var i=n.memoizedState.cachePool.pool;null!=i&&i.refCount++}break;case 24:Ur(n.memoizedState.cache)}if(null!==(i=n.child))i.return=n,Fo=i;else e:for(n=e;null!==Fo;){var r=(i=Fo).sibling,s=i.return;if(Ko(i),i===n){Fo=null;break e}if(null!==r){r.return=s,Fo=r;break e}Fo=s}}}function kl(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Il(e,t,n,i){return new kl(e,t,n,i)}function Ol(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Ll(e,t){var n=e.alternate;return null===n?((n=Il(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=31457280&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Nl(e,t){e.flags&=31457282;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Dl(e,t,n,i,r,s){var o=0;if(i=e,"function"==typeof e)Ol(e)&&(o=1);else if("string"==typeof e)o=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!=typeof t.precedence||"string"!=typeof t.href||""===t.href)break;return!0;case"link":if("string"!=typeof t.rel||"string"!=typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"==typeof t.precedence&&null==e);case"script":if(t.async&&"function"!=typeof t.async&&"symbol"!=typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"==typeof t.src)return!0}return!1}(e,n,X.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case u:return zl(n.children,r,s,t);case h:o=8,r|=24;break;case d:return(e=Il(12,n,t,2|r)).elementType=d,e.lanes=s,e;case v:return(e=Il(13,n,t,r)).elementType=v,e.lanes=s,e;case y:return(e=Il(19,n,t,r)).elementType=y,e.lanes=s,e;case _:return Ul(n,r,s,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case p:case m:o=10;break e;case f:o=9;break e;case g:o=11;break e;case b:o=14;break e;case x:o=16,i=null;break e}throw Error(a(130,null===e?"null":typeof e,""))}return(t=Il(o,n,t,r)).elementType=e,t.type=i,t.lanes=s,t}function zl(e,t,n,i){return(e=Il(7,e,i,t)).lanes=n,e}function Ul(e,t,n,i){(e=Il(22,e,i,t)).elementType=_,e.lanes=n;var r={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var e=r._current;if(null===e)throw Error(a(456));if(!(2&r._pendingVisibility)){var t=Ti(e,2);null!==t&&(r._pendingVisibility|=2,Ac(t,0,2))}},attach:function(){var e=r._current;if(null===e)throw Error(a(456));if(2&r._pendingVisibility){var t=Ti(e,2);null!==t&&(r._pendingVisibility&=-3,Ac(t,0,2))}}};return e.stateNode=r,e}function Fl(e,t,n){return(e=Il(6,e,null,t)).lanes=n,e}function Bl(e,t,n){return(t=Il(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Vl(e){e.flags|=4}function jl(e,t){if("stylesheet"!==t.type||4&t.state.loading)e.flags&=-16777217;else if(e.flags|=16777216,!Ah(t)){if(!Bc())throw cr=sr,rr;e.flags|=8192}}function Hl(e,t){null!==t?e.flags|=4:16384&e.flags&&(t=22!==e.tag?Ce():536870912,e.lanes|=t)}function Gl(e,t){if(!qi)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Wl(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=31457280&r.subtreeFlags,i|=31457280&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Xl(e,t,n){var i=t.pendingProps;switch(Gi(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return Wl(t),null;case 3:return n=t.stateNode,i=null,null!==e&&(i=e.memoizedState.cache),t.memoizedState.cache!==i&&(t.flags|=2048),uo(Dr),J(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(er(t)?Vl(t):null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,null!==Yi&&(Pc(Yi),Yi=null))),Wl(t),null;case 26:return n=t.memoizedState,null===e?(Vl(t),null!==n?(Wl(t),jl(t,n)):(Wl(t),t.flags&=-16777217)):n?n!==e.memoizedState?(Vl(t),Wl(t),jl(t,n)):(Wl(t),t.flags&=-16777217):(e.memoizedProps!==i&&Vl(t),Wl(t),t.flags&=-16777217),null;case 27:ee(t),n=Y.current;var r=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==i&&Vl(t);else{if(!i){if(null===t.stateNode)throw Error(a(166));return Wl(t),null}e=X.current,er(t)?Ji(t):(e=oh(r,i,n),t.stateNode=e,Vl(t))}return Wl(t),null;case 5:if(ee(t),n=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==i&&Vl(t);else{if(!i){if(null===t.stateNode)throw Error(a(166));return Wl(t),null}if(e=X.current,er(t))Ji(t);else{switch(r=qu(Y.current),e){case 1:e=r.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:e=r.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":e=r.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":e=r.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":(e=r.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"==typeof i.is?r.createElement("select",{is:i.is}):r.createElement("select"),i.multiple?e.multiple=!0:i.size&&(e.size=i.size);break;default:e="string"==typeof i.is?r.createElement(n,{is:i.is}):r.createElement(n)}}e[Ne]=t,e[De]=i;e:for(r=t.child;null!==r;){if(5===r.tag||6===r.tag)e.appendChild(r.stateNode);else if(4!==r.tag&&27!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break e;for(;null===r.sibling;){if(null===r.return||r.return===t)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}t.stateNode=e;e:switch(Hu(e,n,i),n){case"button":case"input":case"select":case"textarea":e=!!i.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Vl(t)}}return Wl(t),t.flags&=-16777217,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==i&&Vl(t);else{if("string"!=typeof i&&null===t.stateNode)throw Error(a(166));if(e=Y.current,er(t)){if(e=t.stateNode,n=t.memoizedProps,i=null,null!==(r=Wi))switch(r.tag){case 27:case 5:i=r.memoizedProps}e[Ne]=t,(e=!!(e.nodeValue===n||null!==i&&!0===i.suppressHydrationWarning||Fu(e.nodeValue,n)))||Ki(t)}else(e=qu(e).createTextNode(i))[Ne]=t,t.stateNode=e}return Wl(t),null;case 13:if(i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(r=er(t),null!==i&&null!==i.dehydrated){if(null===e){if(!r)throw Error(a(318));if(!(r=null!==(r=t.memoizedState)?r.dehydrated:null))throw Error(a(317));r[Ne]=t}else tr(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Wl(t),r=!1}else null!==Yi&&(Pc(Yi),Yi=null),r=!0;if(!r)return 256&t.flags?(Pr(t),t):(Pr(t),null)}if(Pr(t),128&t.flags)return t.lanes=n,t;if(n=null!==i,e=null!==e&&null!==e.memoizedState,n){r=null,null!==(i=t.child).alternate&&null!==i.alternate.memoizedState&&null!==i.alternate.memoizedState.cachePool&&(r=i.alternate.memoizedState.cachePool.pool);var s=null;null!==i.memoizedState&&null!==i.memoizedState.cachePool&&(s=i.memoizedState.cachePool.pool),s!==r&&(i.flags|=2048)}return n!==e&&n&&(t.child.flags|=8192),Hl(t,t.updateQueue),Wl(t),null;case 4:return J(),null===e&&Ru(t.stateNode.containerInfo),Wl(t),null;case 10:return uo(t.type),Wl(t),null;case 19:if(G(kr),null===(r=t.memoizedState))return Wl(t),null;if(i=!!(128&t.flags),null===(s=r.rendering))if(i)Gl(r,!1);else{if(0!==sc||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(s=Ir(e))){for(t.flags|=128,Gl(r,!1),e=s.updateQueue,t.updateQueue=e,Hl(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Nl(n,e),n=n.sibling;return W(kr,1&kr.current|2),t.child}e=e.sibling}null!==r.tail&&ae()>mc&&(t.flags|=128,i=!0,Gl(r,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=Ir(s))){if(t.flags|=128,i=!0,e=e.updateQueue,t.updateQueue=e,Hl(t,e),Gl(r,!0),null===r.tail&&"hidden"===r.tailMode&&!s.alternate&&!qi)return Wl(t),null}else 2*ae()-r.renderingStartTime>mc&&536870912!==n&&(t.flags|=128,i=!0,Gl(r,!1),t.lanes=4194304);r.isBackwards?(s.sibling=t.child,t.child=s):(null!==(e=r.last)?e.sibling=s:t.child=s,r.last=s)}return null!==r.tail?(t=r.tail,r.rendering=t,r.tail=t.sibling,r.renderingStartTime=ae(),t.sibling=null,e=kr.current,W(kr,i?1&e|2:1&e),t):(Wl(t),null);case 22:case 23:return Pr(t),Mr(),i=null!==t.memoizedState,null!==e?null!==e.memoizedState!==i&&(t.flags|=8192):i&&(t.flags|=8192),i?!!(536870912&n)&&!(128&t.flags)&&(Wl(t),6&t.subtreeFlags&&(t.flags|=8192)):Wl(t),null!==(n=t.updateQueue)&&Hl(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),i=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(i=t.memoizedState.cachePool.pool),i!==n&&(t.flags|=2048),null!==e&&G(Wr),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),uo(Dr),Wl(t),null;case 25:return null}throw Error(a(156,t.tag))}function ql(e,t){switch(Gi(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return uo(Dr),J(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return ee(t),null;case 13:if(Pr(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));tr()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return G(kr),null;case 4:return J(),null;case 10:return uo(t.type),null;case 22:case 23:return Pr(t),Mr(),null!==e&&G(Wr),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return uo(Dr),null;default:return null}}function Yl(e,t){switch(Gi(t),t.tag){case 3:uo(Dr),J();break;case 26:case 27:case 5:ee(t);break;case 4:J();break;case 13:Pr(t);break;case 19:G(kr);break;case 10:uo(t.type);break;case 22:case 23:Pr(t),Mr(),null!==e&&G(Wr);break;case 24:uo(Dr)}}var $l={getCacheForType:function(e){var t=mo(Dr),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n}},Zl="function"==typeof WeakMap?WeakMap:Map,Kl=0,Jl=null,Ql=null,ec=0,tc=0,nc=null,ic=!1,rc=0,sc=0,ac=0,oc=0,lc=0,cc=0,uc=null,hc=null,dc=!1,pc=!1,fc=0,mc=1/0,gc=null,vc=null,yc=!1,bc=null,xc=0,_c=0,wc=null,Sc=0,Mc=null;function Ec(){return 2&Kl&&0!==ec?ec&-ec:null!==T.T?0!==Vr?Vr:yu():Oe()}function Tc(){0===cc&&(cc=536870912&ec&&!qi?536870912:Ae());var e=Er.current;return null!==e&&(e.flags|=32),cc}function Ac(e,t,n){(e===Jl&&2===tc||null!==e.cancelPendingCommit)&&(Uc(e,0),Lc(e,ec,cc)),Oc(e,n),2&Kl&&e===Jl||(e===Jl&&(!(2&Kl)&&(oc|=n),4===sc&&Lc(e,ec,cc)),fu(e))}function Cc(e,t){if(6&Kl)throw Error(a(327));var n=e.callbackNode;if(Qc()&&e.callbackNode!==n)return null;var i=Me(e,e===Jl?ec:0);if(0===i)return null;var r=!(60&i||i&e.expiredLanes||t);if(t=r?function(e,t){var n=Kl;Kl|=2;var i=Vc(),r=jc();Jl===e&&ec===t||(gc=null,mc=ae()+500,Uc(e,t));e:for(;;)try{if(0!==tc&&null!==Ql){t=Ql;var s=nc;t:switch(tc){case 1:case 6:tc=0,nc=null,$c(e,t,s);break;case 2:if(ar(s)){tc=0,nc=null,Yc(t);break}t=function(){2===tc&&Jl===e&&(tc=7),fu(e)},s.then(t,t);break e;case 3:tc=7;break e;case 4:tc=5;break e;case 7:ar(s)?(tc=0,nc=null,Yc(t)):(tc=0,nc=null,$c(e,t,s));break;case 5:var o=null;switch(Ql.tag){case 26:o=Ql.memoizedState;case 5:case 27:var l=Ql;if(!o||Ah(o)){tc=0,nc=null;var c=l.sibling;if(null!==c)Ql=c;else{var u=l.return;null!==u?(Ql=u,Zc(u)):Ql=null}break t}}tc=0,nc=null,$c(e,t,s);break;case 8:zc(),sc=6;break e;default:throw Error(a(462))}}Xc();break}catch(t){Fc(e,t)}return lo(),T.H=i,T.A=r,Kl=n,null!==Ql?0:(Jl=null,ec=0,Si(),sc)}(e,i):Gc(e,i),0!==t)for(var s=r;;){if(6===t)Lc(e,i,0);else{if(r=e.current.alternate,s&&!Ic(r)){t=Gc(e,i),s=!1;continue}if(2===t){var o=Te(e,s=i);if(0!==o&&(i=o,t=Rc(e,s,o),s=!1,2!==t))continue}if(1===t){Uc(e,0),Lc(e,i,0);break}e.finishedWork=r,e.finishedLanes=i;e:{switch(s=e,t){case 0:case 1:throw Error(a(345));case 4:if((4194176&i)===i){Lc(s,i,cc);break e}break;case 2:hc=null;break;case 3:case 5:break;default:throw Error(a(329))}if((62914560&i)===i&&10<(t=fc+300-ae())){if(Lc(s,i,cc),0!==Me(s,0))break e;s.timeoutHandle=Ju(kc.bind(null,s,r,hc,gc,dc,i,cc),t)}else kc(s,r,hc,gc,dc,i,cc)}}break}return fu(e),vu(e,ae()),e.callbackNode===n?Cc.bind(null,e):null}function Rc(e,t,n){var i=uc,r=e.current.memoizedState.isDehydrated;if(r&&(Uc(e,n).flags|=256),2!==(n=Gc(e,n))){if(ic&&!r)return e.errorRecoveryDisabledLanes|=t,oc|=t,4;e=hc,hc=i,null!==e&&Pc(e)}return n}function Pc(e){null===hc?hc=e:hc.push.apply(hc,e)}function kc(e,t,n,i,r,s,o){var l=t.subtreeFlags;if((8192&l||!(16785408&~l))&&(Ch={stylesheets:null,count:0,unsuspend:Rh},El(t),null!==(t=function(){if(null===Ch)throw Error(a(475));var e=Ch;return e.stylesheets&&0===e.count&&Ih(e,e.stylesheets),0<e.count?function(t){var n=setTimeout((function(){if(e.stylesheets&&Ih(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}}),6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(n)}}:null}())))return e.cancelPendingCommit=t(Kc.bind(null,e,n,i,r)),void Lc(e,s,o);Kc(e,n,i,r,o)}function Ic(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!Wn(s(),r))return!1}catch(e){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Oc(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0),2&Kl?dc=!0:4&Kl&&(pc=!0),ou()}function Lc(e,t,n){t&=~lc,t&=~oc,e.suspendedLanes|=t,e.pingedLanes&=~t;for(var i=e.expirationTimes,r=t;0<r;){var s=31-ye(r),a=1<<s;i[s]=-1,r&=~a}0!==n&&Pe(e,n,t)}function Nc(e,t){if(6&Kl)throw Error(a(327));if(Qc())return fu(e),null;var n=Gc(e,t);if(2===n){var i=t,r=Te(e,i);0!==r&&(t=r,n=Rc(e,i,r))}return 1===n?(Uc(e,0),Lc(e,t,0),fu(e),null):6===n?(Lc(e,t,cc),fu(e),null):(e.finishedWork=e.current.alternate,e.finishedLanes=t,Kc(e,hc,gc,dc,cc),fu(e),null)}function Dc(){return!!(6&Kl)||(mu(),!1)}function zc(){if(null!==Ql){if(0===tc)var e=Ql.return;else e=Ql,lo(),fs(e),hr=null,dr=0,e=Ql;for(;null!==e;)Yl(e.alternate,e),e=e.return;Ql=null}}function Uc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,Qu(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),zc(),Jl=e,Ql=n=Ll(e.current,null),ec=t,tc=0,nc=null,ic=!1,cc=lc=oc=ac=sc=0,hc=uc=null,dc=!1,8&t&&(t|=32&t);var i=e.entangledLanes;if(0!==i)for(e=e.entanglements,i&=t;0<i;){var r=31-ye(i),s=1<<r;t|=e[r],i&=~s}return rc=t,Si(),n}function Fc(e,t){Zr=null,T.H=xa,t===ir?(t=ur(),tc=!Bc()||134217727&ac||134217727&oc?3:2):t===rr?(t=ur(),tc=4):tc=t===Oa?8:null!==t&&"object"==typeof t&&"function"==typeof t.then?6:1,nc=t,null===Ql&&(sc=1,Ca(e,ki(t,e.current)))}function Bc(){var e=Er.current;return null===e||((4194176&ec)===ec?null===Tr:!!((62914560&ec)===ec||536870912&ec)&&e===Tr)}function Vc(){var e=T.H;return T.H=xa,null===e?xa:e}function jc(){var e=T.A;return T.A=$l,e}function Hc(){sc=4,!(134217727&ac)&&!(134217727&oc)||null===Jl||Lc(Jl,ec,cc)}function Gc(e,t){var n=Kl;Kl|=2;var i=Vc(),r=jc();Jl===e&&ec===t||(gc=null,Uc(e,t)),t=!1;e:for(;;)try{if(0!==tc&&null!==Ql){var s=Ql,o=nc;switch(tc){case 8:zc(),sc=6;break e;case 3:case 2:t||null!==Er.current||(t=!0);default:tc=0,nc=null,$c(e,s,o)}}Wc();break}catch(t){Fc(e,t)}if(t&&e.shellSuspendCounter++,lo(),Kl=n,T.H=i,T.A=r,null!==Ql)throw Error(a(261));return Jl=null,ec=0,Si(),sc}function Wc(){for(;null!==Ql;)qc(Ql)}function Xc(){for(;null!==Ql&&!re();)qc(Ql)}function qc(e){var t=io(e.alternate,e,rc);e.memoizedProps=e.pendingProps,null===t?Zc(e):Ql=t}function Yc(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Ha(n,t,t.pendingProps,t.type,void 0,ec);break;case 11:t=Ha(n,t,t.pendingProps,t.type.render,t.ref,ec);break;case 5:fs(t);default:Yl(n,t),t=io(n,t=Ql=Nl(t,rc),rc)}e.memoizedProps=e.pendingProps,null===t?Zc(e):Ql=t}function $c(e,t,n){lo(),fs(t),hr=null,dr=0;var i=t.return;try{if(function(e,t,n,i,r){if(n.flags|=32768,null!==i&&"object"==typeof i&&"function"==typeof i.then){if(null!==(n=Er.current)){switch(n.tag){case 13:return null===Tr?Hc():null===n.alternate&&0===sc&&(sc=3),n.flags&=-257,n.flags|=65536,n.lanes=r,i===sr?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([i]):t.add(i),nu(e,i,r)),!1;case 22:return n.flags|=65536,i===sr?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([i])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([i]):n.add(i),nu(e,i,r)),!1}throw Error(a(435,n.tag))}return nu(e,i,r),Hc(),!1}if(qi)return null!==(t=Er.current)?(!(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=r,i!==Zi&&nr(ki(e=Error(a(422),{cause:i}),n))):(i!==Zi&&nr(ki(t=Error(a(423),{cause:i}),n)),(e=e.current.alternate).flags|=65536,r&=-r,e.lanes|=r,i=ki(i,n),Mo(e,r=Pa(e.stateNode,i,r)),4!==sc&&(sc=2)),!1;var s=Error(a(520),{cause:i});if(s=ki(s,n),null===uc?uc=[s]:uc.push(s),4!==sc&&(sc=2),null===t)return!0;i=ki(i,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=r&-r,n.lanes|=e,Mo(n,e=Pa(n.stateNode,i,e)),!1;case 1:if(t=n.type,s=n.stateNode,!(128&n.flags||"function"!=typeof t.getDerivedStateFromError&&(null===s||"function"!=typeof s.componentDidCatch||null!==vc&&vc.has(s))))return n.flags|=65536,r&=-r,n.lanes|=r,Ia(r=ka(r),e,n,i),Mo(n,r),!1}n=n.return}while(null!==n);return!1}(e,i,t,n,ec))return sc=1,Ca(e,ki(n,e.current)),void(Ql=null)}catch(t){if(null!==i)throw Ql=i,t;return sc=1,Ca(e,ki(n,e.current)),void(Ql=null)}if(32768&t.flags)e:{e=t;do{if(null!==(t=ql(e.alternate,e))){t.flags&=32767,Ql=t;break e}null!==(e=e.return)&&(e.flags|=32768,e.subtreeFlags=0,e.deletions=null),Ql=e}while(null!==e);sc=6,Ql=null}else Zc(t)}function Zc(e){var t=e;do{e=t.return;var n=Xl(t.alternate,t,rc);if(null!==n)return void(Ql=n);if(null!==(t=t.sibling))return void(Ql=t);Ql=t=e}while(null!==t);0===sc&&(sc=5)}function Kc(e,t,n,i,r){var s=T.T,o=F.p;try{F.p=2,T.T=null,function(e,t,n,i,r,s){do{Qc()}while(null!==bc);if(6&Kl)throw Error(a(327));var o=e.finishedWork,l=e.finishedLanes;if(null===o)return null;if(e.finishedWork=null,e.finishedLanes=0,o===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0,e.cancelPendingCommit=null;var c=o.lanes|o.childLanes;if(function(e,t,n){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.entangledLanes&=t,e.errorRecoveryDisabledLanes&=t,e.shellSuspendCounter=0,t=e.entanglements;for(var r=e.expirationTimes,s=e.hiddenUpdates;0<i;){var a=31-ye(i),o=1<<a;t[a]=0,r[a]=-1;var l=s[a];if(null!==l)for(s[a]=null,a=0;a<l.length;a++){var c=l[a];null!==c&&(c.lane&=-536870913)}i&=~o}0!==n&&Pe(e,n,0)}(e,c|=wi,s),pc=!1,e===Jl&&(Ql=Jl=null,ec=0),!(10256&o.subtreeFlags)&&!(10256&o.flags)||yc||(yc=!0,_c=c,wc=n,ne(ue,(function(){return Qc(),null}))),n=!!(15990&o.flags),15990&o.subtreeFlags||n){n=T.T,T.T=null,s=F.p,F.p=2;var u=Kl;Kl|=4,function(e,t){if(Wu=Fh,Kn(e=Zn())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch(e){n=null;break e}var o=0,l=-1,c=-1,u=0,h=0,d=e,p=null;t:for(;;){for(var f;d!==n||0!==r&&3!==d.nodeType||(l=o+r),d!==s||0!==i&&3!==d.nodeType||(c=o+i),3===d.nodeType&&(o+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===e)break t;if(p===n&&++u===r&&(l=o),p===s&&++h===i&&(c=o),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Xu={focusedElem:e,selectionRange:n},Fh=!1,Fo=t;null!==Fo;)if(e=(t=Fo).child,1028&t.subtreeFlags&&null!==e)e.return=t,Fo=e;else for(;null!==Fo;){t=Fo;try{var m=t.alternate,g=t.flags;switch(t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(1024&g&&null!==m){var v=m.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(Lo(t.type,m.memoizedProps),v);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:if(1024&g){var x=t.stateNode.containerInfo,_=x.nodeType;if(9===_)rh(x);else if(1===_)switch(x.nodeName){case"HEAD":case"HTML":case"BODY":rh(x);break;default:x.textContent=""}}break;default:if(1024&g)throw Error(a(163))}}catch(e){tu(t,t.return,e)}if(null!==(e=t.sibling)){e.return=t.return,Fo=e;break}Fo=t.return}m=Go,Go=!1}(e,o),ul(o,e),Jn(Xu),Fh=!!Wu,Xu=Wu=null,e.current=o,Zo(e,o.alternate,o),se(),Kl=u,F.p=s,T.T=n}else e.current=o;if(yc?(yc=!1,bc=e,xc=l):Jc(e,c),0===(c=e.pendingLanes)&&(vc=null),function(e){if(ge&&"function"==typeof ge.onCommitFiberRoot)try{ge.onCommitFiberRoot(me,e,void 0,!(128&~e.current.flags))}catch(e){}}(o.stateNode),fu(e),null!==t)for(r=e.onRecoverableError,o=0;o<t.length;o++)r((c=t[o]).value,{componentStack:c.stack});!!(3&xc)&&Qc(),c=e.pendingLanes,i||pc||4194218&l&&42&c?e===Mc?Sc++:(Sc=0,Mc=e):Sc=0,mu()}(e,t,n,i,o,r)}finally{T.T=s,F.p=o}return null}function Jc(e,t){0==(e.pooledCacheLanes&=t)&&null!=(t=e.pooledCache)&&(e.pooledCache=null,Ur(t))}function Qc(){if(null!==bc){var e=bc,t=_c;_c=0;var n=Ie(xc),i=T.T,r=F.p;try{if(F.p=32>n?32:n,T.T=null,null===bc)var s=!1;else{n=wc,wc=null;var o=bc,l=xc;if(bc=null,xc=0,6&Kl)throw Error(a(331));var c=Kl;if(Kl|=4,Cl(o.current),xl(o,o.current,l,n),Kl=c,mu(),ge&&"function"==typeof ge.onPostCommitFiberRoot)try{ge.onPostCommitFiberRoot(me,o)}catch(e){}s=!0}return s}finally{F.p=r,T.T=i,Jc(e,t)}}return!1}function eu(e,t,n){t=ki(n,t),null!==(e=wo(e,t=Pa(e.stateNode,t,2),2))&&(Oc(e,2),fu(e))}function tu(e,t,n){if(3===e.tag)eu(e,e,n);else for(;null!==t;){if(3===t.tag){eu(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof i.componentDidCatch&&(null===vc||!vc.has(i))){e=ki(n,e),null!==(i=wo(t,n=ka(2),2))&&(Ia(n,i,t,e),Oc(i,2),fu(i));break}}t=t.return}}function nu(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new Zl;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(ic=!0,r.add(n),e=iu.bind(null,e,t,n),t.then(e,e))}function iu(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),e.pingedLanes|=e.suspendedLanes&n,2&Kl?dc=!0:4&Kl&&(pc=!0),ou(),Jl===e&&(ec&n)===n&&(4===sc||3===sc&&(62914560&ec)===ec&&300>ae()-fc?!(2&Kl)&&Uc(e,0):lc|=n),fu(e)}function ru(e,t){0===t&&(t=Ce()),null!==(e=Ti(e,t))&&(Oc(e,t),fu(e))}function su(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),ru(e,n)}function au(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;case 22:i=e.stateNode._retryCache;break;default:throw Error(a(314))}null!==i&&i.delete(t),ru(e,n)}function ou(){if(50<Sc)throw Sc=0,Mc=null,2&Kl&&null!==Jl&&(Jl.errorRecoveryDisabledLanes|=ec),Error(a(185))}var lu=null,cu=null,uu=!1,hu=!1,du=!1,pu=0;function fu(e){var t;e!==cu&&null===e.next&&(null===cu?lu=cu=e:cu=cu.next=e),hu=!0,uu||(uu=!0,t=gu,th((function(){6&Kl?ne(le,t):t()})))}function mu(){if(!du&&hu){du=!0;do{for(var e=!1,t=lu;null!==t;){var n=ec;3&(n=Me(t,t===Jl?n:0))&&(e=!0,Nc(t,n)),t=t.next}}while(e);du=!1}}function gu(){hu=uu=!1;for(var e=ae(),t=null,n=lu;null!==n;){var i=n.next;if(0!==pu&&(a=void 0,(a=window.event)&&"popstate"===a.type?a!==Ku&&(Ku=a,1):(Ku=null,0))){var r=n,s=pu;r.pendingLanes|=2,r.entangledLanes|=2,r.entanglements[1]|=s}0===(r=vu(n,e))?(n.next=null,null===t?lu=i:t.next=i,null===i&&(cu=t)):(t=n,3&r&&(hu=!0)),n=i}var a;pu=0,mu()}function vu(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,s=-62914561&e.pendingLanes;0<s;){var a=31-ye(s),o=1<<a,l=r[a];-1===l?o&n&&!(o&i)||(r[a]=Ee(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}if(n=ec,n=Me(e,e===(t=Jl)?n:0),i=e.callbackNode,0===n||e===t&&2===tc||null!==e.cancelPendingCommit)return null!==i&&null!==i&&ie(i),e.callbackNode=null,e.callbackPriority=0;if(3&n)return null!==i&&null!==i&&ie(i),e.callbackPriority=2,e.callbackNode=null,2;if((t=n&-n)===e.callbackPriority)return t;switch(null!==i&&ie(i),Ie(n)){case 2:n=le;break;case 8:n=ce;break;case 32:default:n=ue;break;case 268435456:n=de}return i=Cc.bind(null,e),n=ne(n,i),e.callbackPriority=t,e.callbackNode=n,t}function yu(){return 0===pu&&(pu=Ae()),pu}function bu(e){return null==e||"symbol"==typeof e||"boolean"==typeof e?null:"function"==typeof e?e:Tt(""+e)}function xu(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var _u=0;_u<yi.length;_u++){var wu=yi[_u];bi(wu.toLowerCase(),"on"+(wu[0].toUpperCase()+wu.slice(1)))}bi(ui,"onAnimationEnd"),bi(hi,"onAnimationIteration"),bi(di,"onAnimationStart"),bi("dblclick","onDoubleClick"),bi("focusin","onFocus"),bi("focusout","onBlur"),bi(pi,"onTransitionRun"),bi(fi,"onTransitionStart"),bi(mi,"onTransitionCancel"),bi(gi,"onTransitionEnd"),Je("onMouseEnter",["mouseout","mouseover"]),Je("onMouseLeave",["mouseout","mouseover"]),Je("onPointerEnter",["pointerout","pointerover"]),Je("onPointerLeave",["pointerout","pointerover"]),Ke("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ke("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ke("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ke("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ke("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ke("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Su="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mu=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Su));function Eu(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var s=void 0;if(t)for(var a=i.length-1;0<=a;a--){var o=i[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&r.isPropagationStopped())break e;s=o,r.currentTarget=c;try{s(r)}catch(e){Ma(e)}r.currentTarget=null,s=l}else for(a=0;a<i.length;a++){if(l=(o=i[a]).instance,c=o.currentTarget,o=o.listener,l!==s&&r.isPropagationStopped())break e;s=o,r.currentTarget=c;try{s(r)}catch(e){Ma(e)}r.currentTarget=null,s=l}}}}function Tu(e,t){var n=t[Ue];void 0===n&&(n=t[Ue]=new Set);var i=e+"__bubble";n.has(i)||(Pu(t,e,2,!1),n.add(i))}function Au(e,t,n){var i=0;t&&(i|=4),Pu(n,e,i,t)}var Cu="_reactListening"+Math.random().toString(36).slice(2);function Ru(e){if(!e[Cu]){e[Cu]=!0,$e.forEach((function(t){"selectionchange"!==t&&(Mu.has(t)||Au(t,!1,e),Au(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Cu]||(t[Cu]=!0,Au("selectionchange",!1,t))}}function Pu(e,t,n,i){switch(Xh(t)){case 2:var r=Bh;break;case 8:r=Vh;break;default:r=jh}n=r.bind(null,t,n,e),r=void 0,!Nt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function ku(e,t,n,i,r){var s=i;if(!(1&t||2&t||null===i))e:for(;;){if(null===i)return;var a=i.tag;if(3===a||4===a){var o=i.stateNode.containerInfo;if(o===r||8===o.nodeType&&o.parentNode===r)break;if(4===a)for(a=i.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;a=a.return}for(;null!==o;){if(null===(a=Ge(o)))return;if(5===(l=a.tag)||6===l||26===l||27===l){i=s=a;continue e}o=o.parentNode}}i=i.return}Ot((function(){var i=s,r=Ct(n),a=[];e:{var o=vi.get(e);if(void 0!==o){var l=$t,c=e;switch(e){case"keypress":if(0===Vt(n))break e;case"keydown":case"keyup":l=hn;break;case"focusin":c="focus",l=tn;break;case"focusout":c="blur",l=tn;break;case"beforeblur":case"afterblur":l=tn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=Qt;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=en;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=pn;break;case ui:case hi:case di:l=nn;break;case gi:l=fn;break;case"scroll":case"scrollend":l=Kt;break;case"wheel":l=mn;break;case"copy":case"cut":case"paste":l=rn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=dn;break;case"toggle":case"beforetoggle":l=gn}var u=!!(4&t),h=!u&&("scroll"===e||"scrollend"===e),d=u?null!==o?o+"Capture":null:o;u=[];for(var p,f=i;null!==f;){var m=f;if(p=m.stateNode,5!==(m=m.tag)&&26!==m&&27!==m||null===p||null===d||null!=(m=Lt(f,d))&&u.push(Iu(f,m,p)),h)break;f=f.return}0<u.length&&(o=new l(o,c,null,n,r),a.push({event:o,listeners:u}))}}if(!(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===At||!(c=n.relatedTarget||n.fromElement)||!Ge(c)&&!c[ze])&&(l||o)&&(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?Ge(c):null)&&(h=O(c),u=c.tag,c!==h||5!==u&&27!==u&&6!==u)&&(c=null)):(l=null,c=i),l!==c)){if(u=Qt,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=dn,m="onPointerLeave",d="onPointerEnter",f="pointer"),h=null==l?o:Xe(l),p=null==c?o:Xe(c),(o=new u(m,f+"leave",l,n,r)).target=h,o.relatedTarget=p,m=null,Ge(r)===i&&((u=new u(d,f+"enter",c,n,r)).target=p,u.relatedTarget=h,m=u),h=m,l&&c)e:{for(d=c,f=0,p=u=l;p;p=Lu(p))f++;for(p=0,m=d;m;m=Lu(m))p++;for(;0<f-p;)u=Lu(u),f--;for(;0<p-f;)d=Lu(d),p--;for(;f--;){if(u===d||null!==d&&u===d.alternate)break e;u=Lu(u),d=Lu(d)}u=null}else u=null;null!==l&&Nu(a,o,l,u,!1),null!==c&&null!==h&&Nu(a,h,c,u,!0)}if("select"===(l=(o=i?Xe(i):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g=Ln;else if(Cn(o))if(Nn)g=Gn;else{g=jn;var v=Vn}else!(l=o.nodeName)||"input"!==l.toLowerCase()||"checkbox"!==o.type&&"radio"!==o.type?i&&St(i.elementType)&&(g=Ln):g=Hn;switch(g&&(g=g(e,i))?Rn(a,g,n,r):(v&&v(e,o,i),"focusout"===e&&i&&"number"===o.type&&null!=i.memoizedProps.value&&mt(o,"number",o.value)),v=i?Xe(i):window,e){case"focusin":(Cn(v)||"true"===v.contentEditable)&&(ei=v,ti=i,ni=null);break;case"focusout":ni=ti=ei=null;break;case"mousedown":ii=!0;break;case"contextmenu":case"mouseup":case"dragend":ii=!1,ri(a,n,r);break;case"selectionchange":if(Qn)break;case"keydown":case"keyup":ri(a,n,r)}var y;if(yn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Tn?Mn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(_n&&"ko"!==n.locale&&(Tn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Tn&&(y=Bt()):(Ut="value"in(zt=r)?zt.value:zt.textContent,Tn=!0)),0<(v=Ou(i,b)).length&&(b=new sn(b,e,null,n,r),a.push({event:b,listeners:v}),(y||null!==(y=En(n)))&&(b.data=y))),(y=xn?function(e,t){switch(e){case"compositionend":return En(t);case"keypress":return 32!==t.which?null:(Sn=!0,wn);case"textInput":return(e=t.data)===wn&&Sn?null:e;default:return null}}(e,n):function(e,t){if(Tn)return"compositionend"===e||!yn&&Mn(e,t)?(e=Bt(),Ft=Ut=zt=null,Tn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return _n&&"ko"!==t.locale?null:t.data}}(e,n))&&0<(b=Ou(i,"onBeforeInput")).length&&(v=new sn("onBeforeInput","beforeinput",null,n,r),a.push({event:v,listeners:b}),v.data=y),function(e,t,n,i,r){if("submit"===t&&n&&n.stateNode===r){var s=bu((r[De]||null).action),a=i.submitter;a&&null!==(t=(t=a[De]||null)?bu(t.formAction):a.getAttribute("formAction"))&&(s=t,a=null);var o=new $t("action","action",null,i,r);e.push({event:o,listeners:[{instance:null,listener:function(){if(i.defaultPrevented){if(0!==pu){var e=a?xu(r,a):new FormData(r);oa(n,{pending:!0,data:e,method:r.method,action:s},null,e)}}else"function"==typeof s&&(o.preventDefault(),e=a?xu(r,a):new FormData(r),oa(n,{pending:!0,data:e,method:r.method,action:s},s,e))},currentTarget:r}]})}}(a,e,i,n,r)}Eu(a,t)}))}function Iu(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Ou(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,s=r.stateNode;5!==(r=r.tag)&&26!==r&&27!==r||null===s||(null!=(r=Lt(e,n))&&i.unshift(Iu(e,r,s)),null!=(r=Lt(e,t))&&i.push(Iu(e,r,s))),e=e.return}return i}function Lu(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function Nu(e,t,n,i,r){for(var s=t._reactName,a=[];null!==n&&n!==i;){var o=n,l=o.alternate,c=o.stateNode;if(o=o.tag,null!==l&&l===i)break;5!==o&&26!==o&&27!==o||null===c||(l=c,r?null!=(c=Lt(n,s))&&a.unshift(Iu(n,c,l)):r||null!=(c=Lt(n,s))&&a.push(Iu(n,c,l))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Du=/\r\n?/g,zu=/\u0000|\uFFFD/g;function Uu(e){return("string"==typeof e?e:""+e).replace(Du,"\n").replace(zu,"")}function Fu(e,t){return t=Uu(t),Uu(e)===t}function Bu(){}function Vu(e,t,n,i,r,s){switch(n){case"children":"string"==typeof i?"body"===t||"textarea"===t&&""===i||bt(e,i):("number"==typeof i||"bigint"==typeof i)&&"body"!==t&&bt(e,""+i);break;case"className":rt(e,"class",i);break;case"tabIndex":rt(e,"tabindex",i);break;case"dir":case"role":case"viewBox":case"width":case"height":rt(e,n,i);break;case"style":wt(e,i,s);break;case"src":case"href":if(""===i&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==i||"function"==typeof i||"symbol"==typeof i||"boolean"==typeof i){e.removeAttribute(n);break}i=Tt(""+i),e.setAttribute(n,i);break;case"action":case"formAction":if("function"==typeof i){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"==typeof s&&("formAction"===n?("input"!==t&&Vu(e,t,"name",r.name,r,null),Vu(e,t,"formEncType",r.formEncType,r,null),Vu(e,t,"formMethod",r.formMethod,r,null),Vu(e,t,"formTarget",r.formTarget,r,null)):(Vu(e,t,"encType",r.encType,r,null),Vu(e,t,"method",r.method,r,null),Vu(e,t,"target",r.target,r,null))),null==i||"symbol"==typeof i||"boolean"==typeof i){e.removeAttribute(n);break}i=Tt(""+i),e.setAttribute(n,i);break;case"onClick":null!=i&&(e.onclick=Bu);break;case"onScroll":null!=i&&Tu("scroll",e);break;case"onScrollEnd":null!=i&&Tu("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=i){if("object"!=typeof i||!("__html"in i))throw Error(a(61));if(null!=(n=i.__html)){if(null!=r.children)throw Error(a(60));e.innerHTML=n}}break;case"multiple":e.multiple=i&&"function"!=typeof i&&"symbol"!=typeof i;break;case"muted":e.muted=i&&"function"!=typeof i&&"symbol"!=typeof i;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":case"innerText":case"textContent":break;case"xlinkHref":if(null==i||"function"==typeof i||"boolean"==typeof i||"symbol"==typeof i){e.removeAttribute("xlink:href");break}n=Tt(""+i),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=i&&"function"!=typeof i&&"symbol"!=typeof i?e.setAttribute(n,""+i):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":i&&"function"!=typeof i&&"symbol"!=typeof i?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===i?e.setAttribute(n,""):!1!==i&&null!=i&&"function"!=typeof i&&"symbol"!=typeof i?e.setAttribute(n,i):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=i&&"function"!=typeof i&&"symbol"!=typeof i&&!isNaN(i)&&1<=i?e.setAttribute(n,i):e.removeAttribute(n);break;case"rowSpan":case"start":null==i||"function"==typeof i||"symbol"==typeof i||isNaN(i)?e.removeAttribute(n):e.setAttribute(n,i);break;case"popover":Tu("beforetoggle",e),Tu("toggle",e),it(e,"popover",i);break;case"xlinkActuate":st(e,"http://www.w3.org/1999/xlink","xlink:actuate",i);break;case"xlinkArcrole":st(e,"http://www.w3.org/1999/xlink","xlink:arcrole",i);break;case"xlinkRole":st(e,"http://www.w3.org/1999/xlink","xlink:role",i);break;case"xlinkShow":st(e,"http://www.w3.org/1999/xlink","xlink:show",i);break;case"xlinkTitle":st(e,"http://www.w3.org/1999/xlink","xlink:title",i);break;case"xlinkType":st(e,"http://www.w3.org/1999/xlink","xlink:type",i);break;case"xmlBase":st(e,"http://www.w3.org/XML/1998/namespace","xml:base",i);break;case"xmlLang":st(e,"http://www.w3.org/XML/1998/namespace","xml:lang",i);break;case"xmlSpace":st(e,"http://www.w3.org/XML/1998/namespace","xml:space",i);break;case"is":it(e,"is",i);break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&it(e,n=Mt.get(n)||n,i)}}function ju(e,t,n,i,r,s){switch(n){case"style":wt(e,i,s);break;case"dangerouslySetInnerHTML":if(null!=i){if("object"!=typeof i||!("__html"in i))throw Error(a(61));if(null!=(n=i.__html)){if(null!=r.children)throw Error(a(60));e.innerHTML=n}}break;case"children":"string"==typeof i?bt(e,i):("number"==typeof i||"bigint"==typeof i)&&bt(e,""+i);break;case"onScroll":null!=i&&Tu("scroll",e);break;case"onScrollEnd":null!=i&&Tu("scrollend",e);break;case"onClick":null!=i&&(e.onclick=Bu);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:Ze.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(r=n.endsWith("Capture"),t=n.slice(2,r?n.length-7:void 0),"function"==typeof(s=null!=(s=e[De]||null)?s[n]:null)&&e.removeEventListener(t,s,r),"function"!=typeof i)?n in e?e[n]=i:!0===i?e.setAttribute(n,""):it(e,n,i):("function"!=typeof s&&null!==s&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,i,r)))}}function Hu(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":Tu("invalid",e);var i=null,r=null,s=null,o=null,l=null,c=null;for(h in n)if(n.hasOwnProperty(h)){var u=n[h];if(null!=u)switch(h){case"name":i=u;break;case"type":r=u;break;case"checked":l=u;break;case"defaultChecked":c=u;break;case"value":s=u;break;case"defaultValue":o=u;break;case"children":case"dangerouslySetInnerHTML":if(null!=u)throw Error(a(137,t));break;default:Vu(e,t,h,u,n,null)}}return ft(e,s,o,l,c,r,i,!1),void lt(e);case"select":Tu("invalid",e);var h=r=s=null;for(i in n)if(n.hasOwnProperty(i)&&null!=(o=n[i]))switch(i){case"value":s=o;break;case"defaultValue":r=o;break;case"multiple":h=o;default:Vu(e,t,i,o,n,null)}return t=s,n=r,e.multiple=!!h,void(null!=t?gt(e,!!h,t,!1):null!=n&&gt(e,!!h,n,!0));case"textarea":for(r in Tu("invalid",e),s=i=h=null,n)if(n.hasOwnProperty(r)&&null!=(o=n[r]))switch(r){case"value":h=o;break;case"defaultValue":i=o;break;case"children":s=o;break;case"dangerouslySetInnerHTML":if(null!=o)throw Error(a(91));break;default:Vu(e,t,r,o,n,null)}return yt(e,h,i,s),void lt(e);case"option":for(o in n)n.hasOwnProperty(o)&&null!=(h=n[o])&&("selected"===o?e.selected=h&&"function"!=typeof h&&"symbol"!=typeof h:Vu(e,t,o,h,n,null));return;case"dialog":Tu("cancel",e),Tu("close",e);break;case"iframe":case"object":Tu("load",e);break;case"video":case"audio":for(h=0;h<Su.length;h++)Tu(Su[h],e);break;case"image":Tu("error",e),Tu("load",e);break;case"details":Tu("toggle",e);break;case"embed":case"source":case"img":case"link":Tu("error",e),Tu("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(l in n)if(n.hasOwnProperty(l)&&null!=(h=n[l]))switch(l){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,t));default:Vu(e,t,l,h,n,null)}return;default:if(St(t)){for(c in n)n.hasOwnProperty(c)&&void 0!==(h=n[c])&&ju(e,t,c,h,n,void 0);return}}for(s in n)n.hasOwnProperty(s)&&null!=(h=n[s])&&Vu(e,t,s,h,n,null)}function Gu(e,t,n,i){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var r=null,s=null,o=null,l=null,c=null,u=null,h=null;for(f in n){var d=n[f];if(n.hasOwnProperty(f)&&null!=d)switch(f){case"checked":case"value":break;case"defaultValue":c=d;default:i.hasOwnProperty(f)||Vu(e,t,f,null,i,d)}}for(var p in i){var f=i[p];if(d=n[p],i.hasOwnProperty(p)&&(null!=f||null!=d))switch(p){case"type":s=f;break;case"name":r=f;break;case"checked":u=f;break;case"defaultChecked":h=f;break;case"value":o=f;break;case"defaultValue":l=f;break;case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(a(137,t));break;default:f!==d&&Vu(e,t,p,f,i,d)}}return void pt(e,o,l,c,u,h,s,r);case"select":for(s in f=o=l=p=null,n)if(c=n[s],n.hasOwnProperty(s)&&null!=c)switch(s){case"value":break;case"multiple":f=c;default:i.hasOwnProperty(s)||Vu(e,t,s,null,i,c)}for(r in i)if(s=i[r],c=n[r],i.hasOwnProperty(r)&&(null!=s||null!=c))switch(r){case"value":p=s;break;case"defaultValue":l=s;break;case"multiple":o=s;default:s!==c&&Vu(e,t,r,s,i,c)}return t=l,n=o,i=f,void(null!=p?gt(e,!!n,p,!1):!!i!=!!n&&(null!=t?gt(e,!!n,t,!0):gt(e,!!n,n?[]:"",!1)));case"textarea":for(l in f=p=null,n)if(r=n[l],n.hasOwnProperty(l)&&null!=r&&!i.hasOwnProperty(l))switch(l){case"value":case"children":break;default:Vu(e,t,l,null,i,r)}for(o in i)if(r=i[o],s=n[o],i.hasOwnProperty(o)&&(null!=r||null!=s))switch(o){case"value":p=r;break;case"defaultValue":f=r;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=r)throw Error(a(91));break;default:r!==s&&Vu(e,t,o,r,i,s)}return void vt(e,p,f);case"option":for(var m in n)p=n[m],n.hasOwnProperty(m)&&null!=p&&!i.hasOwnProperty(m)&&("selected"===m?e.selected=!1:Vu(e,t,m,null,i,p));for(c in i)p=i[c],f=n[c],!i.hasOwnProperty(c)||p===f||null==p&&null==f||("selected"===c?e.selected=p&&"function"!=typeof p&&"symbol"!=typeof p:Vu(e,t,c,p,i,f));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in n)p=n[g],n.hasOwnProperty(g)&&null!=p&&!i.hasOwnProperty(g)&&Vu(e,t,g,null,i,p);for(u in i)if(p=i[u],f=n[u],i.hasOwnProperty(u)&&p!==f&&(null!=p||null!=f))switch(u){case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(a(137,t));break;default:Vu(e,t,u,p,i,f)}return;default:if(St(t)){for(var v in n)p=n[v],n.hasOwnProperty(v)&&void 0!==p&&!i.hasOwnProperty(v)&&ju(e,t,v,void 0,i,p);for(h in i)p=i[h],f=n[h],!i.hasOwnProperty(h)||p===f||void 0===p&&void 0===f||ju(e,t,h,p,i,f);return}}for(var y in n)p=n[y],n.hasOwnProperty(y)&&null!=p&&!i.hasOwnProperty(y)&&Vu(e,t,y,null,i,p);for(d in i)p=i[d],f=n[d],!i.hasOwnProperty(d)||p===f||null==p&&null==f||Vu(e,t,d,p,i,f)}var Wu=null,Xu=null;function qu(e){return 9===e.nodeType?e:e.ownerDocument}function Yu(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function $u(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function Zu(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"bigint"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Ku=null;var Ju="function"==typeof setTimeout?setTimeout:void 0,Qu="function"==typeof clearTimeout?clearTimeout:void 0,eh="function"==typeof Promise?Promise:void 0,th="function"==typeof queueMicrotask?queueMicrotask:void 0!==eh?function(e){return eh.resolve(null).then(e).catch(nh)}:Ju;function nh(e){setTimeout((function(){throw e}))}function ih(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void ud(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);ud(t)}function rh(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":rh(n),He(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function sh(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}function ah(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}function oh(e,t,n){switch(t=qu(n),e){case"html":if(!(e=t.documentElement))throw Error(a(452));return e;case"head":if(!(e=t.head))throw Error(a(453));return e;case"body":if(!(e=t.body))throw Error(a(454));return e;default:throw Error(a(451))}}var lh=new Map,ch=new Set;function uh(e){return"function"==typeof e.getRootNode?e.getRootNode():e.ownerDocument}var hh=F.d;F.d={f:function(){var e=hh.f(),t=Dc();return e||t},r:function(e){var t=We(e);null!==t&&5===t.tag&&"form"===t.type?ca(t):hh.r(e)},D:function(e){hh.D(e),ph("dns-prefetch",e,null)},C:function(e,t){hh.C(e,t),ph("preconnect",e,t)},L:function(e,t,n){hh.L(e,t,n);var i=dh;if(i&&e&&t){var r='link[rel="preload"][as="'+dt(t)+'"]';"image"===t&&n&&n.imageSrcSet?(r+='[imagesrcset="'+dt(n.imageSrcSet)+'"]',"string"==typeof n.imageSizes&&(r+='[imagesizes="'+dt(n.imageSizes)+'"]')):r+='[href="'+dt(e)+'"]';var s=r;switch(t){case"style":s=mh(e);break;case"script":s=yh(e)}lh.has(s)||(e=A({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),lh.set(s,e),null!==i.querySelector(r)||"style"===t&&i.querySelector(gh(s))||"script"===t&&i.querySelector(bh(s))||(Hu(t=i.createElement("link"),"link",e),Ye(t),i.head.appendChild(t)))}},m:function(e,t){hh.m(e,t);var n=dh;if(n&&e){var i=t&&"string"==typeof t.as?t.as:"script",r='link[rel="modulepreload"][as="'+dt(i)+'"][href="'+dt(e)+'"]',s=r;switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":s=yh(e)}if(!lh.has(s)&&(e=A({rel:"modulepreload",href:e},t),lh.set(s,e),null===n.querySelector(r))){switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(bh(s)))return}Hu(i=n.createElement("link"),"link",e),Ye(i),n.head.appendChild(i)}}},X:function(e,t){hh.X(e,t);var n=dh;if(n&&e){var i=qe(n).hoistableScripts,r=yh(e),s=i.get(r);s||((s=n.querySelector(bh(r)))||(e=A({src:e,async:!0},t),(t=lh.get(r))&&Sh(e,t),Ye(s=n.createElement("script")),Hu(s,"link",e),n.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},i.set(r,s))}},S:function(e,t,n){hh.S(e,t,n);var i=dh;if(i&&e){var r=qe(i).hoistableStyles,s=mh(e);t=t||"default";var a=r.get(s);if(!a){var o={loading:0,preload:null};if(a=i.querySelector(gh(s)))o.loading=5;else{e=A({rel:"stylesheet",href:e,"data-precedence":t},n),(n=lh.get(s))&&wh(e,n);var l=a=i.createElement("link");Ye(l),Hu(l,"link",e),l._p=new Promise((function(e,t){l.onload=e,l.onerror=t})),l.addEventListener("load",(function(){o.loading|=1})),l.addEventListener("error",(function(){o.loading|=2})),o.loading|=4,_h(a,t,i)}a={type:"stylesheet",instance:a,count:1,state:o},r.set(s,a)}}},M:function(e,t){hh.M(e,t);var n=dh;if(n&&e){var i=qe(n).hoistableScripts,r=yh(e),s=i.get(r);s||((s=n.querySelector(bh(r)))||(e=A({src:e,async:!0,type:"module"},t),(t=lh.get(r))&&Sh(e,t),Ye(s=n.createElement("script")),Hu(s,"link",e),n.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},i.set(r,s))}}};var dh="undefined"==typeof document?null:document;function ph(e,t,n){var i=dh;if(i&&"string"==typeof t&&t){var r=dt(t);r='link[rel="'+e+'"][href="'+r+'"]',"string"==typeof n&&(r+='[crossorigin="'+n+'"]'),ch.has(r)||(ch.add(r),e={rel:e,crossOrigin:n,href:t},null===i.querySelector(r)&&(Hu(t=i.createElement("link"),"link",e),Ye(t),i.head.appendChild(t)))}}function fh(e,t,n,i){var r=(r=Y.current)?uh(r):null;if(!r)throw Error(a(446));switch(e){case"meta":case"title":return null;case"style":return"string"==typeof n.precedence&&"string"==typeof n.href?(t=mh(n.href),(i=(n=qe(r).hoistableStyles).get(t))||(i={type:"style",instance:null,count:0,state:null},n.set(t,i)),i):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"==typeof n.href&&"string"==typeof n.precedence){e=mh(n.href);var s=qe(r).hoistableStyles,o=s.get(e);if(o||(r=r.ownerDocument||r,o={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},s.set(e,o),(s=r.querySelector(gh(e)))&&!s._p&&(o.instance=s,o.state.loading=5),lh.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},lh.set(e,n),s||function(e,t,n,i){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?i.loading=1:(t=e.createElement("link"),i.preload=t,t.addEventListener("load",(function(){return i.loading|=1})),t.addEventListener("error",(function(){return i.loading|=2})),Hu(t,"link",n),Ye(t),e.head.appendChild(t))}(r,e,n,o.state))),t&&null===i)throw Error(a(528,""));return o}if(t&&null!==i)throw Error(a(529,""));return null;case"script":return t=n.async,"string"==typeof(n=n.src)&&t&&"function"!=typeof t&&"symbol"!=typeof t?(t=yh(n),(i=(n=qe(r).hoistableScripts).get(t))||(i={type:"script",instance:null,count:0,state:null},n.set(t,i)),i):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,e))}}function mh(e){return'href="'+dt(e)+'"'}function gh(e){return'link[rel="stylesheet"]['+e+"]"}function vh(e){return A({},e,{"data-precedence":e.precedence,precedence:null})}function yh(e){return'[src="'+dt(e)+'"]'}function bh(e){return"script[async]"+e}function xh(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var i=e.querySelector('style[data-href~="'+dt(n.href)+'"]');if(i)return t.instance=i,Ye(i),i;var r=A({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return Ye(i=(e.ownerDocument||e).createElement("style")),Hu(i,"style",r),_h(i,n.precedence,e),t.instance=i;case"stylesheet":r=mh(n.href);var s=e.querySelector(gh(r));if(s)return t.state.loading|=4,t.instance=s,Ye(s),s;i=vh(n),(r=lh.get(r))&&wh(i,r),Ye(s=(e.ownerDocument||e).createElement("link"));var o=s;return o._p=new Promise((function(e,t){o.onload=e,o.onerror=t})),Hu(s,"link",i),t.state.loading|=4,_h(s,n.precedence,e),t.instance=s;case"script":return s=yh(n.src),(r=e.querySelector(bh(s)))?(t.instance=r,Ye(r),r):(i=n,(r=lh.get(s))&&Sh(i=A({},n),r),Ye(r=(e=e.ownerDocument||e).createElement("script")),Hu(r,"link",i),e.head.appendChild(r),t.instance=r);case"void":return null;default:throw Error(a(443,t.type))}else"stylesheet"===t.type&&!(4&t.state.loading)&&(i=t.instance,t.state.loading|=4,_h(i,n.precedence,e));return t.instance}function _h(e,t,n){for(var i=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),r=i.length?i[i.length-1]:null,s=r,a=0;a<i.length;a++){var o=i[a];if(o.dataset.precedence===t)s=o;else if(s!==r)break}s?s.parentNode.insertBefore(e,s.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function wh(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function Sh(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var Mh=null;function Eh(e,t,n){if(null===Mh){var i=new Map,r=Mh=new Map;r.set(n,i)}else(i=(r=Mh).get(n))||(i=new Map,r.set(n,i));if(i.has(e))return i;for(i.set(e,null),n=n.getElementsByTagName(e),r=0;r<n.length;r++){var s=n[r];if(!(s[je]||s[Ne]||"link"===e&&"stylesheet"===s.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==s.namespaceURI){var a=s.getAttribute(t)||"";a=e+a;var o=i.get(a);o?o.push(s):i.set(a,[s])}}return i}function Th(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function Ah(e){return!!("stylesheet"!==e.type||3&e.state.loading)}var Ch=null;function Rh(){}function Ph(){if(this.count--,0===this.count)if(this.stylesheets)Ih(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var kh=null;function Ih(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,kh=new Map,t.forEach(Oh,e),kh=null,Ph.call(e))}function Oh(e,t){if(!(4&t.state.loading)){var n=kh.get(e);if(n)var i=n.get(null);else{n=new Map,kh.set(e,n);for(var r=e.querySelectorAll("link[data-precedence],style[data-precedence]"),s=0;s<r.length;s++){var a=r[s];"link"!==a.nodeName&&"not all"===a.getAttribute("media")||(n.set(a.dataset.precedence,a),i=a)}i&&n.set(null,i)}a=(r=t.instance).getAttribute("data-precedence"),(s=n.get(a)||i)===i&&n.set(null,r),n.set(a,r),this.count++,i=Ph.bind(this),r.addEventListener("load",i),r.addEventListener("error",i),s?s.parentNode.insertBefore(r,s.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(r,e.firstChild),t.state.loading|=4}}function Lh(e,t,n,i,r,s,a,o){this.tag=1,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Re(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Re(0),this.hiddenUpdates=Re(null),this.identifierPrefix=i,this.onUncaughtError=r,this.onCaughtError=s,this.onRecoverableError=a,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=o,this.incompleteTransitions=new Map}function Nh(e,t,n,i,r,s){r=function(e){return e?e=Ri:Ri}(r),null===i.context?i.context=r:i.pendingContext=r,(i=_o(t)).payload={element:n},null!==(s=void 0===s?null:s)&&(i.callback=s),null!==(n=wo(e,i,t))&&(Ac(n,0,t),So(n,e,t))}function Dh(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function zh(e,t){Dh(e,t),(e=e.alternate)&&Dh(e,t)}function Uh(e){if(13===e.tag){var t=Ti(e,67108864);null!==t&&Ac(t,0,67108864),zh(e,67108864)}}var Fh=!0;function Bh(e,t,n,i){var r=T.T;T.T=null;var s=F.p;try{F.p=2,jh(e,t,n,i)}finally{F.p=s,T.T=r}}function Vh(e,t,n,i){var r=T.T;T.T=null;var s=F.p;try{F.p=8,jh(e,t,n,i)}finally{F.p=s,T.T=r}}function jh(e,t,n,i){if(Fh){var r=Hh(i);if(null===r)ku(e,t,i,Gh,n),td(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return Yh=nd(Yh,e,t,n,i,r),!0;case"dragenter":return $h=nd($h,e,t,n,i,r),!0;case"mouseover":return Zh=nd(Zh,e,t,n,i,r),!0;case"pointerover":var s=r.pointerId;return Kh.set(s,nd(Kh.get(s)||null,e,t,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Jh.set(s,nd(Jh.get(s)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(td(e,i),4&t&&-1<ed.indexOf(e)){for(;null!==r;){var s=We(r);if(null!==s)switch(s.tag){case 3:if((s=s.stateNode).current.memoizedState.isDehydrated){var a=Se(s.pendingLanes);if(0!==a){var o=s;for(o.pendingLanes|=2,o.entangledLanes|=2;a;){var l=1<<31-ye(a);o.entanglements[1]|=l,a&=~l}fu(s),!(6&Kl)&&(mc=ae()+500,mu())}}break;case 13:null!==(o=Ti(s,2))&&Ac(o,0,2),Dc(),zh(s,2)}if(null===(s=Hh(i))&&ku(e,t,i,Gh,n),s===r)break;r=s}null!==r&&i.stopPropagation()}else ku(e,t,i,null,n)}}function Hh(e){return Wh(e=Ct(e))}var Gh=null;function Wh(e){if(Gh=null,null!==(e=Ge(e))){var t=O(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=L(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Gh=e,null}function Xh(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(oe()){case le:return 2;case ce:return 8;case ue:case he:return 32;case de:return 268435456;default:return 32}default:return 32}}var qh=!1,Yh=null,$h=null,Zh=null,Kh=new Map,Jh=new Map,Qh=[],ed="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function td(e,t){switch(e){case"focusin":case"focusout":Yh=null;break;case"dragenter":case"dragleave":$h=null;break;case"mouseover":case"mouseout":Zh=null;break;case"pointerover":case"pointerout":Kh.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jh.delete(t.pointerId)}}function nd(e,t,n,i,r,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},null!==t&&null!==(t=We(t))&&Uh(t),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function id(e){var t=Ge(e.target);if(null!==t){var n=O(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=L(n)))return e.blockedOn=t,void function(e){var t=F.p;try{return F.p=e,function(){if(13===n.tag){var e=Ec(),t=Ti(n,e);null!==t&&Ac(t,0,e),zh(n,e)}}()}finally{F.p=t}}(e.priority)}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function rd(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Hh(e.nativeEvent);if(null!==n)return null!==(t=We(n))&&Uh(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);At=i,n.target.dispatchEvent(i),At=null,t.shift()}return!0}function sd(e,t,n){rd(e)&&n.delete(t)}function ad(){qh=!1,null!==Yh&&rd(Yh)&&(Yh=null),null!==$h&&rd($h)&&($h=null),null!==Zh&&rd(Zh)&&(Zh=null),Kh.forEach(sd),Jh.forEach(sd)}function od(e,t){e.blockedOn===t&&(e.blockedOn=null,qh||(qh=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,ad)))}var ld=null;function cd(e){ld!==e&&(ld=e,i.unstable_scheduleCallback(i.unstable_NormalPriority,(function(){ld===e&&(ld=null);for(var t=0;t<e.length;t+=3){var n=e[t],i=e[t+1],r=e[t+2];if("function"!=typeof i){if(null===Wh(i||n))continue;break}var s=We(n);null!==s&&(e.splice(t,3),t-=3,oa(s,{pending:!0,data:r,method:n.method,action:i},i,r))}})))}function ud(e){function t(t){return od(t,e)}null!==Yh&&od(Yh,e),null!==$h&&od($h,e),null!==Zh&&od(Zh,e),Kh.forEach(t),Jh.forEach(t);for(var n=0;n<Qh.length;n++){var i=Qh[n];i.blockedOn===e&&(i.blockedOn=null)}for(;0<Qh.length&&null===(n=Qh[0]).blockedOn;)id(n),null===n.blockedOn&&Qh.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(i=0;i<n.length;i+=3){var r=n[i],s=n[i+1],a=r[De]||null;if("function"==typeof s)a||cd(n);else if(a){var o=null;if(s&&s.hasAttribute("formAction")){if(r=s,a=s[De]||null)o=a.formAction;else if(null!==Wh(r))continue}else o=a.action;"function"==typeof o?n[i+1]=o:(n.splice(i,3),i-=3),cd(n)}}}function hd(e){this._internalRoot=e}function dd(e){this._internalRoot=e}dd.prototype.render=hd.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Nh(t.current,Ec(),e,t,null,null)},dd.prototype.unmount=hd.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;0===e.tag&&Qc(),Nh(e.current,2,null,e,null,null),Dc(),t[ze]=null}},dd.prototype.unstable_scheduleHydration=function(e){if(e){var t=Oe();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Qh.length&&0!==t&&t<Qh[n].priority;n++);Qh.splice(n,0,e),0===n&&id(e)}};var pd=r.version;if("19.0.0-rc-fb9a90fa48-20240614"!==pd)throw Error(a(527,pd,"19.0.0-rc-fb9a90fa48-20240614"));F.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return null===(e=D(t))?null:e.stateNode};var fd={findFiberByHostInstance:Ge,bundleType:0,version:"19.0.0-rc-fb9a90fa48-20240614",rendererPackageName:"react-dom"},md={bundleType:fd.bundleType,version:fd.version,rendererPackageName:fd.rendererPackageName,rendererConfig:fd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:T,findHostInstanceByFiber:function(e){return null===(e=D(e))?null:e.stateNode},findFiberByHostInstance:fd.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"19.0.0-rc-fb9a90fa48-20240614"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var gd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!gd.isDisabled&&gd.supportsFiber)try{me=gd.inject(md),ge=gd}catch(e){}}t.createRoot=function(e,t){if(!(n=e)||1!==n.nodeType&&9!==n.nodeType&&11!==n.nodeType)throw Error(a(299));var n,i=!1,r="",s=Ea,o=Ta,l=Aa;return null!=t&&(!0===t.unstable_strictMode&&(i=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onUncaughtError&&(s=t.onUncaughtError),void 0!==t.onCaughtError&&(o=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),t=function(e,t,n,i,r,s,a,o,l,c,u,h,d){return e=new Lh(e,t,n,o,l,c,u,d),t=1,!0===s&&(t|=24),s=Il(3,null,null,t),e.current=s,s.stateNode=e,(t=zr()).refCount++,e.pooledCache=t,t.refCount++,s.memoizedState={element:i,isDehydrated:n,cache:t},bo(s),e}(e,1,!1,null,0,i,0,r,s,o,l,0,null),e[ze]=t.current,Ru(8===e.nodeType?e.parentNode:e),new hd(t)}},259:(e,t,n)=>{function i(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=n(810).__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function s(){}var a={d:{f:s,r:function(){throw Error(i(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},o=Symbol.for("react.portal");function l(e,t){return"font"===e?"":"string"==typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(i(299));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:o,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=r.T,n=a.p;try{if(r.T=null,a.p=2,e)return e()}finally{r.T=t,a.p=n,a.d.f()}},t.preconnect=function(e,t){"string"==typeof e&&(t=t?"string"==typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:null,a.d.C(e,t))},t.prefetchDNS=function(e){"string"==typeof e&&a.d.D(e)},t.preinit=function(e,t){if("string"==typeof e&&t&&"string"==typeof t.as){var n=t.as,i=l(n,t.crossOrigin),r="string"==typeof t.integrity?t.integrity:void 0,s="string"==typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?a.d.S(e,"string"==typeof t.precedence?t.precedence:void 0,{crossOrigin:i,integrity:r,fetchPriority:s}):"script"===n&&a.d.X(e,{crossOrigin:i,integrity:r,fetchPriority:s,nonce:"string"==typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"==typeof e)if("object"==typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=l(t.as,t.crossOrigin);a.d.M(e,{crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0})}}else null==t&&a.d.M(e)},t.preload=function(e,t){if("string"==typeof e&&"object"==typeof t&&null!==t&&"string"==typeof t.as){var n=t.as,i=l(n,t.crossOrigin);a.d.L(e,n,{crossOrigin:i,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0,type:"string"==typeof t.type?t.type:void 0,fetchPriority:"string"==typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"==typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"==typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"==typeof t.imageSizes?t.imageSizes:void 0,media:"string"==typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"==typeof e)if(t){var n=l(t.as,t.crossOrigin);a.d.m(e,{as:"string"==typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0})}else a.d.m(e)},t.requestFormReset=function(e){a.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return r.H.useFormState(e,t,n)},t.useFormStatus=function(){return r.H.useHostTransitionStatus()},t.version="19.0.0-rc-fb9a90fa48-20240614"},140:(e,t,n)=>{!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(305)},483:(e,t,n)=>{!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(259)},491:(e,t)=>{var n=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator,f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var x=b.prototype=new y;x.constructor=b,m(x,v.prototype),x.isPureReactComponent=!0;var _=Array.isArray,w={H:null,A:null,T:null,S:null},S=Object.prototype.hasOwnProperty;function M(e,t,i,r,s,a,o){return i=o.ref,{$$typeof:n,type:e,key:t,ref:void 0!==i?i:null,props:o}}function E(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var T=/\/+/g;function A(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function C(){}function R(e,t,r,s,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l,c,u=!1;if(null===e)u=!0;else switch(o){case"bigint":case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case i:u=!0;break;case d:return R((u=e._init)(e._payload),t,r,s,a)}}if(u)return a=a(e),u=""===s?"."+A(e,0):s,_(a)?(r="",null!=u&&(r=u.replace(T,"$&/")+"/"),R(a,t,r,"",(function(e){return e}))):null!=a&&(E(a)&&(l=a,c=r+(null==a.key||e&&e.key===a.key?"":(""+a.key).replace(T,"$&/")+"/")+u,a=M(l.type,c,null,0,0,0,l.props)),t.push(a)),1;u=0;var h,f=""===s?".":s+":";if(_(e))for(var m=0;m<e.length;m++)u+=R(s=e[m],t,r,o=f+A(s,m),a);else if("function"==typeof(m=null===(h=e)||"object"!=typeof h?null:"function"==typeof(h=p&&h[p]||h["@@iterator"])?h:null))for(e=m.call(e),m=0;!(s=e.next()).done;)u+=R(s=s.value,t,r,o=f+A(s,m++),a);else if("object"===o){if("function"==typeof e.then)return R(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"==typeof e.status?e.then(C,C):(e.status="pending",e.then((function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)}),(function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)}))),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,r,s,a);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return u}function P(e,t,n){if(null==e)return e;var i=[],r=0;return R(e,i,"","",(function(e){return t.call(n,e,r++)})),i}function k(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var I="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function O(){}t.Children={map:P,forEach:function(e,t,n){P(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return P(e,(function(){t++})),t},toArray:function(e){return P(e,(function(e){return e}))||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=r,t.Profiler=a,t.PureComponent=b,t.StrictMode=s,t.Suspense=u,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=w,t.act=function(){throw Error("act(...) is not supported in production builds of React.")},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,n){if(null==e)throw Error("The argument must be a React element, but you passed "+e+".");var i=m({},e.props),r=e.key;if(null!=t)for(s in t.ref,void 0!==t.key&&(r=""+t.key),t)!S.call(t,s)||"key"===s||"__self"===s||"__source"===s||"ref"===s&&void 0===t.ref||(i[s]=t[s]);var s=arguments.length-2;if(1===s)i.children=n;else if(1<s){for(var a=Array(s),o=0;o<s;o++)a[o]=arguments[o+2];i.children=a}return M(e.type,r,null,0,0,0,i)},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:o,_context:e},e},t.createElement=function(e,t,n){var i,r={},s=null;if(null!=t)for(i in void 0!==t.key&&(s=""+t.key),t)S.call(t,i)&&"key"!==i&&"__self"!==i&&"__source"!==i&&(r[i]=t[i]);var a=arguments.length-2;if(1===a)r.children=n;else if(1<a){for(var o=Array(a),l=0;l<a;l++)o[l]=arguments[l+2];r.children=o}if(e&&e.defaultProps)for(i in a=e.defaultProps)void 0===r[i]&&(r[i]=a[i]);return M(e,s,null,0,0,0,r)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:k}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=w.T,n={};w.T=n;try{var i=e(),r=w.S;null!==r&&r(n,i),"object"==typeof i&&null!==i&&"function"==typeof i.then&&i.then(O,I)}catch(e){I(e)}finally{w.T=t}},t.unstable_useCacheRefresh=function(){return w.H.useCacheRefresh()},t.use=function(e){return w.H.use(e)},t.useActionState=function(e,t,n){return w.H.useActionState(e,t,n)},t.useCallback=function(e,t){return w.H.useCallback(e,t)},t.useContext=function(e){return w.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return w.H.useDeferredValue(e,t)},t.useEffect=function(e,t){return w.H.useEffect(e,t)},t.useId=function(){return w.H.useId()},t.useImperativeHandle=function(e,t,n){return w.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return w.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return w.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return w.H.useMemo(e,t)},t.useOptimistic=function(e,t){return w.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return w.H.useReducer(e,t,n)},t.useRef=function(e){return w.H.useRef(e)},t.useState=function(e){return w.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return w.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return w.H.useTransition()},t.version="19.0.0-rc-fb9a90fa48-20240614"},810:(e,t,n)=>{e.exports=n(491)},195:(e,t)=>{function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<s(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,a=r>>>1;i<a;){var o=2*(i+1)-1,l=e[o],c=o+1,u=e[c];if(0>s(l,n))c<r&&0>s(u,l)?(e[i]=u,e[c]=n,i=c):(e[i]=l,e[o]=n,i=o);else{if(!(c<r&&0>s(u,n)))break e;e[i]=u,e[c]=n,i=c}}}return t}function s(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(t.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],h=1,d=null,p=3,f=!1,m=!1,g=!1,v="function"==typeof setTimeout?setTimeout:null,y="function"==typeof clearTimeout?clearTimeout:null,b="undefined"!=typeof setImmediate?setImmediate:null;function x(e){for(var t=i(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(c,t)}t=i(u)}}function _(e){if(g=!1,x(e),!m)if(null!==i(c))m=!0,k();else{var t=i(u);null!==t&&I(_,t.startTime-e)}}var w,S=!1,M=-1,E=5,T=-1;function A(){return!(t.unstable_now()-T<E)}function C(){if(S){var e=t.unstable_now();T=e;var n=!0;try{e:{m=!1,g&&(g=!1,y(M),M=-1),f=!0;var s=p;try{t:{for(x(e),d=i(c);null!==d&&!(d.expirationTime>e&&A());){var a=d.callback;if("function"==typeof a){d.callback=null,p=d.priorityLevel;var o=a(d.expirationTime<=e);if(e=t.unstable_now(),"function"==typeof o){d.callback=o,x(e),n=!0;break t}d===i(c)&&r(c),x(e)}else r(c);d=i(c)}if(null!==d)n=!0;else{var l=i(u);null!==l&&I(_,l.startTime-e),n=!1}}break e}finally{d=null,p=s,f=!1}n=void 0}}finally{n?w():S=!1}}}if("function"==typeof b)w=function(){b(C)};else if("undefined"!=typeof MessageChannel){var R=new MessageChannel,P=R.port2;R.port1.onmessage=C,w=function(){P.postMessage(null)}}else w=function(){v(C,0)};function k(){S||(S=!0,w())}function I(e,n){M=v((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,k())},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,r,s){var a=t.unstable_now();switch(s="object"==typeof s&&null!==s&&"number"==typeof(s=s.delay)&&0<s?a+s:a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:h++,callback:r,priorityLevel:e,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>a?(e.sortIndex=s,n(u,e),null===i(c)&&e===i(u)&&(g?(y(M),M=-1):g=!0,I(_,s-a))):(e.sortIndex=o,n(c,e),m||f||(m=!0,k())),e},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},328:(e,t,n)=>{e.exports=n(195)}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,n),s.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};n.r(i),n.d(i,{ArcCurve:()=>sg,CatmullRomCurve3:()=>hg,CubicBezierCurve:()=>mg,CubicBezierCurve3:()=>gg,EllipseCurve:()=>rg,LineCurve:()=>vg,LineCurve3:()=>yg,QuadraticBezierCurve:()=>bg,QuadraticBezierCurve3:()=>xg,SplineCurve:()=>_g});var r=n(810),s=n(140);const a=console.warn.bind(console);console.warn=(...e)=>{"string"==typeof e[0]&&e[0].includes("computations created outside")||a(...e)};const o={context:void 0,registry:void 0,effects:void 0,done:!1,getContextId(){return l(this.context.count)},getNextContextId(){return l(this.context.count++)}};function l(e){const t=String(e),n=t.length-1;return o.context.id+(n?String.fromCharCode(96+n):"")+t}function c(e){o.context=e}const u=Symbol("solid-proxy"),h="function"==typeof Proxy,d=Symbol("solid-track"),p=(Symbol("solid-dev-component"),{equals:(e,t)=>e===t});let f=q;const m=1,g=2,v={owned:null,cleanups:null,context:null,owner:null};var y=null;let b=null,x=null,_=null,w=null,S=null,M=null,E=0;function T(e,t){const n=w,i=y,r=0===e.length,s=void 0===t?i:t,a=r?v:{owned:null,cleanups:null,context:s?s.context:null,owner:s},o=r?e:()=>e((()=>O((()=>K(a)))));y=a,w=null;try{return X(o,!0)}finally{w=n,y=i}}function A(e,t){const n={value:e,observers:null,observerSlots:null,comparator:(t=t?Object.assign({},p,t):p).equals||void 0};return[B.bind(n),e=>("function"==typeof e&&(e=b&&b.running&&b.sources.has(n)?e(n.tValue):e(n.value)),V(n,e))]}function C(e,t,n){const i=G(e,t,!0,m);x&&b&&b.running?S.push(i):j(i)}function R(e,t,n){const i=G(e,t,!1,m);x&&b&&b.running?S.push(i):j(i)}function P(e,t,n){f=Y;const i=G(e,t,!1,m),r=F&&function(e){let t;return y&&y.context&&void 0!==(t=y.context[e.id])?t:e.defaultValue}(F);r&&(i.suspense=r),n&&n.render||(i.user=!0),M?M.push(i):j(i)}function k(e,t,n){n=n?Object.assign({},p,n):p;const i=G(e,t,!0,0);return i.observers=null,i.observerSlots=null,i.comparator=n.equals||void 0,x&&b&&b.running?(i.tState=m,S.push(i)):j(i),B.bind(i)}function I(e){return X(e,!1)}function O(e){if(!_&&null===w)return e();const t=w;w=null;try{return _?_.untrack(e):e()}finally{w=t}}function L(e){return null===y||(null===y.cleanups?y.cleanups=[e]:y.cleanups.push(e)),e}function N(){return w}function D(){return y}const[z,U]=A(!1);let F;function B(){const e=b&&b.running;if(this.sources&&(e?this.tState:this.state))if((e?this.tState:this.state)===m)j(this);else{const e=S;S=null,X((()=>$(this)),!1),S=e}if(w){const e=this.observers?this.observers.length:0;w.sources?(w.sources.push(this),w.sourceSlots.push(e)):(w.sources=[this],w.sourceSlots=[e]),this.observers?(this.observers.push(w),this.observerSlots.push(w.sources.length-1)):(this.observers=[w],this.observerSlots=[w.sources.length-1])}return e&&b.sources.has(this)?this.tValue:this.value}function V(e,t,n){let i=b&&b.running&&b.sources.has(e)?e.tValue:e.value;if(!e.comparator||!e.comparator(i,t)){if(b){const i=b.running;(i||!n&&b.sources.has(e))&&(b.sources.add(e),e.tValue=t),i||(e.value=t)}else e.value=t;e.observers&&e.observers.length&&X((()=>{for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t],i=b&&b.running;i&&b.disposed.has(n)||((i?n.tState:n.state)||(n.pure?S.push(n):M.push(n),n.observers&&Z(n)),i?n.tState=m:n.state=m)}if(S.length>1e6)throw S=[],new Error}),!1)}return t}function j(e){if(!e.fn)return;K(e);const t=E;H(e,b&&b.running&&b.sources.has(e)?e.tValue:e.value,t),b&&!b.running&&b.sources.has(e)&&queueMicrotask((()=>{X((()=>{b&&(b.running=!0),w=y=e,H(e,e.tValue,t),w=y=null}),!1)}))}function H(e,t,n){let i;const r=y,s=w;w=y=e;try{i=e.fn(t)}catch(t){return e.pure&&(b&&b.running?(e.tState=m,e.tOwned&&e.tOwned.forEach(K),e.tOwned=void 0):(e.state=m,e.owned&&e.owned.forEach(K),e.owned=null)),e.updatedAt=n+1,Q(t)}finally{w=s,y=r}(!e.updatedAt||e.updatedAt<=n)&&(null!=e.updatedAt&&"observers"in e?V(e,i,!0):b&&b.running&&e.pure?(b.sources.add(e),e.tValue=i):e.value=i,e.updatedAt=n)}function G(e,t,n,i=m,r){const s={fn:e,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:y,context:y?y.context:null,pure:n};if(b&&b.running&&(s.state=0,s.tState=i),null===y||y!==v&&(b&&b.running&&y.pure?y.tOwned?y.tOwned.push(s):y.tOwned=[s]:y.owned?y.owned.push(s):y.owned=[s]),_&&s.fn){const[e,t]=A(void 0,{equals:!1}),n=_.factory(s.fn,t);L((()=>n.dispose()));const i=()=>function(e){if(b&&b.running)return e(),b.done;const t=w,n=y;return Promise.resolve().then((()=>{let i;return w=t,y=n,(x||F)&&(i=b||(b={sources:new Set,effects:[],promises:new Set,disposed:new Set,queue:new Set,running:!0}),i.done||(i.done=new Promise((e=>i.resolve=e))),i.running=!0),X(e,!1),w=y=null,i?i.done:void 0}))}(t).then((()=>r.dispose())),r=_.factory(s.fn,i);s.fn=t=>(e(),b&&b.running?r.track(t):n.track(t))}return s}function W(e){const t=b&&b.running;if(0===(t?e.tState:e.state))return;if((t?e.tState:e.state)===g)return $(e);if(e.suspense&&O(e.suspense.inFallback))return e.suspense.effects.push(e);const n=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<E);){if(t&&b.disposed.has(e))return;(t?e.tState:e.state)&&n.push(e)}for(let i=n.length-1;i>=0;i--){if(e=n[i],t){let t=e,r=n[i+1];for(;(t=t.owner)&&t!==r;)if(b.disposed.has(t))return}if((t?e.tState:e.state)===m)j(e);else if((t?e.tState:e.state)===g){const t=S;S=null,X((()=>$(e,n[0])),!1),S=t}}}function X(e,t){if(S)return e();let n=!1;t||(S=[]),M?n=!0:M=[],E++;try{const t=e();return function(e){if(S&&(x&&b&&b.running?function(e){for(let t=0;t<e.length;t++){const n=e[t],i=b.queue;i.has(n)||(i.add(n),x((()=>{i.delete(n),X((()=>{b.running=!0,W(n)}),!1),b&&(b.running=!1)})))}}(S):q(S),S=null),e)return;let t;if(b)if(b.promises.size||b.queue.size){if(b.running)return b.running=!1,b.effects.push.apply(b.effects,M),M=null,void U(!0)}else{const e=b.sources,n=b.disposed;M.push.apply(M,b.effects),t=b.resolve;for(const e of M)"tState"in e&&(e.state=e.tState),delete e.tState;b=null,X((()=>{for(const e of n)K(e);for(const t of e){if(t.value=t.tValue,t.owned)for(let e=0,n=t.owned.length;e<n;e++)K(t.owned[e]);t.tOwned&&(t.owned=t.tOwned),delete t.tValue,delete t.tOwned,t.tState=0}U(!1)}),!1)}const n=M;M=null,n.length&&X((()=>f(n)),!1),t&&t()}(n),t}catch(e){n||(M=null),S=null,Q(e)}}function q(e){for(let t=0;t<e.length;t++)W(e[t])}function Y(e){let t,n=0;for(t=0;t<e.length;t++){const i=e[t];i.user?e[n++]=i:W(i)}if(o.context){if(o.count)return o.effects||(o.effects=[]),void o.effects.push(...e.slice(0,n));c()}for(!o.effects||!o.done&&o.count||(e=[...o.effects,...e],n+=o.effects.length,delete o.effects),t=0;t<n;t++)W(e[t])}function $(e,t){const n=b&&b.running;n?e.tState=0:e.state=0;for(let i=0;i<e.sources.length;i+=1){const r=e.sources[i];if(r.sources){const e=n?r.tState:r.state;e===m?r!==t&&(!r.updatedAt||r.updatedAt<E)&&W(r):e===g&&$(r,t)}}}function Z(e){const t=b&&b.running;for(let n=0;n<e.observers.length;n+=1){const i=e.observers[n];(t?i.tState:i.state)||(t?i.tState=g:i.state=g,i.pure?S.push(i):M.push(i),i.observers&&Z(i))}}function K(e){let t;if(e.sources)for(;e.sources.length;){const t=e.sources.pop(),n=e.sourceSlots.pop(),i=t.observers;if(i&&i.length){const e=i.pop(),r=t.observerSlots.pop();n<i.length&&(e.sourceSlots[r]=n,i[n]=e,t.observerSlots[n]=r)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)K(e.tOwned[t]);delete e.tOwned}if(b&&b.running&&e.pure)J(e,!0);else if(e.owned){for(t=e.owned.length-1;t>=0;t--)K(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}b&&b.running?e.tState=0:e.state=0}function J(e,t){if(t||(e.tState=0,b.disposed.add(e)),e.owned)for(let t=0;t<e.owned.length;t++)J(e.owned[t])}function Q(e,t=y){const n=function(e){return e instanceof Error?e:new Error("string"==typeof e?e:"Unknown error",{cause:e})}(e);throw n}Symbol("fallback");function ee(){return!0}const te={get:(e,t,n)=>t===u?n:e.get(t),has:(e,t)=>t===u||e.has(t),set:ee,deleteProperty:ee,getOwnPropertyDescriptor:(e,t)=>({configurable:!0,enumerable:!0,get:()=>e.get(t),set:ee,deleteProperty:ee}),ownKeys:e=>e.keys()};function ne(e){return(e="function"==typeof e?e():e)?e:{}}function ie(){for(let e=0,t=this.length;e<t;++e){const t=this[e]();if(void 0!==t)return t}}const re=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline","allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"]),se=new Set(["innerHTML","textContent","innerText","children"]),ae=Object.assign(Object.create(null),{className:"class",htmlFor:"for"}),oe=Object.assign(Object.create(null),{class:"className",formnovalidate:{$:"formNoValidate",BUTTON:1,INPUT:1},ismap:{$:"isMap",IMG:1},nomodule:{$:"noModule",SCRIPT:1},playsinline:{$:"playsInline",VIDEO:1},readonly:{$:"readOnly",INPUT:1,TEXTAREA:1}});function le(e,t){const n=oe[e];return"object"==typeof n?n[t]?n.$:void 0:n}const ce=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),ue=new Set(["altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","stop","svg","switch","symbol","text","textPath","tref","tspan","use","view","vkern"]),he={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},de="_$DX_DELEGATE";function pe(e,t=window.document){const n=t[de]||(t[de]=new Set);for(let i=0,r=e.length;i<r;i++){const r=e[i];n.has(r)||(n.add(r),t.addEventListener(r,Se))}}function fe(e,t,n){xe(e)||(null==n?e.removeAttribute(t):e.setAttribute(t,n))}function me(e,t,n,i){xe(e)||(null==i?e.removeAttributeNS(t,n):e.setAttributeNS(t,n,i))}function ge(e,t,n,i){if(i)Array.isArray(n)?(e[`$$${t}`]=n[0],e[`$$${t}Data`]=n[1]):e[`$$${t}`]=n;else if(Array.isArray(n)){const i=n[0];e.addEventListener(t,n[0]=t=>i.call(e,n[1],t))}else e.addEventListener(t,n,"function"!=typeof n&&n)}function ve(e,t,n={}){const i=Object.keys(t||{}),r=Object.keys(n);let s,a;for(s=0,a=r.length;s<a;s++){const i=r[s];i&&"undefined"!==i&&!t[i]&&(_e(e,i,!1),delete n[i])}for(s=0,a=i.length;s<a;s++){const r=i[s],a=!!t[r];r&&"undefined"!==r&&n[r]!==a&&a&&(_e(e,r,!0),n[r]=a)}return n}function ye(e,t,n){if(!t)return n?fe(e,"style"):t;const i=e.style;if("string"==typeof t)return i.cssText=t;let r,s;for(s in"string"==typeof n&&(i.cssText=n=void 0),n||(n={}),t||(t={}),n)null==t[s]&&i.removeProperty(s),delete n[s];for(s in t)r=t[s],r!==n[s]&&(i.setProperty(s,r),n[s]=r);return n}function be(e,t,n,i){if(void 0===n||i||(i=[]),"function"!=typeof t)return Me(e,t,i,n);R((i=>Me(e,t(),i,n)),i)}function xe(e){return!!o.context&&!o.done&&(!e||e.isConnected)}function _e(e,t,n){const i=t.trim().split(/\s+/);for(let t=0,r=i.length;t<r;t++)e.classList.toggle(i[t],n)}function we(e,t,n,i,r,s,a){let o,l,c,u,h;if("style"===t)return ye(e,n,i);if("classList"===t)return ve(e,n,i);if(n===i)return i;if("ref"===t)s||n(e);else if("on:"===t.slice(0,3)){const r=t.slice(3);i&&e.removeEventListener(r,i,"function"!=typeof i&&i),n&&e.addEventListener(r,n,"function"!=typeof n&&n)}else if("oncapture:"===t.slice(0,10)){const r=t.slice(10);i&&e.removeEventListener(r,i,!0),n&&e.addEventListener(r,n,!0)}else if("on"===t.slice(0,2)){const r=t.slice(2).toLowerCase(),s=ce.has(r);if(!s&&i){const t=Array.isArray(i)?i[0]:i;e.removeEventListener(r,t)}(s||n)&&(ge(e,r,n,s),s&&pe([r]))}else if("attr:"===t.slice(0,5))fe(e,t.slice(5),n);else if("bool:"===t.slice(0,5))!function(e,t,n){xe(e)||(n?e.setAttribute(t,""):e.removeAttribute(t))}(e,t.slice(5),n);else if((h="prop:"===t.slice(0,5))||(c=se.has(t))||!r&&((u=le(t,e.tagName))||(l=re.has(t)))||(o=e.nodeName.includes("-")||"is"in a)){if(h)t=t.slice(5),l=!0;else if(xe(e))return n;"class"===t||"className"===t?function(e,t){xe(e)||(null==t?e.removeAttribute("class"):e.className=t)}(e,n):!o||l||c?e[u||t]=n:e[(d=t,d.toLowerCase().replace(/-([a-z])/g,((e,t)=>t.toUpperCase())))]=n}else{const i=r&&t.indexOf(":")>-1&&he[t.split(":")[0]];i?me(e,i,t,n):fe(e,ae[t]||t,n)}var d;return n}function Se(e){if(o.registry&&o.events&&o.events.find((([t,n])=>n===e)))return;let t=e.target;const n=`$$${e.type}`,i=e.target,r=e.currentTarget,s=t=>Object.defineProperty(e,"target",{configurable:!0,value:t}),a=()=>{const i=t[n];if(i&&!t.disabled){const r=t[`${n}Data`];if(void 0!==r?i.call(t,r,e):i.call(t,e),e.cancelBubble)return}return t.host&&"string"!=typeof t.host&&!t.host._$host&&t.contains(e.target)&&s(t.host),!0},l=()=>{for(;a()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get:()=>t||document}),o.registry&&!o.done&&(o.done=_$HY.done=!0),e.composedPath){const n=e.composedPath();s(n[0]);for(let e=0;e<n.length-2&&(t=n[e],a());e++){if(t._$host){t=t._$host,l();break}if(t.parentNode===r)break}}else l();s(i)}function Me(e,t,n,i,r){const s=xe(e);if(s){!n&&(n=[...e.childNodes]);let t=[];for(let e=0;e<n.length;e++){const i=n[e];8===i.nodeType&&"!$"===i.data.slice(0,2)?i.remove():t.push(i)}n=t}for(;"function"==typeof n;)n=n();if(t===n)return n;const a=typeof t,o=void 0!==i;if(e=o&&n[0]&&n[0].parentNode||e,"string"===a||"number"===a){if(s)return n;if("number"===a&&(t=t.toString())===n)return n;if(o){let r=n[0];r&&3===r.nodeType?r.data!==t&&(r.data=t):r=document.createTextNode(t),n=Ae(e,n,i,r)}else n=""!==n&&"string"==typeof n?e.firstChild.data=t:e.textContent=t}else if(null==t||"boolean"===a){if(s)return n;n=Ae(e,n,i)}else{if("function"===a)return R((()=>{let r=t();for(;"function"==typeof r;)r=r();n=Me(e,r,n,i)})),()=>n;if(Array.isArray(t)){const a=[],l=n&&Array.isArray(n);if(Ee(a,t,n,r))return R((()=>n=Me(e,a,n,i,!0))),()=>n;if(s){if(!a.length)return n;if(void 0===i)return n=[...e.childNodes];let t=a[0];if(t.parentNode!==e)return n;const r=[t];for(;(t=t.nextSibling)!==i;)r.push(t);return n=r}if(0===a.length){if(n=Ae(e,n,i),o)return n}else l?0===n.length?Te(e,a,i):function(e,t,n){let i=n.length,r=t.length,s=i,a=0,o=0,l=t[r-1].nextSibling,c=null;for(;a<r||o<s;)if(t[a]!==n[o]){for(;t[r-1]===n[s-1];)r--,s--;if(r===a){const t=s<i?o?n[o-1].nextSibling:n[s-o]:l;for(;o<s;)e.insertBefore(n[o++],t)}else if(s===o)for(;a<r;)c&&c.has(t[a])||t[a].remove(),a++;else if(t[a]===n[s-1]&&n[o]===t[r-1]){const i=t[--r].nextSibling;e.insertBefore(n[o++],t[a++].nextSibling),e.insertBefore(n[--s],i),t[r]=n[s]}else{if(!c){c=new Map;let e=o;for(;e<s;)c.set(n[e],e++)}const i=c.get(t[a]);if(null!=i)if(o<i&&i<s){let l,u=a,h=1;for(;++u<r&&u<s&&null!=(l=c.get(t[u]))&&l===i+h;)h++;if(h>i-o){const r=t[a];for(;o<i;)e.insertBefore(n[o++],r)}else e.replaceChild(n[o++],t[a++])}else a++;else t[a++].remove()}}else a++,o++}(e,n,a):(n&&Ae(e),Te(e,a));n=a}else if(t.nodeType){if(s&&t.parentNode)return n=o?[t]:t;if(Array.isArray(n)){if(o)return n=Ae(e,n,i,t);Ae(e,n,null,t)}else null!=n&&""!==n&&e.firstChild?e.replaceChild(t,e.firstChild):e.appendChild(t);n=t}}return n}function Ee(e,t,n,i){let r=!1;for(let s=0,a=t.length;s<a;s++){let a,o=t[s],l=n&&n[e.length];if(null==o||!0===o||!1===o);else if("object"==(a=typeof o)&&o.nodeType)e.push(o);else if(Array.isArray(o))r=Ee(e,o,l)||r;else if("function"===a)if(i){for(;"function"==typeof o;)o=o();r=Ee(e,Array.isArray(o)?o:[o],Array.isArray(l)?l:[l])||r}else e.push(o),r=!0;else{const t=String(o);l&&3===l.nodeType&&l.data===t?e.push(l):e.push(document.createTextNode(t))}}return r}function Te(e,t,n=null){for(let i=0,r=t.length;i<r;i++)e.insertBefore(t[i],n)}function Ae(e,t,n,i){if(void 0===n)return e.textContent="";const r=i||document.createTextNode("");if(t.length){let i=!1;for(let s=t.length-1;s>=0;s--){const a=t[s];if(r!==a){const t=a.parentNode===e;i||s?t&&a.remove():t?e.replaceChild(r,a):e.insertBefore(r,n)}else i=!0}}else e.insertBefore(r,n);return[r]}function Ce(e,t){let n,i=e;for(;i;){if(n=Object.getOwnPropertyDescriptor(i,t),n)return n.owner=i,n;i=i.__proto__}}function Re(e,...t){if(e[u])return e;const n=t.length?t:Object.keys(e).concat(Object.getOwnPropertySymbols(e));for(const t of n){const n=Array.isArray(t),i=n?t[0]:t,r=n?t[1]:O((()=>e[i]));Le(e,i,r)}return e}Symbol();const Pe=new WeakMap;function ke(e,t){return!!Pe.get(e)?.has(t)}function Ie(e,t){Pe.has(e)||Pe.set(e,new Set),Pe.get(e).add(t)}const Oe=new WeakSet;function Le(e,t,n){let i,r,s=Ce(e,t);const a=!(!s?.get&&!s?.set);if(s){if(i=s.get,r=s.set,i&&Oe.has(i))return;if(a&&(!i||!r))return function(e){console.warn(`Cannot signalify property named "${String(e)}" which had a getter or a setter, but not both. Reactivity on accessors works only when accessors have both get and set. Skipped.`)}(t);if(!a){if(!s.writable)return function(e){console.warn(`The \`@signal\` decorator was used on a property named "${String(e)}" that is not writable. Reactivity is not enabled for non-writable properties.`)}(t);n=s.value}}const o=new WeakMap,l={configurable:!0,enumerable:s?.enumerable,get:a?function(){return Ne(this,o,n)(),i.call(this)}:function(){return Ne(this,o,n)()},set:a?function(e){r.call(this,e),Ie(this,t),Ne(this,o,n)("function"==typeof e?()=>e:e)}:function(e){Ie(this,t),Ne(this,o,n)("function"==typeof e?()=>e:e)}};Oe.add(l.get),Object.defineProperty(e,t,l)}function Ne(e,t,n){let i=t.get(e);return i||t.set(e,i=function(e){const[t,n]=A(e,{equals:!1});return function(e){return 0===arguments.length?t():n(e)}}(n)),i}let De=new Map;const ze=Symbol();function Ue(e,t){const{kind:n,name:i,metadata:r}=t,s=De;if(t.static)throw new Error("@signal is not supported on static fields yet.");if(function(e){Fe||(Fe=!0,queueMicrotask((()=>{if(Fe=!1,e===De)throw new Error(`Stray @signal-decorated properties detected: ${Array.from(e.keys()).join(", ")}. Did you forget to use the \`@reactive\` decorator on a class that has properties decorated with \`@signal\`?`)})))}(s),"field"===n){if(t.private&&"#finalize"!==i)throw new Error("@signal is not supported on private fields yet.");return"#finalize"===i?De=new Map:s.set(i,{initialValue:void 0,kind:n}),function(e){if("#finalize"!==i)return s.get(i).initialValue=e,e;if(this[u])return this;for(const[e,t]of s){let n=t.initialValue;if(!Object.hasOwn(this,e))throw new Be(e);Le(this,e,n)}}}if("accessor"===n){const{get:t,set:n}=e,r=new WeakMap;let s;return{init:function(e){return s=e,e},get:function(){return Ne(this,r,s)(),t.call(this)},set:function(e){n.call(this,e),Ie(this,i),Ne(this,r,s)("function"==typeof e?()=>e:e)}}}if("getter"===n||"setter"===n){const t=e,s=ze;Object.hasOwn(r,"signalStoragesPerProp")||(r.signalStoragesPerProp={});const a=r.signalStoragesPerProp;let o=a[i];o||(a[i]=o=new WeakMap),Object.hasOwn(r,"getterSetterPairs")||(r.getterSetterPairs={});const l=r.getterSetterPairs;return queueMicrotask((()=>{if(2!==l[i])throw new Ve(i)})),"getter"===n?(l[i]??=0,l[i]++,function(){return Ne(this,o,s)(),t.call(this)}):(l[i]??=0,l[i]++,function(e){t.call(this,e),Ie(this,i),Ne(this,o,s)("function"==typeof e?()=>e:e)})}throw new je}let Fe=!1;class Be extends Error{constructor(e){super(`Property "${String(e)}" not found on instance of class decorated with \`@reactive\`. Did you forget to use the \`@reactive\` decorator on one of your classes that has a "${String(e)}" property decorated with \`@signal\`?`)}}class Ve extends Error{constructor(e){super(`Missing @signal decorator on setter or getter for property "${String(e)}". The @signal decorator will only work on a getter/setter pair with *both* getter and setter decorated with @signal.`)}}class je extends Error{constructor(){super("The @signal decorator is only for use on fields, getters, setters, and auto accessors.")}}const He=Object.prototype.hasOwnProperty;function Ge(e,t){if("function"!=typeof e||t&&"class"!==t.kind)throw new TypeError("The @reactive decorator is only for use on classes.");const n=e,i=De;return De=new Map,class extends n{constructor(...e){let t;if(N()?O((()=>t=Reflect.construct(n,e,new.target))):(super(...e),t=this),t[u])return t;for(const[e,r]of i){let i=r.initialValue;if(!He.call(t,e)&&!He.call(n.prototype,e))throw new We(e);Le(t,e,i)}return t}}}class We extends Error{constructor(e){super(`Property "${String(e)}" not found on instance of class decorated with \`@reactive\`. Did you forget to use the \`@reactive\` decorator on one of your classes that has a "${String(e)}" property decorated with \`@signal\`?`)}}function Xe(e){return class extends e{#e=new Set;createEffect(e){this.#t(e)}stopEffects(){this.#n()}#i(e){let t=null;t=function(e){const[t,n]=A(!0);return P((()=>t()&&e())),{stop:()=>n(!1),resume:()=>n(!0)}}((()=>{t&&this.#e.add(t),P(e),L((()=>this.#e.delete(t)))})),this.#e.add(t)}#r(){for(const e of this.#e)e.stop()}#s=null;#a=null;#t(e){if(this.#s){let t=D();for(;t&&t!==this.#s;)t=t?.owner??null;if(t===this.#s)return P(e);!function(e,t){const n=y,i=w;y=e,w=null;try{return X(t,!0)}catch(e){Q(e)}finally{y=n,w=i}}(this.#s,(()=>P(e)))}else T((t=>{this.#s=D(),this.#a=t,this.#t(e)}))}#n(){this.#a?.()}}}new Set,new Map;class qe extends(Xe(class{})){}function Ye(e,t,n,i){let r=!1,s=!1;return C((()=>{const t=e();if(s)return s=!1;r=!0,i(t)})),C((()=>{const e=n();if(r)return r=!1;s=!0,t(e)})),[[e,t],[n,i]]}var $e;const Ze=globalThis.HTMLElement??class{constructor(){throw new Error("@lume/element needs a DOM to operate with! If this code is running during server-side rendering, it means your app is trying to instantiate elements when it shouldn't be, and should be refactored to avoid doing that when no DOM is present.")}},Ke=Symbol("root");class Je extends(Xe(Ze)){static elementName="";static defineElement(e=this.elementName,t=customElements){if(!e)return console.warn("defineElement(): Element name cannot be empty. This is a no-op."),this;if(t.get(e))return console.warn(`defineElement(): An element class was already defined for tag name ${e}. This is a no-op.`),t.get(e);const n=t.getName(this)?class extends(this){}:this;return n.elementName=e,t.define(e,n),n}static observedAttributes;static observedAttributeHandlers;#o(){const e=Object.keys(this);this._preUpgradeValues=new Map;for(const t of e){const e=Object.getOwnPropertyDescriptor(this,t);"value"in e&&(delete this[t],this._preUpgradeValues.set(t,e.value),queueMicrotask((()=>{ke(this,t)||t in this.__proto__&&(this[t]=e.value)})))}}#l=this.#o();hasShadow=!0;shadowOptions;[Ke]=null;get templateRoot(){return this.hasShadow?this[Ke]?this[Ke]:this.shadowRoot?this[Ke]=this.shadowRoot:this[Ke]=this.attachShadow({mode:"open",...this.shadowOptions}):this}set templateRoot(e){if(!this.hasShadow)throw new Error("Can not set root, element.hasShadow is false.");if(this[Ke]||this.shadowRoot)throw new Error("Element root can only be set once if there is no ShadowRoot.");this[Ke]=e}get root(){return this.templateRoot}set root(e){this.templateRoot=e}get styleRoot(){return this.templateRoot}attachShadow(e){return this[Ke]&&console.warn("Element already has a root defined."),this[Ke]=super.attachShadow(e)}#c;connectedCallback(){const e=this.template;e&&(this.#c=function(e,t,n,i={}){let r;return T((i=>{r=i,t===document?e():be(t,e(),t.firstChild?null:void 0,n)}),i.owner),()=>{r(),t.textContent=""}}("function"==typeof e?e.bind(this):()=>e,this.templateRoot)),this.#u()}disconnectedCallback(){this.stopEffects(),this.#c?.(),this.#h()}static#d=new WeakMap;#p=null;#f=e=>`${e} {\n\t\tdisplay: block;\n\t}`;static#m=0;#g=$e.#m++;#v=null;#u(){const e=this.constructor,t="function"==typeof e.css?e.css=e.css():e.css||"",n="function"==typeof this.css?this.css():this.css||"";if(this.hasShadow){const e=":host",i=document.createElement("style");i.innerHTML=`\n\t\t\t\t${this.#f(e)}\n\t\t\t\t${t}\n\t\t\t\t${n}\n\t\t\t`,this.styleRoot.appendChild(i)}else{const e=this.getRootNode();this.#p=e===document?document.head:e;let i=$e.#d.get(this.#p);i||$e.#d.set(this.#p,i={});const r=i[this.tagName]||0;if(i[this.tagName]=r+1,0===r){const e=this.tagName.toLowerCase(),n=document.createElement("style");n.innerHTML=`\n\t\t\t\t\t${this.#f(e)}\n\t\t\t\t\t${t?t.replaceAll(":host",e):t}\n\t\t\t\t`,n.id=this.tagName.toLowerCase(),this.#p.appendChild(n)}if(n){const e=this.tagName.toLowerCase()+"-"+this.#g;this.setAttribute(e,"");const t=this.#v=document.createElement("style");t.id=e,t.innerHTML=n.replaceAll(":host",`[${e}]`);const i=this.getRootNode();this.#p=i===document?document.head:i,this.#p.appendChild(t)}}}#h(){do{if(this.hasShadow)break;const e=$e.#d.get(this.#p);if(!e)break;let t=e[this.tagName];if(void 0===t)break;if(e[this.tagName]=--t,0===t){delete e[this.tagName];const t=this.#p.querySelector("#"+this.tagName);t?.remove()}}while(0);this.#v&&this.#v.remove()}adoptedCallback(){}}$e=Je,Symbol.metadata??=Symbol.for("Symbol.metadata");const Qe=[];function et(e,t){if(2===arguments.length)return nt(e,t,void 0);const n=e;return(e,t)=>nt(e,t,n)}const tt=(e,t)=>{Object.hasOwn(t.metadata,"noSignal")||(t.metadata.noSignal=new Set),t.metadata.noSignal.add(t.name)};function nt(e,t,n={}){const{kind:i,name:r,private:s,static:a,metadata:o}=t,l=Object.hasOwn(o,"noSignal")&&o.noSignal||void 0,c=!l?.has(r);if("symbol"==typeof r)throw new Error("@attribute is not supported on symbol fields yet.");if(s)throw new Error("@attribute is not supported on private fields yet.");if(a)throw new Error("@attribute is not supported on static fields.");if(Qe.push((e=>it(e,r,n))),"field"===i){const i=c?Ue(e,t):e=>e;return function(e){return e=i(e),"default"in n||(n.default=e),e}}if("getter"!==i&&"setter"!==i)throw new Error("@attribute is only for use on fields, getters, and setters. Auto accessor support is coming next if there is demand for it.");c&&Ue(e,t)}function it(e,t,n){if(!e.observedAttributes||!e.hasOwnProperty("observedAttributes")){const t=e.__proto__.observedAttributes;if(t&&!Array.isArray(t))throw new TypeError("observedAttributes is in the wrong format. Did you forget to decorate your custom element class with the `@element` decorator?");i=e,r=[...t||[]],Object.defineProperty(i,"observedAttributes",{value:r,writable:!0,configurable:!0,enumerable:!0})}var i,r;if(!Array.isArray(e.observedAttributes))throw new TypeError("observedAttributes is in the wrong format. Maybe you forgot to decorate your custom element class with the `@element` decorator.");const s=t.replace(/([a-zA-Z])(?=[A-Z])/g,"$1-").toLowerCase();e.observedAttributes.includes(s)||e.observedAttributes.push(s),function(e,t,n,i){if(!e[rt]){e[rt]=!0;const t=e.attributeChangedCallback;e.attributeChangedCallback=function(n,i,r){t?t.call(this,n,i,r):e.__proto__?.attributeChangedCallback?.call(this,n,i,r);const s=this[st]?.[n];this[s.name]=r}}Object.hasOwn(e,st)||(e[st]={__proto__:e[st]||Object.prototype}),e[st][t]={name:n,attributeHandler:i}}(e.prototype,s,t,n)}const rt=Symbol("hasAttributeChangedCallback"),st=Symbol("attributesToProps"),at=e=>e;function ot(e,t){return et(et.string())(e,t)}et.string=()=>({from:at});const lt=e=>+e;function ct(e,t){return et(et.number())(e,t)}et.number=()=>({from:lt});const ut=e=>"false"!==e;function ht(e,t){return et(et.boolean())(e,t)}et.boolean=()=>({from:ut});const dt=Symbol("isAttributeHandler");function pt(e,t){let n="",i=!!(t??1);return"string"==typeof e?(n=e,(e,t)=>ft(e,t,n,i)):(i=!1,ft(e,t,n,i))}function ft(e,t,n,i){if("function"!=typeof e||t&&"class"!==t.kind)throw new Error("@element is only for use on classes.");const{metadata:r={}}=t??{},s=Object.hasOwn(r,"noSignal")&&r.noSignal||void 0;let a=e;const o=a.observedAttributes;if(a.hasOwnProperty("elementName")?n=a.elementName||n:a.elementName=n,Array.isArray(o));else if(o&&"object"==typeof o){a.observedAttributes=void 0;const e=(new Error).stack;console.warn("Defining the static observedAttributes property as a map of attribute names to attribute handlers is now deprecated, please use the static observedAttributeHandlers property to define the map instead.\n"+e);const t=o;for(const e in t)it(a,e,o[e])}const l=Object.hasOwn(a,"observedAttributeHandlers")?a.observedAttributeHandlers:void 0;if(l)for(const e of Object.keys(l))it(a,e,l[e]);a=Ge(a,t);class c extends a{constructor(...t){super(...t),O((()=>{!function(e){if(e instanceof Je)for(const[t,n]of e._preUpgradeValues){if(!(t in e))continue;e._preUpgradeValues.delete(t);const i=Object.getOwnPropertyDescriptor(e,t);i&&"value"in i&&delete e[t],e[t]=n}}(this);const t=c.prototype[st]??{},n=Object.values(t);for(const t of n){const n=t.name;if(s?.has(n))continue;let i=!1;const r=Object.getOwnPropertyDescriptor(this,n),a=Object.getOwnPropertyDescriptor(e.prototype,n);let o=r;o&&(i=!0),o||(o=a),o||gt(n);const{get:l,set:c}=o,u=o&&(l||c)&&l?l.call(this):this[n];Re(i?this:e.prototype,[n,u])}for(const t of n){const n=t.name,i=t.attributeHandler;if(!i)continue;"default"in i||(i.default=this[n]);let r=!1;const s=Object.getOwnPropertyDescriptor(this,n),a=Object.getOwnPropertyDescriptor(e.prototype,n);let o=s;o&&(r=!0),o||(o=a),o||gt(n);const{get:l,set:c,writable:u}=o,h=!(!l&&!c);if(!h&&!r)throw new Error(`Cannot map attribute to prototype value property "${String(n)}". Only prototype getters/setters are supported. Either make the property a class field, or make two separate properties: one for the attribute as a class field, one for the prototype value property.`);if(h&&!c||!h&&!u)throw new Error(`An attribute decorator cannot be used on readonly property "${String(n)}".`);let d;if(h){if(c?.[dt])continue}else d=Symbol("attributeHandlerStorage:"+String(n)),this[d]=this[n];const p=r?this:e.prototype,f=h?l:()=>this[d],m=h?function(e){"string"!=typeof e&&null!==e||(e=mt(e,i)),c.call(this,e)}:e=>{"string"!=typeof e&&null!==e||(e=mt(e,i)),this[d]=e};f&&(f[dt]=!0),m[dt]=!0,Object.defineProperty(p,n,{enumerable:o.enumerable,configurable:o.configurable,get:f,set:m})}}))}}const u=[...Qe];function h(){for(const e of u)e(c);n&&i&&globalThis.window?.customElements?.define(n,c)}return Qe.length=0,t?.addInitializer?t.addInitializer(h):h(),c}function mt(e,t){return t?null===e?"default"in t?t.default:null:t.from?t.from(e):e:e}function gt(e){throw new TypeError(`Missing descriptor for property "${String(e)}" while mapping attributes to properties. Make sure the @element decorator is the first decorator on your element class, and if you're using 'static observedAttributes' or 'static observedAttributeHandlers' make sure you also define the respective class fields for the initial values. If a pre-existing class is already decoratored with other decorators, extend from it, then use @element directly on the subclass.`)}const vt=Symbol("store-raw"),yt=Symbol("store-node"),bt=Symbol("store-has"),xt=Symbol("store-self");function _t(e){let t;return null!=e&&"object"==typeof e&&(e[u]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function wt(e,t=new Set){let n,i,r,s;if(n=null!=e&&e[vt])return n;if(!_t(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let n=0,s=e.length;n<s;n++)r=e[n],(i=wt(r,t))!==r&&(e[n]=i)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const n=Object.keys(e),a=Object.getOwnPropertyDescriptors(e);for(let o=0,l=n.length;o<l;o++)s=n[o],a[s].get||(r=e[s],(i=wt(r,t))!==r&&(e[s]=i))}return e}function St(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function Mt(e,t,n){if(e[t])return e[t];const[i,r]=A(n,{equals:!1,internal:!0});return i.$=r,e[t]=i}function Et(e){N()&&Mt(St(e,yt),xt)()}function Tt(e,t,n,i=!1){if(!i&&e[t]===n)return;const r=e[t],s=e.length;void 0===n?(delete e[t],e[bt]&&e[bt][t]&&void 0!==r&&e[bt][t].$()):(e[t]=n,e[bt]&&e[bt][t]&&void 0===r&&e[bt][t].$());let a,o=St(e,yt);if((a=Mt(o,t,r))&&a.$((()=>n)),Array.isArray(e)&&e.length!==s){for(let t=e.length;t<s;t++)(a=o[t])&&a.$();(a=Mt(o,"length",s))&&a.$(e.length)}(a=o[xt])&&a.$()}const At={get(e,t,n){if(t===vt)return e;if(t===u)return n;if(t===d)return Et(e),n;const i=St(e,yt),r=i[t];let s=r?r():e[t];if(t===yt||t===bt||"__proto__"===t)return s;if(!r){const r=Object.getOwnPropertyDescriptor(e,t),a="function"==typeof s;if(!N()||a&&!e.hasOwnProperty(t)||r&&r.get){if(null!=s&&a&&s===Array.prototype[t])return(...e)=>I((()=>Array.prototype[t].apply(n,e)))}else s=Mt(i,t,s)()}return _t(s)?Ct(s):s},has:(e,t)=>t===vt||t===u||t===d||t===yt||t===bt||"__proto__"===t||(N()&&Mt(St(e,bt),t)(),t in e),set:(e,t,n)=>(I((()=>Tt(e,t,wt(n)))),!0),deleteProperty:(e,t)=>(I((()=>Tt(e,t,void 0,!0))),!0),ownKeys:function(e){return Et(e),Reflect.ownKeys(e)},getOwnPropertyDescriptor:function(e,t){const n=Reflect.getOwnPropertyDescriptor(e,t);return!n||n.get||n.set||!n.configurable||t===u||t===yt||(delete n.value,delete n.writable,n.get=()=>e[u][t],n.set=n=>e[u][t]=n),n}};function Ct(e){let t=e[u];if(!t){Object.defineProperty(e,u,{value:t=new Proxy(e,At)});const n=Object.keys(e),i=Object.getOwnPropertyDescriptors(e),r=Object.getPrototypeOf(e),s=null!==r&&null!==e&&"object"==typeof e&&!Array.isArray(e)&&r!==Object.prototype;if(s){const e=Object.getOwnPropertyDescriptors(r);n.push(...Object.keys(e)),Object.assign(i,e)}for(let r=0,a=n.length;r<a;r++){const a=n[r];if(!s||"constructor"!==a){if(i[a].get){const n=i[a].get.bind(t);Object.defineProperty(e,a,{get:n,configurable:!0})}if(i[a].set){const n=i[a].set,r=e=>I((()=>n.call(t,e)));Object.defineProperty(e,a,{set:r,configurable:!0})}}}}return t}const Rt=Symbol("store-root");function Pt(e,t,n,i,r){const s=t[n];if(e===s)return;const a=Array.isArray(e);if(n!==Rt&&(!_t(e)||!_t(s)||a!==Array.isArray(s)||r&&e[r]!==s[r]))return void Tt(t,n,e);if(a){if(e.length&&s.length&&(!i||r&&e[0]&&null!=e[0][r])){let t,n,a,o,l,c,u,h;for(a=0,o=Math.min(s.length,e.length);a<o&&(s[a]===e[a]||r&&s[a]&&e[a]&&s[a][r]===e[a][r]);a++)Pt(e[a],s,a,i,r);const d=new Array(e.length),p=new Map;for(o=s.length-1,l=e.length-1;o>=a&&l>=a&&(s[o]===e[l]||r&&s[a]&&e[a]&&s[o][r]===e[l][r]);o--,l--)d[l]=s[o];if(a>l||a>o){for(n=a;n<=l;n++)Tt(s,n,e[n]);for(;n<e.length;n++)Tt(s,n,d[n]),Pt(e[n],s,n,i,r);return void(s.length>e.length&&Tt(s,"length",e.length))}for(u=new Array(l+1),n=l;n>=a;n--)c=e[n],h=r&&c?c[r]:c,t=p.get(h),u[n]=void 0===t?-1:t,p.set(h,n);for(t=a;t<=o;t++)c=s[t],h=r&&c?c[r]:c,n=p.get(h),void 0!==n&&-1!==n&&(d[n]=s[t],n=u[n],p.set(h,n));for(n=a;n<e.length;n++)n in d?(Tt(s,n,d[n]),Pt(e[n],s,n,i,r)):Tt(s,n,e[n])}else for(let t=0,n=e.length;t<n;t++)Pt(e[t],s,t,i,r);return void(s.length>e.length&&Tt(s,"length",e.length))}const o=Object.keys(e);for(let t=0,n=o.length;t<n;t++)Pt(e[o[t]],s,o[t],i,r);const l=Object.keys(s);for(let t=0,n=l.length;t<n;t++)void 0===e[l[t]]&&Tt(s,l[t],void 0)}function kt(e,t={}){const{merge:n,key:i="id"}=t,r=wt(e);return e=>{if(!_t(e)||!_t(r))return r;const t=Pt(r,{[Rt]:e},Rt,n,i);return void 0===t?e:t}}new WeakMap;class It extends Map{#y=function(){return Ct(wt({}||{}))}();find(e){let t;for(const[n,i]of this)if(e(n,i)){t=i;break}return t}get(e){return this.#y[e],super.get(e)}set(e,t){return queueMicrotask((()=>{this.#y[e]=t})),super.set(e,t),this}delete(e){return queueMicrotask((()=>{delete this.#y[e]})),super.delete(e)}clear(){queueMicrotask((()=>{var e,t;e=this.#y,t=kt({}),I((()=>t(wt(e))))})),super.clear()}has(e){return this.#y[e],super.has(e)}entries(){return this.#y[d],super.entries()}[Symbol.iterator](){return this.#y[d],super[Symbol.iterator]()}forEach(e,t){this.#y[d],super.forEach(e,t)}keys(){return this.#y[d],super.keys()}get size(){return this.#y[d],super.size}set size(e){super.size=e}}let Ot;globalThis.window?.document&&(Ot=globalThis.elementBehaviors=new class{#b=new Map;#x=new Map;define(e,t){if(this.#b.has(e))throw new Error(`Behavior ${e} is already defined.`);this.#b.set(e,t),this.#x.has(e)&&(this.#x.get(e).resolve(),this.#x.delete(e))}get(e){return this.#b.get(e)}has(e){return this.#b.has(e)}whenDefined(e){if(this.#x.has(e))return this.#x.get(e).promise;if(this.has(e))return Promise.resolve();let t;const n=new Promise((e=>t=e));return this.#x.set(e,{promise:n,resolve:t}),n}});const Lt=Array.prototype.forEach;class Nt{ownerDocument;#_=new Map;#w=new WeakMap;#S=new MutationObserver((e=>{Lt.call(e,(e=>{"attributes"===e.type?this.#M(e.attributeName)&&this.#E(e.attributeName,e.target,e.oldValue):(Lt.call(e.removedNodes,this.#T),Lt.call(e.addedNodes,this.#A))}))}));constructor(e){if(this.ownerDocument=e,!e)throw new Error("Must be given a document")}define(e,t){this.#_.set(e,t),this.#C(e),this.#R()}get(e,t){const n=this.#w.get(e);if(n)return n.get(t)}#M(e){return this.#_.get(e)}#P(){this.#S.observe(this.ownerDocument,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,attributeFilter:Array.from(this.#_.keys())})}#k(){this.#S.disconnect()}#R(){this.#k(),this.#P()}#C(e,t=this.ownerDocument){const n=t.querySelectorAll("["+e+"]");Lt.call(n,(t=>this.#E(e,t,null)))}#A=e=>{1===e.nodeType&&(Lt.call(e.attributes,(t=>{this.#M(t.name)&&this.#E(t.name,e,null)})),this.#_.forEach(((t,n)=>this.#C(n,e))))};#T=e=>{const t=this.#w.get(e);t&&(t.forEach((e=>e.disconnectedCallback?.()),this),this.#w.delete(e))};#E(e,t,n){let i=this.#w.get(t);i||this.#w.set(t,i=new Map);let r=i.get(e);const s=t.getAttribute(e);if(!r){if(r=new(this.#M(e)),i.set(e,r),r.ownerElement=t,r.name=e,null==s)throw new Error("Not possible!");return r.value=s,void r.connectedCallback?.()}if(null==s)r.disconnectedCallback?.(),i.delete(e);else if(s!==r.value){if(r.value=s,null==n)throw new Error("Not possible!");r.changedCallback?.(n,s)}}}if(globalThis.window?.document){const e=Element.prototype.attachShadow;Element.prototype.attachShadow=function(t){const n=e.call(this,t);return n.customAttributes||(n.customAttributes=new Nt(n)),n}}let Dt;globalThis.window?.document&&(Dt=globalThis.customAttributes=new Nt(document));const zt=function(){const e=new WeakMap;return t=>{let n=e.get(t);return n||e.set(t,n={}),n}}();class Ut extends Error{}class Ft extends Promise{canceled;constructor(e,t){const n=!!t&&t.rejectOnCancel;let i;if(e instanceof Promise){const t=e;super(((e,n)=>{i=n,t.then((t=>{this.canceled||e(t)})).catch((e=>{this.canceled||n(e)}))}))}else super(((t,n)=>{i=n,e((e=>{this.canceled||t(e)}),(e=>{this.canceled||n(e)}))}));this.canceled=!1,zt(this).originalReject=i,zt(this).rejectOnCancel=n}cancel(){this.canceled=!0,zt(this).rejectOnCancel&&zt(this).originalReject(new Ut("canceled"))}}class Bt{get behaviors(){return this.ownerElement.behaviors}observers=new Map;elementDefinedPromises=new Map;isConnected=!1;connectedCallback(){this.isConnected=!0,this.changedCallback("",this.value)}disconnectedCallback(){this.isConnected=!1,this.#I=!0,this.changedCallback(this.value,""),this.#I=!1}#I=!1;changedCallback(e,t){if(!this.#I&&!this.isConnected)return;const n=this.getBehaviorNames(t),i=this.getBehaviorNames(e);if(0==n.length&&0==i.length)return;const{removed:r,added:s}=this.getDiff(i,n);this.handleDiff(r,s)}getBehaviorNames(e){return""==e.trim()?[]:e.split(/\s+/)}getDiff(e,t){const n={removed:[],added:t};for(let t=0,i=e.length;t<i;t+=1){const i=e[t];n.added.includes(i)?n.added.splice(n.added.indexOf(i),1):n.removed.push(i)}return n}handleDiff(e,t){for(const t of e)this.disconnectBehavior(t);for(const e of t)this.connectBehavior(e)}async connectBehavior(e){let t=elementBehaviors.get(e);t||(await elementBehaviors.whenDefined(e),t=elementBehaviors.get(e));const n=t.observedAttributes,i=this.ownerElement.tagName;try{if(t.awaitElementDefined&&i.includes("-")&&!customElements.get(i.toLowerCase())){const t=e+"_"+i;let n=this.elementDefinedPromises.get(t);n||(n=new Ft(customElements.whenDefined(i.toLowerCase()),{rejectOnCancel:!0}),this.elementDefinedPromises.set(t,n)),await n,this.elementDefinedPromises.delete(t)}if(this.isConnected){const i=new t(this.ownerElement);this.behaviors.set(e,i),i.connectedCallback?.(this.ownerElement),Array.isArray(n)&&n.length&&(this.fireInitialAttributeChangedCallbacks(i,n),this.createAttributeObserver(i))}}catch(e){if(!(e instanceof Ut))throw e}}disconnectBehavior(e){const t=e+"_"+this.ownerElement.tagName,n=this.elementDefinedPromises.get(t);n&&(n.cancel(),this.elementDefinedPromises.delete(t));const i=this.behaviors.get(e);i&&(i.disconnectedCallback?.(this.ownerElement),this.destroyAttributeObserver(i),this.behaviors.delete(e))}destroyAttributeObserver(e){const t=this.observers.get(e);t&&(t.disconnect(),this.observers.delete(e))}createAttributeObserver(e){const t=this.ownerElement,n=new MutationObserver((n=>{if(!e.attributeChangedCallback)return;let i,r={},s="";for(const t of n)"attributes"===t.type&&(s=t.attributeName,void 0!==r[s]?(e.attributeChangedCallback(s,r[s],t.oldValue,this.ownerElement),r[s]=t.oldValue):r[s]=t.oldValue);for(const n in r)i=t.attributes.getNamedItem(n),e.attributeChangedCallback(n,r[n],null===i?null:i.value,this.ownerElement)}));n.observe(t,{attributes:!0,attributeOldValue:!0,attributeFilter:e.constructor.observedAttributes}),this.observers.set(e,n)}fireInitialAttributeChangedCallbacks(e,t){if(e.attributeChangedCallback)for(const n of t)this.ownerElement.hasAttribute(n)&&e.attributeChangedCallback(n,null,this.ownerElement.attributes.getNamedItem(n).value,this.ownerElement)}}if(globalThis.window?.document){const e=new WeakMap;Object.defineProperty(Element.prototype,"behaviors",{get(){let t=null;return e.has(this)?t=e.get(this):e.set(this,t=new It),t}});const t=Element.prototype.attachShadow;Element.prototype.attachShadow=function(e){const n=t.call(this,e);return n.customAttributes.define("has",Bt),n},globalThis.customAttributes.define("has",Bt)}const Vt=new WeakMap,jt=new WeakMap;function Ht(e,t,n){let i;const r=n.inherited;if(!r)if(i=jt.get(e),i){if(i.has(t))return}else jt.set(e,i=new Set);const s=Ce(e,t)||{value:void 0,writable:!0,configurable:!0,enumerable:!0},a=n.inherited&&s.owner||e;if(r)if(i=jt.get(a),i){if(i.has(t))return}else jt.set(a,i=new Set);let o,l;if(s.get||s.set){const t=s.get,n=s.set;o=t?()=>t.call(e):void 0,l=n?t=>n.call(e,t):void 0}else{let n=s.value;if(!s.writable)throw console.error(`Can not observe readonly property "${String(t)}" with descriptor`,s,"of object:",e),new Error(`Can not observe readonly property "${String(t)}" of object: ${e} (see above)`);delete s.value,delete s.writable,o=()=>n,l=e=>n=e}if(!l)throw new Error("Can not observe read-only property.");if(!o)throw new Error("Can not observe write-only property.");Object.defineProperty(a,t,{...s,get:o,set(n){l(n),function(e,t,n){const i=Vt.get(e).get(t);if(i)for(const e of i)e(t,n)}(e,t,o())}}),i.add(t)}const Gt=Symbol();function Wt(e){if("object"!=typeof e)throw new Error("cannot use @receiver on class returning a non-object instance");return!0}function Xt(e,t){const{kind:n,name:i}=t;if("field"===n)return function(e){return Wt(this),qt(this,i),e};if("getter"!==n&&"setter"!==n&&"accessor"!==n)throw new TypeError("@receiver is for use only on class fields, getters/setters, and auto accessors. Also make sure your class extends from PropReceiver.");t.addInitializer((function(){Wt(this),qt(this,i)}))}function qt(e,t){if(!e.constructor[Gt])throw new TypeError("@receiver must be used on a property of a class that extends PropReceiver");e.hasOwnProperty("receivedProperties")||(e.receivedProperties=[...e.receivedProperties||[]]),e.receivedProperties,e.receivedProperties.push(t)}function Yt(e,t){if("string"==typeof e&&null==t)return(t,n)=>elementBehaviors.define(e,pt(t,n));if(t&&"class"===t.kind)return pt(e,t);throw new TypeError("Invalid decorator usage. Call with a string, or as a plain decorator with, only on a class meant to be used as an element behavior.")}class $t extends(function(e=Object){return class extends e{static[Gt]=!0;connectedCallback(){super.connectedCallback?.(),this.receiveProps()}disconnectedCallback(){super.disconnectedCallback?.(),this.unreceiveProps()}get observedObject(){throw new TypeError("implement 'observedObject' in subclass")}#O=(e,t)=>{this[e]=t};receiveProps(){this.receivedProperties&&(this.receivedProperties=Array.from(new Set(this.receivedProperties))),this.receiveInitialValues(),function(e,t,n,i={}){i.async=i.async||!1,i.inherited=i.inherited||!1;for(const r of t){let t=Vt.get(e);!t&&Vt.set(e,t=new Map);let s=t.get(r);s||(t.set(r,s=[]),Ht(e,r,i)),s.includes(n)||s.push(n)}}(this.observedObject,this.#L(),this.#O,{})}unreceiveProps(){!function(e,t,n){const i=Vt.get(e);if(i){if("function"==typeof t&&(n=t,t=Array.from(i.keys())),!n)throw new TypeError("callback not supplied");for(const e of t){const t=i.get(e);t.includes(n)&&(t.splice(t.indexOf(n),1),t.length||i.delete(e))}}else console.warn("the object is not observed, no need to unobserve:",e)}(this.observedObject,this.#L(),this.#O)}receivedProperties=[];#L(){const e=this.receivedProperties||[];if(!Array.isArray(e))throw new TypeError("Expected receivedProperties to be an array.");return e}receiveInitialValues(){const e=this.observedObject;for(const t of this.#L())if(t in e){const n=e[t];this.#O(t,void 0!==n?n:this[t])}}}}()){static awaitElementDefined=!0;element;constructor(e){super(),this.#N(e),this.element=e}requiredElementType(){return[Element]}get observedObject(){return this.element}#D=null;#z=!1;receiveInitialValues(){super.receiveInitialValues(),this.#U()}#F=!1;#U(){if(this.#F)return;const e=this.observedObject;if(function(e){return"_preUpgradeValues"in e}(e)){this.#F=!0;for(const t of this.receivedProperties??[])void 0!==e._preUpgradeValues.get(t)&&this[t]}}async#N(e){const t=this.requiredElementType();if(!e.nodeName.includes("-")){const n=`\n\t\t\t\tThe element you're using the mesh behavior on (<${e.tagName.toLowerCase()}>)\n\t\t\t\tis not an instance of one of the following classes:\n\t\t\t`;throw queueMicrotask((()=>console.error(n,t))),new Error(`${n}\n\n\t\t\t\t${t}\n\t\t\t`)}if(this.#D=customElements.whenDefined(e.nodeName.toLowerCase()),this.#D.then((()=>{this.#z=t.some((t=>e instanceof t)),this.#U()})),await Promise.race([this.#D,new Promise((e=>setTimeout(e,1e3)))]),!this.#z){const n=`\n\t\t\t\t\tEither the element you're using the behavior on\n\t\t\t\t\t(<${e.tagName.toLowerCase()}>) is not an instance of one\n\t\t\t\t\tof the allowed classes, or there was a 1-second timeout waiting\n\t\t\t\t\tfor the element to be defined. Please make sure all elements\n\t\t\t\t\tyou intend to use are defined. The allowed classes are:\n\t\t\t\t`;throw queueMicrotask((()=>console.error(n,t))),new Error(`${n}\n\n\t\t\t\t\t${t}\n\t\t\t\t`)}}}const Zt=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Kt=Math.PI/180,Jt=180/Math.PI;function Qt(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Zt[255&e]+Zt[e>>8&255]+Zt[e>>16&255]+Zt[e>>24&255]+"-"+Zt[255&t]+Zt[t>>8&255]+"-"+Zt[t>>16&15|64]+Zt[t>>24&255]+"-"+Zt[63&n|128]+Zt[n>>8&255]+"-"+Zt[n>>16&255]+Zt[n>>24&255]+Zt[255&i]+Zt[i>>8&255]+Zt[i>>16&255]+Zt[i>>24&255]).toLowerCase()}function en(e,t,n){return Math.max(t,Math.min(n,e))}function tn(e,t,n){return(1-n)*e+n*t}function nn(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function rn(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}class sn{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,s,a){let o=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3];const h=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===a)return e[t+0]=o,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===a)return e[t+0]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(u!==f||o!==h||l!==d||c!==p){let e=1-a;const t=o*h+l*d+c*p+u*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),s=Math.atan2(r,t*n);e=Math.sin(e*s)/r,a=Math.sin(a*s)/r}const r=a*n;if(o=o*e+h*r,l=l*e+d*r,c=c*e+p*r,u=u*e+f*r,e===1-a){const e=1/Math.sqrt(o*o+l*l+c*c+u*u);o*=e,l*=e,c*=e,u*=e}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,i,r,s){const a=n[i],o=n[i+1],l=n[i+2],c=n[i+3],u=r[s],h=r[s+1],d=r[s+2],p=r[s+3];return e[t]=a*p+c*u+o*d-l*h,e[t+1]=o*p+c*h+l*u-a*d,e[t+2]=l*p+c*d+a*h-o*u,e[t+3]=c*p-a*u-o*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,i=e._y,r=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(n/2),c=a(i/2),u=a(r/2),h=o(n/2),d=o(i/2),p=o(r/2);switch(s){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],s=t[1],a=t[5],o=t[9],l=t[2],c=t[6],u=t[10],h=n+a+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-o)*e,this._y=(r-l)*e,this._z=(s-i)*e}else if(n>a&&n>u){const e=2*Math.sqrt(1+n-a-u);this._w=(c-o)/e,this._x=.25*e,this._y=(i+s)/e,this._z=(r+l)/e}else if(a>u){const e=2*Math.sqrt(1+a-n-u);this._w=(r-l)/e,this._x=(i+s)/e,this._y=.25*e,this._z=(o+c)/e}else{const e=2*Math.sqrt(1+u-n-a);this._w=(s-i)/e,this._x=(r+l)/e,this._y=(o+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(en(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,s=e._w,a=t._x,o=t._y,l=t._z,c=t._w;return this._x=n*c+s*a+i*l-r*o,this._y=i*c+s*o+r*a-n*l,this._z=r*c+s*l+n*o-i*a,this._w=s*c-n*a-i*o-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,s=this._w;let a=s*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const e=1-t;return this._w=e*s+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this}const l=Math.sqrt(o),c=Math.atan2(l,a),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=s*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class an{constructor(e=0,t=0,n=0){an.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(ln.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(ln.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,s=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,s=e.y,a=e.z,o=e.w,l=2*(s*i-a*n),c=2*(a*t-r*i),u=2*(r*n-s*t);return this.x=t+o*l+s*u-a*c,this.y=n+o*c+a*l-r*u,this.z=i+o*u+r*c-s*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,s=t.x,a=t.y,o=t.z;return this.x=i*o-r*a,this.y=r*s-n*o,this.z=n*a-i*s,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return on.copy(this).projectOnVector(e),this.sub(on)}reflect(e){return this.sub(on.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(en(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const on=new an,ln=new sn,cn=0,un=1,hn=2,dn=100,pn=101,fn=102,mn=200,gn=201,vn=202,yn=203,bn=204,xn=205,_n=206,wn=207,Sn=208,Mn=209,En=210,Tn=211,An=212,Cn=213,Rn=214,Pn=0,kn=1,In=2,On=3,Ln=4,Nn=5,Dn=6,zn=7,Un=301,Fn=302,Bn=306,Vn=1e3,jn=1001,Hn=1002,Gn=1003,Wn=1004,Xn=1005,qn=1006,Yn=1007,$n=1008,Zn=1009,Kn=1012,Jn=1013,Qn=1014,ei=1015,ti=1016,ni=1017,ii=1018,ri=1020,si=1023,ai=1026,oi=1027,li=1028,ci=1029,ui=1031,hi=1033,di=33776,pi=33777,fi=33778,mi=33779,gi=35840,vi=35841,yi=35842,bi=35843,xi=36196,_i=37492,wi=37496,Si=37808,Mi=37809,Ei=37810,Ti=37811,Ai=37812,Ci=37813,Ri=37814,Pi=37815,ki=37816,Ii=37817,Oi=37818,Li=37819,Ni=37820,Di=37821,zi=36492,Ui=36494,Fi=36495,Bi=36284,Vi=36285,ji=36286,Hi="",Gi="srgb",Wi="srgb-linear",Xi="display-p3",qi="display-p3-linear",Yi="linear",$i="srgb",Zi="rec709",Ki="p3",Ji=7680,Qi=512,er=513,tr=514,nr=515,ir=516,rr=517,sr=518,ar=519,or="300 es",lr=2e3,cr=2001;class ur{constructor(e,t,n,i,r,s,a,o,l,c,u,h,d,p,f,m){ur.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,s,a,o,l,c,u,h,d,p,f,m)}set(e,t,n,i,r,s,a,o,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ur).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/hr.setFromMatrixColumn(e,0).length(),r=1/hr.setFromMatrixColumn(e,1).length(),s=1/hr.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,s=Math.cos(n),a=Math.sin(n),o=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){const e=s*c,n=s*u,i=a*c,r=a*u;t[0]=o*c,t[4]=-o*u,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-a*o,t[2]=r-e*l,t[6]=i+n*l,t[10]=s*o}else if("YXZ"===e.order){const e=o*c,n=o*u,i=l*c,r=l*u;t[0]=e+r*a,t[4]=i*a-n,t[8]=s*l,t[1]=s*u,t[5]=s*c,t[9]=-a,t[2]=n*a-i,t[6]=r+e*a,t[10]=s*o}else if("ZXY"===e.order){const e=o*c,n=o*u,i=l*c,r=l*u;t[0]=e-r*a,t[4]=-s*u,t[8]=i+n*a,t[1]=n+i*a,t[5]=s*c,t[9]=r-e*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if("ZYX"===e.order){const e=s*c,n=s*u,i=a*c,r=a*u;t[0]=o*c,t[4]=i*l-n,t[8]=e*l+r,t[1]=o*u,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=a*o,t[10]=s*o}else if("YZX"===e.order){const e=s*o,n=s*l,i=a*o,r=a*l;t[0]=o*c,t[4]=r-e*u,t[8]=i*u+n,t[1]=u,t[5]=s*c,t[9]=-a*c,t[2]=-l*c,t[6]=n*u+i,t[10]=e-r*u}else if("XZY"===e.order){const e=s*o,n=s*l,i=a*o,r=a*l;t[0]=o*c,t[4]=-u,t[8]=l*c,t[1]=e*u+r,t[5]=s*c,t[9]=n*u-i,t[2]=i*u-n,t[6]=a*c,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(pr,e,fr)}lookAt(e,t,n){const i=this.elements;return vr.subVectors(e,t),0===vr.lengthSq()&&(vr.z=1),vr.normalize(),mr.crossVectors(n,vr),0===mr.lengthSq()&&(1===Math.abs(n.z)?vr.x+=1e-4:vr.z+=1e-4,vr.normalize(),mr.crossVectors(n,vr)),mr.normalize(),gr.crossVectors(vr,mr),i[0]=mr.x,i[4]=gr.x,i[8]=vr.x,i[1]=mr.y,i[5]=gr.y,i[9]=vr.y,i[2]=mr.z,i[6]=gr.z,i[10]=vr.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,s=n[0],a=n[4],o=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],x=n[15],_=i[0],w=i[4],S=i[8],M=i[12],E=i[1],T=i[5],A=i[9],C=i[13],R=i[2],P=i[6],k=i[10],I=i[14],O=i[3],L=i[7],N=i[11],D=i[15];return r[0]=s*_+a*E+o*R+l*O,r[4]=s*w+a*T+o*P+l*L,r[8]=s*S+a*A+o*k+l*N,r[12]=s*M+a*C+o*I+l*D,r[1]=c*_+u*E+h*R+d*O,r[5]=c*w+u*T+h*P+d*L,r[9]=c*S+u*A+h*k+d*N,r[13]=c*M+u*C+h*I+d*D,r[2]=p*_+f*E+m*R+g*O,r[6]=p*w+f*T+m*P+g*L,r[10]=p*S+f*A+m*k+g*N,r[14]=p*M+f*C+m*I+g*D,r[3]=v*_+y*E+b*R+x*O,r[7]=v*w+y*T+b*P+x*L,r[11]=v*S+y*A+b*k+x*N,r[15]=v*M+y*C+b*I+x*D,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],s=e[1],a=e[5],o=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+r*o*u-i*l*u-r*a*h+n*l*h+i*a*d-n*o*d)+e[7]*(+t*o*d-t*l*h+r*s*h-i*s*d+i*l*c-r*o*c)+e[11]*(+t*l*u-t*a*d-r*s*u+n*s*d+r*a*c-n*l*c)+e[15]*(-i*a*c-t*o*u+t*a*h+i*s*u-n*s*h+n*o*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=u*m*l-f*h*l+f*o*d-a*m*d-u*o*g+a*h*g,y=p*h*l-c*m*l-p*o*d+s*m*d+c*o*g-s*h*g,b=c*f*l-p*u*l+p*a*d-s*f*d-c*a*g+s*u*g,x=p*u*o-c*f*o-p*a*h+s*f*h+c*a*m-s*u*m,_=t*v+n*y+i*b+r*x;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/_;return e[0]=v*w,e[1]=(f*h*r-u*m*r-f*i*d+n*m*d+u*i*g-n*h*g)*w,e[2]=(a*m*r-f*o*r+f*i*l-n*m*l-a*i*g+n*o*g)*w,e[3]=(u*o*r-a*h*r-u*i*l+n*h*l+a*i*d-n*o*d)*w,e[4]=y*w,e[5]=(c*m*r-p*h*r+p*i*d-t*m*d-c*i*g+t*h*g)*w,e[6]=(p*o*r-s*m*r-p*i*l+t*m*l+s*i*g-t*o*g)*w,e[7]=(s*h*r-c*o*r+c*i*l-t*h*l-s*i*d+t*o*d)*w,e[8]=b*w,e[9]=(p*u*r-c*f*r-p*n*d+t*f*d+c*n*g-t*u*g)*w,e[10]=(s*f*r-p*a*r+p*n*l-t*f*l-s*n*g+t*a*g)*w,e[11]=(c*a*r-s*u*r-c*n*l+t*u*l+s*n*d-t*a*d)*w,e[12]=x*w,e[13]=(c*f*i-p*u*i+p*n*h-t*f*h-c*n*m+t*u*m)*w,e[14]=(p*a*i-s*f*i-p*n*o+t*f*o+s*n*m-t*a*m)*w,e[15]=(s*u*i-c*a*i+c*n*o-t*u*o-s*n*h+t*a*h)*w,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,s=e.x,a=e.y,o=e.z,l=r*s,c=r*a;return this.set(l*s+n,l*a-i*o,l*o+i*a,0,l*a+i*o,c*a+n,c*o-i*s,0,l*o-i*a,c*o+i*s,r*o*o+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,s){return this.set(1,n,r,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,s=t._y,a=t._z,o=t._w,l=r+r,c=s+s,u=a+a,h=r*l,d=r*c,p=r*u,f=s*c,m=s*u,g=a*u,v=o*l,y=o*c,b=o*u,x=n.x,_=n.y,w=n.z;return i[0]=(1-(f+g))*x,i[1]=(d+b)*x,i[2]=(p-y)*x,i[3]=0,i[4]=(d-b)*_,i[5]=(1-(h+g))*_,i[6]=(m+v)*_,i[7]=0,i[8]=(p+y)*w,i[9]=(m-v)*w,i[10]=(1-(h+f))*w,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=hr.set(i[0],i[1],i[2]).length();const s=hr.set(i[4],i[5],i[6]).length(),a=hr.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],dr.copy(this);const o=1/r,l=1/s,c=1/a;return dr.elements[0]*=o,dr.elements[1]*=o,dr.elements[2]*=o,dr.elements[4]*=l,dr.elements[5]*=l,dr.elements[6]*=l,dr.elements[8]*=c,dr.elements[9]*=c,dr.elements[10]*=c,t.setFromRotationMatrix(dr),n.x=r,n.y=s,n.z=a,this}makePerspective(e,t,n,i,r,s,a=2e3){const o=this.elements,l=2*r/(t-e),c=2*r/(n-i),u=(t+e)/(t-e),h=(n+i)/(n-i);let d,p;if(a===lr)d=-(s+r)/(s-r),p=-2*s*r/(s-r);else{if(a!==cr)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);d=-s/(s-r),p=-s*r/(s-r)}return o[0]=l,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=c,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,n,i,r,s,a=2e3){const o=this.elements,l=1/(t-e),c=1/(n-i),u=1/(s-r),h=(t+e)*l,d=(n+i)*c;let p,f;if(a===lr)p=(s+r)*u,f=-2*u;else{if(a!==cr)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);p=r*u,f=-1*u}return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=f,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const hr=new an,dr=new ur,pr=new an(0,0,0),fr=new an(1,1,1),mr=new an,gr=new an,vr=new an;class yr{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const br=new ur,xr=new sn;class _r{constructor(e=0,t=0,n=0,i=_r.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],s=i[4],a=i[8],o=i[1],l=i[5],c=i[9],u=i[2],h=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(en(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-en(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(en(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-en(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(en(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-en(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return br.makeRotationFromQuaternion(e),this.setFromRotationMatrix(br,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return xr.setFromEuler(this),this.setFromQuaternion(xr,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}_r.DEFAULT_ORDER="XYZ";class wr{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return!!(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}class Sr{constructor(e,t,n,i,r,s,a,o,l){Sr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,s,a,o,l)}set(e,t,n,i,r,s,a,o,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=a,c[3]=t,c[4]=r,c[5]=o,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,s=n[0],a=n[3],o=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],b=i[7],x=i[2],_=i[5],w=i[8];return r[0]=s*f+a*v+o*x,r[3]=s*m+a*y+o*_,r[6]=s*g+a*b+o*w,r[1]=l*f+c*v+u*x,r[4]=l*m+c*y+u*_,r[7]=l*g+c*b+u*w,r[2]=h*f+d*v+p*x,r[5]=h*m+d*y+p*_,r[8]=h*g+d*b+p*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8];return t*s*c-t*a*l-n*r*c+n*a*o+i*r*l-i*s*o}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=c*s-a*l,h=a*o-c*r,d=l*r-s*o,p=t*u+n*h+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=u*f,e[1]=(i*l-c*n)*f,e[2]=(a*n-i*s)*f,e[3]=h*f,e[4]=(c*t-i*o)*f,e[5]=(i*r-a*t)*f,e[6]=d*f,e[7]=(n*o-l*t)*f,e[8]=(s*t-n*r)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,s,a){const o=Math.cos(r),l=Math.sin(r);return this.set(n*o,n*l,-n*(o*s+l*a)+s+e,-i*l,i*o,-i*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(Mr.makeScale(e,t)),this}rotate(e){return this.premultiply(Mr.makeRotation(-e)),this}translate(e,t){return this.premultiply(Mr.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const Mr=new Sr;let Er=0;const Tr=new an,Ar=new sn,Cr=new ur,Rr=new an,Pr=new an,kr=new an,Ir=new sn,Or=new an(1,0,0),Lr=new an(0,1,0),Nr=new an(0,0,1),Dr={type:"added"},zr={type:"removed"},Ur={type:"childadded",child:null},Fr={type:"childremoved",child:null};class Br extends yr{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Er++}),this.uuid=Qt(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Br.DEFAULT_UP.clone();const e=new an,t=new _r,n=new sn,i=new an(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new ur},normalMatrix:{value:new Sr}}),this.matrix=new ur,this.matrixWorld=new ur,this.matrixAutoUpdate=Br.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Br.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new wr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Ar.setFromAxisAngle(e,t),this.quaternion.multiply(Ar),this}rotateOnWorldAxis(e,t){return Ar.setFromAxisAngle(e,t),this.quaternion.premultiply(Ar),this}rotateX(e){return this.rotateOnAxis(Or,e)}rotateY(e){return this.rotateOnAxis(Lr,e)}rotateZ(e){return this.rotateOnAxis(Nr,e)}translateOnAxis(e,t){return Tr.copy(e).applyQuaternion(this.quaternion),this.position.add(Tr.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Or,e)}translateY(e){return this.translateOnAxis(Lr,e)}translateZ(e){return this.translateOnAxis(Nr,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Cr.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Rr.copy(e):Rr.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),Pr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Cr.lookAt(Pr,Rr,this.up):Cr.lookAt(Rr,Pr,this.up),this.quaternion.setFromRotationMatrix(Cr),i&&(Cr.extractRotation(i.matrixWorld),Ar.setFromRotationMatrix(Cr),this.quaternion.premultiply(Ar.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Dr),Ur.child=e,this.dispatchEvent(Ur),Ur.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(zr),Fr.child=e,this.dispatchEvent(Fr),Fr.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Cr.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Cr.multiply(e.parent.matrixWorld)),e.applyMatrix4(Cr),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Dr),Ur.child=e,this.dispatchEvent(Ur),Ur.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Pr,e,kr),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Pr,Ir,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map((e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()}))),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),null!==this.boundingBox&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=s(e.geometries),i=s(e.materials),r=s(e.textures),a=s(e.images),o=s(e.shapes),l=s(e.skeletons),c=s(e.animations),u=s(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),a.length>0&&(n.images=a),o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=i,n;function s(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}Br.DEFAULT_UP=new an(0,1,0),Br.DEFAULT_MATRIX_AUTO_UPDATE=!0,Br.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Vr=function(e,...t){let n="",i="";const r=[...e.raw],s=r.length-1,a=r[s].match(/\/[gimuy]*$/);let o=!1;r[0].match(/^\//)?a?(r[0]=r[0].replace("/",""),i=a[0].replace("/",""),r[s]=r[s].replace(/\/[gimuy]*$/,"")):o=!0:a&&(o=!0);for(let e=0,i=t.length;e<i;e+=1){const i=t[e];n+=r[e],n+=i instanceof RegExp?i.source:String(i)}if(n+=r[s],o)throw new TypeError(`regex has unmatched slashes, f.e. r\`/foo\` or r\`foo/\` instead of r\`/foo/\`. Input was: ${n}.`);return new RegExp(n,i)},jr={};function Hr(e,t=","){let n=jr[t=t||","];return n||(n=Vr`/(?:\s*${(e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"))(t)}\s*)|(?:\s+)/g`,jr[t]=n),e.trim().split(n)}var Gr=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},Wr=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0},Xr=function(e,t,n){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})};const qr={x:void 0,y:void 0,z:void 0};let Yr=(()=>{let e,t,n,i,r,s,a,o,l=[Ge],c=[],u=Object,h=[],d=[],p=[],f=[],m=[],g=[];return class extends u{static{t=this}static{const v="function"==typeof Symbol&&Symbol.metadata?Object.create(u[Symbol.metadata]??null):void 0;n=[Ue],r=[Ue],a=[Ue],Gr(this,i={get:Xr((function(){return this.#B}),"#x","get"),set:Xr((function(e){this.#B=e}),"#x","set")},n,{kind:"accessor",name:"#x",static:!1,private:!0,access:{has:e=>#V in e,get:e=>e.#V,set:(e,t)=>{e.#V=t}},metadata:v},h,d),Gr(this,s={get:Xr((function(){return this.#j}),"#y","get"),set:Xr((function(e){this.#j=e}),"#y","set")},r,{kind:"accessor",name:"#y",static:!1,private:!0,access:{has:e=>#H in e,get:e=>e.#H,set:(e,t)=>{e.#H=t}},metadata:v},p,f),Gr(this,o={get:Xr((function(){return this.#G}),"#z","get"),set:Xr((function(e){this.#G=e}),"#z","set")},a,{kind:"accessor",name:"#z",static:!1,private:!0,access:{has:e=>#W in e,get:e=>e.#W,set:(e,t)=>{e.#W=t}},metadata:v},m,g),Gr(null,e={value:t},l,{kind:"class",name:t.name,metadata:v},null,c),t=e.value,v&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:v}),Wr(t,c)}#B=Wr(this,h,void 0);get#V(){return i.get.call(this)}set#V(e){return i.set.call(this,e)}#j=(Wr(this,d),Wr(this,p,void 0));get#H(){return s.get.call(this)}set#H(e){return s.set.call(this,e)}#G=(Wr(this,f),Wr(this,m,void 0));get#W(){return o.get.call(this)}set#W(e){return o.set.call(this,e)}set x(e){"string"==typeof e&&(e=this.deserializeValue("x",e)),this.checkValue("x",e)&&(this.#V=e)}get x(){return this.#V}set y(e){"string"==typeof e&&(e=this.deserializeValue("y",e)),this.checkValue("y",e)&&(this.#H=e)}get y(){return this.#H}set z(e){"string"==typeof e&&(e=this.deserializeValue("z",e)),this.checkValue("z",e)&&(this.#W=e)}get z(){return this.#W}constructor(e,t,n){super(),this.#X(e,t,n)}get#q(){return this.default||qr}fromDefault(){return this.from(this.#q),this}#X(e,t,n){if(null==e&&void 0===t&&void 0===n)this.fromDefault();else if(Array.isArray(e))this.fromArray(e);else if("object"==typeof e&&null!==e){if(e===this)return this;this.fromObject(e)}else"string"==typeof e&&void 0===t&&void 0===n?this.fromString(e):this.set(e,t,n);return this}from(e,t,n){return this.#X(e,t,n)}set(e,t,n){return I((()=>{this.x=e,this.y=t,this.z=n})),this}fromArray(e){return this.set(e[0],e[1],e[2]),this}toArray(){return[this.x,this.y,this.z]}fromObject(e){return this.set(e.x,e.y,e.z),this}toObject(){return{x:this.x,y:this.y,z:this.z}}fromString(e,t=","){return this.fromArray(this.#Y(e,t)),this}toString(e=""){return e?`${this.x}${e} ${this.y}${e} ${this.z}`:`${this.x} ${this.y} ${this.z}`}deserializeValue(e,t){return t}#Y(e,t=","){const n=Hr(e,t),i=[],r=n.length;return r>0&&(i[0]=this.deserializeValue("x",n[0])),r>1&&(i[1]=this.deserializeValue("y",n[1])),r>2&&(i[2]=this.deserializeValue("z",n[2])),i}checkValue(e,t){return!0}asDependency=(Wr(this,g),()=>(this.x,this.y,this.z,this))},t})();function $r(e,t){const n=Ce(e,t);n&&Object.defineProperty(n.owner,t,{...n,enumerable:!0})}$r(Yr.prototype,"x"),$r(Yr.prototype,"y"),$r(Yr.prototype,"z");class Zr extends Yr{get default(){return{x:0,y:0,z:0}}deserializeValue(e,t){return Number(t)}checkValue(e,t){if(!super.checkValue(e,t))return!1;if(void 0===t)return!1;if("number"!=typeof t||isNaN(t)||!isFinite(t))throw new TypeError(`Expected ${e} to be a finite number. Received: ${t}`);return!0}}const Kr=new class{addRenderTask(e){if("function"!=typeof e)throw new Error("Render task must be a function.");return this.#$.includes(e)||(this.#$.push(e),this.#Z+=1,this.#K||this.#J()),e}removeRenderTask(e){const t=this.#$.indexOf(e);-1!=t&&(this.#$.splice(t,1),this.#Z-=1,t<=this.#Q&&(this.#Q-=1))}#ee=new Set;once(e,t=!0){if(t||!this.#ee.has(e))return this.#ee.add(e),this.addRenderTask(((t,n)=>(e(t,n),!1)))}needsUpdate(e){this.#te.has(e)&&this.#te.delete(e),this.#te.add(e),this.#J()}willUpdate(e){return this.#te.has(e)}setFrameRequester(e){this.#ne=e}forceTick(e=performance.now()){this.#J(),this.#ie(e)}#K=!1;#Q=0;#Z=0;#$=[];#te=new Set;#re=new Set;#se=new Set;#ne=globalThis.requestAnimationFrame?.bind(globalThis);async#J(){if("loading"===document.readyState&&await new Promise((e=>setTimeout(e))),this.#K)return;this.#K=!0;let e=performance.now();for(;this.#K;){const t=await this.#ae(),n=t-e;this.#oe(t,n),this.#ee.clear(),await null,this.#le(t,n),this.#$.length||(this.#K=!1),e=t}}#ie=e=>{};#ce(){return new Promise((e=>this.#ie=e))}#ae(){return Promise.race([this.#ce(),new Promise((e=>this.#ne(e)))])}#oe(e,t){for(this.#Q=0;this.#Q<this.#Z;this.#Q+=1){const n=this.#$[this.#Q];!1===n(e,t)&&this.removeRenderTask(n)}}#le(e,t){if(0!==this.#te.size){for(const n of this.#te)n.update(e,t),Jr(n)||this.#se.add(n),n.scene&&this.#re.add(n.scene);this.#te.clear();for(const e of this.#se)e.updateWorldMatrices();this.#se.clear();for(const e of this.#re)e.drawScene();this.#re.clear()}}};function Jr(e){let t=e.composedSceneGraphParent;for(;t;){if(Kr.willUpdate(t))return!0;t=t.composedSceneGraphParent}return!1}class Qr extends Yr{get default(){return{x:"",y:"",z:""}}checkValue(e,t){if(!super.checkValue(e,t))return!1;if(void 0===t)return!1;if("string"!=typeof t)throw new TypeError(`Expected ${e} to be a string. Received: ${t}`);return!0}}class es extends Qr{get default(){return{x:"literal",y:"literal",z:"literal"}}get allowedValues(){return["literal","l","proportional","p"]}checkValue(e,t){if(!super.checkValue(e,t))return!1;if(!this.allowedValues.includes(t))throw new TypeError(`Expected ${e} to be one of 'literal' ('l' for short) or 'proportional' ('p' for short). Received: '${t}'`);return!0}}class ts extends Zr{checkValue(e,t){if(!super.checkValue(e,t))return!1;if(t<0)throw new TypeError(`Expected ${e} not to be negative. Received: ${t}`);return!0}}const ns=Symbol();function is(e=Object){return class extends e{[ns]=!0;_setPropertyXYZ(e,t,n){n!==t&&("function"==typeof n?this.#ue(n,e,t):(this.#he?this.#he=!1:this.#de(e),t.from(n)))}_setPropertySingle(e,t,n){"function"==typeof n?this.#pe(n,e):(this.#he?this.#he=!1:this.#de(e),t(n))}#fe=null;#he=!1;#ue(e,t,n){this.#fe||(this.#fe=new Map);const i=this.#fe.get(t);i&&Kr.removeRenderTask(i),this.#fe.set(t,Kr.addRenderTask(((i,r)=>{const s=e(n.x,n.y,n.z,i,r);if(!1===s)return this.#fe.delete(t),!1;this.#he=!0,n.from(s)})))}#pe(e,t){this.#fe||(this.#fe=new Map);const n=this.#fe.get(t);n&&Kr.removeRenderTask(n),this.#fe.set(t,Kr.addRenderTask((n=>{const i=e(this[t],n);if(!1===i)return this.#fe.delete(t),!1;this.#he=!0,this[t]=i})))}#de(e){if(!this.#fe)return;const t=this.#fe.get(e);t&&(Kr.removeRenderTask(t),this.#fe.delete(e),this.#fe.size||(this.#fe=null))}removeAllPropertyFunctions(){if(this.#fe)for(const[e]of this.#fe)this.#de(e)}disconnectedCallback(){super.disconnectedCallback?.(),this.removeAllPropertyFunctions()}}}Object.defineProperty(is,Symbol.hasInstance,{value:e=>!!e&&!!e[ns]});const rs=Symbol("isEventful");function ss(e=Object){return class extends e{[rs]=!0;#me=null;on(e,t,n){let i=this.#me;if("function"!=typeof t)throw new Error("Expected a function in callback argument of Eventful#on.");i||(i=this.#me=new Map);let r=i.get(e);r||i.set(e,r=new Set),r.add([t,n])}off(e,t,n){const i=this.#me;if(!i)return;const r=i.get(e);if(!r)return;const s=Array.from(r).find((e=>e[0]===t&&e[1]===n));s&&(r.delete(s),0===r.size&&i.delete(e),0===i.size&&(this.#me=null))}emit(e,t){const n=this.#me;if(!n)return;const i=n.get(e);if(i)for(const[e,n]of new Set(i))e.call(n,t)}}}Object.defineProperty(ss,Symbol.hasInstance,{value:e=>!!e&&!!e[rs]});class as extends(Xe(ss(Je))){get parentLumeElement(){return this.parentElement instanceof as?this.parentElement:null}get lumeChildren(){return Array.prototype.filter.call(this.children,(e=>e instanceof as))}get lumeChildCount(){return this.lumeChildren.length}disconnectedCallback(){super.disconnectedCallback(),this.stopEffects()}on(e,t,n){super.on(e,t,n)}emit(e,t){super.emit(e,t)}}function os({target:e,onConnect:t,onDisconnect:n,includeTextNodes:i=!1,weighted:r=!1}){const s=function(e,t,n=!1,i=!1){const r=new MutationObserver((r=>{if(!i){for(const n of r){const{target:i,removedNodes:r,addedNodes:s}=n;for(let e=0,n=r.length;e<n;e+=1)t.call(i,r[e]);for(let t=0,n=s.length;t<n;t+=1)e.call(i,s[t])}return}const s=new Map;for(let e=0,t=r.length;e<t;e+=1){const t=r[e];if("childList"!=t.type)continue;let n=s.get(t.target);n||s.set(t.target,n=new Map);const{addedNodes:i}=t;for(let e=i.length,t=0;t<e;t+=1){const e=i[t];n.set(e,(n.get(e)||0)+1)}const{removedNodes:a}=t;for(let e=a.length,t=0;t<e;t+=1){const e=a[t];n.set(e,(n.get(e)||0)-1)}}for(const[i,r]of Array.from(s))for(const[s,a]of Array.from(r))!n&&(s instanceof Text||s instanceof Comment)||(a>0&&"function"==typeof e?e.call(i,s):a<0&&"function"==typeof t&&t.call(i,s))}));return r}(t,n,i,r);return s.observe(e,{childList:!0}),()=>s.disconnect()}const ls=e=>!!e.isElement3D,cs=()=>!!globalThis.window?.document,us=Symbol("triggerChildComposedCallback"),hs=Symbol("triggerChildUncomposedCallback");function ds(e){return class t extends e{isScene=!1;isElement3D=!1;skipShadowObservation=!1;attachShadow(e){const n=super.attachShadow(e);if(this.skipShadowObservation)return n;this.exposedShadowRoot=n,os({target:n,onConnect:this.#ge.bind(this),onDisconnect:this.#ve.bind(this)});const i=Array.from(this.children);for(const e of i)e instanceof t&&(e.isPossiblySlotted=!0,this.#ye[hs](e,"actual"));return n}get _hasShadowRoot(){return!!this.exposedShadowRoot}get _isPossiblyDistributedToShadowRoot(){return this.isPossiblySlotted}get _shadowRootParent(){return this.shadowParent}get _shadowRootChildren(){return this.exposedShadowRoot?Array.from(this.exposedShadowRoot.children).filter((e=>e instanceof t)):[]}get _distributedShadowRootChildren(){const e=[];for(const n of Array.from(this.exposedShadowRoot?.children||[]))if(n instanceof HTMLSlotElement&&!n.assignedSlot)for(const i of n.assignedElements({flatten:!0}))i instanceof t&&e.push(i);return e}get _distributedParent(){return this.slottedParent}get _distributedChildren(){return this.slottedChildren?[...this.slottedChildren]:null}__composedParent=null;get composedParent(){let e=this.__composedParent;return e||(e=this.__getComposedParent()),e}get __isComposed(){return this.__composedParent}get isComposed(){return this.composedParent}__getComposedParent(){let e=this.parentElement;return e&&e.isScene?e:(e=this.slottedParent||this.shadowParent,e||fs(this))}get _composedChildren(){return this.exposedShadowRoot?[...this._distributedShadowRootChildren,...this._shadowRootChildren]:[...this.slottedChildren||[],...Array.from(this.children).filter((e=>e instanceof t))]}exposedShadowRoot;isPossiblySlotted=!1;#be;get __previousSlotAssignedNodes(){return this.#be||(this.#be=new WeakMap),this.#be}slottedParent=null;shadowParent=null;slottedChildren=null;#ye=this;#ge(e){e instanceof t?(e.shadowParent=this,this.#ye[us](e,"root")):e instanceof HTMLSlotElement&&(e.addEventListener("slotchange",this.__onChildSlotChange),this.__handleSlottedChildren(e))}#ve(e){e instanceof t?(e.shadowParent=null,this.#ye[hs](e,"root")):e instanceof HTMLSlotElement&&(e.removeEventListener("slotchange",this.__onChildSlotChange,{capture:!0}),this.__handleSlottedChildren(e),this.__previousSlotAssignedNodes.delete(e))}get __onChildSlotChange(){return this.__onChildSlotChange__||(this.__onChildSlotChange__=e=>{const t=e.currentTarget;this.__handleSlottedChildren(t)}),this.__onChildSlotChange__}__onChildSlotChange__;#xe=!1;[us](e,t){if(e.#xe)return;e.__composedParent=this;const n=()=>{this.childComposedCallback?.(e,t),e.composedCallback?.(this,t)};e.matches(":defined")?n():customElements.whenDefined(e.tagName.toLowerCase()).then(n)}[hs](e,t){e.#xe||(e.__composedParent=null,this.childUncomposedCallback?.(e,t),e.uncomposedCallback?.(this,t))}__handleSlottedChildren(e){const n=this.__getSlottedChildDifference(e),{removed:i}=n;for(let e=i.length,n=0;n<e;n+=1){const e=i[n];e instanceof t&&(e.slottedParent=null,this.slottedChildren&&(this.slottedChildren.delete(e),this.slottedChildren.size&&(this.slottedChildren=null)),this.#ye[hs](e,"slot"))}const{added:r}=n;for(let e=r.length,n=0;n<e;n+=1){const e=r[n];if(!(e instanceof t))continue;const i=e.slottedParent;if(i){const t=i.slottedChildren;t&&(t.delete(e),t.size||(i.slottedChildren=null))}e.slottedParent=this,this.slottedChildren||(this.slottedChildren=new Set),this.slottedChildren.add(e),e.__composedParent&&(e.#xe=!0),this.#ye[us](e,"slot")}queueMicrotask((()=>{for(let e=r.length,n=0;n<e;n+=1){const e=r[n];e instanceof t&&e.isConnected&&e.#xe&&(e.#xe=!1,this.#ye[hs](e,"slot"),this.#ye[us](e,"slot"))}}))}__getSlottedChildDifference(e){{const t=this.__previousSlotAssignedNodes.get(e)??[],n=this.#_e(e);return this.__previousSlotAssignedNodes.set(e,[...n]),{removed:t,added:n}}}#_e(e){return!this.isScene&&e.assignedSlot?[]:e.assignedElements({flatten:!0})}traverseComposed(e,t=!1){if(e(this),!t){for(const n of this._composedChildren)n.traverseComposed(e,t);return}let n=Promise.resolve();for(const i of this._composedChildren)n=i.matches(":defined")?n.then((()=>i.traverseComposed(e,t))):n.then((()=>customElements.whenDefined(i.tagName.toLowerCase()))).then((()=>i.traverseComposed(e,t)));return n}}}const ps=new WeakSet;if(cs()){const e=Element.prototype.attachShadow;Element.prototype.attachShadow=function(...t){const n=e.apply(this,t);return ps.add(this),n}}function fs(e){const t=e.parentNode;if(t instanceof HTMLSlotElement){let e=t;return e.assignedElements({flatten:!0}).length?null:fs(e)}{const t=e.parentNode;if(!t)return null;if(t instanceof ShadowRoot)return t.host;if(function(e){return ps.has(e)}(t)){if(!e.assignedSlot)return null;for(;e.assignedSlot;)e=e.assignedSlot;return fs(e)}return t}}var ms=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0},gs=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},vs=function(e,t,n){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})};const ys={},bs=new WeakMap,xs=new WeakMap;let _s=(()=>{let e,t,n,i,r,s,a,o,l=[pt],c=[],u=is(ds(as)),h=[],d=[],p=[];var f=class extends u{static{t=this}static{const m="function"==typeof Symbol&&Symbol.metadata?Object.create(u[Symbol.metadata]??null):void 0;n=[Ue],r=[et,tt],s=[et,tt],a=[et,tt],o=[et,tt],gs(this,i={get:vs((function(){return this.#we}),"#calculatedSize","get"),set:vs((function(e){this.#we=e}),"#calculatedSize","set")},n,{kind:"accessor",name:"#calculatedSize",static:!1,private:!0,access:{has:e=>#Se in e,get:e=>e.#Se,set:(e,t)=>{e.#Se=t}},metadata:m},d,p),gs(this,null,r,{kind:"setter",name:"sizeMode",static:!1,private:!1,access:{has:e=>"sizeMode"in e,set:(e,t)=>{e.sizeMode=t}},metadata:m},null,h),gs(this,null,s,{kind:"getter",name:"sizeMode",static:!1,private:!1,access:{has:e=>"sizeMode"in e,get:e=>e.sizeMode},metadata:m},null,h),gs(this,null,a,{kind:"setter",name:"size",static:!1,private:!1,access:{has:e=>"size"in e,set:(e,t)=>{e.size=t}},metadata:m},null,h),gs(this,null,o,{kind:"getter",name:"size",static:!1,private:!1,access:{has:e=>"size"in e,get:e=>e.size},metadata:m},null,h),gs(null,e={value:t},l,{kind:"class",name:t.name,metadata:m},null,c),f=t=e.value,m&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:m}),ms(t,c)}#we=(ms(this,h),ms(this,d,{x:0,y:0,z:0}));get#Se(){return i.get.call(this)}set#Se(e){return i.set.call(this,e)}set sizeMode(e){if("function"==typeof e)throw new TypeError("property functions are not allowed for sizeMode");bs.has(this)||bs.set(this,new es("literal","literal","literal")),this._setPropertyXYZ("sizeMode",bs.get(this),e)}get sizeMode(){return bs.has(this)||bs.set(this,new es("literal","literal","literal")),bs.get(this)}set size(e){xs.has(this)||xs.set(this,new ts(0,0,0)),this._setPropertyXYZ("size",xs.get(this),e)}get size(){return xs.has(this)||xs.set(this,new ts(0,0,0)),xs.get(this)}get calculatedSize(){return{...this.#Se}}get composedLumeParent(){const e=this.composedParent;return e instanceof f?e:null}get composedLumeChildren(){return super._composedChildren}get parentSize(){return this.composedLumeParent?.calculatedSize??{x:0,y:0,z:0}}#Me=(ms(this,p),new Event("sizechange"));_calcSize(){const e=this.#Se;Object.assign(ys,e);const t=this.size,n=this.sizeMode,{x:i,y:r,z:s}=n,a=this.parentSize;"literal"===i||"l"===i?e.x=t.x:"proportional"!==i&&"p"!==i||(e.x=a.x*t.x),"literal"===r||"l"===r?e.y=t.y:"proportional"!==r&&"p"!==r||(e.y=a.y*t.y),"literal"===s||"l"===s?e.z=t.z:"proportional"!==s&&"p"!==s||(e.z=a.z*t.z),this.#Se=e,ys.x===e.x&&ys.y===e.y&&ys.z===e.z||(this.emit("sizechange",{...e}),this.dispatchEvent(this.#Me))}};return f=t})();var ws=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0},Ss=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0};const Ms=new WeakMap,Es=new WeakMap,Ts=new WeakMap,As=new WeakMap,Cs=new WeakMap,Rs=new WeakMap;let Ps=(()=>{let e,t,n,i,r,s,a,o,l,c,u,h,d,p,f=[pt],m=[],g=_s,v=[];return class extends g{static{t=this}static{const y="function"==typeof Symbol&&Symbol.metadata?Object.create(g[Symbol.metadata]??null):void 0;n=[et,tt],i=[et,tt],r=[et,tt],s=[et,tt],a=[et,tt],o=[et,tt],l=[et,tt],c=[et,tt],u=[et,tt],h=[et,tt],d=[et,tt],p=[et,tt],Ss(this,null,n,{kind:"setter",name:"position",static:!1,private:!1,access:{has:e=>"position"in e,set:(e,t)=>{e.position=t}},metadata:y},null,v),Ss(this,null,i,{kind:"getter",name:"position",static:!1,private:!1,access:{has:e=>"position"in e,get:e=>e.position},metadata:y},null,v),Ss(this,null,r,{kind:"setter",name:"rotation",static:!1,private:!1,access:{has:e=>"rotation"in e,set:(e,t)=>{e.rotation=t}},metadata:y},null,v),Ss(this,null,s,{kind:"getter",name:"rotation",static:!1,private:!1,access:{has:e=>"rotation"in e,get:e=>e.rotation},metadata:y},null,v),Ss(this,null,a,{kind:"setter",name:"scale",static:!1,private:!1,access:{has:e=>"scale"in e,set:(e,t)=>{e.scale=t}},metadata:y},null,v),Ss(this,null,o,{kind:"getter",name:"scale",static:!1,private:!1,access:{has:e=>"scale"in e,get:e=>e.scale},metadata:y},null,v),Ss(this,null,l,{kind:"setter",name:"origin",static:!1,private:!1,access:{has:e=>"origin"in e,set:(e,t)=>{e.origin=t}},metadata:y},null,v),Ss(this,null,c,{kind:"getter",name:"origin",static:!1,private:!1,access:{has:e=>"origin"in e,get:e=>e.origin},metadata:y},null,v),Ss(this,null,u,{kind:"setter",name:"alignPoint",static:!1,private:!1,access:{has:e=>"alignPoint"in e,set:(e,t)=>{e.alignPoint=t}},metadata:y},null,v),Ss(this,null,h,{kind:"getter",name:"alignPoint",static:!1,private:!1,access:{has:e=>"alignPoint"in e,get:e=>e.alignPoint},metadata:y},null,v),Ss(this,null,d,{kind:"setter",name:"mountPoint",static:!1,private:!1,access:{has:e=>"mountPoint"in e,set:(e,t)=>{e.mountPoint=t}},metadata:y},null,v),Ss(this,null,p,{kind:"getter",name:"mountPoint",static:!1,private:!1,access:{has:e=>"mountPoint"in e,get:e=>e.mountPoint},metadata:y},null,v),Ss(null,e={value:t},f,{kind:"class",name:t.name,metadata:y},null,m),t=e.value,y&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:y}),ws(t,m)}set position(e){Ms.has(this)||Ms.set(this,new Zr(0,0,0)),this._setPropertyXYZ("position",Ms.get(this),e)}get position(){return Ms.has(this)||Ms.set(this,new Zr(0,0,0)),Ms.get(this)}set rotation(e){Es.has(this)||Es.set(this,new Zr(0,0,0)),this._setPropertyXYZ("rotation",Es.get(this),e)}get rotation(){return Es.has(this)||Es.set(this,new Zr(0,0,0)),Es.get(this)}set scale(e){Ts.has(this)||Ts.set(this,new Zr(1,1,1)),this._setPropertyXYZ("scale",Ts.get(this),e)}get scale(){return Ts.has(this)||Ts.set(this,new Zr(1,1,1)),Ts.get(this)}set origin(e){As.has(this)||As.set(this,new Zr(.5,.5,.5)),this._setPropertyXYZ("origin",As.get(this),e)}get origin(){return As.has(this)||As.set(this,new Zr(.5,.5,.5)),As.get(this)}set alignPoint(e){Cs.has(this)||Cs.set(this,new Zr(0,0,0)),this._setPropertyXYZ("alignPoint",Cs.get(this),e)}get alignPoint(){return Cs.has(this)||Cs.set(this,new Zr(0,0,0)),Cs.get(this)}set mountPoint(e){Rs.has(this)||Rs.set(this,new Zr(0,0,0)),this._setPropertyXYZ("mountPoint",Rs.get(this),e)}get mountPoint(){return Rs.has(this)||Rs.set(this,new Zr(0,0,0)),Rs.get(this)}constructor(){super(...arguments),ws(this,v)}},t})();class ks{#Ee;constructor(e){this.#Ee=e}#Te=!1;applyProperties(){this.#Te&&(this.#Ae(),this.#Ce())}set shouldRender(e){this.#Te=e,requestAnimationFrame((()=>{this.#Re("display",e?"block":"none")}))}get shouldRender(){return this.#Te}#Ce(){const{x:e,y:t}=this.#Ee.calculatedSize;this.#Re("width",`${e}px`),this.#Re("height",`${t}px`)}#Ae(){this.#Re("opacity",this.#Ee.opacity.toString())}#Re(e,t){this.#Ee.style.setProperty(e,t)}}const Is=Symbol("pivot");class Os extends Br{type="Object3DWithPivot";[Is];get pivot(){return this[Is]||(this[Is]=new an),this[Is]}set pivot(e){this[Is]=e}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale);const e=this.pivot;if(0!==e.x||0!==e.y||0!==e.z){const t=e.x,n=e.y,i=e.z,r=this.matrix.elements;r[12]+=t-r[0]*t-r[4]*n-r[8]*i,r[13]+=n-r[1]*t-r[5]*n-r[9]*i,r[14]+=i-r[2]*t-r[6]*n-r[10]*i}this.matrixWorldNeedsUpdate=!0}}function Ls(e){return"geometry"in e&&"material"in e}function Ns(e){return!!e.isOrthographicCamera}Br.prototype.updateMatrix=Os.prototype.updateMatrix,Object.defineProperty(Br.prototype,"pivot",Object.getOwnPropertyDescriptor(Os.prototype,"pivot"));class Ds extends Os{element;type="CSS3DObjectNested";#Pe=requestAnimationFrame((()=>{this.element.style.position="absolute"}));constructor(e){super(),this.element=e}dispose(){cancelAnimationFrame(this.#Pe)}}class zs extends Ds{}class Us{domElement;#ke=new ur;#Ie={camera:{fov:0,style:""},objects:new WeakMap};#Oe=0;#Le=0;#Ne=0;#De=0;#ze;constructor(){const e=document.createElement("div");e.classList.add("CSS3DRendererNested"),e.style.overflow="hidden",this.domElement=e;const t=document.createElement("div");t.classList.add("cameraElement"),t.appendChild(document.createElement("slot")),t.style.transformStyle="preserve-3d",e.appendChild(t),this.#ze=t}getSize(){return{width:this.#Oe,height:this.#Le}}setSize(e,t){this.#Oe=e,this.#Le=t,this.#Ne=e/2,this.#De=t/2,this.domElement.style.width=e+"px",this.domElement.style.height=t+"px",this.#ze.style.width=e+"px",this.#ze.style.height=t+"px"}#Ue(e,t){if(e instanceof Ds){let n="";e instanceof zs?(this.#ke.copy(t.matrixWorldInverse),this.#ke.transpose(),this.#ke.copyPosition(e.matrixWorld),this.#ke.scale(e.scale),this.#ke.elements[3]=0,this.#ke.elements[7]=0,this.#ke.elements[11]=0,this.#ke.elements[15]=1,n=Bs(e,this.#ke)):n=Bs(e,e.matrix);const i=e.element,r=this.#Ie.objects.get(e);if(void 0===r||r.style!==n){i.style.transform=n;const t={style:n};this.#Ie.objects.set(e,t)}}for(let n=0,i=e.children.length;n<i;n++)this.#Ue(e.children[n],t)}render(e,t){const n=t.projectionMatrix.elements[5]*this.#De;this.#Ie.camera.fov!==n&&(function(e){return!!e.isPerspectiveCamera}(t)&&(this.domElement.style.perspective=n+"px"),this.#Ie.camera.fov=n),e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(void 0);let i=0,r=0;Ns(t)&&(i=-(t.right+t.left)/2,r=(t.top+t.bottom)/2);const s=(Ns(t)?"scale("+n+")translate("+Vs(i)+"px,"+Vs(r)+"px)"+Fs(t.matrixWorldInverse):"translateZ("+n+"px)"+Fs(t.matrixWorldInverse))+"translate("+this.#Ne+"px,"+this.#De+"px)";this.#Ie.camera.style!==s&&(this.#ze.style.transform=s,this.#Ie.camera.style=s),this.#Ue(e,t)}}function Fs(e){const t=e.elements;return"matrix3d("+Vs(t[0])+","+Vs(-t[1])+","+Vs(t[2])+","+Vs(t[3])+","+Vs(t[4])+","+Vs(-t[5])+","+Vs(t[6])+","+Vs(t[7])+","+Vs(t[8])+","+Vs(-t[9])+","+Vs(t[10])+","+Vs(t[11])+","+Vs(t[12])+","+Vs(-t[13])+","+Vs(t[14])+","+Vs(t[15])+")"}function Bs(e,t){const n=e.parent,i=n&&"Scene"===n.type,r=t.elements;return`${i?"translate(-50%, -50%)":""} ${"matrix3d("+Vs(r[0])+","+Vs(r[1])+","+Vs(r[2])+","+Vs(r[3])+","+Vs((i?-1:1)*r[4])+","+Vs((i?-1:1)*r[5])+","+Vs((i?-1:1)*r[6])+","+Vs((i?-1:1)*r[7])+","+Vs(r[8])+","+Vs(r[9])+","+Vs(r[10])+","+Vs(r[11])+","+Vs(r[12])+","+Vs((i?1:-1)*r[13])+","+Vs(r[14])+","+Vs(r[15])+")"}`}function Vs(e){return Math.abs(e)<1e-10?0:e}function js(e){if(!Ls(e))return;const t=[].concat(e.material);for(const e of t)e.dispose()}function Hs(e,t=!0,n=!0,i=!0){e&&(Ls(e)&&(e.geometry&&n&&e.geometry.dispose(),i&&js(e)),t&&queueMicrotask((()=>{e.parent&&e.parent.remove(e)})))}function Gs(e,t={}){e.traverse((e=>{Hs(e,t.removeFromParent,t.destroyGeometry,t.destroyMaterial)}))}const Ws=Symbol();function Xs(e=Object){return class extends e{[Ws]=!0;set(e){return Object.assign(this,e),this}}}function qs(e){return e/180*Math.PI}Object.defineProperty(Xs,Symbol.hasInstance,{value:e=>!!e&&!!e[Ws]});var Ys=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0},$s=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},Zs=function(e,t,n){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})};const Ks=[0,0,0],Js=[0,0,0],Qs=[0,0,0],ea=[0,0,0],ta=new WeakMap,na=new WeakSet,ia=e=>na.has(e),ra=new WeakMap;let sa,aa=(()=>{let e,t,n=[pt],i=[],r=function(e){return class extends e{initialBehaviors;constructor(...e){super(...e),queueMicrotask((()=>this.#Fe()))}#Fe(){this.initialBehaviors&&function(e,t,n=!0){let i=e.getAttribute("has")??"";const r=i.split(" ");for(const[s,a]of Object.entries(t))n?e.setAttribute("has",i=i.replace(Vr`/[a-z-]*-${s}/`,"")+` ${a}-${s}`):r.some((e=>e.endsWith("-"+s)))||e.setAttribute("has",i+=` ${a}-${s}`)}(this,this.initialBehaviors,!1)}}}((s=Xs(Ps),class extends s{awaitChildrenDefined=!0;syncChildCallbacks=!0;constructor(...e){super(...e),this.#Be()}connectedCallback(){super.connectedCallback?.(),this.syncChildCallbacks&&this.#Ve(),this.#Be()}disconnectedCallback(){super.disconnectedCallback?.(),this.syncChildCallbacks&&this.#je(),this.#He()}#Ge=new Set;#Ve(){for(let e=this.firstElementChild;e;e=e.nextElementSibling)this.#We(e)}#We(e){e.matches(":defined")||!this.awaitChildrenDefined?this.childConnectedCallback?.(e):this.#Ge.has(e)||(this.#Ge.add(e),customElements.whenDefined(e.tagName.toLowerCase()).then((()=>{this.#Ge.delete(e),this.isConnected&&this.childConnectedCallback?.(e)})))}#je(){for(let e=this.firstElementChild;e;e=e.nextElementSibling)this.#Xe(e)}#Xe(e){this.#Ge.has(e)||this.childDisconnectedCallback?.(e)}#qe=null;#Be(){this.#qe||(this.#qe=os({target:this,onConnect:e=>{this.isConnected&&this.childConnectedCallback&&this.childConnectedCallback(e)},onDisconnect:e=>{this.isConnected&&this.childDisconnectedCallback&&this.childDisconnectedCallback(e)}}))}#He(){this.#qe&&(this.#qe(),this.#qe=null)}}));var s;let a,o,l,c,u,h,d=[],p=[],f=[],m=[],g=[],v=[],y=[];var b=class extends r{static{t=this}static{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(r[Symbol.metadata]??null):void 0;a=[ct],o=[ct],l=[ht],c=[Ue],h=[Ue],$s(this,null,a,{kind:"setter",name:"opacity",static:!1,private:!1,access:{has:e=>"opacity"in e,set:(e,t)=>{e.opacity=t}},metadata:s},null,d),$s(this,null,o,{kind:"getter",name:"opacity",static:!1,private:!1,access:{has:e=>"opacity"in e,get:e=>e.opacity},metadata:s},null,d),$s(this,u={get:Zs((function(){return this.#Ye}),"#scene","get"),set:Zs((function(e){this.#Ye=e}),"#scene","set")},c,{kind:"accessor",name:"#scene",static:!1,private:!0,access:{has:e=>#$e in e,get:e=>e.#$e,set:(e,t)=>{e.#$e=t}},metadata:s},m,g),$s(null,null,l,{kind:"field",name:"debug",static:!1,private:!1,access:{has:e=>"debug"in e,get:e=>e.debug,set:(e,t)=>{e.debug=t}},metadata:s},p,f),$s(null,null,h,{kind:"field",name:"version",static:!1,private:!1,access:{has:e=>"version"in e,get:e=>e.version,set:(e,t)=>{e.version=t}},metadata:s},v,y),$s(null,e={value:t},n,{kind:"class",name:t.name,metadata:s},null,i),b=t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s})}static define(e){this.defineElement(e)}isScene=(Ys(this,d),!1);isElement3D=!1;set opacity(e){ra.has(this)||ra.set(this,1),this._setPropertySingle("opacity",(e=>ra.set(this,e)),e)}get opacity(){return ra.has(this)||ra.set(this,1),ra.get(this)}debug=Ys(this,p,!1);get glLoaded(){return!0}get cssLoaded(){return!0}#Ye=(Ys(this,f),Ys(this,m,null));get#$e(){return u.get.call(this)}set#$e(e){return u.set.call(this,e)}get scene(){return this.#$e}#Ze=Ys(this,g);get three(){return this.#Ze||(this.#Ze=this.#Ke()),this.#Ze}#Ke(){const e=this.makeThreeObject3d();return e.name=`${this.tagName}${this.id?"#"+this.id:""} (webgl, ${e.type})`,na.add(e),e.matrixAutoUpdate=!1,e}#Je(){this.#Ze&&(Hs(this.#Ze),na.delete(this.#Ze),this.#Ze=void 0)}recreateThree(){const e=this.#Ze?.children;this.#Je(),this.#Qe(),e&&e.length&&this.three.add(...e)}#et;get threeCSS(){return this.#et||(this.#et=this.#tt()),this.#et}#tt(){const e=this.makeThreeCSSObject();return e.name=`${this.tagName}${this.id?"#"+this.id:""} (css3d, ${e.type})`,na.add(e),e.matrixAutoUpdate=!1,e}#nt(){this.#et&&(Hs(this.#et),na.delete(this.#et),this.#et=void 0)}recreateThreeCSS(){const e=this.#et?.children;this.#nt(),this.#it(),e&&e.length&&this.threeCSS.add(...e)}connectedCallback(){super.connectedCallback(),this.createEffect((()=>{this.scene,this.sizeMode.asDependency(),this.size.asDependency(),O((()=>{this._calcSize(),this.needsUpdate()}))})),this.createEffect((()=>{this.parentSize,O((()=>{const{x:e,y:t,z:n}=this.sizeMode;"proportional"!==e&&"p"!==e&&"proportional"!==t&&"p"!==t&&"proportional"!==n&&"p"!==n||this._calcSize()})),this.needsUpdate()})),this.createEffect((()=>{this.position.asDependency(),this.rotation.asDependency(),this.scale.asDependency(),this.origin.asDependency(),this.alignPoint.asDependency(),this.mountPoint.asDependency(),this.opacity,this.needsUpdate()}))}disconnectedCallback(){super.disconnectedCallback(),this.stopEffects(),this.#Je(),this.#nt(),this.#$e=null}composedCallback(e,t){super.composedCallback?.(e,t),this.isScene&&console.warn("Composing `<lume-scene>` elements directly into other `<lume-*>` elements is not currently supported. To nest a scene inside a scene, wrap it with a `<div>` inside of a `<lume-mixed-plane>`."),this.composedSceneGraphParent.three.add(this.three),this.composedSceneGraphParent.threeCSS.add(this.threeCSS),this.#$e=this.composedSceneGraphParent.scene,this.#$e&&this.#rt()}uncomposedCallback(e,t){super.uncomposedCallback?.(e,t),this.three.parent?.remove(this.three),this.threeCSS.parent?.remove(this.threeCSS),this.#$e=null,this.#rt()}#rt(){this.traverseSceneGraph((e=>{e!==this&&e.#$e!==this.#$e&&(e.#$e=this.#$e)}))}childComposedCallback(e,t){e instanceof b&&this.needsUpdate()}childUncomposedCallback(e,t){e instanceof b&&this.needsUpdate()}traverseSceneGraph(e,t=!1){throw"Element3D and Scene implement this"}get parentLumeElement(){const e=super.parentLumeElement;if(e&&!(e instanceof b))throw new TypeError("Parent must be type SharedAPI.");return e}needsUpdate(){Kr.needsUpdate(this)}get _elementOperations(){return ta.has(this)||ta.set(this,new ks(this)),ta.get(this)}get composedLumeChildren(){const e=[];for(const t of super.composedLumeChildren)ls(t)&&e.push(t);return e}makeThreeObject3d(){return new Br}makeThreeCSSObject(){if(!(this instanceof HTMLElement))throw"API available only in DOM environment.";return new Ds(this)}#Qe(){this.composedSceneGraphParent?.three.add(this.three);for(const e of this.composedLumeChildren)this.three.add(e.three);this.needsUpdate()}#it(){this.composedSceneGraphParent?.threeCSS.add(this.threeCSS);for(const e of this.composedLumeChildren)this.threeCSS.add(e.threeCSS);this.needsUpdate()}get composedLumeParent(){const e=super.composedLumeParent;return e instanceof b?e:null}get composedSceneGraphParent(){const e=this.composedLumeParent;return this.parentLumeElement?.isScene?this.parentLumeElement:e}_calculateMatrix(){const e=this.alignPoint,t=this.mountPoint,n=this.position,i=this.origin,r=this.calculatedSize;Ks[0]=r.x/2,Ks[1]=r.y/2,Ks[2]=r.z/2;const s=this.parentSize;Ks[0]+=-s.x/2,Ks[1]+=-s.y/2,Ks[2]+=-s.z/2,Js[0]=s.x*e.x,Js[1]=s.y*e.y,Js[2]=s.z*e.z,Qs[0]=r.x*t.x,Qs[1]=r.y*t.y,Qs[2]=r.z*t.z,ea[0]=n.x+Js[0]-Qs[0],ea[1]=n.y+Js[1]-Qs[1],ea[2]=n.z+Js[2]-Qs[2],this.three.position.set(ea[0]+Ks[0],-(ea[1]+Ks[1]),ea[2]+Ks[2]);const a=this.composedSceneGraphParent?.isScene;a?this.threeCSS.position.set(ea[0]+Ks[0],-(ea[1]+Ks[1]),ea[2]+Ks[2]):this.threeCSS.position.set(ea[0],-ea[1],ea[2]+Ks[2]),.5!==i.x||.5!==i.y||.5!==i.z?(this.three.pivot.set(i.x*r.x-r.x/2,-(i.y*r.y-r.y/2),i.z*r.z-r.z/2),this.threeCSS.pivot.set(i.x*r.x-r.x/2,-(i.y*r.y-r.y/2),i.z*r.z-r.z/2)):(this.three.pivot.set(0,0,0),this.threeCSS.pivot.set(0,0,0)),this.three.updateMatrix(),this.threeCSS.updateMatrix()}_updateRotation(){const{x:e,y:t,z:n}=this.rotation;this.three.rotation.set(-qs(e),qs(t),-qs(n));const i=this.composedSceneGraphParent?.isScene;this.threeCSS.rotation.set((i?-1:1)*qs(e),qs(t),(i?-1:1)*qs(n))}_updateScale(){const{x:e,y:t,z:n}=this.scale;this.three.scale.set(e,t,n),this.threeCSS.scale.set(e,t,n)}version=Ys(this,v,0);updateWorldMatrices(e=!0){this.three.updateWorldMatrix(!1,!1);for(const e of this.three.children)ia(e)||e.updateMatrixWorld(!0);this.threeCSS.updateWorldMatrix(!1,!1);for(const e of this.threeCSS.children)ia(e)||e.updateMatrixWorld(!0);e&&this.traverseSceneGraph((e=>e!==this&&e.updateWorldMatrices(!1)),!1),O((()=>this.version++))}update(e,t){this._updateRotation(),this._updateScale(),this._calculateMatrix(),this._elementOperations.applyProperties()}#ye=(Ys(this,y),this);childConnectedCallback(e){ls(e)?!this.isScene&&this.exposedShadowRoot?e.isPossiblySlotted=!0:this.#ye[us](e,"actual"):e instanceof HTMLSlotElement&&(e.addEventListener("slotchange",this.__onChildSlotChange),queueMicrotask((()=>this.__handleSlottedChildren(e))))}childDisconnectedCallback(e){ls(e)?!this.isScene&&this.exposedShadowRoot?e.isPossiblySlotted=!1:this.#ye[hs](e,"actual"):e instanceof HTMLSlotElement&&(e.removeEventListener("slotchange",this.__onChildSlotChange,{capture:!0}),this.__handleSlottedChildren(e),this.__previousSlotAssignedNodes.delete(e))}setAttribute(e,t){super.setAttribute(e,t)}get _composedChildren(){return!this.isScene&&this.exposedShadowRoot?[...this._distributedShadowRootChildren.filter((e=>e instanceof b)),...this._shadowRootChildren.filter((e=>e instanceof b))]:[...[...this.slottedChildren||[]].filter((e=>e instanceof b)),...Array.from(this.children).filter((e=>e instanceof b))]}static css="\n\t\t:host {\n\t\t\t/*\n\t\t\t * All items of the scene graph are hidden until they are mounted in\n\t\t\t * a scene (this changes to display:block). This gets toggled\n\t\t\t * between \"none\" and \"block\" by SharedAPI depending on if CSS\n\t\t\t * rendering is enabled.\n\t\t\t */\n\t\t\tdisplay: none;\n\n\t\t\t/*\n\t\t\tLayout of a node's CSS rectangle is never affected by anything\n\t\t\toutside of it. We don't contain paint because CSS content can\n\t\t\toverflow if desired, or size because eventually we'll add natural\n\t\t\tsizing to let the node be sized by its content.\n\t\t\t*/\n\t\t\tcontain: layout;\n\n\t\t\t/* TODO see how content-visibility affects CSS performance with nodes that are off-screen. */\n\t\t\t/* content-visibility: auto; implies contain:strict */\n\n\t\t\tbox-sizing: border-box;\n\n\t\t\t/*\n\t\t\t * Defaults to [0.5,0.5,0.5] (the Z axis doesn't apply for DOM\n\t\t\t * elements, but does for 3D objects in WebGL that have any size\n\t\t\t * along Z.)\n\t\t\t */\n\t\t\ttransform-origin: 50% 50% 0; /* default */\n\n\t\t\ttransform-style: preserve-3d;\n\n\t\t\t/*\n\t\t\t * Force anti-aliasing of 3D element edges using an invisible shadow.\n\t\t\t * https://stackoverflow.com/questions/6492027\n\t\t\t * TODO allow to be configured with an antialiased attribute or similar.\n\t\t\t */\n\t\t\t/*box-shadow: 0 0 1px rgba(255, 255, 255, 0); currently is very very slow, https://crbug.com/1405629*/\n\t\t}\n\t";static{Ys(t,i)}};return b=t})();cs()&&globalThis.addEventListener("error",(e=>{const t=e.error;t&&/Illegal constructor/i.test(t.message)&&console.error("\n\t\t\t\tOne of the reasons the following error can happen is if a Custom\n\t\t\t\tElement is called with 'new' before being defined. Did you set\n\t\t\t\twindow.$lume.autoDefineElements to false and then forget to call\n\t\t\t\t'LUME.defineElements()' or to call '.defineElement()' on\n\t\t\t\tindividual Lume classes?  For other reasons, see:\n\t\t\t\thttps://www.google.com/search?q=chrome%20illegal%20constructor\n\t\t\t")}));try{sa=$lume??{}}catch{sa={}}const oa=!!(sa.autoDefineElements??globalThis.window?.customElements);var la=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},ca=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let ua=(()=>{let e,t,n,i=[pt("lume-element3d",oa)],r=[],s=aa,a=[],o=[];return class extends s{static{t=this}static{const l="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;n=[ht],la(null,null,n,{kind:"field",name:"visible",static:!1,private:!1,access:{has:e=>"visible"in e,get:e=>e.visible,set:(e,t)=>{e.visible=t}},metadata:l},a,o),la(null,e={value:t},i,{kind:"class",name:t.name,metadata:l},null,r),t=e.value,l&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:l})}hasShadow=!1;isElement3D=!0;visible=ca(this,a,!0);get parentSize(){const e=this.composedLumeParent;return this.scene&&this.scene===this.parentElement?this.scene.calculatedSize:e?.calculatedSize??{x:0,y:0,z:0}}constructor(){super(),ca(this,o),this.composedLumeParent&&(this._calcSize(),queueMicrotask((()=>this.needsUpdate())))}traverseSceneGraph(e,t=!1){if(e(this),!t){for(const n of this.composedLumeChildren)n.traverseSceneGraph(e,t);return}let n=Promise.resolve();for(const i of this.composedLumeChildren)n=i.matches(":defined")?n.then((()=>i.traverseSceneGraph(e,t))):n.then((()=>customElements.whenDefined(i.tagName.toLowerCase()))).then((()=>i.traverseSceneGraph(e,t)));return n}connectedCallback(){super.connectedCallback(),this.createEffect((()=>{this._elementOperations.shouldRender=this.visible,this.three.visible=this.visible,this.needsUpdate()}))}static css=`\n\t\t${Reflect.get(s,"css",t)}\n\n\t\t:host {\n\t\t\tposition: absolute;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\t\t}\n\t`;static{ca(t,r)}},t})();ua.prototype.isElement3D=!0;class ha extends(Xe($t)){requiredElementType(){return[ua]}connectedCallback(){super.connectedCallback(),this.element.needsUpdate()}disconnectedCallback(){super.disconnectedCallback(),this.element.needsUpdate()}}class da{constructor(e=0,t=0){da.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(en(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*n-s*i+e.x,this.y=r*i+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class pa{constructor(e=new an(1/0,1/0,1/0),t=new an(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(ma.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(ma.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=ma.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const i=n.getAttribute("position");if(!0===t&&void 0!==i&&!0!==e.isInstancedMesh)for(let t=0,n=i.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,ma):ma.fromBufferAttribute(i,t),ma.applyMatrix4(e.matrixWorld),this.expandByPoint(ma);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),ga.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),ga.copy(n.boundingBox)),ga.applyMatrix4(e.matrixWorld),this.union(ga)}const i=e.children;for(let e=0,n=i.length;e<n;e++)this.expandByObject(i[e],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,ma),ma.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Sa),Ma.subVectors(this.max,Sa),va.subVectors(e.a,Sa),ya.subVectors(e.b,Sa),ba.subVectors(e.c,Sa),xa.subVectors(ya,va),_a.subVectors(ba,ya),wa.subVectors(va,ba);let t=[0,-xa.z,xa.y,0,-_a.z,_a.y,0,-wa.z,wa.y,xa.z,0,-xa.x,_a.z,0,-_a.x,wa.z,0,-wa.x,-xa.y,xa.x,0,-_a.y,_a.x,0,-wa.y,wa.x,0];return!!Aa(t,va,ya,ba,Ma)&&(t=[1,0,0,0,1,0,0,0,1],!!Aa(t,va,ya,ba,Ma)&&(Ea.crossVectors(xa,_a),t=[Ea.x,Ea.y,Ea.z],Aa(t,va,ya,ba,Ma)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,ma).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(ma).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(fa[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),fa[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),fa[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),fa[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),fa[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),fa[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),fa[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),fa[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(fa)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const fa=[new an,new an,new an,new an,new an,new an,new an,new an],ma=new an,ga=new pa,va=new an,ya=new an,ba=new an,xa=new an,_a=new an,wa=new an,Sa=new an,Ma=new an,Ea=new an,Ta=new an;function Aa(e,t,n,i,r){for(let s=0,a=e.length-3;s<=a;s+=3){Ta.fromArray(e,s);const a=r.x*Math.abs(Ta.x)+r.y*Math.abs(Ta.y)+r.z*Math.abs(Ta.z),o=t.dot(Ta),l=n.dot(Ta),c=i.dot(Ta);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>a)return!1}return!0}const Ca=new pa,Ra=new an,Pa=new an;class ka{constructor(e=new an,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Ca.setFromPoints(e).getCenter(n);let i=0;for(let t=0,r=e.length;t<r;t++)i=Math.max(i,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Ra.subVectors(e,this.center);const t=Ra.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(Ra,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(Pa.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Ra.copy(e.center).add(Pa)),this.expandByPoint(Ra.copy(e.center).sub(Pa))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Ia=new an,Oa=new an,La=new an,Na=new an,Da=new an,za=new an,Ua=new an;class Fa{constructor(e=new an,t=new an(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ia)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ia.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ia.copy(this.origin).addScaledVector(this.direction,t),Ia.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){Oa.copy(e).add(t).multiplyScalar(.5),La.copy(t).sub(e).normalize(),Na.copy(this.origin).sub(Oa);const r=.5*e.distanceTo(t),s=-this.direction.dot(La),a=Na.dot(this.direction),o=-Na.dot(La),l=Na.lengthSq(),c=Math.abs(1-s*s);let u,h,d,p;if(c>0)if(u=s*o-a,h=s*a-o,p=r*c,u>=0)if(h>=-p)if(h<=p){const e=1/c;u*=e,h*=e,d=u*(u+s*h+2*a)+h*(s*u+h+2*o)+l}else h=r,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h=-r,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h<=-p?(u=Math.max(0,-(-s*r+a)),h=u>0?-r:Math.min(Math.max(-r,-o),r),d=-u*u+h*(h+2*o)+l):h<=p?(u=0,h=Math.min(Math.max(-r,-o),r),d=h*(h+2*o)+l):(u=Math.max(0,-(s*r+a)),h=u>0?r:Math.min(Math.max(-r,-o),r),d=-u*u+h*(h+2*o)+l);else h=s>0?-r:r,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),i&&i.copy(Oa).addScaledVector(La,h),d}intersectSphere(e,t){Ia.subVectors(e.center,this.origin);const n=Ia.dot(this.direction),i=Ia.dot(Ia)-n*n,r=e.radius*e.radius;if(i>r)return null;const s=Math.sqrt(r-i),a=n-s,o=n+s;return o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,s,a,o;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),c>=0?(r=(e.min.y-h.y)*c,s=(e.max.y-h.y)*c):(r=(e.max.y-h.y)*c,s=(e.min.y-h.y)*c),n>s||r>i?null:((r>n||isNaN(n))&&(n=r),(s<i||isNaN(i))&&(i=s),u>=0?(a=(e.min.z-h.z)*u,o=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,o=(e.min.z-h.z)*u),n>o||a>i?null:((a>n||n!=n)&&(n=a),(o<i||i!=i)&&(i=o),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,Ia)}intersectTriangle(e,t,n,i,r){Da.subVectors(t,e),za.subVectors(n,e),Ua.crossVectors(Da,za);let s,a=this.direction.dot(Ua);if(a>0){if(i)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}Na.subVectors(this.origin,e);const o=s*this.direction.dot(za.crossVectors(Na,za));if(o<0)return null;const l=s*this.direction.dot(Da.cross(Na));if(l<0)return null;if(o+l>a)return null;const c=-s*Na.dot(Ua);return c<0?null:this.at(c/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Ba{constructor(e=0,t=0,n=0,i=1){Ba.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*t+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*t+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*t+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const s=.01,a=.1,o=e.elements,l=o[0],c=o[4],u=o[8],h=o[1],d=o[5],p=o[9],f=o[2],m=o[6],g=o[10];if(Math.abs(c-h)<s&&Math.abs(u-f)<s&&Math.abs(p-m)<s){if(Math.abs(c+h)<a&&Math.abs(u+f)<a&&Math.abs(p+m)<a&&Math.abs(l+d+g-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,o=(d+1)/2,v=(g+1)/2,y=(c+h)/4,b=(u+f)/4,x=(p+m)/4;return e>o&&e>v?e<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=y/n,r=b/n):o>v?o<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(o),n=y/i,r=x/i):v<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(v),n=b/r,i=x/r),this.set(n,i,r,t),this}let v=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(u-f)/v,this.z=(h-c)/v,this.w=Math.acos((l+d+g-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}const Va=new an,ja=new an,Ha=new an,Ga=new an,Wa=new an,Xa=new an,qa=new an,Ya=new an,$a=new an,Za=new an,Ka=new Ba,Ja=new Ba,Qa=new Ba;class eo{constructor(e=new an,t=new an,n=new an){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),Va.subVectors(e,t),i.cross(Va);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){Va.subVectors(i,t),ja.subVectors(n,t),Ha.subVectors(e,t);const s=Va.dot(Va),a=Va.dot(ja),o=Va.dot(Ha),l=ja.dot(ja),c=ja.dot(Ha),u=s*l-a*a;if(0===u)return r.set(0,0,0),null;const h=1/u,d=(l*o-a*c)*h,p=(s*c-a*o)*h;return r.set(1-d-p,p,d)}static containsPoint(e,t,n,i){return null!==this.getBarycoord(e,t,n,i,Ga)&&Ga.x>=0&&Ga.y>=0&&Ga.x+Ga.y<=1}static getInterpolation(e,t,n,i,r,s,a,o){return null===this.getBarycoord(e,t,n,i,Ga)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(r,Ga.x),o.addScaledVector(s,Ga.y),o.addScaledVector(a,Ga.z),o)}static getInterpolatedAttribute(e,t,n,i,r,s){return Ka.setScalar(0),Ja.setScalar(0),Qa.setScalar(0),Ka.fromBufferAttribute(e,t),Ja.fromBufferAttribute(e,n),Qa.fromBufferAttribute(e,i),s.setScalar(0),s.addScaledVector(Ka,r.x),s.addScaledVector(Ja,r.y),s.addScaledVector(Qa,r.z),s}static isFrontFacing(e,t,n,i){return Va.subVectors(n,t),ja.subVectors(e,t),Va.cross(ja).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Va.subVectors(this.c,this.b),ja.subVectors(this.a,this.b),.5*Va.cross(ja).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return eo.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return eo.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,i,r){return eo.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return eo.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return eo.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let s,a;Wa.subVectors(i,n),Xa.subVectors(r,n),Ya.subVectors(e,n);const o=Wa.dot(Ya),l=Xa.dot(Ya);if(o<=0&&l<=0)return t.copy(n);$a.subVectors(e,i);const c=Wa.dot($a),u=Xa.dot($a);if(c>=0&&u<=c)return t.copy(i);const h=o*u-c*l;if(h<=0&&o>=0&&c<=0)return s=o/(o-c),t.copy(n).addScaledVector(Wa,s);Za.subVectors(e,r);const d=Wa.dot(Za),p=Xa.dot(Za);if(p>=0&&d<=p)return t.copy(r);const f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(n).addScaledVector(Xa,a);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return qa.subVectors(r,i),a=(u-c)/(u-c+(d-p)),t.copy(i).addScaledVector(qa,a);const g=1/(m+f+h);return s=f*g,a=h*g,t.copy(n).addScaledVector(Wa,s).addScaledVector(Xa,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const to=(new Sr).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),no=(new Sr).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),io={[Wi]:{transfer:Yi,primaries:Zi,luminanceCoefficients:[.2126,.7152,.0722],toReference:e=>e,fromReference:e=>e},[Gi]:{transfer:$i,primaries:Zi,luminanceCoefficients:[.2126,.7152,.0722],toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[qi]:{transfer:Yi,primaries:Ki,luminanceCoefficients:[.2289,.6917,.0793],toReference:e=>e.applyMatrix3(no),fromReference:e=>e.applyMatrix3(to)},[Xi]:{transfer:$i,primaries:Ki,luminanceCoefficients:[.2289,.6917,.0793],toReference:e=>e.convertSRGBToLinear().applyMatrix3(no),fromReference:e=>e.applyMatrix3(to).convertLinearToSRGB()}},ro=new Set([Wi,qi]),so={enabled:!0,_workingColorSpace:Wi,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){if(!ro.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const i=io[t].toReference;return(0,io[n].fromReference)(i(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return io[e].primaries},getTransfer:function(e){return e===Hi?Yi:io[e].transfer},getLuminanceCoefficients:function(e,t=this._workingColorSpace){return e.fromArray(io[t].luminanceCoefficients)}};function ao(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function oo(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const lo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},co={h:0,s:0,l:0},uo={h:0,s:0,l:0};function ho(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class po{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Gi){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,so.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=so.workingColorSpace){return this.r=e,this.g=t,this.b=n,so.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=so.workingColorSpace){if(e=(e%(r=1)+r)%r,t=en(t,0,1),n=en(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=ho(r,i,e+1/3),this.g=ho(r,i,e),this.b=ho(r,i,e-1/3)}var r;return so.toWorkingColorSpace(this,i),this}setStyle(e,t=Gi){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const s=i[1],a=i[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=i[1],r=n.length;if(3===r)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,t);if(6===r)return this.setHex(parseInt(n,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Gi){const n=lo[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ao(e.r),this.g=ao(e.g),this.b=ao(e.b),this}copyLinearToSRGB(e){return this.r=oo(e.r),this.g=oo(e.g),this.b=oo(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Gi){return so.fromWorkingColorSpace(fo.copy(this),e),65536*Math.round(en(255*fo.r,0,255))+256*Math.round(en(255*fo.g,0,255))+Math.round(en(255*fo.b,0,255))}getHexString(e=Gi){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=so.workingColorSpace){so.fromWorkingColorSpace(fo.copy(this),t);const n=fo.r,i=fo.g,r=fo.b,s=Math.max(n,i,r),a=Math.min(n,i,r);let o,l;const c=(a+s)/2;if(a===s)o=0,l=0;else{const e=s-a;switch(l=c<=.5?e/(s+a):e/(2-s-a),s){case n:o=(i-r)/e+(i<r?6:0);break;case i:o=(r-n)/e+2;break;case r:o=(n-i)/e+4}o/=6}return e.h=o,e.s=l,e.l=c,e}getRGB(e,t=so.workingColorSpace){return so.fromWorkingColorSpace(fo.copy(this),t),e.r=fo.r,e.g=fo.g,e.b=fo.b,e}getStyle(e=Gi){so.fromWorkingColorSpace(fo.copy(this),e);const t=fo.r,n=fo.g,i=fo.b;return e!==Gi?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(e,t,n){return this.getHSL(co),this.setHSL(co.h+e,co.s+t,co.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(co),e.getHSL(uo);const n=tn(co.h,uo.h,t),i=tn(co.s,uo.s,t),r=tn(co.l,uo.l,t);return this.setHSL(n,i,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*i,this.g=r[1]*t+r[4]*n+r[7]*i,this.b=r[2]*t+r[5]*n+r[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const fo=new po;po.NAMES=lo;let mo=0;class go extends yr{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:mo++}),this.uuid=Qt(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=dn,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new po(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ji,this.stencilZFail=Ji,this.stencilZPass=Ji,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),204!==this.blendSrc&&(n.blendSrc=this.blendSrc),205!==this.blendDst&&(n.blendDst=this.blendDst),this.blendEquation!==dn&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Ji&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Ji&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Ji&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class vo extends go{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new po(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new _r,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const yo=new an,bo=new da;class xo{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=35044,this.updateRanges=[],this.gpuType=ei,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)bo.fromBufferAttribute(this,t),bo.applyMatrix3(e),this.setXY(t,bo.x,bo.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)yo.fromBufferAttribute(this,t),yo.applyMatrix3(e),this.setXYZ(t,yo.x,yo.y,yo.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)yo.fromBufferAttribute(this,t),yo.applyMatrix4(e),this.setXYZ(t,yo.x,yo.y,yo.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)yo.fromBufferAttribute(this,t),yo.applyNormalMatrix(e),this.setXYZ(t,yo.x,yo.y,yo.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)yo.fromBufferAttribute(this,t),yo.transformDirection(e),this.setXYZ(t,yo.x,yo.y,yo.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=nn(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=rn(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=nn(t,this.array)),t}setX(e,t){return this.normalized&&(t=rn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=nn(t,this.array)),t}setY(e,t){return this.normalized&&(t=rn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=nn(t,this.array)),t}setZ(e,t){return this.normalized&&(t=rn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=nn(t,this.array)),t}setW(e,t){return this.normalized&&(t=rn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=rn(t,this.array),n=rn(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=rn(t,this.array),n=rn(n,this.array),i=rn(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=rn(t,this.array),n=rn(n,this.array),i=rn(i,this.array),r=rn(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),e}}class _o extends xo{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class wo extends xo{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class So extends xo{constructor(e,t,n){super(new Float32Array(e),t,n)}}function Mo(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}function Eo(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function To(){const e=Eo("canvas");return e.style.display="block",e}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const Ao={};function Co(e){e in Ao||(Ao[e]=!0,console.warn(e))}let Ro=0;const Po=new ur,ko=new Br,Io=new an,Oo=new pa,Lo=new pa,No=new an;class Do extends yr{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Ro++}),this.uuid=Qt(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Mo(e)?wo:_o)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new Sr).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Po.makeRotationFromQuaternion(e),this.applyMatrix4(Po),this}rotateX(e){return Po.makeRotationX(e),this.applyMatrix4(Po),this}rotateY(e){return Po.makeRotationY(e),this.applyMatrix4(Po),this}rotateZ(e){return Po.makeRotationZ(e),this.applyMatrix4(Po),this}translate(e,t,n){return Po.makeTranslation(e,t,n),this.applyMatrix4(Po),this}scale(e,t,n){return Po.makeScale(e,t,n),this.applyMatrix4(Po),this}lookAt(e){return ko.lookAt(e),ko.updateMatrix(),this.applyMatrix4(ko.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Io).negate(),this.translate(Io.x,Io.y,Io.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new So(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new pa);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new an(-1/0,-1/0,-1/0),new an(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Oo.setFromBufferAttribute(n),this.morphTargetsRelative?(No.addVectors(this.boundingBox.min,Oo.min),this.boundingBox.expandByPoint(No),No.addVectors(this.boundingBox.max,Oo.max),this.boundingBox.expandByPoint(No)):(this.boundingBox.expandByPoint(Oo.min),this.boundingBox.expandByPoint(Oo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ka);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new an,1/0);if(e){const n=this.boundingSphere.center;if(Oo.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Lo.setFromBufferAttribute(n),this.morphTargetsRelative?(No.addVectors(Oo.min,Lo.min),Oo.expandByPoint(No),No.addVectors(Oo.max,Lo.max),Oo.expandByPoint(No)):(Oo.expandByPoint(Lo.min),Oo.expandByPoint(Lo.max))}Oo.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)No.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(No));if(t)for(let r=0,s=t.length;r<s;r++){const s=t[r],a=this.morphTargetsRelative;for(let t=0,r=s.count;t<r;t++)No.fromBufferAttribute(s,t),a&&(Io.fromBufferAttribute(e,t),No.add(Io)),i=Math.max(i,n.distanceToSquared(No))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.position,i=t.normal,r=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new xo(new Float32Array(4*n.count),4));const s=this.getAttribute("tangent"),a=[],o=[];for(let e=0;e<n.count;e++)a[e]=new an,o[e]=new an;const l=new an,c=new an,u=new an,h=new da,d=new da,p=new da,f=new an,m=new an;function g(e,t,i){l.fromBufferAttribute(n,e),c.fromBufferAttribute(n,t),u.fromBufferAttribute(n,i),h.fromBufferAttribute(r,e),d.fromBufferAttribute(r,t),p.fromBufferAttribute(r,i),c.sub(l),u.sub(l),d.sub(h),p.sub(h);const s=1/(d.x*p.y-p.x*d.y);isFinite(s)&&(f.copy(c).multiplyScalar(p.y).addScaledVector(u,-d.y).multiplyScalar(s),m.copy(u).multiplyScalar(d.x).addScaledVector(c,-p.x).multiplyScalar(s),a[e].add(f),a[t].add(f),a[i].add(f),o[e].add(m),o[t].add(m),o[i].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:e.count}]);for(let t=0,n=v.length;t<n;++t){const n=v[t],i=n.start;for(let t=i,r=i+n.count;t<r;t+=3)g(e.getX(t+0),e.getX(t+1),e.getX(t+2))}const y=new an,b=new an,x=new an,_=new an;function w(e){x.fromBufferAttribute(i,e),_.copy(x);const t=a[e];y.copy(t),y.sub(x.multiplyScalar(x.dot(t))).normalize(),b.crossVectors(_,t);const n=b.dot(o[e])<0?-1:1;s.setXYZW(e,y.x,y.y,y.z,n)}for(let t=0,n=v.length;t<n;++t){const n=v[t],i=n.start;for(let t=i,r=i+n.count;t<r;t+=3)w(e.getX(t+0)),w(e.getX(t+1)),w(e.getX(t+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new xo(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new an,r=new an,s=new an,a=new an,o=new an,l=new an,c=new an,u=new an;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);i.fromBufferAttribute(t,d),r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,f),c.subVectors(s,r),u.subVectors(i,r),c.cross(u),a.fromBufferAttribute(n,d),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),a.add(c),o.add(c),l.add(c),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,a=t.count;e<a;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),c.subVectors(s,r),u.subVectors(i,r),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)No.fromBufferAttribute(e,t),No.normalize(),e.setXYZ(t,No.x,No.y,No.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,s=new n.constructor(t.length*i);let a=0,o=0;for(let r=0,l=t.length;r<l;r++){a=e.isInterleavedBufferAttribute?t[r]*e.data.stride+e.offset:t[r]*i;for(let e=0;e<i;e++)s[o++]=n[a++]}return new xo(s,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Do,n=this.index.array,i=this.attributes;for(const r in i){const s=e(i[r],n);t.setAttribute(r,s)}const r=this.morphAttributes;for(const i in r){const s=[],a=r[i];for(let t=0,i=a.length;t<i;t++){const i=e(a[t],n);s.push(i)}t.morphAttributes[i]=s}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let e=0,n=s.length;e<n;e++){const n=s[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const i=n[t];e.data.attributes[t]=i.toJSON(e.data)}const i={};let r=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],s=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];s.push(i.toJSON(e.data))}s.length>0&&(i[t]=s,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const e in i){const n=i[e];this.setAttribute(e,n.clone(t))}const r=e.morphAttributes;for(const e in r){const n=[],i=r[e];for(let e=0,r=i.length;e<r;e++)n.push(i[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let e=0,t=s.length;e<t;e++){const t=s[e];this.addGroup(t.start,t.count,t.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const zo=new ur,Uo=new Fa,Fo=new ka,Bo=new an,Vo=new an,jo=new an,Ho=new an,Go=new an,Wo=new an,Xo=new an,qo=new an;class Yo extends Br{constructor(e=new Do,t=new vo){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,s=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(r&&a){Wo.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=a[n],o=r[n];0!==i&&(Go.fromBufferAttribute(o,e),s?Wo.addScaledVector(Go,i):Wo.addScaledVector(Go.sub(t),i))}t.add(Wo)}return t}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),Fo.copy(n.boundingSphere),Fo.applyMatrix4(r),Uo.copy(e.ray).recast(e.near),!1===Fo.containsPoint(Uo.origin)){if(null===Uo.intersectSphere(Fo,Bo))return;if(Uo.origin.distanceToSquared(Bo)>(e.far-e.near)**2)return}zo.copy(r).invert(),Uo.copy(e.ray).applyMatrix4(zo),null!==n.boundingBox&&!1===Uo.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,Uo)}}_computeIntersections(e,t,n){let i;const r=this.geometry,s=this.material,a=r.index,o=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,u=r.attributes.normal,h=r.groups,d=r.drawRange;if(null!==a)if(Array.isArray(s))for(let r=0,o=h.length;r<o;r++){const o=h[r],p=s[o.materialIndex];for(let r=Math.max(o.start,d.start),s=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));r<s;r+=3)i=$o(this,p,e,n,l,c,u,a.getX(r),a.getX(r+1),a.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),i.face.materialIndex=o.materialIndex,t.push(i))}else for(let r=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);r<o;r+=3)i=$o(this,s,e,n,l,c,u,a.getX(r),a.getX(r+1),a.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),t.push(i));else if(void 0!==o)if(Array.isArray(s))for(let r=0,a=h.length;r<a;r++){const a=h[r],p=s[a.materialIndex];for(let r=Math.max(a.start,d.start),s=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));r<s;r+=3)i=$o(this,p,e,n,l,c,u,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),i.face.materialIndex=a.materialIndex,t.push(i))}else for(let r=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);r<a;r+=3)i=$o(this,s,e,n,l,c,u,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}function $o(e,t,n,i,r,s,a,o,l,c){e.getVertexPosition(o,Vo),e.getVertexPosition(l,jo),e.getVertexPosition(c,Ho);const u=function(e,t,n,i,r,s,a,o){let l;if(l=1===t.side?i.intersectTriangle(a,s,r,!0,o):i.intersectTriangle(r,s,a,0===t.side,o),null===l)return null;qo.copy(o),qo.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(qo);return c<n.near||c>n.far?null:{distance:c,point:qo.clone(),object:e}}(e,t,n,i,Vo,jo,Ho,Xo);if(u){const e=new an;eo.getBarycoord(Xo,Vo,jo,Ho,e),r&&(u.uv=eo.getInterpolatedAttribute(r,o,l,c,e,new da)),s&&(u.uv1=eo.getInterpolatedAttribute(s,o,l,c,e,new da)),a&&(u.normal=eo.getInterpolatedAttribute(a,o,l,c,e,new an),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const t={a:o,b:l,c,normal:new an,materialIndex:0};eo.getNormal(Vo,jo,Ho,t.normal),u.face=t,u.barycoord=e}return u}var Zo=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},Ko=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let Jo=(()=>{let e,t,n,i,r=[pt("lume-mesh",oa)],s=[],a=ua,o=[],l=[],c=[],u=[];return class extends a{static{t=this}static{const h="function"==typeof Symbol&&Symbol.metadata?Object.create(a[Symbol.metadata]??null):void 0;n=[ht],i=[ht],Zo(null,null,n,{kind:"field",name:"castShadow",static:!1,private:!1,access:{has:e=>"castShadow"in e,get:e=>e.castShadow,set:(e,t)=>{e.castShadow=t}},metadata:h},o,l),Zo(null,null,i,{kind:"field",name:"receiveShadow",static:!1,private:!1,access:{has:e=>"receiveShadow"in e,get:e=>e.receiveShadow,set:(e,t)=>{e.receiveShadow=t}},metadata:h},c,u),Zo(null,e={value:t},r,{kind:"class",name:t.name,metadata:h},null,s),t=e.value,h&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:h}),Ko(t,s)}castShadow=Ko(this,o,!0);receiveShadow=(Ko(this,l),Ko(this,c,!0));connectedCallback(){super.connectedCallback(),this.createEffect((()=>{this.three.castShadow=this.castShadow,this.needsUpdate()})),this.createEffect((()=>{this.three.receiveShadow=this.receiveShadow,this.three.material.needsUpdate=!0,this.needsUpdate()}))}makeThreeObject3d(){return new Yo}constructor(){super(...arguments),Ko(this,u)}},t})();class Qo extends go{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new po(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const el=new ur,tl=new Fa,nl=new ka,il=new an;class rl extends Br{constructor(e=new Do,t=new Qo){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),nl.copy(n.boundingSphere),nl.applyMatrix4(i),nl.radius+=r,!1===e.ray.intersectsSphere(nl))return;el.copy(i).invert(),tl.copy(e.ray).applyMatrix4(el);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=n.index,c=n.attributes.position;if(null!==l)for(let n=Math.max(0,s.start),r=Math.min(l.count,s.start+s.count);n<r;n++){const r=l.getX(n);il.fromBufferAttribute(c,r),sl(il,r,o,i,e,t,this)}else for(let n=Math.max(0,s.start),r=Math.min(c.count,s.start+s.count);n<r;n++)il.fromBufferAttribute(c,n),sl(il,n,o,i,e,t,this)}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function sl(e,t,n,i,r,s,a){const o=tl.distanceSqToPoint(e);if(o<n){const n=new an;tl.closestPointToPoint(e,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:n,index:t,face:null,faceIndex:null,barycoord:null,object:a})}}let al,ol=(()=>{let e,t,n=[pt("lume-points",oa)],i=[],r=ua;return class extends r{static{t=this}static{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(r[Symbol.metadata]??null):void 0;(function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0})(null,e={value:t},n,{kind:"class",name:t.name,metadata:s},null,i),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e)}(t,i)}initialBehaviors={geometry:"box",material:"points"};makeThreeObject3d(){return new rl}},t})();class ll extends xo{constructor(e,t,n,i=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}class cl{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===al&&(al=Eo("canvas")),al.width=e.width,al.height=e.height;const n=al.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=al}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=Eo("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*ao(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*ao(t[e]/255)):t[e]=ao(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let ul=0;class hl{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:ul++}),this.uuid=Qt(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(dl(i[t].image)):e.push(dl(i[t]))}else e=dl(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function dl(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?cl.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let pl=0;class fl extends yr{constructor(e=fl.DEFAULT_IMAGE,t=fl.DEFAULT_MAPPING,n=1001,i=1001,r=1006,s=1008,a=1023,o=1009,l=fl.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:pl++}),this.uuid=Qt(),this.name="",this.source=new hl(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new da(0,0),this.repeat=new da(1,1),this.center=new da(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Sr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Vn:e.x=e.x-Math.floor(e.x);break;case jn:e.x=e.x<0?0:1;break;case Hn:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Vn:e.y=e.y-Math.floor(e.y);break;case jn:e.y=e.y<0?0:1;break;case Hn:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}fl.DEFAULT_IMAGE=null,fl.DEFAULT_MAPPING=300,fl.DEFAULT_ANISOTROPY=1;class ml extends fl{constructor(e=null,t=1,n=1,i,r,s,a,o,l=1003,c=1003,u,h){super(null,s,a,o,l,c,i,r,u,h),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const gl=new ur,vl=new ur,yl=[],bl=new pa,xl=new ur,_l=new Yo,wl=new ka;class Sl extends Yo{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new ll(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let e=0;e<n;e++)this.setMatrixAt(e,xl)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new pa),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,gl),bl.copy(e.boundingBox).applyMatrix4(gl),this.boundingBox.union(bl)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new ka),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,gl),wl.copy(e.boundingSphere).applyMatrix4(gl),this.boundingSphere.union(wl)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){const n=t.morphTargetInfluences,i=this.morphTexture.source.data.data,r=e*(n.length+1)+1;for(let e=0;e<n.length;e++)n[e]=i[r+e]}raycast(e,t){const n=this.matrixWorld,i=this.count;if(_l.geometry=this.geometry,_l.material=this.material,void 0!==_l.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),wl.copy(this.boundingSphere),wl.applyMatrix4(n),!1!==e.ray.intersectsSphere(wl)))for(let r=0;r<i;r++){this.getMatrixAt(r,gl),vl.multiplyMatrices(n,gl),_l.matrixWorld=vl,_l.raycast(e,yl);for(let e=0,n=yl.length;e<n;e++){const n=yl[e];n.instanceId=r,n.object=this,t.push(n)}yl.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new ll(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){const n=t.morphTargetInfluences,i=n.length+1;null===this.morphTexture&&(this.morphTexture=new ml(new Float32Array(i*this.count),i,this.count,li,ei));const r=this.morphTexture.source.data.data;let s=0;for(let e=0;e<n.length;e++)s+=n[e];const a=this.geometry.morphTargetsRelative?1:1-s,o=i*e;r[o]=a,r.set(n,o+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class Ml extends Do{constructor(e=1,t=1,n=1,i=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};const a=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);const o=[],l=[],c=[],u=[];let h=0,d=0;function p(e,t,n,i,r,s,p,f,m,g,v){const y=s/m,b=p/g,x=s/2,_=p/2,w=f/2,S=m+1,M=g+1;let E=0,T=0;const A=new an;for(let s=0;s<M;s++){const a=s*b-_;for(let o=0;o<S;o++){const h=o*y-x;A[e]=h*i,A[t]=a*r,A[n]=w,l.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[n]=f>0?1:-1,c.push(A.x,A.y,A.z),u.push(o/m),u.push(1-s/g),E+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=h+t+S*e,i=h+t+S*(e+1),r=h+(t+1)+S*(e+1),s=h+(t+1)+S*e;o.push(n,i,s),o.push(i,r,s),T+=6}a.addGroup(d,T,v),d+=T,h+=E}p("z","y","x",-1,-1,n,t,e,s,r,0),p("z","y","x",1,-1,n,t,-e,s,r,1),p("x","z","y",1,1,e,n,t,i,s,2),p("x","z","y",1,-1,e,n,-t,i,s,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(o),this.setAttribute("position",new So(l,3)),this.setAttribute("normal",new So(c,3)),this.setAttribute("uv",new So(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ml(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}class El extends go{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new po(16777215),this.specular=new po(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new po(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new da(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new _r,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}function Tl(e,t){"string"==typeof e&&(e=Hr(e).map((e=>parseFloat(e))));for(let n=0,i=e.length;n<i;n+=1)if(isNaN(e[n]))throw new TypeError(`Array for property "${t}" should have numbers only.`);return e}const Al=new Set;let Cl=!1;function Rl(e){Al.add(e),Cl||(Cl=!0,queueMicrotask((()=>{Cl=!1;const e=[...Al];Al.clear();for(const t of e)t()})))}var Pl=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0},kl=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0};const Il=new sn,Ol=new an,Ll=new an,Nl=new an,Dl=new ur,zl=new _r,Ul=new po,Fl=[0,0,0];let Bl=(()=>{let e,t,n,i,r,s,a,o,l,c,u,h=[pt("lume-instanced-mesh",oa)],d=[],p=Jo,f=[],m=[],g=[];return class extends p{static{t=this}static{const v="function"==typeof Symbol&&Symbol.metadata?Object.create(p[Symbol.metadata]??null):void 0;n=[ct],i=[ot],r=[ot],s=[ot],a=[ot],o=[ot],l=[ot],c=[ot],u=[ot],kl(this,null,i,{kind:"getter",name:"rotations",static:!1,private:!1,access:{has:e=>"rotations"in e,get:e=>e.rotations},metadata:v},null,f),kl(this,null,r,{kind:"setter",name:"rotations",static:!1,private:!1,access:{has:e=>"rotations"in e,set:(e,t)=>{e.rotations=t}},metadata:v},null,f),kl(this,null,s,{kind:"getter",name:"positions",static:!1,private:!1,access:{has:e=>"positions"in e,get:e=>e.positions},metadata:v},null,f),kl(this,null,a,{kind:"setter",name:"positions",static:!1,private:!1,access:{has:e=>"positions"in e,set:(e,t)=>{e.positions=t}},metadata:v},null,f),kl(this,null,o,{kind:"getter",name:"scales",static:!1,private:!1,access:{has:e=>"scales"in e,get:e=>e.scales},metadata:v},null,f),kl(this,null,l,{kind:"setter",name:"scales",static:!1,private:!1,access:{has:e=>"scales"in e,set:(e,t)=>{e.scales=t}},metadata:v},null,f),kl(this,null,c,{kind:"getter",name:"colors",static:!1,private:!1,access:{has:e=>"colors"in e,get:e=>e.colors},metadata:v},null,f),kl(this,null,u,{kind:"setter",name:"colors",static:!1,private:!1,access:{has:e=>"colors"in e,set:(e,t)=>{e.colors=t}},metadata:v},null,f),kl(null,null,n,{kind:"field",name:"count",static:!1,private:!1,access:{has:e=>"count"in e,get:e=>e.count,set:(e,t)=>{e.count=t}},metadata:v},m,g),kl(null,e={value:t},h,{kind:"class",name:t.name,metadata:v},null,d),t=e.value,v&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:v}),Pl(t,d)}count=(Pl(this,f),Pl(this,m,10));#st=(Pl(this,g),this.count);get rotations(){return this.#at}set rotations(e){this.#at=Tl(e,"rotations")}#at=[];get positions(){return this.#ot}set positions(e){this.#ot=Tl(e,"positions")}#ot=[];get scales(){return this.#lt}set scales(e){this.#lt=Tl(e,"scales")}#lt=[];get colors(){return this.#ct}set colors(e){this.#ct=Tl(e,"colors")}#ct=[];initialBehaviors={geometry:"box",material:"physical"};makeThreeObject3d(){let e=null,t=null;for(const[n,i]of this.behaviors)n.endsWith("-geometry")?e=i:n.endsWith("-material")&&(t=i);const n=new Sl(e?.meshComponent||new Ml,t?.meshComponent||new El,this.#st);n.instanceMatrix.setUsage(35048);const i=n.setColorAt;return n.setColorAt=function(e,t){i.call(n,e,t),n.instanceColor.setUsage(35048)},n}#ut=!1;#ht=!1;#dt=!1;setInstancePosition(e,t,n,i){const r=3*e;O((()=>{this.positions[r]=t,this.positions[r+1]=n,this.positions[r+2]=i,this.#pt(r),this.three.instanceMatrix.needsUpdate=!0})),Rl(this.#ft)}#ft=()=>{this.#dt=!0,this.positions=this.positions};setInstanceScale(e,t,n,i){const r=3*e;O((()=>{this.scales[r]=t,this.scales[r+1]=n,this.scales[r+2]=i,this.#pt(r),this.three.instanceMatrix.needsUpdate=!0})),Rl(this.#mt)}#mt=()=>{this.#dt=!0,this.scales=this.scales};setInstanceRotation(e,t,n,i){const r=3*e;O((()=>{this.rotations[r]=t,this.rotations[r+1]=n,this.rotations[r+2]=i,this.#pt(r),this.three.instanceMatrix.needsUpdate=!0})),Rl(this.#gt)}#gt=()=>{this.#dt=!0,this.rotations=this.rotations};setInstanceColor(e,t,n,i){const r=3*e;O((()=>{this.colors[r]=t,this.colors[r+1]=n,this.colors[r+2]=i})),this.#vt(e,t,n,i),this.three.instanceColor.needsUpdate=!0,Rl(this.#yt)}#yt=()=>{this.#dt=!0,this.colors=this.colors};#pt(e){zl.set(this.rotations[e+0]??0,this.rotations[e+1]??0,this.rotations[e+2]??0),Il.setFromEuler(zl),Ol.set(this.positions[e+0]??0,this.positions[e+1]??0,this.positions[e+2]??0),Ll.set(this.scales[e+0]??1,this.scales[e+1]??1,this.scales[e+2]??1),this._calculateInstanceMatrix(Ol,Il,Ll,Nl,Dl),this.three.setMatrixAt(e/3,Dl)}#vt(e,t,n,i){Ul.setRGB(t,n,i),this.three.setColorAt(e,Ul)}updateAllMatrices(){for(let e=0,t=this.count;e<t;e+=1)this.#pt(3*e);this.three.instanceMatrix.needsUpdate=!0}updateAllColors(){for(let e=0,t=this.count;e<t;e+=1){const t=3*e,n=this.colors[t+0]??1,i=this.colors[t+1]??1,r=this.colors[t+2]??1;this.#vt(e,n,i,r)}this.three.instanceColor.needsUpdate=!0}_calculateInstanceMatrix(e,t,n,i,r){const s=e,a=new an(.5,.5,.5),o=this.calculatedSize;if(Fl[0]=s.x,Fl[1]=s.y,Fl[2]=s.z,s.set(Fl[0],-Fl[1],Fl[2]),.5!==a.x||.5!==a.y||.5!==a.z?i.set(a.x*o.x-o.x/2,-(a.y*o.y-o.y/2),a.z*o.z-o.z/2):i.set(0,0,0),r.compose(s,t,n),0!==i.x||0!==i.y||0!==i.z){const e=i.x,t=i.y,n=i.z,s=r.elements;s[12]+=e-s[0]*e-s[4]*t-s[8]*n,s[13]+=t-s[1]*e-s[5]*t-s[9]*n,s[14]+=n-s[2]*e-s[6]*t-s[10]*n}}connectedCallback(){super.connectedCallback(),this.createEffect((()=>{this.count>this.#st&&(this.#st=this.count,this.recreateThree(),O((()=>{I((()=>{this.rotations=this.rotations,this.positions=this.positions,this.scales=this.scales,this.colors=this.colors}))}))),O((()=>this.three.count=this.count)),this.needsUpdate()})),this.createEffect((()=>{this.rotations,this.#dt||(this.#ut=!0),this.#dt=!1,this.needsUpdate()})),this.createEffect((()=>{this.positions,this.#dt||(this.#ut=!0),this.#dt=!1,this.needsUpdate()})),this.createEffect((()=>{this.scales,this.#dt||(this.#ut=!0),this.#dt=!1,this.needsUpdate()})),this.createEffect((()=>{this.colors,this.#dt||(this.#ht=!0),this.#dt=!1,this.needsUpdate()}))}update(e,t){super.update(e,t),this.#ut&&(this.#ut=!1,this.updateAllMatrices()),this.#ht&&(this.#ht=!1,this.updateAllColors())}},t})();class Vl extends go{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new po(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const jl=new an,Hl=new an,Gl=new ur,Wl=new Fa,Xl=new ka,ql=new an,Yl=new an;class $l extends Br{constructor(e=new Do,t=new Vl){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)jl.fromBufferAttribute(t,e-1),Hl.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=jl.distanceTo(Hl);e.setAttribute("lineDistance",new So(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Xl.copy(n.boundingSphere),Xl.applyMatrix4(i),Xl.radius+=r,!1===e.ray.intersectsSphere(Xl))return;Gl.copy(i).invert(),Wl.copy(e.ray).applyMatrix4(Gl);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=this.isLineSegments?2:1,c=n.index,u=n.attributes.position;if(null!==c){const n=Math.max(0,s.start),i=Math.min(c.count,s.start+s.count);for(let r=n,s=i-1;r<s;r+=l){const n=c.getX(r),i=c.getX(r+1),s=Zl(this,e,Wl,o,n,i);s&&t.push(s)}if(this.isLineLoop){const r=c.getX(i-1),s=c.getX(n),a=Zl(this,e,Wl,o,r,s);a&&t.push(a)}}else{const n=Math.max(0,s.start),i=Math.min(u.count,s.start+s.count);for(let r=n,s=i-1;r<s;r+=l){const n=Zl(this,e,Wl,o,r,r+1);n&&t.push(n)}if(this.isLineLoop){const r=Zl(this,e,Wl,o,i-1,n);r&&t.push(r)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function Zl(e,t,n,i,r,s){const a=e.geometry.attributes.position;if(jl.fromBufferAttribute(a,r),Hl.fromBufferAttribute(a,s),n.distanceSqToSegment(jl,Hl,ql,Yl)>i)return;ql.applyMatrix4(e.matrixWorld);const o=t.ray.origin.distanceTo(ql);return o<t.near||o>t.far?void 0:{distance:o,point:Yl.clone().applyMatrix4(e.matrixWorld),index:r,face:null,faceIndex:null,barycoord:null,object:e}}let Kl=(()=>{let e,t,n=[pt("lume-line",oa)],i=[],r=ua;return class extends r{static{t=this}static{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(r[Symbol.metadata]??null):void 0;(function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0})(null,e={value:t},n,{kind:"class",name:t.name,metadata:s},null,i),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e)}(t,i)}initialBehaviors={geometry:"line",material:"line"};makeThreeObject3d(){return new $l}},t})();var Jl=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},Ql=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let ec=(()=>{let e,t,n,i=[Yt],r=[],s=ha,a=[],o=[];return class extends s{static{t=this}static{const l="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;n=[Ue],Jl(null,null,n,{kind:"field",name:"meshComponent",static:!1,private:!1,access:{has:e=>"meshComponent"in e,get:e=>e.meshComponent,set:(e,t)=>{e.meshComponent=t}},metadata:l},a,o),Jl(null,e={value:t},i,{kind:"class",name:t.name,metadata:l},null,r),t=e.value,l&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:l}),Ql(t,r)}requiredElementType(){return[Jo,ol,Bl,Kl]}_createComponent(){throw new Error("`_createComponent()` is not implemented by subclass.")}meshComponent=Ql(this,a,null);constructor(){super(...arguments),Ql(this,o)}},t})();const tc=new an,nc=new an,ic=new Sr;class rc{constructor(e=new an(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=tc.subVectors(n,t).cross(nc.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(tc),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||ic.getNormalMatrix(e),i=this.coplanarPoint(tc).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}var sc=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},ac=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};const oc=[0,0,-1];let lc=(()=>{let e,t,n,i,r=[pt("lume-clip-plane",oa)],s=[],a=ua,o=[],l=[],c=[],u=[];return class extends a{static{t=this}static{const h="function"==typeof Symbol&&Symbol.metadata?Object.create(a[Symbol.metadata]??null):void 0;n=[Ue],i=[Ue],sc(null,null,n,{kind:"field",name:"threeClip",static:!1,private:!1,access:{has:e=>"threeClip"in e,get:e=>e.threeClip,set:(e,t)=>{e.threeClip=t}},metadata:h},o,l),sc(null,null,i,{kind:"field",name:"threeInverseClip",static:!1,private:!1,access:{has:e=>"threeInverseClip"in e,get:e=>e.threeInverseClip,set:(e,t)=>{e.threeInverseClip=t}},metadata:h},c,u),sc(null,e={value:t},r,{kind:"class",name:t.name,metadata:h},null,s),t=e.value,h&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:h}),ac(t,s)}threeClip=ac(this,o,new rc(new an(...oc)));threeInverseClip=(ac(this,l),ac(this,c,new rc(new an(...oc).negate())));updateWorldMatrices(){super.updateWorldMatrices();const e=this.threeClip,t=this.threeInverseClip;e&&t&&(e.normal.set(...oc),e.constant=0,t.normal.set(...oc).negate(),t.constant=0,e.applyMatrix4(this.three.matrixWorld),t.applyMatrix4(this.three.matrixWorld))}constructor(){super(...arguments),ac(this,u)}},t})();function*cc(e){let t=e.getRootNode();for(;t;)yield t,t=t instanceof ShadowRoot?t.host.getRootNode():null}var uc=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0},hc=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0};let dc=0,pc=(()=>{let e,t,n,i,r,s,a,o,l=[Yt],c=[],u=ec,h=[],d=[],p=[],f=[],m=[],g=[],v=[],y=[],b=[];return class extends u{static{t=this}static{const x="function"==typeof Symbol&&Symbol.metadata?Object.create(u[Symbol.metadata]??null):void 0;n=[ht,Xt],i=[ht,Xt],r=[ot,Xt],s=[ot],a=[ht,Xt],o=[ht,Xt],hc(this,null,r,{kind:"getter",name:"clipPlanes",static:!1,private:!1,access:{has:e=>"clipPlanes"in e,get:e=>e.clipPlanes},metadata:x},null,h),hc(this,null,s,{kind:"setter",name:"clipPlanes",static:!1,private:!1,access:{has:e=>"clipPlanes"in e,set:(e,t)=>{e.clipPlanes=t}},metadata:x},null,h),hc(null,null,n,{kind:"field",name:"clipIntersection",static:!1,private:!1,access:{has:e=>"clipIntersection"in e,get:e=>e.clipIntersection,set:(e,t)=>{e.clipIntersection=t}},metadata:x},d,p),hc(null,null,i,{kind:"field",name:"clipShadows",static:!1,private:!1,access:{has:e=>"clipShadows"in e,get:e=>e.clipShadows,set:(e,t)=>{e.clipShadows=t}},metadata:x},f,m),hc(null,null,a,{kind:"field",name:"flipClip",static:!1,private:!1,access:{has:e=>"flipClip"in e,get:e=>e.flipClip,set:(e,t)=>{e.flipClip=t}},metadata:x},g,v),hc(null,null,o,{kind:"field",name:"clipDisabled",static:!1,private:!1,access:{has:e=>"clipDisabled"in e,get:e=>e.clipDisabled,set:(e,t)=>{e.clipDisabled=t}},metadata:x},y,b),hc(null,e={value:t},l,{kind:"class",name:t.name,metadata:x},null,c),t=e.value,x&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:x}),uc(t,c)}clipIntersection=(uc(this,h),uc(this,d,!1));clipShadows=(uc(this,p),uc(this,f,!0));#bt=(uc(this,m),[]);#xt=[];get clipPlanes(){return this.#bt}set clipPlanes(e){this.#xt=e;let t=[];if("string"==typeof e)t=[e.trim()];else{if(!Array.isArray(e))throw new TypeError("Invalid value for clipPlanes");t=e}this.#bt=[];for(const e of t){if("string"!=typeof e){e instanceof lc&&e.scene&&this.#bt.push(e);continue}if(!e)continue;let t=this.element.getRootNode();for(;t;){const n=t.querySelectorAll(e);for(let e=0,t=n.length;e<t;e+=1){const t=n.item(e);t&&t instanceof lc&&t.scene&&this.#bt.push(t)}t=t instanceof ShadowRoot?t.host.getRootNode():null}}}flipClip=uc(this,g,!1);clipDisabled=(uc(this,v),uc(this,y,!1));get material(){const e=this.element.behaviors.find((e=>e.endsWith("-material")));return e?.meshComponent??null}#S=(uc(this,b),null);connectedCallback(){super.connectedCallback();let e=null;this.createEffect((()=>{if(this.element.scene){e=this.element.scene,this.clipPlanes=this.#xt,dc||(this.element.scene.localClipping=!0),dc++,this.#S=new MutationObserver((()=>{this.clipPlanes=this.#xt}));for(const e of cc(this.element))this.#S.observe(e,{childList:!0,subtree:!0});P((()=>{const{clipPlanes:e,clipIntersection:t,clipShadows:n,flipClip:i}=this,r=this.material;if(r){if(this.element.needsUpdate(),!e.length||this.clipDisabled)return r.clippingPlanes=null,void(r.clipShadows=!1);r.clippingPlanes||(r.clippingPlanes=[]),r.clippingPlanes.length=0,r.clipIntersection=t,r.clipShadows=n;for(const t of e)r.clippingPlanes.push(i?t.threeInverseClip:t.threeClip)}})),L((()=>{this.#S?.disconnect(),this.#S=null,dc--,dc||(e.localClipping=!1),e=null}))}}))}},t})();globalThis.window?.document&&!elementBehaviors.has("clip-planes")&&elementBehaviors.define("clip-planes",pc);class fc extends ec{connectedCallback(){super.connectedCallback(),this.createEffect((()=>this.resetMeshComponent()))}resetMeshComponent(){this.#_t(),this.element.needsUpdate(),L(this.#wt)}_createComponent(){throw new Error("`_createComponent()` is not implemented by subclass.")}#wt=()=>{this.meshComponent?.dispose(),this.meshComponent=null};#_t(){const e=this._createComponent();O((()=>{this.element.three[this.type]=e})),this.meshComponent=e}}class mc extends fc{type="geometry";get size(){return this.element.size}set size(e){this.element.size=e}get sizeMode(){return this.element.sizeMode}set sizeMode(e){this.element.sizeMode=e}get geometry(){return this.meshComponent}_createComponent(){return new Do}}globalThis.window?.document&&!elementBehaviors.has("box-geometry")&&elementBehaviors.define("box-geometry",class extends mc{_createComponent(){return new Ml(this.element.calculatedSize.x,this.element.calculatedSize.y,this.element.calculatedSize.z)}});var gc=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0},vc=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0};let yc=(()=>{let e,t,n,i,r,s,a=[Yt],o=[],l=mc,c=[],u=[],h=[],d=[],p=[];return class extends l{static{t=this}static{const f="function"==typeof Symbol&&Symbol.metadata?Object.create(l[Symbol.metadata]??null):void 0;n=[et,Xt],i=[et],r=[ht,Xt],s=[ot,Xt],vc(this,null,n,{kind:"getter",name:"points",static:!1,private:!1,access:{has:e=>"points"in e,get:e=>e.points},metadata:f},null,c),vc(this,null,i,{kind:"setter",name:"points",static:!1,private:!1,access:{has:e=>"points"in e,set:(e,t)=>{e.points=t}},metadata:f},null,c),vc(null,null,r,{kind:"field",name:"centerGeometry",static:!1,private:!1,access:{has:e=>"centerGeometry"in e,get:e=>e.centerGeometry,set:(e,t)=>{e.centerGeometry=t}},metadata:f},u,h),vc(null,null,s,{kind:"field",name:"fitment",static:!1,private:!1,access:{has:e=>"fitment"in e,get:e=>e.fitment,set:(e,t)=>{e.fitment=t}},metadata:f},d,p),vc(null,e={value:t},a,{kind:"class",name:t.name,metadata:f},null,o),t=e.value,f&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:f}),gc(t,o)}#St=(gc(this,c),[]);get points(){return this.#St}set points(e){if(e){if("string"==typeof e||Array.isArray(e)){const t="string"==typeof e?Tl(e,"points"):e;if(t.length){if(t.length%3!=0)throw new Error("The points array needs to have 3 numbers per point.");this.#St.length!==t.length&&(this.#St.length=t.length);for(let e=0,n=t.length;e<n;e+=1)this.#St[e]=t[e]}else this.#St.length=0}}else this.#St.length=0}centerGeometry=gc(this,u,!1);fitment=(gc(this,h),gc(this,d,"none"));_createComponent(){const e=new Do,t=new So(this.points,3);return t.needsUpdate=!0,e.attributes.position=t,this.centerGeometry&&e.center(),e.scale(1,-1,1),this.fitment,e}constructor(){super(...arguments),gc(this,p)}},t})();globalThis.window?.document&&!elementBehaviors.has("line-geometry")&&elementBehaviors.define("line-geometry",yc),globalThis.window?.document&&!elementBehaviors.has("mixedplane-geometry")&&elementBehaviors.define("mixedplane-geometry",class extends mc{_createComponent(){return new Ml(this.element.calculatedSize.x,this.element.calculatedSize.y,1)}});class bc extends Do{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,s=t/2,a=Math.floor(n),o=Math.floor(i),l=a+1,c=o+1,u=e/a,h=t/o,d=[],p=[],f=[],m=[];for(let e=0;e<c;e++){const t=e*h-s;for(let n=0;n<l;n++){const i=n*u-r;p.push(i,-t,0),f.push(0,0,1),m.push(n/a),m.push(1-e/o)}}for(let e=0;e<o;e++)for(let t=0;t<a;t++){const n=t+l*e,i=t+l*(e+1),r=t+1+l*(e+1),s=t+1+l*e;d.push(n,i,s),d.push(i,r,s)}this.setIndex(d),this.setAttribute("position",new So(p,3)),this.setAttribute("normal",new So(f,3)),this.setAttribute("uv",new So(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new bc(e.width,e.height,e.widthSegments,e.heightSegments)}}var xc=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},_c=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let wc=(()=>{let e,t,n,i,r=[Yt],s=[],a=mc,o=[],l=[],c=[],u=[];return class extends a{static{t=this}static{const h="function"==typeof Symbol&&Symbol.metadata?Object.create(a[Symbol.metadata]??null):void 0;n=[ct,Xt],i=[ct,Xt],xc(null,null,n,{kind:"field",name:"widthSegments",static:!1,private:!1,access:{has:e=>"widthSegments"in e,get:e=>e.widthSegments,set:(e,t)=>{e.widthSegments=t}},metadata:h},o,l),xc(null,null,i,{kind:"field",name:"heightSegments",static:!1,private:!1,access:{has:e=>"heightSegments"in e,get:e=>e.heightSegments,set:(e,t)=>{e.heightSegments=t}},metadata:h},c,u),xc(null,e={value:t},r,{kind:"class",name:t.name,metadata:h},null,s),t=e.value,h&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:h}),_c(t,s)}widthSegments=_c(this,o,1);heightSegments=(_c(this,l),_c(this,c,1));_createComponent(){return new bc(this.element.calculatedSize.x,this.element.calculatedSize.y,this.widthSegments,this.heightSegments)}constructor(){super(...arguments),_c(this,u)}},t})();globalThis.window?.document&&!elementBehaviors.has("plane-geometry")&&elementBehaviors.define("plane-geometry",wc);const Sc="attached",Mc=1e3,Ec=1001,Tc=1002,Ac=1006,Cc=1008,Rc=1015,Pc=2300,kc=2301,Ic=2302,Oc="srgb",Lc="srgb-linear",Nc="display-p3",Dc="display-p3-linear",zc="linear",Uc="srgb",Fc="rec709",Bc=7680,Vc=35044,jc=2e3,Hc=2001;class Gc{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const Wc=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Xc=1234567;const qc=Math.PI/180,Yc=180/Math.PI;function $c(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Wc[255&e]+Wc[e>>8&255]+Wc[e>>16&255]+Wc[e>>24&255]+"-"+Wc[255&t]+Wc[t>>8&255]+"-"+Wc[t>>16&15|64]+Wc[t>>24&255]+"-"+Wc[63&n|128]+Wc[n>>8&255]+"-"+Wc[n>>16&255]+Wc[n>>24&255]+Wc[255&i]+Wc[i>>8&255]+Wc[i>>16&255]+Wc[i>>24&255]).toLowerCase()}function Zc(e,t,n){return Math.max(t,Math.min(n,e))}function Kc(e,t){return(e%t+t)%t}function Jc(e,t,n){return(1-n)*e+n*t}function Qc(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function eu(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const tu={DEG2RAD:qc,RAD2DEG:Yc,generateUUID:$c,clamp:Zc,euclideanModulo:Kc,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Jc,damp:function(e,t,n,i){return Jc(e,t,1-Math.exp(-n*i))},pingpong:function(e,t=1){return t-Math.abs(Kc(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(Xc=e);let t=Xc+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*qc},radToDeg:function(e){return e*Yc},isPowerOfTwo:function(e){return!(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,i,r){const s=Math.cos,a=Math.sin,o=s(n/2),l=a(n/2),c=s((t+i)/2),u=a((t+i)/2),h=s((t-i)/2),d=a((t-i)/2),p=s((i-t)/2),f=a((i-t)/2);switch(r){case"XYX":e.set(o*u,l*h,l*d,o*c);break;case"YZY":e.set(l*d,o*u,l*h,o*c);break;case"ZXZ":e.set(l*h,l*d,o*u,o*c);break;case"XZX":e.set(o*u,l*f,l*p,o*c);break;case"YXY":e.set(l*p,o*u,l*f,o*c);break;case"ZYZ":e.set(l*f,l*p,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:eu,denormalize:Qc};class nu{constructor(e=0,t=0){nu.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Zc(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*n-s*i+e.x,this.y=r*i+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class iu{constructor(e,t,n,i,r,s,a,o,l){iu.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,s,a,o,l)}set(e,t,n,i,r,s,a,o,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=a,c[3]=t,c[4]=r,c[5]=o,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,s=n[0],a=n[3],o=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],b=i[7],x=i[2],_=i[5],w=i[8];return r[0]=s*f+a*v+o*x,r[3]=s*m+a*y+o*_,r[6]=s*g+a*b+o*w,r[1]=l*f+c*v+u*x,r[4]=l*m+c*y+u*_,r[7]=l*g+c*b+u*w,r[2]=h*f+d*v+p*x,r[5]=h*m+d*y+p*_,r[8]=h*g+d*b+p*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8];return t*s*c-t*a*l-n*r*c+n*a*o+i*r*l-i*s*o}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=c*s-a*l,h=a*o-c*r,d=l*r-s*o,p=t*u+n*h+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=u*f,e[1]=(i*l-c*n)*f,e[2]=(a*n-i*s)*f,e[3]=h*f,e[4]=(c*t-i*o)*f,e[5]=(i*r-a*t)*f,e[6]=d*f,e[7]=(n*o-l*t)*f,e[8]=(s*t-n*r)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,s,a){const o=Math.cos(r),l=Math.sin(r);return this.set(n*o,n*l,-n*(o*s+l*a)+s+e,-i*l,i*o,-i*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(ru.makeScale(e,t)),this}rotate(e){return this.premultiply(ru.makeRotation(-e)),this}translate(e,t){return this.premultiply(ru.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const ru=new iu;function su(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const au=(new iu).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),ou=(new iu).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),lu={[Lc]:{transfer:zc,primaries:Fc,luminanceCoefficients:[.2126,.7152,.0722],toReference:e=>e,fromReference:e=>e},[Oc]:{transfer:Uc,primaries:Fc,luminanceCoefficients:[.2126,.7152,.0722],toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[Dc]:{transfer:zc,primaries:"p3",luminanceCoefficients:[.2289,.6917,.0793],toReference:e=>e.applyMatrix3(ou),fromReference:e=>e.applyMatrix3(au)},[Nc]:{transfer:Uc,primaries:"p3",luminanceCoefficients:[.2289,.6917,.0793],toReference:e=>e.convertSRGBToLinear().applyMatrix3(ou),fromReference:e=>e.applyMatrix3(au).convertLinearToSRGB()}},cu=new Set([Lc,Dc]),uu={enabled:!0,_workingColorSpace:Lc,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){if(!cu.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const i=lu[t].toReference;return(0,lu[n].fromReference)(i(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return lu[e].primaries},getTransfer:function(e){return""===e?zc:lu[e].transfer},getLuminanceCoefficients:function(e,t=this._workingColorSpace){return e.fromArray(lu[t].luminanceCoefficients)}};function hu(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function du(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let pu;class fu{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===pu&&(pu=su("canvas")),pu.width=e.width,pu.height=e.height;const n=pu.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=pu}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=su("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*hu(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*hu(t[e]/255)):t[e]=hu(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let mu=0;class gu{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:mu++}),this.uuid=$c(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(vu(i[t].image)):e.push(vu(i[t]))}else e=vu(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function vu(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?fu.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let yu=0;class bu extends Gc{constructor(e=bu.DEFAULT_IMAGE,t=bu.DEFAULT_MAPPING,n=1001,i=1001,r=1006,s=1008,a=1023,o=1009,l=bu.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:yu++}),this.uuid=$c(),this.name="",this.source=new gu(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new nu(0,0),this.repeat=new nu(1,1),this.center=new nu(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new iu,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Mc:e.x=e.x-Math.floor(e.x);break;case Ec:e.x=e.x<0?0:1;break;case Tc:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Mc:e.y=e.y-Math.floor(e.y);break;case Ec:e.y=e.y<0?0:1;break;case Tc:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}bu.DEFAULT_IMAGE=null,bu.DEFAULT_MAPPING=300,bu.DEFAULT_ANISOTROPY=1;class xu{constructor(e=0,t=0,n=0,i=1){xu.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*t+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*t+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*t+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const s=.01,a=.1,o=e.elements,l=o[0],c=o[4],u=o[8],h=o[1],d=o[5],p=o[9],f=o[2],m=o[6],g=o[10];if(Math.abs(c-h)<s&&Math.abs(u-f)<s&&Math.abs(p-m)<s){if(Math.abs(c+h)<a&&Math.abs(u+f)<a&&Math.abs(p+m)<a&&Math.abs(l+d+g-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,o=(d+1)/2,v=(g+1)/2,y=(c+h)/4,b=(u+f)/4,x=(p+m)/4;return e>o&&e>v?e<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=y/n,r=b/n):o>v?o<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(o),n=y/i,r=x/i):v<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(v),n=b/r,i=x/r),this.set(n,i,r,t),this}let v=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(u-f)/v,this.z=(h-c)/v,this.w=Math.acos((l+d+g-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class _u{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,s,a){let o=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3];const h=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===a)return e[t+0]=o,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===a)return e[t+0]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(u!==f||o!==h||l!==d||c!==p){let e=1-a;const t=o*h+l*d+c*p+u*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),s=Math.atan2(r,t*n);e=Math.sin(e*s)/r,a=Math.sin(a*s)/r}const r=a*n;if(o=o*e+h*r,l=l*e+d*r,c=c*e+p*r,u=u*e+f*r,e===1-a){const e=1/Math.sqrt(o*o+l*l+c*c+u*u);o*=e,l*=e,c*=e,u*=e}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,i,r,s){const a=n[i],o=n[i+1],l=n[i+2],c=n[i+3],u=r[s],h=r[s+1],d=r[s+2],p=r[s+3];return e[t]=a*p+c*u+o*d-l*h,e[t+1]=o*p+c*h+l*u-a*d,e[t+2]=l*p+c*d+a*h-o*u,e[t+3]=c*p-a*u-o*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,i=e._y,r=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(n/2),c=a(i/2),u=a(r/2),h=o(n/2),d=o(i/2),p=o(r/2);switch(s){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],s=t[1],a=t[5],o=t[9],l=t[2],c=t[6],u=t[10],h=n+a+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-o)*e,this._y=(r-l)*e,this._z=(s-i)*e}else if(n>a&&n>u){const e=2*Math.sqrt(1+n-a-u);this._w=(c-o)/e,this._x=.25*e,this._y=(i+s)/e,this._z=(r+l)/e}else if(a>u){const e=2*Math.sqrt(1+a-n-u);this._w=(r-l)/e,this._x=(i+s)/e,this._y=.25*e,this._z=(o+c)/e}else{const e=2*Math.sqrt(1+u-n-a);this._w=(s-i)/e,this._x=(r+l)/e,this._y=(o+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Zc(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,s=e._w,a=t._x,o=t._y,l=t._z,c=t._w;return this._x=n*c+s*a+i*l-r*o,this._y=i*c+s*o+r*a-n*l,this._z=r*c+s*l+n*o-i*a,this._w=s*c-n*a-i*o-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,s=this._w;let a=s*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const e=1-t;return this._w=e*s+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this}const l=Math.sqrt(o),c=Math.atan2(l,a),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=s*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class wu{constructor(e=0,t=0,n=0){wu.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Mu.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Mu.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,s=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,s=e.y,a=e.z,o=e.w,l=2*(s*i-a*n),c=2*(a*t-r*i),u=2*(r*n-s*t);return this.x=t+o*l+s*u-a*c,this.y=n+o*c+a*l-r*u,this.z=i+o*u+r*c-s*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,s=t.x,a=t.y,o=t.z;return this.x=i*o-r*a,this.y=r*s-n*o,this.z=n*a-i*s,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Su.copy(this).projectOnVector(e),this.sub(Su)}reflect(e){return this.sub(Su.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Zc(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Su=new wu,Mu=new _u;class Eu{constructor(e=new wu(1/0,1/0,1/0),t=new wu(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Au.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Au.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Au.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const i=n.getAttribute("position");if(!0===t&&void 0!==i&&!0!==e.isInstancedMesh)for(let t=0,n=i.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,Au):Au.fromBufferAttribute(i,t),Au.applyMatrix4(e.matrixWorld),this.expandByPoint(Au);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),Cu.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Cu.copy(n.boundingBox)),Cu.applyMatrix4(e.matrixWorld),this.union(Cu)}const i=e.children;for(let e=0,n=i.length;e<n;e++)this.expandByObject(i[e],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Au),Au.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Nu),Du.subVectors(this.max,Nu),Ru.subVectors(e.a,Nu),Pu.subVectors(e.b,Nu),ku.subVectors(e.c,Nu),Iu.subVectors(Pu,Ru),Ou.subVectors(ku,Pu),Lu.subVectors(Ru,ku);let t=[0,-Iu.z,Iu.y,0,-Ou.z,Ou.y,0,-Lu.z,Lu.y,Iu.z,0,-Iu.x,Ou.z,0,-Ou.x,Lu.z,0,-Lu.x,-Iu.y,Iu.x,0,-Ou.y,Ou.x,0,-Lu.y,Lu.x,0];return!!Fu(t,Ru,Pu,ku,Du)&&(t=[1,0,0,0,1,0,0,0,1],!!Fu(t,Ru,Pu,ku,Du)&&(zu.crossVectors(Iu,Ou),t=[zu.x,zu.y,zu.z],Fu(t,Ru,Pu,ku,Du)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Au).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Au).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Tu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Tu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Tu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Tu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Tu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Tu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Tu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Tu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Tu)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Tu=[new wu,new wu,new wu,new wu,new wu,new wu,new wu,new wu],Au=new wu,Cu=new Eu,Ru=new wu,Pu=new wu,ku=new wu,Iu=new wu,Ou=new wu,Lu=new wu,Nu=new wu,Du=new wu,zu=new wu,Uu=new wu;function Fu(e,t,n,i,r){for(let s=0,a=e.length-3;s<=a;s+=3){Uu.fromArray(e,s);const a=r.x*Math.abs(Uu.x)+r.y*Math.abs(Uu.y)+r.z*Math.abs(Uu.z),o=t.dot(Uu),l=n.dot(Uu),c=i.dot(Uu);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>a)return!1}return!0}const Bu=new Eu,Vu=new wu,ju=new wu;class Hu{constructor(e=new wu,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Bu.setFromPoints(e).getCenter(n);let i=0;for(let t=0,r=e.length;t<r;t++)i=Math.max(i,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Vu.subVectors(e,this.center);const t=Vu.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(Vu,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(ju.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Vu.copy(e.center).add(ju)),this.expandByPoint(Vu.copy(e.center).sub(ju))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Gu=new wu,Wu=new wu,Xu=new wu,qu=new wu,Yu=new wu,$u=new wu,Zu=new wu;class Ku{constructor(e=new wu,t=new wu(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Gu)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Gu.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Gu.copy(this.origin).addScaledVector(this.direction,t),Gu.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){Wu.copy(e).add(t).multiplyScalar(.5),Xu.copy(t).sub(e).normalize(),qu.copy(this.origin).sub(Wu);const r=.5*e.distanceTo(t),s=-this.direction.dot(Xu),a=qu.dot(this.direction),o=-qu.dot(Xu),l=qu.lengthSq(),c=Math.abs(1-s*s);let u,h,d,p;if(c>0)if(u=s*o-a,h=s*a-o,p=r*c,u>=0)if(h>=-p)if(h<=p){const e=1/c;u*=e,h*=e,d=u*(u+s*h+2*a)+h*(s*u+h+2*o)+l}else h=r,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h=-r,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h<=-p?(u=Math.max(0,-(-s*r+a)),h=u>0?-r:Math.min(Math.max(-r,-o),r),d=-u*u+h*(h+2*o)+l):h<=p?(u=0,h=Math.min(Math.max(-r,-o),r),d=h*(h+2*o)+l):(u=Math.max(0,-(s*r+a)),h=u>0?r:Math.min(Math.max(-r,-o),r),d=-u*u+h*(h+2*o)+l);else h=s>0?-r:r,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),i&&i.copy(Wu).addScaledVector(Xu,h),d}intersectSphere(e,t){Gu.subVectors(e.center,this.origin);const n=Gu.dot(this.direction),i=Gu.dot(Gu)-n*n,r=e.radius*e.radius;if(i>r)return null;const s=Math.sqrt(r-i),a=n-s,o=n+s;return o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,s,a,o;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),c>=0?(r=(e.min.y-h.y)*c,s=(e.max.y-h.y)*c):(r=(e.max.y-h.y)*c,s=(e.min.y-h.y)*c),n>s||r>i?null:((r>n||isNaN(n))&&(n=r),(s<i||isNaN(i))&&(i=s),u>=0?(a=(e.min.z-h.z)*u,o=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,o=(e.min.z-h.z)*u),n>o||a>i?null:((a>n||n!=n)&&(n=a),(o<i||i!=i)&&(i=o),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,Gu)}intersectTriangle(e,t,n,i,r){Yu.subVectors(t,e),$u.subVectors(n,e),Zu.crossVectors(Yu,$u);let s,a=this.direction.dot(Zu);if(a>0){if(i)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}qu.subVectors(this.origin,e);const o=s*this.direction.dot($u.crossVectors(qu,$u));if(o<0)return null;const l=s*this.direction.dot(Yu.cross(qu));if(l<0)return null;if(o+l>a)return null;const c=-s*qu.dot(Zu);return c<0?null:this.at(c/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Ju{constructor(e,t,n,i,r,s,a,o,l,c,u,h,d,p,f,m){Ju.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,s,a,o,l,c,u,h,d,p,f,m)}set(e,t,n,i,r,s,a,o,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ju).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/Qu.setFromMatrixColumn(e,0).length(),r=1/Qu.setFromMatrixColumn(e,1).length(),s=1/Qu.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,s=Math.cos(n),a=Math.sin(n),o=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){const e=s*c,n=s*u,i=a*c,r=a*u;t[0]=o*c,t[4]=-o*u,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-a*o,t[2]=r-e*l,t[6]=i+n*l,t[10]=s*o}else if("YXZ"===e.order){const e=o*c,n=o*u,i=l*c,r=l*u;t[0]=e+r*a,t[4]=i*a-n,t[8]=s*l,t[1]=s*u,t[5]=s*c,t[9]=-a,t[2]=n*a-i,t[6]=r+e*a,t[10]=s*o}else if("ZXY"===e.order){const e=o*c,n=o*u,i=l*c,r=l*u;t[0]=e-r*a,t[4]=-s*u,t[8]=i+n*a,t[1]=n+i*a,t[5]=s*c,t[9]=r-e*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if("ZYX"===e.order){const e=s*c,n=s*u,i=a*c,r=a*u;t[0]=o*c,t[4]=i*l-n,t[8]=e*l+r,t[1]=o*u,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=a*o,t[10]=s*o}else if("YZX"===e.order){const e=s*o,n=s*l,i=a*o,r=a*l;t[0]=o*c,t[4]=r-e*u,t[8]=i*u+n,t[1]=u,t[5]=s*c,t[9]=-a*c,t[2]=-l*c,t[6]=n*u+i,t[10]=e-r*u}else if("XZY"===e.order){const e=s*o,n=s*l,i=a*o,r=a*l;t[0]=o*c,t[4]=-u,t[8]=l*c,t[1]=e*u+r,t[5]=s*c,t[9]=n*u-i,t[2]=i*u-n,t[6]=a*c,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(th,e,nh)}lookAt(e,t,n){const i=this.elements;return sh.subVectors(e,t),0===sh.lengthSq()&&(sh.z=1),sh.normalize(),ih.crossVectors(n,sh),0===ih.lengthSq()&&(1===Math.abs(n.z)?sh.x+=1e-4:sh.z+=1e-4,sh.normalize(),ih.crossVectors(n,sh)),ih.normalize(),rh.crossVectors(sh,ih),i[0]=ih.x,i[4]=rh.x,i[8]=sh.x,i[1]=ih.y,i[5]=rh.y,i[9]=sh.y,i[2]=ih.z,i[6]=rh.z,i[10]=sh.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,s=n[0],a=n[4],o=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],x=n[15],_=i[0],w=i[4],S=i[8],M=i[12],E=i[1],T=i[5],A=i[9],C=i[13],R=i[2],P=i[6],k=i[10],I=i[14],O=i[3],L=i[7],N=i[11],D=i[15];return r[0]=s*_+a*E+o*R+l*O,r[4]=s*w+a*T+o*P+l*L,r[8]=s*S+a*A+o*k+l*N,r[12]=s*M+a*C+o*I+l*D,r[1]=c*_+u*E+h*R+d*O,r[5]=c*w+u*T+h*P+d*L,r[9]=c*S+u*A+h*k+d*N,r[13]=c*M+u*C+h*I+d*D,r[2]=p*_+f*E+m*R+g*O,r[6]=p*w+f*T+m*P+g*L,r[10]=p*S+f*A+m*k+g*N,r[14]=p*M+f*C+m*I+g*D,r[3]=v*_+y*E+b*R+x*O,r[7]=v*w+y*T+b*P+x*L,r[11]=v*S+y*A+b*k+x*N,r[15]=v*M+y*C+b*I+x*D,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],s=e[1],a=e[5],o=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+r*o*u-i*l*u-r*a*h+n*l*h+i*a*d-n*o*d)+e[7]*(+t*o*d-t*l*h+r*s*h-i*s*d+i*l*c-r*o*c)+e[11]*(+t*l*u-t*a*d-r*s*u+n*s*d+r*a*c-n*l*c)+e[15]*(-i*a*c-t*o*u+t*a*h+i*s*u-n*s*h+n*o*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=u*m*l-f*h*l+f*o*d-a*m*d-u*o*g+a*h*g,y=p*h*l-c*m*l-p*o*d+s*m*d+c*o*g-s*h*g,b=c*f*l-p*u*l+p*a*d-s*f*d-c*a*g+s*u*g,x=p*u*o-c*f*o-p*a*h+s*f*h+c*a*m-s*u*m,_=t*v+n*y+i*b+r*x;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/_;return e[0]=v*w,e[1]=(f*h*r-u*m*r-f*i*d+n*m*d+u*i*g-n*h*g)*w,e[2]=(a*m*r-f*o*r+f*i*l-n*m*l-a*i*g+n*o*g)*w,e[3]=(u*o*r-a*h*r-u*i*l+n*h*l+a*i*d-n*o*d)*w,e[4]=y*w,e[5]=(c*m*r-p*h*r+p*i*d-t*m*d-c*i*g+t*h*g)*w,e[6]=(p*o*r-s*m*r-p*i*l+t*m*l+s*i*g-t*o*g)*w,e[7]=(s*h*r-c*o*r+c*i*l-t*h*l-s*i*d+t*o*d)*w,e[8]=b*w,e[9]=(p*u*r-c*f*r-p*n*d+t*f*d+c*n*g-t*u*g)*w,e[10]=(s*f*r-p*a*r+p*n*l-t*f*l-s*n*g+t*a*g)*w,e[11]=(c*a*r-s*u*r-c*n*l+t*u*l+s*n*d-t*a*d)*w,e[12]=x*w,e[13]=(c*f*i-p*u*i+p*n*h-t*f*h-c*n*m+t*u*m)*w,e[14]=(p*a*i-s*f*i-p*n*o+t*f*o+s*n*m-t*a*m)*w,e[15]=(s*u*i-c*a*i+c*n*o-t*u*o-s*n*h+t*a*h)*w,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,s=e.x,a=e.y,o=e.z,l=r*s,c=r*a;return this.set(l*s+n,l*a-i*o,l*o+i*a,0,l*a+i*o,c*a+n,c*o-i*s,0,l*o-i*a,c*o+i*s,r*o*o+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,s){return this.set(1,n,r,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,s=t._y,a=t._z,o=t._w,l=r+r,c=s+s,u=a+a,h=r*l,d=r*c,p=r*u,f=s*c,m=s*u,g=a*u,v=o*l,y=o*c,b=o*u,x=n.x,_=n.y,w=n.z;return i[0]=(1-(f+g))*x,i[1]=(d+b)*x,i[2]=(p-y)*x,i[3]=0,i[4]=(d-b)*_,i[5]=(1-(h+g))*_,i[6]=(m+v)*_,i[7]=0,i[8]=(p+y)*w,i[9]=(m-v)*w,i[10]=(1-(h+f))*w,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=Qu.set(i[0],i[1],i[2]).length();const s=Qu.set(i[4],i[5],i[6]).length(),a=Qu.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],eh.copy(this);const o=1/r,l=1/s,c=1/a;return eh.elements[0]*=o,eh.elements[1]*=o,eh.elements[2]*=o,eh.elements[4]*=l,eh.elements[5]*=l,eh.elements[6]*=l,eh.elements[8]*=c,eh.elements[9]*=c,eh.elements[10]*=c,t.setFromRotationMatrix(eh),n.x=r,n.y=s,n.z=a,this}makePerspective(e,t,n,i,r,s,a=2e3){const o=this.elements,l=2*r/(t-e),c=2*r/(n-i),u=(t+e)/(t-e),h=(n+i)/(n-i);let d,p;if(a===jc)d=-(s+r)/(s-r),p=-2*s*r/(s-r);else{if(a!==Hc)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);d=-s/(s-r),p=-s*r/(s-r)}return o[0]=l,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=c,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,n,i,r,s,a=2e3){const o=this.elements,l=1/(t-e),c=1/(n-i),u=1/(s-r),h=(t+e)*l,d=(n+i)*c;let p,f;if(a===jc)p=(s+r)*u,f=-2*u;else{if(a!==Hc)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);p=r*u,f=-1*u}return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=f,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Qu=new wu,eh=new Ju,th=new wu(0,0,0),nh=new wu(1,1,1),ih=new wu,rh=new wu,sh=new wu,ah=new Ju,oh=new _u;class lh{constructor(e=0,t=0,n=0,i=lh.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],s=i[4],a=i[8],o=i[1],l=i[5],c=i[9],u=i[2],h=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(Zc(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Zc(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(Zc(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-Zc(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Zc(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-Zc(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return ah.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ah,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return oh.setFromEuler(this),this.setFromQuaternion(oh,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}lh.DEFAULT_ORDER="XYZ";class ch{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return!!(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}let uh=0;const hh=new wu,dh=new _u,ph=new Ju,fh=new wu,mh=new wu,gh=new wu,vh=new _u,yh=new wu(1,0,0),bh=new wu(0,1,0),xh=new wu(0,0,1),_h={type:"added"},wh={type:"removed"},Sh={type:"childadded",child:null},Mh={type:"childremoved",child:null};class Eh extends Gc{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:uh++}),this.uuid=$c(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Eh.DEFAULT_UP.clone();const e=new wu,t=new lh,n=new _u,i=new wu(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Ju},normalMatrix:{value:new iu}}),this.matrix=new Ju,this.matrixWorld=new Ju,this.matrixAutoUpdate=Eh.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Eh.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new ch,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return dh.setFromAxisAngle(e,t),this.quaternion.multiply(dh),this}rotateOnWorldAxis(e,t){return dh.setFromAxisAngle(e,t),this.quaternion.premultiply(dh),this}rotateX(e){return this.rotateOnAxis(yh,e)}rotateY(e){return this.rotateOnAxis(bh,e)}rotateZ(e){return this.rotateOnAxis(xh,e)}translateOnAxis(e,t){return hh.copy(e).applyQuaternion(this.quaternion),this.position.add(hh.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(yh,e)}translateY(e){return this.translateOnAxis(bh,e)}translateZ(e){return this.translateOnAxis(xh,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(ph.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?fh.copy(e):fh.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),mh.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ph.lookAt(mh,fh,this.up):ph.lookAt(fh,mh,this.up),this.quaternion.setFromRotationMatrix(ph),i&&(ph.extractRotation(i.matrixWorld),dh.setFromRotationMatrix(ph),this.quaternion.premultiply(dh.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(_h),Sh.child=e,this.dispatchEvent(Sh),Sh.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(wh),Mh.child=e,this.dispatchEvent(Mh),Mh.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),ph.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),ph.multiply(e.parent.matrixWorld)),e.applyMatrix4(ph),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(_h),Sh.child=e,this.dispatchEvent(Sh),Sh.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mh,e,gh),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mh,vh,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map((e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()}))),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),null!==this.boundingBox&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=s(e.geometries),i=s(e.materials),r=s(e.textures),a=s(e.images),o=s(e.shapes),l=s(e.skeletons),c=s(e.animations),u=s(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),a.length>0&&(n.images=a),o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=i,n;function s(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}Eh.DEFAULT_UP=new wu(0,1,0),Eh.DEFAULT_MATRIX_AUTO_UPDATE=!0,Eh.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Th=new wu,Ah=new wu,Ch=new wu,Rh=new wu,Ph=new wu,kh=new wu,Ih=new wu,Oh=new wu,Lh=new wu,Nh=new wu,Dh=new xu,zh=new xu,Uh=new xu;class Fh{constructor(e=new wu,t=new wu,n=new wu){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),Th.subVectors(e,t),i.cross(Th);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){Th.subVectors(i,t),Ah.subVectors(n,t),Ch.subVectors(e,t);const s=Th.dot(Th),a=Th.dot(Ah),o=Th.dot(Ch),l=Ah.dot(Ah),c=Ah.dot(Ch),u=s*l-a*a;if(0===u)return r.set(0,0,0),null;const h=1/u,d=(l*o-a*c)*h,p=(s*c-a*o)*h;return r.set(1-d-p,p,d)}static containsPoint(e,t,n,i){return null!==this.getBarycoord(e,t,n,i,Rh)&&Rh.x>=0&&Rh.y>=0&&Rh.x+Rh.y<=1}static getInterpolation(e,t,n,i,r,s,a,o){return null===this.getBarycoord(e,t,n,i,Rh)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(r,Rh.x),o.addScaledVector(s,Rh.y),o.addScaledVector(a,Rh.z),o)}static getInterpolatedAttribute(e,t,n,i,r,s){return Dh.setScalar(0),zh.setScalar(0),Uh.setScalar(0),Dh.fromBufferAttribute(e,t),zh.fromBufferAttribute(e,n),Uh.fromBufferAttribute(e,i),s.setScalar(0),s.addScaledVector(Dh,r.x),s.addScaledVector(zh,r.y),s.addScaledVector(Uh,r.z),s}static isFrontFacing(e,t,n,i){return Th.subVectors(n,t),Ah.subVectors(e,t),Th.cross(Ah).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Th.subVectors(this.c,this.b),Ah.subVectors(this.a,this.b),.5*Th.cross(Ah).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Fh.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Fh.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,i,r){return Fh.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return Fh.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Fh.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let s,a;Ph.subVectors(i,n),kh.subVectors(r,n),Oh.subVectors(e,n);const o=Ph.dot(Oh),l=kh.dot(Oh);if(o<=0&&l<=0)return t.copy(n);Lh.subVectors(e,i);const c=Ph.dot(Lh),u=kh.dot(Lh);if(c>=0&&u<=c)return t.copy(i);const h=o*u-c*l;if(h<=0&&o>=0&&c<=0)return s=o/(o-c),t.copy(n).addScaledVector(Ph,s);Nh.subVectors(e,r);const d=Ph.dot(Nh),p=kh.dot(Nh);if(p>=0&&d<=p)return t.copy(r);const f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(n).addScaledVector(kh,a);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return Ih.subVectors(r,i),a=(u-c)/(u-c+(d-p)),t.copy(i).addScaledVector(Ih,a);const g=1/(m+f+h);return s=f*g,a=h*g,t.copy(n).addScaledVector(Ph,s).addScaledVector(kh,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Bh={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Vh={h:0,s:0,l:0},jh={h:0,s:0,l:0};function Hh(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class Gh{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Oc){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,uu.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=uu.workingColorSpace){return this.r=e,this.g=t,this.b=n,uu.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=uu.workingColorSpace){if(e=Kc(e,1),t=Zc(t,0,1),n=Zc(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=Hh(r,i,e+1/3),this.g=Hh(r,i,e),this.b=Hh(r,i,e-1/3)}return uu.toWorkingColorSpace(this,i),this}setStyle(e,t=Oc){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const s=i[1],a=i[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=i[1],r=n.length;if(3===r)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,t);if(6===r)return this.setHex(parseInt(n,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Oc){const n=Bh[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=hu(e.r),this.g=hu(e.g),this.b=hu(e.b),this}copyLinearToSRGB(e){return this.r=du(e.r),this.g=du(e.g),this.b=du(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Oc){return uu.fromWorkingColorSpace(Wh.copy(this),e),65536*Math.round(Zc(255*Wh.r,0,255))+256*Math.round(Zc(255*Wh.g,0,255))+Math.round(Zc(255*Wh.b,0,255))}getHexString(e=Oc){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=uu.workingColorSpace){uu.fromWorkingColorSpace(Wh.copy(this),t);const n=Wh.r,i=Wh.g,r=Wh.b,s=Math.max(n,i,r),a=Math.min(n,i,r);let o,l;const c=(a+s)/2;if(a===s)o=0,l=0;else{const e=s-a;switch(l=c<=.5?e/(s+a):e/(2-s-a),s){case n:o=(i-r)/e+(i<r?6:0);break;case i:o=(r-n)/e+2;break;case r:o=(n-i)/e+4}o/=6}return e.h=o,e.s=l,e.l=c,e}getRGB(e,t=uu.workingColorSpace){return uu.fromWorkingColorSpace(Wh.copy(this),t),e.r=Wh.r,e.g=Wh.g,e.b=Wh.b,e}getStyle(e=Oc){uu.fromWorkingColorSpace(Wh.copy(this),e);const t=Wh.r,n=Wh.g,i=Wh.b;return e!==Oc?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(e,t,n){return this.getHSL(Vh),this.setHSL(Vh.h+e,Vh.s+t,Vh.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Vh),e.getHSL(jh);const n=Jc(Vh.h,jh.h,t),i=Jc(Vh.s,jh.s,t),r=Jc(Vh.l,jh.l,t);return this.setHSL(n,i,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*i,this.g=r[1]*t+r[4]*n+r[7]*i,this.b=r[2]*t+r[5]*n+r[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Wh=new Gh;Gh.NAMES=Bh;let Xh=0;class qh extends Gc{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Xh++}),this.uuid=$c(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Gh(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Bc,this.stencilZFail=Bc,this.stencilZPass=Bc,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),204!==this.blendSrc&&(n.blendSrc=this.blendSrc),205!==this.blendDst&&(n.blendDst=this.blendDst),100!==this.blendEquation&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Bc&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Bc&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Bc&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Yh extends qh{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Gh(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new lh,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const $h=new wu,Zh=new nu;class Kh{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=Vc,this.updateRanges=[],this.gpuType=Rc,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)Zh.fromBufferAttribute(this,t),Zh.applyMatrix3(e),this.setXY(t,Zh.x,Zh.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)$h.fromBufferAttribute(this,t),$h.applyMatrix3(e),this.setXYZ(t,$h.x,$h.y,$h.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)$h.fromBufferAttribute(this,t),$h.applyMatrix4(e),this.setXYZ(t,$h.x,$h.y,$h.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)$h.fromBufferAttribute(this,t),$h.applyNormalMatrix(e),this.setXYZ(t,$h.x,$h.y,$h.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)$h.fromBufferAttribute(this,t),$h.transformDirection(e),this.setXYZ(t,$h.x,$h.y,$h.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=Qc(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=eu(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Qc(t,this.array)),t}setX(e,t){return this.normalized&&(t=eu(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Qc(t,this.array)),t}setY(e,t){return this.normalized&&(t=eu(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Qc(t,this.array)),t}setZ(e,t){return this.normalized&&(t=eu(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Qc(t,this.array)),t}setW(e,t){return this.normalized&&(t=eu(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=eu(t,this.array),n=eu(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=eu(t,this.array),n=eu(n,this.array),i=eu(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=eu(t,this.array),n=eu(n,this.array),i=eu(i,this.array),r=eu(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Vc&&(e.usage=this.usage),e}}class Jh extends Kh{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Qh extends Kh{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class ed extends Kh{constructor(e,t,n){super(new Float32Array(e),t,n)}}let td=0;const nd=new Ju,id=new Eh,rd=new wu,sd=new Eu,ad=new Eu,od=new wu;class ld extends Gc{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:td++}),this.uuid=$c(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(function(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}(e)?Qh:Jh)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new iu).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return nd.makeRotationFromQuaternion(e),this.applyMatrix4(nd),this}rotateX(e){return nd.makeRotationX(e),this.applyMatrix4(nd),this}rotateY(e){return nd.makeRotationY(e),this.applyMatrix4(nd),this}rotateZ(e){return nd.makeRotationZ(e),this.applyMatrix4(nd),this}translate(e,t,n){return nd.makeTranslation(e,t,n),this.applyMatrix4(nd),this}scale(e,t,n){return nd.makeScale(e,t,n),this.applyMatrix4(nd),this}lookAt(e){return id.lookAt(e),id.updateMatrix(),this.applyMatrix4(id.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(rd).negate(),this.translate(rd.x,rd.y,rd.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new ed(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Eu);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new wu(-1/0,-1/0,-1/0),new wu(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];sd.setFromBufferAttribute(n),this.morphTargetsRelative?(od.addVectors(this.boundingBox.min,sd.min),this.boundingBox.expandByPoint(od),od.addVectors(this.boundingBox.max,sd.max),this.boundingBox.expandByPoint(od)):(this.boundingBox.expandByPoint(sd.min),this.boundingBox.expandByPoint(sd.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Hu);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new wu,1/0);if(e){const n=this.boundingSphere.center;if(sd.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];ad.setFromBufferAttribute(n),this.morphTargetsRelative?(od.addVectors(sd.min,ad.min),sd.expandByPoint(od),od.addVectors(sd.max,ad.max),sd.expandByPoint(od)):(sd.expandByPoint(ad.min),sd.expandByPoint(ad.max))}sd.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)od.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(od));if(t)for(let r=0,s=t.length;r<s;r++){const s=t[r],a=this.morphTargetsRelative;for(let t=0,r=s.count;t<r;t++)od.fromBufferAttribute(s,t),a&&(rd.fromBufferAttribute(e,t),od.add(rd)),i=Math.max(i,n.distanceToSquared(od))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.position,i=t.normal,r=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Kh(new Float32Array(4*n.count),4));const s=this.getAttribute("tangent"),a=[],o=[];for(let e=0;e<n.count;e++)a[e]=new wu,o[e]=new wu;const l=new wu,c=new wu,u=new wu,h=new nu,d=new nu,p=new nu,f=new wu,m=new wu;function g(e,t,i){l.fromBufferAttribute(n,e),c.fromBufferAttribute(n,t),u.fromBufferAttribute(n,i),h.fromBufferAttribute(r,e),d.fromBufferAttribute(r,t),p.fromBufferAttribute(r,i),c.sub(l),u.sub(l),d.sub(h),p.sub(h);const s=1/(d.x*p.y-p.x*d.y);isFinite(s)&&(f.copy(c).multiplyScalar(p.y).addScaledVector(u,-d.y).multiplyScalar(s),m.copy(u).multiplyScalar(d.x).addScaledVector(c,-p.x).multiplyScalar(s),a[e].add(f),a[t].add(f),a[i].add(f),o[e].add(m),o[t].add(m),o[i].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:e.count}]);for(let t=0,n=v.length;t<n;++t){const n=v[t],i=n.start;for(let t=i,r=i+n.count;t<r;t+=3)g(e.getX(t+0),e.getX(t+1),e.getX(t+2))}const y=new wu,b=new wu,x=new wu,_=new wu;function w(e){x.fromBufferAttribute(i,e),_.copy(x);const t=a[e];y.copy(t),y.sub(x.multiplyScalar(x.dot(t))).normalize(),b.crossVectors(_,t);const n=b.dot(o[e])<0?-1:1;s.setXYZW(e,y.x,y.y,y.z,n)}for(let t=0,n=v.length;t<n;++t){const n=v[t],i=n.start;for(let t=i,r=i+n.count;t<r;t+=3)w(e.getX(t+0)),w(e.getX(t+1)),w(e.getX(t+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new Kh(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new wu,r=new wu,s=new wu,a=new wu,o=new wu,l=new wu,c=new wu,u=new wu;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);i.fromBufferAttribute(t,d),r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,f),c.subVectors(s,r),u.subVectors(i,r),c.cross(u),a.fromBufferAttribute(n,d),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),a.add(c),o.add(c),l.add(c),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,a=t.count;e<a;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),c.subVectors(s,r),u.subVectors(i,r),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)od.fromBufferAttribute(e,t),od.normalize(),e.setXYZ(t,od.x,od.y,od.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,s=new n.constructor(t.length*i);let a=0,o=0;for(let r=0,l=t.length;r<l;r++){a=e.isInterleavedBufferAttribute?t[r]*e.data.stride+e.offset:t[r]*i;for(let e=0;e<i;e++)s[o++]=n[a++]}return new Kh(s,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new ld,n=this.index.array,i=this.attributes;for(const r in i){const s=e(i[r],n);t.setAttribute(r,s)}const r=this.morphAttributes;for(const i in r){const s=[],a=r[i];for(let t=0,i=a.length;t<i;t++){const i=e(a[t],n);s.push(i)}t.morphAttributes[i]=s}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let e=0,n=s.length;e<n;e++){const n=s[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const i=n[t];e.data.attributes[t]=i.toJSON(e.data)}const i={};let r=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],s=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];s.push(i.toJSON(e.data))}s.length>0&&(i[t]=s,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const e in i){const n=i[e];this.setAttribute(e,n.clone(t))}const r=e.morphAttributes;for(const e in r){const n=[],i=r[e];for(let e=0,r=i.length;e<r;e++)n.push(i[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let e=0,t=s.length;e<t;e++){const t=s[e];this.addGroup(t.start,t.count,t.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const cd=new Ju,ud=new Ku,hd=new Hu,dd=new wu,pd=new wu,fd=new wu,md=new wu,gd=new wu,vd=new wu,yd=new wu,bd=new wu;class xd extends Eh{constructor(e=new ld,t=new Yh){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,s=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(r&&a){vd.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=a[n],o=r[n];0!==i&&(gd.fromBufferAttribute(o,e),s?vd.addScaledVector(gd,i):vd.addScaledVector(gd.sub(t),i))}t.add(vd)}return t}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),hd.copy(n.boundingSphere),hd.applyMatrix4(r),ud.copy(e.ray).recast(e.near),!1===hd.containsPoint(ud.origin)){if(null===ud.intersectSphere(hd,dd))return;if(ud.origin.distanceToSquared(dd)>(e.far-e.near)**2)return}cd.copy(r).invert(),ud.copy(e.ray).applyMatrix4(cd),null!==n.boundingBox&&!1===ud.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,ud)}}_computeIntersections(e,t,n){let i;const r=this.geometry,s=this.material,a=r.index,o=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,u=r.attributes.normal,h=r.groups,d=r.drawRange;if(null!==a)if(Array.isArray(s))for(let r=0,o=h.length;r<o;r++){const o=h[r],p=s[o.materialIndex];for(let r=Math.max(o.start,d.start),s=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));r<s;r+=3)i=_d(this,p,e,n,l,c,u,a.getX(r),a.getX(r+1),a.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),i.face.materialIndex=o.materialIndex,t.push(i))}else for(let r=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);r<o;r+=3)i=_d(this,s,e,n,l,c,u,a.getX(r),a.getX(r+1),a.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),t.push(i));else if(void 0!==o)if(Array.isArray(s))for(let r=0,a=h.length;r<a;r++){const a=h[r],p=s[a.materialIndex];for(let r=Math.max(a.start,d.start),s=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));r<s;r+=3)i=_d(this,p,e,n,l,c,u,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),i.face.materialIndex=a.materialIndex,t.push(i))}else for(let r=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);r<a;r+=3)i=_d(this,s,e,n,l,c,u,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}function _d(e,t,n,i,r,s,a,o,l,c){e.getVertexPosition(o,pd),e.getVertexPosition(l,fd),e.getVertexPosition(c,md);const u=function(e,t,n,i,r,s,a,o){let l;if(l=1===t.side?i.intersectTriangle(a,s,r,!0,o):i.intersectTriangle(r,s,a,0===t.side,o),null===l)return null;bd.copy(o),bd.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(bd);return c<n.near||c>n.far?null:{distance:c,point:bd.clone(),object:e}}(e,t,n,i,pd,fd,md,yd);if(u){const e=new wu;Fh.getBarycoord(yd,pd,fd,md,e),r&&(u.uv=Fh.getInterpolatedAttribute(r,o,l,c,e,new nu)),s&&(u.uv1=Fh.getInterpolatedAttribute(s,o,l,c,e,new nu)),a&&(u.normal=Fh.getInterpolatedAttribute(a,o,l,c,e,new wu),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const t={a:o,b:l,c,normal:new wu,materialIndex:0};Fh.getNormal(pd,fd,md,t.normal),u.face=t,u.barycoord=e}return u}function wd(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][i]=null):t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function Sd(e){const t={};for(let n=0;n<e.length;n++){const i=wd(e[n]);for(const e in i)t[e]=i[e]}return t}class Md extends Eh{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ju,this.projectionMatrix=new Ju,this.projectionMatrixInverse=new Ju,this.coordinateSystem=jc}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const Ed=new wu,Td=new nu,Ad=new nu;class Cd extends Md{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Yc*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*qc*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Yc*Math.atan(Math.tan(.5*qc*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){Ed.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Ed.x,Ed.y).multiplyScalar(-e/Ed.z),Ed.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Ed.x,Ed.y).multiplyScalar(-e/Ed.z)}getViewSize(e,t){return this.getViewBounds(e,Td,Ad),t.subVectors(Ad,Td)}setViewOffset(e,t,n,i,r,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*qc*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const e=s.fullWidth,a=s.fullHeight;r+=s.offsetX*i/e,t-=s.offsetY*n/a,i*=s.width/e,n*=s.height/a}const a=this.filmOffset;0!==a&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Rd=new wu,Pd=new wu,kd=new iu;class Id{constructor(e=new wu(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=Rd.subVectors(n,t).cross(Pd.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Rd),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||kd.getNormalMatrix(e),i=this.coplanarPoint(Rd).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Od=new Hu,Ld=new wu;class Nd{constructor(e=new Id,t=new Id,n=new Id,i=new Id,r=new Id,s=new Id){this.planes=[e,t,n,i,r,s]}set(e,t,n,i,r,s){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(s),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=2e3){const n=this.planes,i=e.elements,r=i[0],s=i[1],a=i[2],o=i[3],l=i[4],c=i[5],u=i[6],h=i[7],d=i[8],p=i[9],f=i[10],m=i[11],g=i[12],v=i[13],y=i[14],b=i[15];if(n[0].setComponents(o-r,h-l,m-d,b-g).normalize(),n[1].setComponents(o+r,h+l,m+d,b+g).normalize(),n[2].setComponents(o+s,h+c,m+p,b+v).normalize(),n[3].setComponents(o-s,h-c,m-p,b-v).normalize(),n[4].setComponents(o-a,h-u,m-f,b-y).normalize(),t===jc)n[5].setComponents(o+a,h+u,m+f,b+y).normalize();else{if(t!==Hc)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(a,u,f,y).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),Od.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),Od.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Od)}intersectsSprite(e){return Od.center.set(0,0,0),Od.radius=.7071067811865476,Od.applyMatrix4(e.matrixWorld),this.intersectsSphere(Od)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(Ld.x=i.normal.x>0?e.max.x:e.min.x,Ld.y=i.normal.y>0?e.max.y:e.min.y,Ld.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Ld)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}const Dd="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",zd="uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",Ud="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",Fd="#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",Bd="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",Vd="uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",jd="#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",Hd="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",Gd="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",Wd="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",Xd="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",qd="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",Yd="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",$d="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",Zd="#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",Kd="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Jd="#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Qd="#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",ep="#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",tp="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",np="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",ip="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",rp="#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sp="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",ap="#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",op="#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",lp="#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",cp="#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",up="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",hp="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",dp="#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",pp="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",fp="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",mp="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",gp={common:{diffuse:{value:new Gh(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new iu},alphaMap:{value:null},alphaMapTransform:{value:new iu},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new iu}},envmap:{envMap:{value:null},envMapRotation:{value:new iu},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new iu}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new iu}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new iu},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new iu},normalScale:{value:new nu(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new iu},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new iu}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new iu}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new iu}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Gh(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Gh(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new iu},alphaTest:{value:0},uvTransform:{value:new iu}},sprite:{diffuse:{value:new Gh(16777215)},opacity:{value:1},center:{value:new nu(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new iu},alphaMap:{value:null},alphaMapTransform:{value:new iu},alphaTest:{value:0}}},vp={basic:{uniforms:Sd([gp.common,gp.specularmap,gp.envmap,gp.aomap,gp.lightmap,gp.fog]),vertexShader:Zd,fragmentShader:Kd},lambert:{uniforms:Sd([gp.common,gp.specularmap,gp.envmap,gp.aomap,gp.lightmap,gp.emissivemap,gp.bumpmap,gp.normalmap,gp.displacementmap,gp.fog,gp.lights,{emissive:{value:new Gh(0)}}]),vertexShader:Jd,fragmentShader:Qd},phong:{uniforms:Sd([gp.common,gp.specularmap,gp.envmap,gp.aomap,gp.lightmap,gp.emissivemap,gp.bumpmap,gp.normalmap,gp.displacementmap,gp.fog,gp.lights,{emissive:{value:new Gh(0)},specular:{value:new Gh(1118481)},shininess:{value:30}}]),vertexShader:rp,fragmentShader:sp},standard:{uniforms:Sd([gp.common,gp.envmap,gp.aomap,gp.lightmap,gp.emissivemap,gp.bumpmap,gp.normalmap,gp.displacementmap,gp.roughnessmap,gp.metalnessmap,gp.fog,gp.lights,{emissive:{value:new Gh(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ap,fragmentShader:op},toon:{uniforms:Sd([gp.common,gp.aomap,gp.lightmap,gp.emissivemap,gp.bumpmap,gp.normalmap,gp.displacementmap,gp.gradientmap,gp.fog,gp.lights,{emissive:{value:new Gh(0)}}]),vertexShader:lp,fragmentShader:cp},matcap:{uniforms:Sd([gp.common,gp.bumpmap,gp.normalmap,gp.displacementmap,gp.fog,{matcap:{value:null}}]),vertexShader:ep,fragmentShader:tp},points:{uniforms:Sd([gp.points,gp.fog]),vertexShader:up,fragmentShader:hp},dashed:{uniforms:Sd([gp.common,gp.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Yd,fragmentShader:$d},depth:{uniforms:Sd([gp.common,gp.displacementmap]),vertexShader:jd,fragmentShader:Hd},normal:{uniforms:Sd([gp.common,gp.bumpmap,gp.normalmap,gp.displacementmap,{opacity:{value:1}}]),vertexShader:np,fragmentShader:ip},sprite:{uniforms:Sd([gp.sprite,gp.fog]),vertexShader:fp,fragmentShader:mp},background:{uniforms:{uvTransform:{value:new iu},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Dd,fragmentShader:zd},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new iu}},vertexShader:Ud,fragmentShader:Fd},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Bd,fragmentShader:Vd},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Xd,fragmentShader:qd},distanceRGBA:{uniforms:Sd([gp.common,gp.displacementmap,{referencePosition:{value:new wu},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Gd,fragmentShader:Wd},shadow:{uniforms:Sd([gp.lights,gp.fog,{color:{value:new Gh(0)},opacity:{value:1}}]),vertexShader:dp,fragmentShader:pp}};vp.physical={uniforms:Sd([vp.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new iu},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new iu},clearcoatNormalScale:{value:new nu(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new iu},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new iu},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new iu},sheen:{value:0},sheenColor:{value:new Gh(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new iu},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new iu},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new iu},transmissionSamplerSize:{value:new nu},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new iu},attenuationDistance:{value:0},attenuationColor:{value:new Gh(0)},specularColor:{value:new Gh(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new iu},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new iu},anisotropyVector:{value:new nu},anisotropyMap:{value:null},anisotropyMapTransform:{value:new iu}}]),vertexShader:ap,fragmentShader:op};class yp extends Md{constructor(e=-1,t=1,n=1,i=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,s=n+e,a=i+t,o=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,s=r+e*this.view.width,a-=t*this.view.offsetY,o=a-t*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}Math.sqrt(5),new Float32Array(16),new Float32Array(9),new Float32Array(4),new Map;class bp extends Eh{constructor(){super(),this.isGroup=!0,this.type="Group"}}class xp extends Eh{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new lh,this.environmentIntensity=1,this.environmentRotation=new lh,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class _p{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Vc,this.updateRanges=[],this.version=0,this.uuid=$c()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=$c()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=$c()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const wp=new wu;class Sp{constructor(e,t,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)wp.fromBufferAttribute(this,t),wp.applyMatrix4(e),this.setXYZ(t,wp.x,wp.y,wp.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)wp.fromBufferAttribute(this,t),wp.applyNormalMatrix(e),this.setXYZ(t,wp.x,wp.y,wp.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)wp.fromBufferAttribute(this,t),wp.transformDirection(e),this.setXYZ(t,wp.x,wp.y,wp.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=Qc(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=eu(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=eu(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=eu(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=eu(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=eu(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Qc(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Qc(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Qc(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Qc(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=eu(t,this.array),n=eu(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=eu(t,this.array),n=eu(n,this.array),i=eu(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=eu(t,this.array),n=eu(n,this.array),i=eu(i,this.array),r=eu(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new Kh(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Sp(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const Mp=new wu,Ep=new xu,Tp=new xu,Ap=new wu,Cp=new Ju,Rp=new wu,Pp=new Hu,kp=new Ju,Ip=new Ku;class Op extends xd{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Sc,this.bindMatrix=new Ju,this.bindMatrixInverse=new Ju,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Eu),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,Rp),this.boundingBox.expandByPoint(Rp)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Hu),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,Rp),this.boundingSphere.expandByPoint(Rp)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,i=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),Pp.copy(this.boundingSphere),Pp.applyMatrix4(i),!1!==e.ray.intersectsSphere(Pp)&&(kp.copy(i).invert(),Ip.copy(e.ray).applyMatrix4(kp),null!==this.boundingBox&&!1===Ip.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,Ip)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new xu,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===Sc?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,i=this.geometry;Ep.fromBufferAttribute(i.attributes.skinIndex,e),Tp.fromBufferAttribute(i.attributes.skinWeight,e),Mp.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const i=Tp.getComponent(e);if(0!==i){const r=Ep.getComponent(e);Cp.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),t.addScaledVector(Ap.copy(Mp).applyMatrix4(Cp),i)}}return t.applyMatrix4(this.bindMatrixInverse)}}class Lp extends Eh{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Np extends bu{constructor(e=null,t=1,n=1,i,r,s,a,o,l=1003,c=1003,u,h){super(null,s,a,o,l,c,i,r,u,h),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Dp=new Ju,zp=new Ju;class Up{constructor(e=[],t=[]){this.uuid=$c(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Ju)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Ju;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let i=0,r=e.length;i<r;i++){const r=e[i]?e[i].matrixWorld:zp;Dp.multiplyMatrices(r,t[i]),Dp.toArray(n,16*i)}null!==i&&(i.needsUpdate=!0)}clone(){return new Up(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Np(t,e,e,1023,Rc);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const i=e.bones[n];let r=t[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new Lp),this.bones.push(r),this.boneInverses.push((new Ju).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){const r=t[i];e.bones.push(r.uuid);const s=n[i];e.boneInverses.push(s.toArray())}return e}}class Fp extends Kh{constructor(e,t,n,i=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Bp=new Ju,Vp=new Ju,jp=[],Hp=new Eu,Gp=new Ju,Wp=new xd,Xp=new Hu;class qp extends xd{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Fp(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let e=0;e<n;e++)this.setMatrixAt(e,Gp)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Eu),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Bp),Hp.copy(e.boundingBox).applyMatrix4(Bp),this.boundingBox.union(Hp)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new Hu),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Bp),Xp.copy(e.boundingSphere).applyMatrix4(Bp),this.boundingSphere.union(Xp)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){const n=t.morphTargetInfluences,i=this.morphTexture.source.data.data,r=e*(n.length+1)+1;for(let e=0;e<n.length;e++)n[e]=i[r+e]}raycast(e,t){const n=this.matrixWorld,i=this.count;if(Wp.geometry=this.geometry,Wp.material=this.material,void 0!==Wp.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Xp.copy(this.boundingSphere),Xp.applyMatrix4(n),!1!==e.ray.intersectsSphere(Xp)))for(let r=0;r<i;r++){this.getMatrixAt(r,Bp),Vp.multiplyMatrices(n,Bp),Wp.matrixWorld=Vp,Wp.raycast(e,jp);for(let e=0,n=jp.length;e<n;e++){const n=jp[e];n.instanceId=r,n.object=this,t.push(n)}jp.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Fp(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){const n=t.morphTargetInfluences,i=n.length+1;null===this.morphTexture&&(this.morphTexture=new Np(new Float32Array(i*this.count),i,this.count,1028,Rc));const r=this.morphTexture.source.data.data;let s=0;for(let e=0;e<n.length;e++)s+=n[e];const a=this.geometry.morphTargetsRelative?1:1-s,o=i*e;r[o]=a,r.set(n,o+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class Yp extends qh{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Gh(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const $p=new wu,Zp=new wu,Kp=new Ju,Jp=new Ku,Qp=new Hu,ef=new wu,tf=new wu;class nf extends Eh{constructor(e=new ld,t=new Yp){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)$p.fromBufferAttribute(t,e-1),Zp.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=$p.distanceTo(Zp);e.setAttribute("lineDistance",new ed(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Qp.copy(n.boundingSphere),Qp.applyMatrix4(i),Qp.radius+=r,!1===e.ray.intersectsSphere(Qp))return;Kp.copy(i).invert(),Jp.copy(e.ray).applyMatrix4(Kp);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=this.isLineSegments?2:1,c=n.index,u=n.attributes.position;if(null!==c){const n=Math.max(0,s.start),i=Math.min(c.count,s.start+s.count);for(let r=n,s=i-1;r<s;r+=l){const n=c.getX(r),i=c.getX(r+1),s=rf(this,e,Jp,o,n,i);s&&t.push(s)}if(this.isLineLoop){const r=c.getX(i-1),s=c.getX(n),a=rf(this,e,Jp,o,r,s);a&&t.push(a)}}else{const n=Math.max(0,s.start),i=Math.min(u.count,s.start+s.count);for(let r=n,s=i-1;r<s;r+=l){const n=rf(this,e,Jp,o,r,r+1);n&&t.push(n)}if(this.isLineLoop){const r=rf(this,e,Jp,o,i-1,n);r&&t.push(r)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function rf(e,t,n,i,r,s){const a=e.geometry.attributes.position;if($p.fromBufferAttribute(a,r),Zp.fromBufferAttribute(a,s),n.distanceSqToSegment($p,Zp,ef,tf)>i)return;ef.applyMatrix4(e.matrixWorld);const o=t.ray.origin.distanceTo(ef);return o<t.near||o>t.far?void 0:{distance:o,point:tf.clone().applyMatrix4(e.matrixWorld),index:r,face:null,faceIndex:null,barycoord:null,object:e}}const sf=new wu,af=new wu;class of extends nf{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)sf.fromBufferAttribute(t,e),af.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+sf.distanceTo(af);e.setAttribute("lineDistance",new ed(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class lf extends nf{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class cf extends qh{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Gh(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const uf=new Ju,hf=new Ku,df=new Hu,pf=new wu;class ff extends Eh{constructor(e=new ld,t=new cf){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),df.copy(n.boundingSphere),df.applyMatrix4(i),df.radius+=r,!1===e.ray.intersectsSphere(df))return;uf.copy(i).invert(),hf.copy(e.ray).applyMatrix4(uf);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=n.index,c=n.attributes.position;if(null!==l)for(let n=Math.max(0,s.start),r=Math.min(l.count,s.start+s.count);n<r;n++){const r=l.getX(n);pf.fromBufferAttribute(c,r),mf(pf,r,o,i,e,t,this)}else for(let n=Math.max(0,s.start),r=Math.min(c.count,s.start+s.count);n<r;n++)pf.fromBufferAttribute(c,n),mf(pf,n,o,i,e,t,this)}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function mf(e,t,n,i,r,s,a){const o=hf.distanceSqToPoint(e);if(o<n){const n=new wu;hf.closestPointToPoint(e,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:n,index:t,face:null,faceIndex:null,barycoord:null,object:a})}}class gf{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let s=1;s<=e;s++)n=this.getPoint(s/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const r=n.length;let s;s=t||e*n[r-1];let a,o=0,l=r-1;for(;o<=l;)if(i=Math.floor(o+(l-o)/2),a=n[i]-s,a<0)o=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(i=l,n[i]===s)return i/(r-1);const c=n[i];return(i+(s-c)/(n[i+1]-c))/(r-1)}getTangent(e,t){const n=1e-4;let i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);const s=this.getPoint(i),a=this.getPoint(r),o=t||(s.isVector2?new nu:new wu);return o.copy(a).sub(s).normalize(),o}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new wu,i=[],r=[],s=[],a=new wu,o=new Ju;for(let t=0;t<=e;t++){const n=t/e;i[t]=this.getTangentAt(n,new wu)}r[0]=new wu,s[0]=new wu;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),u=Math.abs(i[0].y),h=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],a),s[0].crossVectors(i[0],r[0]);for(let t=1;t<=e;t++){if(r[t]=r[t-1].clone(),s[t]=s[t-1].clone(),a.crossVectors(i[t-1],i[t]),a.length()>Number.EPSILON){a.normalize();const e=Math.acos(Zc(i[t-1].dot(i[t]),-1,1));r[t].applyMatrix4(o.makeRotationAxis(a,e))}s[t].crossVectors(i[t],r[t])}if(!0===t){let t=Math.acos(Zc(r[0].dot(r[e]),-1,1));t/=e,i[0].dot(a.crossVectors(r[0],r[e]))>0&&(t=-t);for(let n=1;n<=e;n++)r[n].applyMatrix4(o.makeRotationAxis(i[n],t*n)),s[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}function vf(e,t,n,i,r){let s,a;if(r===function(e,t,n,i){let r=0;for(let s=t,a=n-i;s<n;s+=i)r+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return r}(e,t,n,i)>0)for(s=t;s<n;s+=i)a=Uf(s,e[s],e[s+1],a);else for(s=n-i;s>=t;s-=i)a=Uf(s,e[s],e[s+1],a);return a&&If(a,a.next)&&(Ff(a),a=a.next),a}function yf(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!If(i,i.next)&&0!==kf(i.prev,i,i.next))i=i.next;else{if(Ff(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function bf(e,t,n,i,r,s,a){if(!e)return;!a&&s&&function(e,t,n,i){let r=e;do{0===r.z&&(r.z=Af(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,n,i,r,s,a,o,l,c=1;do{for(n=e,e=null,s=null,a=0;n;){for(a++,i=n,o=0,t=0;t<c&&(o++,i=i.nextZ,i);t++);for(l=c;o>0||l>0&&i;)0!==o&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,o--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(a>1)}(r)}(e,i,r,s);let o,l,c=e;for(;e.prev!==e.next;)if(o=e.prev,l=e.next,s?_f(e,i,r,s):xf(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),Ff(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?bf(e=wf(yf(e),t,n),t,n,i,r,s,2):2===a&&Sf(e,t,n,i,r,s):bf(yf(e),t,n,i,r,s,1);break}}function xf(e){const t=e.prev,n=e,i=e.next;if(kf(t,n,i)>=0)return!1;const r=t.x,s=n.x,a=i.x,o=t.y,l=n.y,c=i.y,u=r<s?r<a?r:a:s<a?s:a,h=o<l?o<c?o:c:l<c?l:c,d=r>s?r>a?r:a:s>a?s:a,p=o>l?o>c?o:c:l>c?l:c;let f=i.next;for(;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&Rf(r,o,s,l,a,c,f.x,f.y)&&kf(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function _f(e,t,n,i){const r=e.prev,s=e,a=e.next;if(kf(r,s,a)>=0)return!1;const o=r.x,l=s.x,c=a.x,u=r.y,h=s.y,d=a.y,p=o<l?o<c?o:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=o>l?o>c?o:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,v=Af(p,f,t,n,i),y=Af(m,g,t,n,i);let b=e.prevZ,x=e.nextZ;for(;b&&b.z>=v&&x&&x.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==a&&Rf(o,u,l,h,c,d,b.x,b.y)&&kf(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==a&&Rf(o,u,l,h,c,d,x.x,x.y)&&kf(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;b&&b.z>=v;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==a&&Rf(o,u,l,h,c,d,b.x,b.y)&&kf(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==a&&Rf(o,u,l,h,c,d,x.x,x.y)&&kf(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function wf(e,t,n){let i=e;do{const r=i.prev,s=i.next.next;!If(r,s)&&Of(r,i,i.next,s)&&Df(r,s)&&Df(s,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(s.i/n|0),Ff(i),Ff(i.next),i=e=s),i=i.next}while(i!==e);return yf(i)}function Sf(e,t,n,i,r,s){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&Pf(a,e)){let o=zf(a,e);return a=yf(a,a.next),o=yf(o,o.next),bf(a,t,n,i,r,s,0),void bf(o,t,n,i,r,s,0)}e=e.next}a=a.next}while(a!==e)}function Mf(e,t){return e.x-t.x}function Ef(e,t){const n=function(e,t){let n,i=t,r=-1/0;const s=e.x,a=e.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const e=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=s&&e>r&&(r=e,n=i.x<i.next.x?i:i.next,e===s))return n}i=i.next}while(i!==t);if(!n)return null;const o=n,l=n.x,c=n.y;let u,h=1/0;i=n;do{s>=i.x&&i.x>=l&&s!==i.x&&Rf(a<c?s:r,a,l,c,a<c?r:s,a,i.x,i.y)&&(u=Math.abs(a-i.y)/(s-i.x),Df(i,e)&&(u<h||u===h&&(i.x>n.x||i.x===n.x&&Tf(n,i)))&&(n=i,h=u)),i=i.next}while(i!==o);return n}(e,t);if(!n)return t;const i=zf(n,e);return yf(i,i.next),yf(n,n.next)}function Tf(e,t){return kf(e.prev,e,t.prev)<0&&kf(t.next,e,e.next)<0}function Af(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Cf(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Rf(e,t,n,i,r,s,a,o){return(r-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(i-o)>=(n-a)*(t-o)&&(n-a)*(s-o)>=(r-a)*(i-o)}function Pf(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Of(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Df(e,t)&&Df(t,e)&&function(e,t){let n=e,i=!1;const r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(kf(e.prev,e,t.prev)||kf(e,t.prev,t))||If(e,t)&&kf(e.prev,e,e.next)>0&&kf(t.prev,t,t.next)>0)}function kf(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function If(e,t){return e.x===t.x&&e.y===t.y}function Of(e,t,n,i){const r=Nf(kf(e,t,n)),s=Nf(kf(e,t,i)),a=Nf(kf(n,i,e)),o=Nf(kf(n,i,t));return r!==s&&a!==o||!(0!==r||!Lf(e,n,t))||!(0!==s||!Lf(e,i,t))||!(0!==a||!Lf(n,e,i))||!(0!==o||!Lf(n,t,i))}function Lf(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Nf(e){return e>0?1:e<0?-1:0}function Df(e,t){return kf(e.prev,e,e.next)<0?kf(e,t,e.next)>=0&&kf(e,e.prev,t)>=0:kf(e,t,e.prev)<0||kf(e,e.next,t)<0}function zf(e,t){const n=new Bf(e.i,e.x,e.y),i=new Bf(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function Uf(e,t,n,i){const r=new Bf(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Ff(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Bf(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Vf{static area(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}static isClockWise(e){return Vf.area(e)<0}static triangulateShape(e,t){const n=[],i=[],r=[];jf(e),Hf(n,e);let s=e.length;t.forEach(jf);for(let e=0;e<t.length;e++)i.push(s),s+=t[e].length,Hf(n,t[e]);const a=function(e,t,n=2){const i=t&&t.length,r=i?t[0]*n:e.length;let s=vf(e,0,r,n,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c,u,h,d,p;if(i&&(s=function(e,t,n,i){const r=[];let s,a,o,l,c;for(s=0,a=t.length;s<a;s++)o=t[s]*i,l=s<a-1?t[s+1]*i:e.length,c=vf(e,o,l,i,!1),c===c.next&&(c.steiner=!0),r.push(Cf(c));for(r.sort(Mf),s=0;s<r.length;s++)n=Ef(r[s],n);return n}(e,t,s,n)),e.length>80*n){o=c=e[0],l=u=e[1];for(let t=n;t<r;t+=n)h=e[t],d=e[t+1],h<o&&(o=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-o,u-l),p=0!==p?32767/p:0}return bf(s,a,n,o,l,p,0),a}(n,i);for(let e=0;e<a.length;e+=3)r.push(a.slice(e,e+3));return r}}function jf(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Hf(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Gf extends qh{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Gh(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Gh(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new nu(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new lh,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Wf extends Gf{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new nu(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Zc(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Gh(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Gh(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Gh(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Xf extends qh{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Gh(16777215),this.specular=new Gh(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Gh(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new nu(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new lh,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class qf extends qh{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Gh(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Gh(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new nu(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new lh,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}function Yf(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function $f(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n}function Zf(e,t,n){const i=e.length,r=new e.constructor(i);for(let s=0,a=0;a!==i;++s){const i=n[s]*t;for(let n=0;n!==t;++n)r[a++]=e[i+n]}return r}function Kf(e,t,n,i){let r=1,s=e[0];for(;void 0!==s&&void 0===s[i];)s=e[r++];if(void 0===s)return;let a=s[i];if(void 0!==a)if(Array.isArray(a))do{a=s[i],void 0!==a&&(t.push(s.time),n.push.apply(n,a)),s=e[r++]}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[i],void 0!==a&&(t.push(s.time),a.toArray(n,n.length)),s=e[r++]}while(void 0!==s);else do{a=s[i],void 0!==a&&(t.push(s.time),n.push(a)),s=e[r++]}while(void 0!==s)}class Jf{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let s;n:{i:if(!(e<i)){for(let s=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(r=i,i=t[++n],e<i)break t}s=t.length;break n}if(e>=r)break e;{const a=t[1];e<a&&(n=2,r=a);for(let s=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(i=r,r=t[--n-1],e>=r)break t}s=n,n=0}}for(;n<s;){const i=n+s>>>1;e<t[i]?s=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let e=0;e!==i;++e)t[e]=n[r+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Qf extends Jf{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,s=e+1,a=i[r],o=i[s];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:r=e,a=2*t-n;break;case 2402:r=i.length-2,a=t+i[r]-i[r+1];break;default:r=e,a=n}if(void 0===o)switch(this.getSettings_().endingEnd){case 2401:s=e,o=2*n-t;break;case 2402:s=1,o=n+i[1]-i[0];break;default:s=e-1,o=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-n),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(i-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,b=d*m-d*f;for(let e=0;e!==a;++e)r[e]=g*s[c+e]+v*s[l+e]+y*s[o+e]+b*s[u+e];return r}}class em extends Jf{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=(n-t)/(i-t),u=1-c;for(let e=0;e!==a;++e)r[e]=s[l+e]*u+s[o+e]*c;return r}}class tm extends Jf{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class nm{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Yf(t,this.TimeBufferType),this.values=Yf(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Yf(e.times,Array),values:Yf(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new tm(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new em(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Qf(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Pc:t=this.InterpolantFactoryMethodDiscrete;break;case kc:t=this.InterpolantFactoryMethodLinear;break;case Ic:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Pc;case this.InterpolantFactoryMethodLinear:return kc;case this.InterpolantFactoryMethodSmooth:return Ic}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,s=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==s&&n[s]>t;)--s;if(++s,0!==r||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);const e=this.getValueSize();this.times=n.slice(r,s),this.values=this.values.slice(r*e,s*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let t=0;t!==r;t++){const i=n[t];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,i),e=!1;break}if(null!==s&&s>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,i,s),e=!1;break}s=i}if(void 0!==i&&(a=i,ArrayBuffer.isView(a)&&!(a instanceof DataView)))for(let t=0,n=i.length;t!==n;++t){const n=i[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}var a;return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===Ic,r=e.length-1;let s=1;for(let a=1;a<r;++a){let r=!1;const o=e[a];if(o!==e[a+1]&&(1!==a||o!==e[0]))if(i)r=!0;else{const e=a*n,i=e-n,s=e+n;for(let a=0;a!==n;++a){const n=t[e+a];if(n!==t[i+a]||n!==t[s+a]){r=!0;break}}}if(r){if(a!==s){e[s]=e[a];const i=a*n,r=s*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++s}}if(r>0){e[s]=e[r];for(let e=r*n,i=s*n,a=0;a!==n;++a)t[i+a]=t[e+a];++s}return s!==e.length?(this.times=e.slice(0,s),this.values=t.slice(0,s*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}nm.prototype.TimeBufferType=Float32Array,nm.prototype.ValueBufferType=Float32Array,nm.prototype.DefaultInterpolation=kc;class im extends nm{constructor(e,t,n){super(e,t,n)}}im.prototype.ValueTypeName="bool",im.prototype.ValueBufferType=Array,im.prototype.DefaultInterpolation=Pc,im.prototype.InterpolantFactoryMethodLinear=void 0,im.prototype.InterpolantFactoryMethodSmooth=void 0;class rm extends nm{}rm.prototype.ValueTypeName="color";class sm extends nm{}sm.prototype.ValueTypeName="number";class am extends Jf{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(n-t)/(i-t);let l=e*a;for(let e=l+a;l!==e;l+=4)_u.slerpFlat(r,0,s,l-a,s,l,o);return r}}class om extends nm{InterpolantFactoryMethodLinear(e){return new am(this.times,this.values,this.getValueSize(),e)}}om.prototype.ValueTypeName="quaternion",om.prototype.InterpolantFactoryMethodSmooth=void 0;class lm extends nm{constructor(e,t,n){super(e,t,n)}}lm.prototype.ValueTypeName="string",lm.prototype.ValueBufferType=Array,lm.prototype.DefaultInterpolation=Pc,lm.prototype.InterpolantFactoryMethodLinear=void 0,lm.prototype.InterpolantFactoryMethodSmooth=void 0;class cm extends nm{}cm.prototype.ValueTypeName="vector";class um{constructor(e="",t=-1,n=[],i=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=$c(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let e=0,r=n.length;e!==r;++e)t.push(hm(n[e]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,i=n.length;e!==i;++e)t.push(nm.toJSON(n[e]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,s=[];for(let e=0;e<r;e++){let a=[],o=[];a.push((e+r-1)%r,e,(e+1)%r),o.push(0,1,0);const l=$f(a);a=Zf(a,1,l),o=Zf(o,1,l),i||0!==a[0]||(a.push(r),o.push(o[0])),s.push(new sm(".morphTargetInfluences["+t[e].name+"]",a,o).scale(1/n))}return new this(e,-1,s)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],s=n.name.match(r);if(s&&s.length>1){const e=s[1];let t=i[e];t||(i[e]=t=[]),t.push(n)}}const s=[];for(const e in i)s.push(this.CreateFromMorphTargetSequence(e,i[e],t,n));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,i,r){if(0!==n.length){const s=[],a=[];Kf(n,s,a,i),0!==s.length&&r.push(new e(t,s,a))}},i=[],r=e.name||"default",s=e.fps||30,a=e.blendMode;let o=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const r=l[e].keys;if(r&&0!==r.length)if(r[0].morphTargets){const e={};let t;for(t=0;t<r.length;t++)if(r[t].morphTargets)for(let n=0;n<r[t].morphTargets.length;n++)e[r[t].morphTargets[n]]=-1;for(const n in e){const e=[],s=[];for(let i=0;i!==r[t].morphTargets.length;++i){const i=r[t];e.push(i.time),s.push(i.morphTarget===n?1:0)}i.push(new sm(".morphTargetInfluence["+n+"]",e,s))}o=e.length*s}else{const s=".bones["+t[e].name+"]";n(cm,s+".position",r,"pos",i),n(om,s+".quaternion",r,"rot",i),n(cm,s+".scale",r,"scl",i)}}return 0===i.length?null:new this(r,o,i,a)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function hm(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return sm;case"vector":case"vector2":case"vector3":case"vector4":return cm;case"color":return rm;case"quaternion":return om;case"bool":case"boolean":return im;case"string":return lm}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];Kf(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const dm={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class pm{constructor(e,t,n){const i=this;let r,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===s&&void 0!==i.onStart&&i.onStart(e,a,o),s=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,o),a===o&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}}const fm=new pm;class mm{constructor(e){this.manager=void 0!==e?e:fm,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}mm.DEFAULT_MATERIAL_NAME="__DEFAULT";const gm={};class vm extends Error{constructor(e,t){super(e),this.response=t}}class ym extends mm{constructor(e){super(e)}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=dm.get(e);if(void 0!==r)return this.manager.itemStart(e),setTimeout((()=>{t&&t(r),this.manager.itemEnd(e)}),0),r;if(void 0!==gm[e])return void gm[e].push({onLoad:t,onProgress:n,onError:i});gm[e]=[],gm[e].push({onLoad:t,onProgress:n,onError:i});const s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=gm[e],i=t.body.getReader(),r=t.headers.get("X-File-Size")||t.headers.get("Content-Length"),s=r?parseInt(r):0,a=0!==s;let o=0;const l=new ReadableStream({start(e){!function t(){i.read().then((({done:i,value:r})=>{if(i)e.close();else{o+=r.byteLength;const i=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:s});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(i)}e.enqueue(r),t()}}),(t=>{e.error(t)}))}()}});return new Response(l)}throw new vm(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)})).then((e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,a)));case"json":return e.json();default:if(void 0===a)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(a),n=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(n);return e.arrayBuffer().then((e=>i.decode(e)))}}})).then((t=>{dm.add(e,t);const n=gm[e];delete gm[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onLoad&&i.onLoad(t)}})).catch((t=>{const n=gm[e];if(void 0===n)throw this.manager.itemError(e),t;delete gm[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class bm extends mm{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=dm.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;const a=su("img");function o(){c(),dm.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){c(),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}class xm extends mm{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new Np,a=new ym(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(e,(function(e){let n;try{n=r.parse(e)}catch(e){if(void 0===i)return void console.error(e);i(e)}void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=void 0!==n.wrapS?n.wrapS:Ec,s.wrapT=void 0!==n.wrapT?n.wrapT:Ec,s.magFilter=void 0!==n.magFilter?n.magFilter:Ac,s.minFilter=void 0!==n.minFilter?n.minFilter:Ac,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(s.colorSpace=n.colorSpace),void 0!==n.flipY&&(s.flipY=n.flipY),void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=Cc),1===n.mipmapCount&&(s.minFilter=Ac),void 0!==n.generateMipmaps&&(s.generateMipmaps=n.generateMipmaps),s.needsUpdate=!0,t&&t(s,n)}),n,i),s}}class _m extends mm{constructor(e){super(e)}load(e,t,n,i){const r=new bu,s=new bm(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}class wm extends Eh{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Gh(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(t.object.target=this.target.uuid),t}}const Sm=new Ju,Mm=new wu,Em=new wu;class Tm{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new nu(512,512),this.map=null,this.mapPass=null,this.matrix=new Ju,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Nd,this._frameExtents=new nu(1,1),this._viewportCount=1,this._viewports=[new xu(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Mm.setFromMatrixPosition(e.matrixWorld),t.position.copy(Mm),Em.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Em),t.updateMatrixWorld(),Sm.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Sm),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Sm)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Am extends Tm{constructor(){super(new Cd(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=2*Yc*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Cm extends wm{constructor(e,t,n=0,i=Math.PI/3,r=0,s=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Eh.DEFAULT_UP),this.updateMatrix(),this.target=new Eh,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new Am}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Rm=new Ju,Pm=new wu,km=new wu;class Im extends Tm{constructor(){super(new Cd(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new nu(4,2),this._viewportCount=6,this._viewports=[new xu(2,1,1,1),new xu(0,1,1,1),new xu(3,1,1,1),new xu(1,1,1,1),new xu(3,0,1,1),new xu(1,0,1,1)],this._cubeDirections=[new wu(1,0,0),new wu(-1,0,0),new wu(0,0,1),new wu(0,0,-1),new wu(0,1,0),new wu(0,-1,0)],this._cubeUps=[new wu(0,1,0),new wu(0,1,0),new wu(0,1,0),new wu(0,1,0),new wu(0,0,1),new wu(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Pm.setFromMatrixPosition(e.matrixWorld),n.position.copy(Pm),km.copy(n.position),km.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(km),n.updateMatrixWorld(),i.makeTranslation(-Pm.x,-Pm.y,-Pm.z),Rm.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Rm)}}class Om extends wm{constructor(e,t,n=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Im}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Lm extends Tm{constructor(){super(new yp(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Nm extends wm{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Eh.DEFAULT_UP),this.updateMatrix(),this.target=new Eh,this.shadow=new Lm}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Dm extends wm{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class zm{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),"undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class Um extends mm{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=dm.get(e);if(void 0!==s)return r.manager.itemStart(e),s.then?void s.then((n=>{t&&t(n),r.manager.itemEnd(e)})).catch((e=>{i&&i(e)})):(setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s);const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader;const o=fetch(e,a).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){return dm.add(e,n),t&&t(n),r.manager.itemEnd(e),n})).catch((function(t){i&&i(t),dm.remove(e),r.manager.itemError(e),r.manager.itemEnd(e)}));dm.add(e,o),r.manager.itemStart(e)}}const Fm="\\[\\]\\.:\\/",Bm=new RegExp("["+Fm+"]","g"),Vm="[^"+Fm+"]",jm="[^"+Fm.replace("\\.","")+"]",Hm=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Vm)+/(WCOD+)?/.source.replace("WCOD",jm)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Vm)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Vm)+"$"),Gm=["material","materials","bones","map"];class Wm{constructor(e,t,n){this.path=t,this.parsedPath=n||Wm.parseTrackName(t),this.node=Wm.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Wm.Composite(e,t,n):new Wm(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Bm,"")}static parseTrackName(e){const t=Hm.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==Gm.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t||r.uuid===t)return r;const s=n(r.children);if(s)return s}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=Wm.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const s=e[i];if(void 0===s){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Wm.Composite=class{constructor(e,t,n){const i=n||Wm.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Wm.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Wm.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Wm.prototype.GetterByBindingType=[Wm.prototype._getValue_direct,Wm.prototype._getValue_array,Wm.prototype._getValue_arrayElement,Wm.prototype._getValue_toArray],Wm.prototype.SetterByBindingTypeAndVersioning=[[Wm.prototype._setValue_direct,Wm.prototype._setValue_direct_setNeedsUpdate,Wm.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Wm.prototype._setValue_array,Wm.prototype._setValue_array_setNeedsUpdate,Wm.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Wm.prototype._setValue_arrayElement,Wm.prototype._setValue_arrayElement_setNeedsUpdate,Wm.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Wm.prototype._setValue_fromArray,Wm.prototype._setValue_fromArray_setNeedsUpdate,Wm.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1),"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"169"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="169");const Xm=new Gh;class qm extends mm{constructor(e){super(e),this.propertyNameMapping={},this.customPropertyMapping={}}load(e,t,n,i){const r=this,s=new ym(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{t(r.parse(n))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}setPropertyNameMapping(e){this.propertyNameMapping=e}setCustomPropertyNameMapping(e){this.customPropertyMapping=e}parse(e){function t(e,t=0){let n="";const i=/^ply([\s\S]*)end_header(\r\n|\r|\n)/.exec(e);null!==i&&(n=i[1]);const r={comments:[],elements:[],headerLength:t,objInfo:""},s=n.split(/\r\n|\r|\n/);let a;function o(e,t){const n={type:e[0]};return"list"===n.type?(n.name=e[3],n.countType=e[1],n.itemType=e[2]):n.name=e[1],n.name in t&&(n.name=t[n.name]),n}for(let e=0;e<s.length;e++){let t=s[e];if(t=t.trim(),""===t)continue;const n=t.split(/\s+/),i=n.shift();switch(t=n.join(" "),i){case"format":r.format=n[0],r.version=n[1];break;case"comment":r.comments.push(t);break;case"element":void 0!==a&&r.elements.push(a),a={},a.name=n[0],a.count=parseInt(n[1]),a.properties=[];break;case"property":a.properties.push(o(n,d.propertyNameMapping));break;case"obj_info":r.objInfo=t;break;default:console.log("unhandled",i,n)}}return void 0!==a&&r.elements.push(a),r}function n(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function i(e,t){const i={};for(let r=0;r<e.length;r++){if(t.empty())return null;if("list"===e[r].type){const s=[],a=n(t.next(),e[r].countType);for(let i=0;i<a;i++){if(t.empty())return null;s.push(n(t.next(),e[r].itemType))}i[e[r].name]=s}else i[e[r].name]=n(t.next(),e[r].type)}return i}function r(){const e={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[],faceVertexColors:[]};for(const t of Object.keys(d.customPropertyMapping))e[t]=[];return e}function s(e){const t=e.map((e=>e.name));function n(e){for(let n=0,i=e.length;n<i;n++){const i=e[n];if(t.includes(i))return i}return null}return{attrX:n(["x","px","posx"])||"x",attrY:n(["y","py","posy"])||"y",attrZ:n(["z","pz","posz"])||"z",attrNX:n(["nx","normalx"]),attrNY:n(["ny","normaly"]),attrNZ:n(["nz","normalz"]),attrS:n(["s","u","texture_u","tx"]),attrT:n(["t","v","texture_v","ty"]),attrR:n(["red","diffuse_red","r","diffuse_r"]),attrG:n(["green","diffuse_green","g","diffuse_g"]),attrB:n(["blue","diffuse_blue","b","diffuse_b"])}}function a(e,t){const n=r();let a,c;a=null!==(c=/end_header\s+(\S[\s\S]*\S|\S)\s*$/.exec(e))?c[1].split(/\s+/):[];const u=new Ym(a);e:for(let e=0;e<t.elements.length;e++){const r=t.elements[e],a=s(r.properties);for(let e=0;e<r.count;e++){const e=i(r.properties,u);if(!e)break e;l(n,r.name,e,a)}}return o(n)}function o(e){let t=new ld;e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new ed(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new ed(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new ed(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new ed(e.colors,3)),(e.faceVertexUvs.length>0||e.faceVertexColors.length>0)&&(t=t.toNonIndexed(),e.faceVertexUvs.length>0&&t.setAttribute("uv",new ed(e.faceVertexUvs,2)),e.faceVertexColors.length>0&&t.setAttribute("color",new ed(e.faceVertexColors,3)));for(const n of Object.keys(d.customPropertyMapping))e[n].length>0&&t.setAttribute(n,new ed(e[n],d.customPropertyMapping[n].length));return t.computeBoundingSphere(),t}function l(e,t,n,i){if("vertex"===t){e.vertices.push(n[i.attrX],n[i.attrY],n[i.attrZ]),null!==i.attrNX&&null!==i.attrNY&&null!==i.attrNZ&&e.normals.push(n[i.attrNX],n[i.attrNY],n[i.attrNZ]),null!==i.attrS&&null!==i.attrT&&e.uvs.push(n[i.attrS],n[i.attrT]),null!==i.attrR&&null!==i.attrG&&null!==i.attrB&&(Xm.setRGB(n[i.attrR]/255,n[i.attrG]/255,n[i.attrB]/255,Oc),e.colors.push(Xm.r,Xm.g,Xm.b));for(const t of Object.keys(d.customPropertyMapping))for(const i of d.customPropertyMapping[t])e[t].push(n[i])}else if("face"===t){const t=n.vertex_indices||n.vertex_index,r=n.texcoord;3===t.length?(e.indices.push(t[0],t[1],t[2]),r&&6===r.length&&(e.faceVertexUvs.push(r[0],r[1]),e.faceVertexUvs.push(r[2],r[3]),e.faceVertexUvs.push(r[4],r[5]))):4===t.length&&(e.indices.push(t[0],t[1],t[3]),e.indices.push(t[1],t[2],t[3])),null!==i.attrR&&null!==i.attrG&&null!==i.attrB&&(Xm.setRGB(n[i.attrR]/255,n[i.attrG]/255,n[i.attrB]/255,Oc),e.faceVertexColors.push(Xm.r,Xm.g,Xm.b),e.faceVertexColors.push(Xm.r,Xm.g,Xm.b),e.faceVertexColors.push(Xm.r,Xm.g,Xm.b))}}function c(e,t){const n={};let i=0;for(let r=0;r<t.length;r++){const s=t[r],a=s.valueReader;if("list"===s.type){const t=[],r=s.countReader.read(e+i);i+=s.countReader.size;for(let n=0;n<r;n++)t.push(a.read(e+i)),i+=a.size;n[s.name]=t}else n[s.name]=a.read(e+i),i+=a.size}return[n,i]}function u(e,t,n){function i(e,t,n){switch(t){case"int8":case"char":return{read:t=>e.getInt8(t),size:1};case"uint8":case"uchar":return{read:t=>e.getUint8(t),size:1};case"int16":case"short":return{read:t=>e.getInt16(t,n),size:2};case"uint16":case"ushort":return{read:t=>e.getUint16(t,n),size:2};case"int32":case"int":return{read:t=>e.getInt32(t,n),size:4};case"uint32":case"uint":return{read:t=>e.getUint32(t,n),size:4};case"float32":case"float":return{read:t=>e.getFloat32(t,n),size:4};case"float64":case"double":return{read:t=>e.getFloat64(t,n),size:8}}}for(let r=0,s=e.length;r<s;r++){const s=e[r];"list"===s.type?(s.countReader=i(t,s.countType,n),s.valueReader=i(t,s.itemType,n)):s.valueReader=i(t,s.type,n)}}let h;const d=this;if(e instanceof ArrayBuffer){const n=new Uint8Array(e),{headerText:i,headerLength:d}=function(e){let t=0,n=!0,i="";const r=[],s=(new TextDecoder).decode(e.subarray(0,5)),a=/^ply\r\n/.test(s);do{const s=String.fromCharCode(e[t++]);"\n"!==s&&"\r"!==s?i+=s:("end_header"===i&&(n=!1),""!==i&&(r.push(i),i=""))}while(n&&t<e.length);return!0===a&&t++,{headerText:r.join("\r")+"\r",headerLength:t}}(n),p=t(i,d);h="ascii"===p.format?a((new TextDecoder).decode(n),p):function(e,t){const n=r(),i="binary_little_endian"===t.format,a=new DataView(e,t.headerLength);let h,d=0;for(let e=0;e<t.elements.length;e++){const r=t.elements[e],o=r.properties,p=s(o);u(o,a,i);for(let e=0;e<r.count;e++){h=c(d,o),d+=h[1];const e=h[0];l(n,r.name,e,p)}}return o(n)}(e,p)}else h=a(e,t(e));return h}}class Ym{constructor(e){this.arr=e,this.i=0}empty(){return this.i>=this.arr.length}next(){return this.arr[this.i++]}}const $m=function(){const e={};for(const t in new class{MODEL_LOAD;MODEL_ERROR;PROGRESS;constructor(e,t,n){this.MODEL_LOAD=e,this.MODEL_ERROR=t,this.PROGRESS=n}})e[t]=t;return Object.freeze(e)}();class Zm extends Event{static type="load";static defaultOptions={cancelable:!1,bubbles:!1};constructor(e={}){super("load",{...Zm.defaultOptions,...e})}}const Km=globalThis.ErrorEvent??Event;class Jm extends Km{static type="error";static defaultOptions={bubbles:!1,cancelable:!1};constructor(e="",t={}){e=Qm(e),super(Jm.type,{...Jm.defaultOptions,error:e,message:e.message,...t})}}function Qm(e){return e instanceof Error?e:e instanceof globalThis.ErrorEvent?e.error?e.error instanceof Error?e.error:new Error(String(e.error||"unknown error")):new Error(e.message||"unknown error"):new Error(String(e||"unknown error"))}var eg=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},tg=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let ng=(()=>{let e,t,n,i,r=[Yt],s=[],a=mc,o=[],l=[],c=[],u=[];return class extends a{static{t=this}static{const h="function"==typeof Symbol&&Symbol.metadata?Object.create(a[Symbol.metadata]??null):void 0;n=[ot,Xt],i=[Ue],eg(null,null,n,{kind:"field",name:"src",static:!1,private:!1,access:{has:e=>"src"in e,get:e=>e.src,set:(e,t)=>{e.src=t}},metadata:h},o,l),eg(null,null,i,{kind:"field",name:"model",static:!1,private:!1,access:{has:e=>"model"in e,get:e=>e.model,set:(e,t)=>{e.model=t}},metadata:h},c,u),eg(null,e={value:t},r,{kind:"class",name:t.name,metadata:h},null,s),t=e.value,h&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:h}),tg(t,s)}src=tg(this,o,"");loader=(tg(this,l),new qm);model=tg(this,c,null);_createComponent(){return this.model?this.model:new Do}#Mt=(tg(this,u),0);connectedCallback(){super.connectedCallback(),this.createEffect((()=>{this.src,this.#Et(),L((()=>{this.model?.dispose(),this.model=null,this.#Mt++}))}))}#Et(){const{src:e}=this,t=this.#Mt;e&&this.loader.load(e,(e=>t===this.#Mt&&this.#Tt(e)),(e=>t===this.#Mt&&(this.element.emit($m.PROGRESS,e),this.element.dispatchEvent(e))),(e=>t===this.#Mt&&this.#At(e)))}#At(e){const t=`Failed to load ${this.element.tagName.toLowerCase()} with src "${this.src}". See the following error.`;console.warn(t);const n=Qm(e);console.error(n),this.element.emit($m.MODEL_ERROR,n),this.element.dispatchEvent(new Jm(n))}#Tt(e){e.computeVertexNormals(),this.model=e,this.element.emit($m.MODEL_LOAD,{format:"ply",model:e}),this.element.dispatchEvent(new Zm)}},t})();globalThis.window?.document&&!elementBehaviors.has("ply-geometry")&&elementBehaviors.define("ply-geometry",ng);class ig{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let s=1;s<=e;s++)n=this.getPoint(s/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const r=n.length;let s;s=t||e*n[r-1];let a,o=0,l=r-1;for(;o<=l;)if(i=Math.floor(o+(l-o)/2),a=n[i]-s,a<0)o=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(i=l,n[i]===s)return i/(r-1);const c=n[i];return(i+(s-c)/(n[i+1]-c))/(r-1)}getTangent(e,t){const n=1e-4;let i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);const s=this.getPoint(i),a=this.getPoint(r),o=t||(s.isVector2?new da:new an);return o.copy(a).sub(s).normalize(),o}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new an,i=[],r=[],s=[],a=new an,o=new ur;for(let t=0;t<=e;t++){const n=t/e;i[t]=this.getTangentAt(n,new an)}r[0]=new an,s[0]=new an;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),u=Math.abs(i[0].y),h=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],a),s[0].crossVectors(i[0],r[0]);for(let t=1;t<=e;t++){if(r[t]=r[t-1].clone(),s[t]=s[t-1].clone(),a.crossVectors(i[t-1],i[t]),a.length()>Number.EPSILON){a.normalize();const e=Math.acos(en(i[t-1].dot(i[t]),-1,1));r[t].applyMatrix4(o.makeRotationAxis(a,e))}s[t].crossVectors(i[t],r[t])}if(!0===t){let t=Math.acos(en(r[0].dot(r[e]),-1,1));t/=e,i[0].dot(a.crossVectors(r[0],r[e]))>0&&(t=-t);for(let n=1;n<=e;n++)r[n].applyMatrix4(o.makeRotationAxis(i[n],t*n)),s[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class rg extends ig{constructor(e=0,t=0,n=1,i=1,r=0,s=2*Math.PI,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(e,t=new da){const n=t,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=s?0:i),!0!==this.aClockwise||s||(r===i?r=-i:r-=i);const a=this.aStartAngle+e*r;let o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=o-this.aX,i=l-this.aY;o=n*e-i*t+this.aX,l=n*t+i*e+this.aY}return n.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class sg extends rg{constructor(e,t,n,i,r,s){super(e,t,n,n,i,r,s),this.isArcCurve=!0,this.type="ArcCurve"}}function ag(){let e=0,t=0,n=0,i=0;function r(r,s,a,o){e=r,t=a,n=-3*r+3*s-2*a-o,i=2*r-2*s+a+o}return{initCatmullRom:function(e,t,n,i,s){r(t,n,s*(n-e),s*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,s,a,o){let l=(t-e)/s-(n-e)/(s+a)+(n-t)/a,c=(n-t)/a-(i-t)/(a+o)+(i-n)/o;l*=a,c*=a,r(t,n,l,c)},calc:function(r){const s=r*r;return e+t*r+n*s+i*(s*r)}}}const og=new an,lg=new ag,cg=new ag,ug=new ag;class hg extends ig{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new an){const n=t,i=this.points,r=i.length,s=(r-(this.closed?0:1))*e;let a,o,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?a=i[(l-1)%r]:(og.subVectors(i[0],i[1]).add(i[0]),a=og);const u=i[l%r],h=i[(l+1)%r];if(this.closed||l+2<r?o=i[(l+2)%r]:(og.subVectors(i[r-1],i[r-2]).add(i[r-1]),o=og),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(a.distanceToSquared(u),e),n=Math.pow(u.distanceToSquared(h),e),i=Math.pow(h.distanceToSquared(o),e);n<1e-4&&(n=1),t<1e-4&&(t=n),i<1e-4&&(i=n),lg.initNonuniformCatmullRom(a.x,u.x,h.x,o.x,t,n,i),cg.initNonuniformCatmullRom(a.y,u.y,h.y,o.y,t,n,i),ug.initNonuniformCatmullRom(a.z,u.z,h.z,o.z,t,n,i)}else"catmullrom"===this.curveType&&(lg.initCatmullRom(a.x,u.x,h.x,o.x,this.tension),cg.initCatmullRom(a.y,u.y,h.y,o.y,this.tension),ug.initCatmullRom(a.z,u.z,h.z,o.z,this.tension));return n.set(lg.calc(c),cg.calc(c),ug.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new an).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function dg(e,t,n,i,r){const s=.5*(i-t),a=.5*(r-n),o=e*e;return(2*n-2*i+s+a)*(e*o)+(-3*n+3*i-2*s-a)*o+s*e+n}function pg(e,t,n,i){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function fg(e,t,n,i,r){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}class mg extends ig{constructor(e=new da,t=new da,n=new da,i=new da){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new da){const n=t,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(fg(e,i.x,r.x,s.x,a.x),fg(e,i.y,r.y,s.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class gg extends ig{constructor(e=new an,t=new an,n=new an,i=new an){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new an){const n=t,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(fg(e,i.x,r.x,s.x,a.x),fg(e,i.y,r.y,s.y,a.y),fg(e,i.z,r.z,s.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class vg extends ig{constructor(e=new da,t=new da){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new da){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new da){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class yg extends ig{constructor(e=new an,t=new an){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new an){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new an){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class bg extends ig{constructor(e=new da,t=new da,n=new da){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new da){const n=t,i=this.v0,r=this.v1,s=this.v2;return n.set(pg(e,i.x,r.x,s.x),pg(e,i.y,r.y,s.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class xg extends ig{constructor(e=new an,t=new an,n=new an){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new an){const n=t,i=this.v0,r=this.v1,s=this.v2;return n.set(pg(e,i.x,r.x,s.x),pg(e,i.y,r.y,s.y),pg(e,i.z,r.z,s.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class _g extends ig{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new da){const n=t,i=this.points,r=(i.length-1)*e,s=Math.floor(r),a=r-s,o=i[0===s?s:s-1],l=i[s],c=i[s>i.length-2?i.length-1:s+1],u=i[s>i.length-3?i.length-1:s+2];return n.set(dg(a,o.x,l.x,c.x,u.x),dg(a,o.y,l.y,c.y,u.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new da).fromArray(n))}return this}}class wg extends ig{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new i[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const e=i[r]-n,s=this.curves[r],a=s.getLength(),o=0===a?0:1-e/a;return s.getPointAt(o,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const s=r[i],a=s.isEllipseCurve?2*e:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,o=s.getPoints(a);for(let e=0;e<o.length;e++){const i=o[e];n&&n.equals(i)||(t.push(i),n=i)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new i[n.type]).fromJSON(n))}return this}}class Sg extends wg{constructor(e){super(),this.type="Path",this.currentPoint=new da,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new vg(this.currentPoint.clone(),new da(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const r=new bg(this.currentPoint.clone(),new da(e,t),new da(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,s){const a=new mg(this.currentPoint.clone(),new da(e,t),new da(n,i),new da(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new _g(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,s){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,n,i,r,s),this}absarc(e,t,n,i,r,s){return this.absellipse(e,t,n,n,i,r,s),this}ellipse(e,t,n,i,r,s,a,o){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,i,r,s,a,o),this}absellipse(e,t,n,i,r,s,a,o){const l=new rg(e,t,n,i,r,s,a,o);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Mg extends Sg{constructor(e){super(e),this.uuid=Qt(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new Sg).fromJSON(n))}return this}}function Eg(e,t,n,i,r){let s,a;if(r===function(e,t,n,i){let r=0;for(let s=t,a=n-i;s<n;s+=i)r+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return r}(e,t,n,i)>0)for(s=t;s<n;s+=i)a=Xg(s,e[s],e[s+1],a);else for(s=n-i;s>=t;s-=i)a=Xg(s,e[s],e[s+1],a);return a&&Bg(a,a.next)&&(qg(a),a=a.next),a}function Tg(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!Bg(i,i.next)&&0!==Fg(i.prev,i,i.next))i=i.next;else{if(qg(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function Ag(e,t,n,i,r,s,a){if(!e)return;!a&&s&&function(e,t,n,i){let r=e;do{0===r.z&&(r.z=Ng(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,n,i,r,s,a,o,l,c=1;do{for(n=e,e=null,s=null,a=0;n;){for(a++,i=n,o=0,t=0;t<c&&(o++,i=i.nextZ,i);t++);for(l=c;o>0||l>0&&i;)0!==o&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,o--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(a>1)}(r)}(e,i,r,s);let o,l,c=e;for(;e.prev!==e.next;)if(o=e.prev,l=e.next,s?Rg(e,i,r,s):Cg(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),qg(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?Ag(e=Pg(Tg(e),t,n),t,n,i,r,s,2):2===a&&kg(e,t,n,i,r,s):Ag(Tg(e),t,n,i,r,s,1);break}}function Cg(e){const t=e.prev,n=e,i=e.next;if(Fg(t,n,i)>=0)return!1;const r=t.x,s=n.x,a=i.x,o=t.y,l=n.y,c=i.y,u=r<s?r<a?r:a:s<a?s:a,h=o<l?o<c?o:c:l<c?l:c,d=r>s?r>a?r:a:s>a?s:a,p=o>l?o>c?o:c:l>c?l:c;let f=i.next;for(;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&zg(r,o,s,l,a,c,f.x,f.y)&&Fg(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Rg(e,t,n,i){const r=e.prev,s=e,a=e.next;if(Fg(r,s,a)>=0)return!1;const o=r.x,l=s.x,c=a.x,u=r.y,h=s.y,d=a.y,p=o<l?o<c?o:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=o>l?o>c?o:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,v=Ng(p,f,t,n,i),y=Ng(m,g,t,n,i);let b=e.prevZ,x=e.nextZ;for(;b&&b.z>=v&&x&&x.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==a&&zg(o,u,l,h,c,d,b.x,b.y)&&Fg(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==a&&zg(o,u,l,h,c,d,x.x,x.y)&&Fg(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;b&&b.z>=v;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==a&&zg(o,u,l,h,c,d,b.x,b.y)&&Fg(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==a&&zg(o,u,l,h,c,d,x.x,x.y)&&Fg(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Pg(e,t,n){let i=e;do{const r=i.prev,s=i.next.next;!Bg(r,s)&&Vg(r,i,i.next,s)&&Gg(r,s)&&Gg(s,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(s.i/n|0),qg(i),qg(i.next),i=e=s),i=i.next}while(i!==e);return Tg(i)}function kg(e,t,n,i,r,s){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&Ug(a,e)){let o=Wg(a,e);return a=Tg(a,a.next),o=Tg(o,o.next),Ag(a,t,n,i,r,s,0),void Ag(o,t,n,i,r,s,0)}e=e.next}a=a.next}while(a!==e)}function Ig(e,t){return e.x-t.x}function Og(e,t){const n=function(e,t){let n,i=t,r=-1/0;const s=e.x,a=e.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const e=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=s&&e>r&&(r=e,n=i.x<i.next.x?i:i.next,e===s))return n}i=i.next}while(i!==t);if(!n)return null;const o=n,l=n.x,c=n.y;let u,h=1/0;i=n;do{s>=i.x&&i.x>=l&&s!==i.x&&zg(a<c?s:r,a,l,c,a<c?r:s,a,i.x,i.y)&&(u=Math.abs(a-i.y)/(s-i.x),Gg(i,e)&&(u<h||u===h&&(i.x>n.x||i.x===n.x&&Lg(n,i)))&&(n=i,h=u)),i=i.next}while(i!==o);return n}(e,t);if(!n)return t;const i=Wg(n,e);return Tg(i,i.next),Tg(n,n.next)}function Lg(e,t){return Fg(e.prev,e,t.prev)<0&&Fg(t.next,e,e.next)<0}function Ng(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Dg(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function zg(e,t,n,i,r,s,a,o){return(r-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(i-o)>=(n-a)*(t-o)&&(n-a)*(s-o)>=(r-a)*(i-o)}function Ug(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Vg(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Gg(e,t)&&Gg(t,e)&&function(e,t){let n=e,i=!1;const r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(Fg(e.prev,e,t.prev)||Fg(e,t.prev,t))||Bg(e,t)&&Fg(e.prev,e,e.next)>0&&Fg(t.prev,t,t.next)>0)}function Fg(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Bg(e,t){return e.x===t.x&&e.y===t.y}function Vg(e,t,n,i){const r=Hg(Fg(e,t,n)),s=Hg(Fg(e,t,i)),a=Hg(Fg(n,i,e)),o=Hg(Fg(n,i,t));return r!==s&&a!==o||!(0!==r||!jg(e,n,t))||!(0!==s||!jg(e,i,t))||!(0!==a||!jg(n,e,i))||!(0!==o||!jg(n,t,i))}function jg(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Hg(e){return e>0?1:e<0?-1:0}function Gg(e,t){return Fg(e.prev,e,e.next)<0?Fg(e,t,e.next)>=0&&Fg(e,e.prev,t)>=0:Fg(e,t,e.prev)<0||Fg(e,e.next,t)<0}function Wg(e,t){const n=new Yg(e.i,e.x,e.y),i=new Yg(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function Xg(e,t,n,i){const r=new Yg(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function qg(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Yg(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class $g{static area(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}static isClockWise(e){return $g.area(e)<0}static triangulateShape(e,t){const n=[],i=[],r=[];Zg(e),Kg(n,e);let s=e.length;t.forEach(Zg);for(let e=0;e<t.length;e++)i.push(s),s+=t[e].length,Kg(n,t[e]);const a=function(e,t,n=2){const i=t&&t.length,r=i?t[0]*n:e.length;let s=Eg(e,0,r,n,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c,u,h,d,p;if(i&&(s=function(e,t,n,i){const r=[];let s,a,o,l,c;for(s=0,a=t.length;s<a;s++)o=t[s]*i,l=s<a-1?t[s+1]*i:e.length,c=Eg(e,o,l,i,!1),c===c.next&&(c.steiner=!0),r.push(Dg(c));for(r.sort(Ig),s=0;s<r.length;s++)n=Og(r[s],n);return n}(e,t,s,n)),e.length>80*n){o=c=e[0],l=u=e[1];for(let t=n;t<r;t+=n)h=e[t],d=e[t+1],h<o&&(o=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-o,u-l),p=0!==p?32767/p:0}return Ag(s,a,n,o,l,p,0),a}(n,i);for(let e=0;e<a.length;e+=3)r.push(a.slice(e,e+3));return r}}function Zg(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Kg(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Jg extends Do{constructor(e=new Mg([new da(.5,.5),new da(-.5,.5),new da(-.5,-.5),new da(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let t=0,n=e.length;t<n;t++)s(e[t]);function s(e){const s=[],a=void 0!==t.curveSegments?t.curveSegments:12,o=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:.2,h=void 0!==t.bevelSize?t.bevelSize:u-.1,d=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Qg;let g,v,y,b,x,_=!1;f&&(g=f.getSpacedPoints(o),_=!0,c=!1,v=f.computeFrenetFrames(o,!1),y=new an,b=new an,x=new an),c||(p=0,u=0,h=0,d=0);const w=e.extractPoints(a);let S=w.shape;const M=w.holes;if(!$g.isClockWise(S)){S=S.reverse();for(let e=0,t=M.length;e<t;e++){const t=M[e];$g.isClockWise(t)&&(M[e]=t.reverse())}}const E=$g.triangulateShape(S,M),T=S;for(let e=0,t=M.length;e<t;e++){const t=M[e];S=S.concat(t)}function A(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}const C=S.length,R=E.length;function P(e,t,n){let i,r,s;const a=e.x-t.x,o=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=a*a+o*o,h=a*c-o*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=t.x-o/h,f=t.y+a/h,m=((n.x-c/d-p)*c-(n.y+l/d-f)*l)/(a*c-o*l);i=p+a*m-e.x,r=f+o*m-e.y;const g=i*i+r*r;if(g<=2)return new da(i,r);s=Math.sqrt(g/2)}else{let e=!1;a>Number.EPSILON?l>Number.EPSILON&&(e=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(c)&&(e=!0),e?(i=-o,r=a,s=Math.sqrt(u)):(i=a,r=o,s=Math.sqrt(u/2))}return new da(i/s,r/s)}const k=[];for(let e=0,t=T.length,n=t-1,i=e+1;e<t;e++,n++,i++)n===t&&(n=0),i===t&&(i=0),k[e]=P(T[e],T[n],T[i]);const I=[];let O,L=k.concat();for(let e=0,t=M.length;e<t;e++){const t=M[e];O=[];for(let e=0,n=t.length,i=n-1,r=e+1;e<n;e++,i++,r++)i===n&&(i=0),r===n&&(r=0),O[e]=P(t[e],t[i],t[r]);I.push(O),L=L.concat(O)}for(let e=0;e<p;e++){const t=e/p,n=u*Math.cos(t*Math.PI/2),i=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=T.length;e<t;e++){const t=A(T[e],k[e],i);z(t.x,t.y,-n)}for(let e=0,t=M.length;e<t;e++){const t=M[e];O=I[e];for(let e=0,r=t.length;e<r;e++){const r=A(t[e],O[e],i);z(r.x,r.y,-n)}}}const N=h+d;for(let e=0;e<C;e++){const t=c?A(S[e],L[e],N):S[e];_?(b.copy(v.normals[0]).multiplyScalar(t.x),y.copy(v.binormals[0]).multiplyScalar(t.y),x.copy(g[0]).add(b).add(y),z(x.x,x.y,x.z)):z(t.x,t.y,0)}for(let e=1;e<=o;e++)for(let t=0;t<C;t++){const n=c?A(S[t],L[t],N):S[t];_?(b.copy(v.normals[e]).multiplyScalar(n.x),y.copy(v.binormals[e]).multiplyScalar(n.y),x.copy(g[e]).add(b).add(y),z(x.x,x.y,x.z)):z(n.x,n.y,l/o*e)}for(let e=p-1;e>=0;e--){const t=e/p,n=u*Math.cos(t*Math.PI/2),i=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=T.length;e<t;e++){const t=A(T[e],k[e],i);z(t.x,t.y,l+n)}for(let e=0,t=M.length;e<t;e++){const t=M[e];O=I[e];for(let e=0,r=t.length;e<r;e++){const r=A(t[e],O[e],i);_?z(r.x,r.y+g[o-1].y,g[o-1].x+n):z(r.x,r.y,l+n)}}}function D(e,t){let n=e.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=e.length-1);for(let e=0,n=o+2*p;e<n;e++){const n=C*e,s=C*(e+1);F(t+i+n,t+r+n,t+r+s,t+i+s)}}}function z(e,t,n){s.push(e),s.push(t),s.push(n)}function U(e,t,r){B(e),B(t),B(r);const s=i.length/3,a=m.generateTopUV(n,i,s-3,s-2,s-1);V(a[0]),V(a[1]),V(a[2])}function F(e,t,r,s){B(e),B(t),B(s),B(t),B(r),B(s);const a=i.length/3,o=m.generateSideWallUV(n,i,a-6,a-3,a-2,a-1);V(o[0]),V(o[1]),V(o[3]),V(o[1]),V(o[2]),V(o[3])}function B(e){i.push(s[3*e+0]),i.push(s[3*e+1]),i.push(s[3*e+2])}function V(e){r.push(e.x),r.push(e.y)}!function(){const e=i.length/3;if(c){let e=0,t=C*e;for(let e=0;e<R;e++){const n=E[e];U(n[2]+t,n[1]+t,n[0]+t)}e=o+2*p,t=C*e;for(let e=0;e<R;e++){const n=E[e];U(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<R;e++){const t=E[e];U(t[2],t[1],t[0])}for(let e=0;e<R;e++){const t=E[e];U(t[0]+C*o,t[1]+C*o,t[2]+C*o)}}n.addGroup(e,i.length/3-e,0)}(),function(){const e=i.length/3;let t=0;D(T,t),t+=T.length;for(let e=0,n=M.length;e<n;e++){const n=M[e];D(n,t),t+=n.length}n.addGroup(e,i.length/3-e,1)}()}this.setAttribute("position",new So(i,3)),this.setAttribute("uv",new So(r,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,i=e.length;t<i;t++){const i=e[t];n.shapes.push(i.uuid)}else n.shapes.push(e.uuid);return n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let i=0,r=e.shapes.length;i<r;i++){const r=t[e.shapes[i]];n.push(r)}const r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=(new i[r.type]).fromJSON(r)),new Jg(n,e.options)}}const Qg={generateTopUV:function(e,t,n,i,r){const s=t[3*n],a=t[3*n+1],o=t[3*i],l=t[3*i+1],c=t[3*r],u=t[3*r+1];return[new da(s,a),new da(o,l),new da(c,u)]},generateSideWallUV:function(e,t,n,i,r,s){const a=t[3*n],o=t[3*n+1],l=t[3*n+2],c=t[3*i],u=t[3*i+1],h=t[3*i+2],d=t[3*r],p=t[3*r+1],f=t[3*r+2],m=t[3*s],g=t[3*s+1],v=t[3*s+2];return Math.abs(o-u)<Math.abs(a-c)?[new da(a,1-l),new da(c,1-h),new da(d,1-f),new da(m,1-v)]:[new da(o,1-l),new da(u,1-h),new da(p,1-f),new da(g,1-v)]}};class ev extends Do{constructor(e=new Mg([new da(0,.5),new da(-.5,-.5),new da(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],r=[],s=[];let a=0,o=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(a,o,t),a+=o,o=0;function l(e){const a=i.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===$g.isClockWise(c)&&(c=c.reverse());for(let e=0,t=u.length;e<t;e++){const t=u[e];!0===$g.isClockWise(t)&&(u[e]=t.reverse())}const h=$g.triangulateShape(c,u);for(let e=0,t=u.length;e<t;e++){const t=u[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];i.push(t.x,t.y,0),r.push(0,0,1),s.push(t.x,t.y)}for(let e=0,t=h.length;e<t;e++){const t=h[e],i=t[0]+a,r=t[1]+a,s=t[2]+a;n.push(i,r,s),o+=3}}this.setIndex(n),this.setAttribute("position",new So(i,3)),this.setAttribute("normal",new So(r,3)),this.setAttribute("uv",new So(s,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,i=e.length;n<i;n++){const i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let i=0,r=e.shapes.length;i<r;i++){const r=t[e.shapes[i]];n.push(r)}return new ev(n,e.curveSegments)}}var tv=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0},nv=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0};let iv=(()=>{let e,t,n,i,r,s,a=[Yt],o=[],l=mc,c=[],u=[],h=[],d=[],p=[];return class extends l{static{t=this}static{const f="function"==typeof Symbol&&Symbol.metadata?Object.create(l[Symbol.metadata]??null):void 0;n=[et({from:Number}),Xt],i=[et({from:Number}),Xt],r=[et,Xt],s=[et],nv(this,null,r,{kind:"getter",name:"quadraticCorners",static:!1,private:!1,access:{has:e=>"quadraticCorners"in e,get:e=>e.quadraticCorners},metadata:f},null,c),nv(this,null,s,{kind:"setter",name:"quadraticCorners",static:!1,private:!1,access:{has:e=>"quadraticCorners"in e,set:(e,t)=>{e.quadraticCorners=t}},metadata:f},null,c),nv(null,null,n,{kind:"field",name:"cornerRadius",static:!1,private:!1,access:{has:e=>"cornerRadius"in e,get:e=>e.cornerRadius,set:(e,t)=>{e.cornerRadius=t}},metadata:f},u,h),nv(null,null,i,{kind:"field",name:"thickness",static:!1,private:!1,access:{has:e=>"thickness"in e,get:e=>e.thickness,set:(e,t)=>{e.thickness=t}},metadata:f},d,p),nv(null,e={value:t},a,{kind:"class",name:t.name,metadata:f},null,o),t=e.value,f&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:f}),tv(t,o)}cornerRadius=(tv(this,c),tv(this,u,0));thickness=(tv(this,h),tv(this,d,0));#Ct=(tv(this,p),!1);get quadraticCorners(){return this.#Ct}set quadraticCorners(e){this.#Ct=null!==e&&"false"!==e}_createComponent(){let e,t=this.thickness;const n=new rv(0,0,this.element.calculatedSize.x,this.element.calculatedSize.y,this.cornerRadius,this.quadraticCorners);return e=t>0?new Jg(n,{bevelEnabled:!0,steps:1,bevelSegments:1,bevelSize:0,bevelThickness:0,depth:t}):new ev(n),e.translate(-this.element.calculatedSize.x/2,-this.element.calculatedSize.y/2,-t/2),e}},t})();globalThis.window?.document&&!elementBehaviors.has("rounded-rectangle-geometry")&&elementBehaviors.define("rounded-rectangle-geometry",iv);class rv extends Mg{constructor(e,t,n,i,r,s=!1){if(super(),s)return this.moveTo(e,t+r),this.lineTo(e,t+i-r),this.quadraticCurveTo(e,t+i,e+r,t+i),this.lineTo(e+n-r,t+i),this.quadraticCurveTo(e+n,t+i,e+n,t+i-r),this.lineTo(e+n,t+r),this.quadraticCurveTo(e+n,t,e+n-r,t),this.lineTo(e+r,t),void this.quadraticCurveTo(e,t,e,t+r);this.absarc(e+n-r,t+r,r,-Math.PI/2,0,!1),this.absarc(e+n-r,t+i-r,r,0,Math.PI/2,!1),this.absarc(e+r,t+i-r,r,Math.PI/2,Math.PI,!1),this.absarc(e+r,t+r,r,Math.PI,Math.PI+Math.PI/2,!1),this.lineTo(e+n-r,t)}}class sv{constructor(){this.type="ShapePath",this.color=new po,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Sg,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,r,s){return this.currentPath.bezierCurveTo(e,t,n,i,r,s),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){const n=t.length;let i=!1;for(let r=n-1,s=0;s<n;r=s++){let n=t[r],a=t[s],o=a.x-n.x,l=a.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[s],o=-o,a=t[r],l=-l),e.y<n.y||e.y>a.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-o*(e.y-n.y);if(0===t)return!0;if(t<0)continue;i=!i}}else{if(e.y!==n.y)continue;if(a.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=a.x)return!0}}return i}const n=$g.isClockWise,i=this.subPaths;if(0===i.length)return[];let r,s,a;const o=[];if(1===i.length)return s=i[0],a=new Mg,a.curves=s.curves,o.push(a),o;let l=!n(i[0].getPoints());l=e?!l:l;const c=[],u=[];let h,d,p=[],f=0;u[f]=void 0,p[f]=[];for(let t=0,a=i.length;t<a;t++)s=i[t],h=s.getPoints(),r=n(h),r=e?!r:r,r?(!l&&u[f]&&f++,u[f]={s:new Mg,p:h},u[f].s.curves=s.curves,l&&f++,p[f]=[]):p[f].push({h:s,p:h[0]});if(!u[0])return function(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n],r=new Mg;r.curves=i.curves,t.push(r)}return t}(i);if(u.length>1){let e=!1,n=0;for(let e=0,t=u.length;e<t;e++)c[e]=[];for(let i=0,r=u.length;i<r;i++){const r=p[i];for(let s=0;s<r.length;s++){const a=r[s];let o=!0;for(let r=0;r<u.length;r++)t(a.p,u[r].p)&&(i!==r&&n++,o?(o=!1,c[r].push(a)):e=!0);o&&c[i].push(a)}}n>0&&!1===e&&(p=c)}for(let e=0,t=u.length;e<t;e++){a=u[e].s,o.push(a),d=p[e];for(let e=0,t=d.length;e<t;e++)a.holes.push(d[e].h)}return o}}function av(e,t,n){if("string"!=typeof e)throw new TypeError("Invalid input: "+typeof e);const i={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/};let r=0,s=!0,a="",o="";const l=[];class c extends SyntaxError{partial}function u(e,t,n){const i=new c('Unexpected character "'+e+'" at index '+t+".");throw i.partial=n,i}function h(){""!==a&&(""===o?l.push(Number(a)):l.push(Number(a)*Math.pow(10,Number(o)))),a="",o=""}let d;const p=e.length;for(let c=0;c<p;c++)if(d=e[c],Array.isArray(t)&&t.includes(l.length%n)&&i.FLAGS.test(d))r=1,a=d,h();else{if(0===r){if(i.WHITESPACE.test(d))continue;if(i.DIGIT.test(d)||i.SIGN.test(d)){r=1,a=d;continue}if(i.POINT.test(d)){r=2,a=d;continue}i.COMMA.test(d)&&(s&&u(d,c,l),s=!0)}if(1===r){if(i.DIGIT.test(d)){a+=d;continue}if(i.POINT.test(d)){a+=d,r=2;continue}if(i.EXP.test(d)){r=3;continue}i.SIGN.test(d)&&1===a.length&&i.SIGN.test(a[0])&&u(d,c,l)}if(2===r){if(i.DIGIT.test(d)){a+=d;continue}if(i.EXP.test(d)){r=3;continue}i.POINT.test(d)&&"."===a[a.length-1]&&u(d,c,l)}if(3===r){if(i.DIGIT.test(d)){o+=d;continue}if(i.SIGN.test(d)){if(""===o){o+=d;continue}1===o.length&&i.SIGN.test(o)&&u(d,c,l)}}i.WHITESPACE.test(d)?(h(),r=0,s=!1):i.COMMA.test(d)?(h(),r=0,s=!0):i.SIGN.test(d)?(h(),r=1,a=d):i.POINT.test(d)?(h(),r=2,a=d):u(d,c,l)}return h(),l}function ov(e,t,n,i,r,s,a,o){if(0==t||0==n)return void e.lineTo(o.x,o.y);i=i*Math.PI/180,t=Math.abs(t),n=Math.abs(n);const l=(a.x-o.x)/2,c=(a.y-o.y)/2,u=Math.cos(i)*l+Math.sin(i)*c,h=-Math.sin(i)*l+Math.cos(i)*c;let d=t*t,p=n*n;const f=u*u,m=h*h,g=f/d+m/p;if(g>1){const e=Math.sqrt(g);d=(t*=e)*t,p=(n*=e)*n}const v=d*m+p*f,y=(d*p-v)/v;let b=Math.sqrt(Math.max(0,y));r===s&&(b=-b);const x=b*t*h/n,_=-b*n*u/t,w=Math.cos(i)*x-Math.sin(i)*_+(a.x+o.x)/2,S=Math.sin(i)*x+Math.cos(i)*_+(a.y+o.y)/2,M=cv(1,0,(u-x)/t,(h-_)/n),E=cv((u-x)/t,(h-_)/n,(-u-x)/t,(-h-_)/n)%(2*Math.PI);e.currentPath.absellipse(w,S,t,n,M,M+E,0===s,i)}function lv(e,t){return e-(t-e)}function cv(e,t,n,i){const r=e*n+t*i,s=Math.sqrt(e*e+t*t)*Math.sqrt(n*n+i*i);let a=Math.acos(Math.max(-1,Math.min(1,r/s)));return e*i-t*n<0&&(a=-a),a}var uv=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0},hv=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0};const dv=new Mg;dv.moveTo(5,5),dv.bezierCurveTo(5,5,4,0,0,0),dv.bezierCurveTo(-6,0,-6,7,-6,7),dv.bezierCurveTo(-6,11,-3,15.4,5,19),dv.bezierCurveTo(12,15.4,16,11,16,7),dv.bezierCurveTo(16,7,16,0,10,0),dv.bezierCurveTo(7,0,5,5,5,5);const pv=new Mg,fv=/^[mlhvcsqtaz][^a-z]/i;let mv=(()=>{let e,t,n,i,r,s,a,o,l,c,u=[Yt],h=[],d=mc,p=[],f=[],m=[],g=[],v=[],y=[],b=[],x=[],_=[],w=[],S=[],M=[],E=[];return class extends d{static{t=this}static{const T="function"==typeof Symbol&&Symbol.metadata?Object.create(d[Symbol.metadata]??null):void 0;n=[et,Xt],i=[et],r=[ct,Xt],s=[ht,Xt],a=[ct,Xt],o=[ct,Xt],l=[ht,Xt],c=[ot,Xt],hv(this,null,n,{kind:"getter",name:"shape",static:!1,private:!1,access:{has:e=>"shape"in e,get:e=>e.shape},metadata:T},null,p),hv(this,null,i,{kind:"setter",name:"shape",static:!1,private:!1,access:{has:e=>"shape"in e,set:(e,t)=>{e.shape=t}},metadata:T},null,p),hv(null,null,r,{kind:"field",name:"curveSegments",static:!1,private:!1,access:{has:e=>"curveSegments"in e,get:e=>e.curveSegments,set:(e,t)=>{e.curveSegments=t}},metadata:T},f,m),hv(null,null,s,{kind:"field",name:"bevel",static:!1,private:!1,access:{has:e=>"bevel"in e,get:e=>e.bevel,set:(e,t)=>{e.bevel=t}},metadata:T},g,v),hv(null,null,a,{kind:"field",name:"bevelSegments",static:!1,private:!1,access:{has:e=>"bevelSegments"in e,get:e=>e.bevelSegments,set:(e,t)=>{e.bevelSegments=t}},metadata:T},y,b),hv(null,null,o,{kind:"field",name:"bevelThickness",static:!1,private:!1,access:{has:e=>"bevelThickness"in e,get:e=>e.bevelThickness,set:(e,t)=>{e.bevelThickness=t}},metadata:T},x,_),hv(null,null,l,{kind:"field",name:"centerGeometry",static:!1,private:!1,access:{has:e=>"centerGeometry"in e,get:e=>e.centerGeometry,set:(e,t)=>{e.centerGeometry=t}},metadata:T},w,S),hv(null,null,c,{kind:"field",name:"fitment",static:!1,private:!1,access:{has:e=>"fitment"in e,get:e=>e.fitment,set:(e,t)=>{e.fitment=t}},metadata:T},M,E),hv(null,e={value:t},u,{kind:"class",name:t.name,metadata:T},null,h),t=e.value,T&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:T}),uv(t,h)}#Rt=(uv(this,p),(new Mg).copy(dv));get shape(){return this.#Rt}set shape(e){if(e)if("string"==typeof e&&(e=e.trim())&&e.match(fv)){const t=function(e){const t=new sv,n=new da,i=new da,r=new da;let s=!0,a=!1;if(!e)return console.error("Path has not `d` attribute."),t;const o=e.match(/[a-df-z][^a-df-z]*/gi);if(!o)return console.error("Empty or invalid path: ",e),t;for(let e=0,l=o.length;e<l;e++){const l=o[e],c=l.charAt(0),u=l.slice(1).trim();let h;switch(!0===s&&(a=!0,s=!1),c){case"M":h=av(u);for(let e=0,s=h.length;e<s;e+=2)n.x=h[e+0],n.y=h[e+1],i.x=n.x,i.y=n.y,0===e?t.moveTo(n.x,n.y):t.lineTo(n.x,n.y),0===e&&r.copy(n);break;case"H":h=av(u);for(let e=0,s=h.length;e<s;e++)n.x=h[e],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===a&&r.copy(n);break;case"V":h=av(u);for(let e=0,s=h.length;e<s;e++)n.y=h[e],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===a&&r.copy(n);break;case"L":h=av(u);for(let e=0,s=h.length;e<s;e+=2)n.x=h[e+0],n.y=h[e+1],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===a&&r.copy(n);break;case"C":h=av(u);for(let e=0,s=h.length;e<s;e+=6)t.bezierCurveTo(h[e+0],h[e+1],h[e+2],h[e+3],h[e+4],h[e+5]),i.x=h[e+2],i.y=h[e+3],n.x=h[e+4],n.y=h[e+5],0===e&&!0===a&&r.copy(n);break;case"S":h=av(u);for(let e=0,s=h.length;e<s;e+=4)t.bezierCurveTo(lv(n.x,i.x),lv(n.y,i.y),h[e+0],h[e+1],h[e+2],h[e+3]),i.x=h[e+0],i.y=h[e+1],n.x=h[e+2],n.y=h[e+3],0===e&&!0===a&&r.copy(n);break;case"Q":h=av(u);for(let e=0,s=h.length;e<s;e+=4)t.quadraticCurveTo(h[e+0],h[e+1],h[e+2],h[e+3]),i.x=h[e+0],i.y=h[e+1],n.x=h[e+2],n.y=h[e+3],0===e&&!0===a&&r.copy(n);break;case"T":h=av(u);for(let e=0,s=h.length;e<s;e+=2){const s=lv(n.x,i.x),o=lv(n.y,i.y);t.quadraticCurveTo(s,o,h[e+0],h[e+1]),i.x=s,i.y=o,n.x=h[e+0],n.y=h[e+1],0===e&&!0===a&&r.copy(n)}break;case"A":h=av(u,[3,4],7);for(let e=0,s=h.length;e<s;e+=7){if(h[e+5]==n.x&&h[e+6]==n.y)continue;const s=n.clone();n.x=h[e+5],n.y=h[e+6],i.x=n.x,i.y=n.y,ov(t,h[e],h[e+1],h[e+2],h[e+3],h[e+4],s,n),0===e&&!0===a&&r.copy(n)}break;case"m":h=av(u);for(let e=0,s=h.length;e<s;e+=2)n.x+=h[e+0],n.y+=h[e+1],i.x=n.x,i.y=n.y,0===e?t.moveTo(n.x,n.y):t.lineTo(n.x,n.y),0===e&&r.copy(n);break;case"h":h=av(u);for(let e=0,s=h.length;e<s;e++)n.x+=h[e],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===a&&r.copy(n);break;case"v":h=av(u);for(let e=0,s=h.length;e<s;e++)n.y+=h[e],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===a&&r.copy(n);break;case"l":h=av(u);for(let e=0,s=h.length;e<s;e+=2)n.x+=h[e+0],n.y+=h[e+1],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===a&&r.copy(n);break;case"c":h=av(u);for(let e=0,s=h.length;e<s;e+=6)t.bezierCurveTo(n.x+h[e+0],n.y+h[e+1],n.x+h[e+2],n.y+h[e+3],n.x+h[e+4],n.y+h[e+5]),i.x=n.x+h[e+2],i.y=n.y+h[e+3],n.x+=h[e+4],n.y+=h[e+5],0===e&&!0===a&&r.copy(n);break;case"s":h=av(u);for(let e=0,s=h.length;e<s;e+=4)t.bezierCurveTo(lv(n.x,i.x),lv(n.y,i.y),n.x+h[e+0],n.y+h[e+1],n.x+h[e+2],n.y+h[e+3]),i.x=n.x+h[e+0],i.y=n.y+h[e+1],n.x+=h[e+2],n.y+=h[e+3],0===e&&!0===a&&r.copy(n);break;case"q":h=av(u);for(let e=0,s=h.length;e<s;e+=4)t.quadraticCurveTo(n.x+h[e+0],n.y+h[e+1],n.x+h[e+2],n.y+h[e+3]),i.x=n.x+h[e+0],i.y=n.y+h[e+1],n.x+=h[e+2],n.y+=h[e+3],0===e&&!0===a&&r.copy(n);break;case"t":h=av(u);for(let e=0,s=h.length;e<s;e+=2){const s=lv(n.x,i.x),o=lv(n.y,i.y);t.quadraticCurveTo(s,o,n.x+h[e+0],n.y+h[e+1]),i.x=s,i.y=o,n.x=n.x+h[e+0],n.y=n.y+h[e+1],0===e&&!0===a&&r.copy(n)}break;case"a":h=av(u,[3,4],7);for(let e=0,s=h.length;e<s;e+=7){if(0==h[e+5]&&0==h[e+6])continue;const s=n.clone();n.x+=h[e+5],n.y+=h[e+6],i.x=n.x,i.y=n.y,ov(t,h[e],h[e+1],h[e+2],h[e+3],h[e+4],s,n),0===e&&!0===a&&r.copy(n)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(n.copy(r),t.currentPath.currentPoint.copy(n),s=!0);break;default:console.warn(l)}a=!1}return t}(e);this.#Rt.copy(t.toShapes(!0)[0]??dv)}else if("string"!=typeof e||e.match(/^-?[0-9]/))if("string"==typeof e||Array.isArray(e)){const t="string"==typeof e?Tl(e,"shape"):e;if(t.length){if(t.length%2!=0)throw new Error("shape path must have an even number of numbers, each pair of numbers being a point.");if(this.#Rt.copy(pv),this.#Rt.moveTo(t[0],t[1]),t.length>2)for(let e=2;e<t.length;e+=2)this.#Rt.lineTo(t[e],t[e+1])}else this.#Rt.copy(dv)}else this.#Rt!==e&&this.#Rt.copy(e);else console.error("Unsupported shape path: ",e),this.#Rt.copy(dv);else this.#Rt.copy(dv);this.#Rt.updateArcLengths()}curveSegments=uv(this,f,8);bevel=(uv(this,m),uv(this,g,!1));bevelSegments=(uv(this,v),uv(this,y,4));bevelThickness=(uv(this,b),uv(this,x,4));centerGeometry=(uv(this,_),uv(this,w,!0));fitment=(uv(this,S),uv(this,M,"none"));_createComponent(){let e;if(e=0===this.element.calculatedSize.z?new ev(this.shape,this.curveSegments):new Jg(this.shape,{curveSegments:this.curveSegments,bevelSegments:this.bevelSegments,bevelThickness:this.bevelThickness,bevelEnabled:this.bevel,depth:this.element.calculatedSize.z}),this.centerGeometry&&e.center(),e.scale(1,-1,1),function(e){let t=0,n=0,i=0;const r=e.attributes.normal.array;for(let e=0,s=r.length/9;e<s;e++)t=r[9*e],n=r[9*e+1],i=r[9*e+2],r[9*e]=r[9*e+6],r[9*e+1]=r[9*e+7],r[9*e+2]=r[9*e+8],r[9*e+6]=t,r[9*e+7]=n,r[9*e+8]=i;const s=e.attributes.position.array;for(let e=0,r=s.length/9;e<r;e++)t=s[9*e],n=s[9*e+1],i=s[9*e+2],s[9*e]=s[9*e+6],s[9*e+1]=s[9*e+7],s[9*e+2]=s[9*e+8],s[9*e+6]=t,s[9*e+7]=n,s[9*e+8]=i;const a=e.attributes.uv.array;for(let e=0,i=a.length/6;e<i;e++)t=a[6*e],n=a[6*e+1],a[6*e]=a[6*e+4],a[6*e+1]=a[6*e+5],a[6*e+4]=t,a[6*e+5]=n;e.attributes.normal.needsUpdate=!0,e.attributes.position.needsUpdate=!0,e.attributes.uv.needsUpdate=!0}(e),"none"===this.fitment)return e;let t=Number.MAX_VALUE,n=-Number.MAX_VALUE,i=Number.MAX_VALUE,r=-Number.MAX_VALUE;const s=e.attributes.position.array;for(let e=0,a=s.length/3;e<a;e++){const a=s[3*e+0],o=s[3*e+1];a<t&&(t=a),a>n&&(n=a),o<i&&(i=o),o>r&&(r=o)}const a=n-t,o=r-i,l=a/this.element.calculatedSize.x,c=o/this.element.calculatedSize.y;if("fill"===this.fitment)return e.scale(1/l,1/c,1);const u=a/o,h=this.element.calculatedSize.x/this.element.calculatedSize.y;return"contain"===this.fitment?u<h?e.scale(1/c,1/c,1):e.scale(1/l,1/l,1):"cover"===this.fitment?u<h?e.scale(1/l,1/l,1):e.scale(1/c,1/c,1):"scale-down"===this.fitment&&(a<=this.element.calculatedSize.x&&o<=this.element.calculatedSize.y||(u<h?e.scale(1/c,1/c,1):e.scale(1/l,1/l,1))),e}constructor(){super(...arguments),uv(this,E)}},t})();globalThis.window?.document&&!elementBehaviors.has("shape-geometry")&&elementBehaviors.define("shape-geometry",mv);class gv extends Do{constructor(e=1,t=32,n=16,i=0,r=2*Math.PI,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const o=Math.min(s+a,Math.PI);let l=0;const c=[],u=new an,h=new an,d=[],p=[],f=[],m=[];for(let d=0;d<=n;d++){const g=[],v=d/n;let y=0;0===d&&0===s?y=.5/t:d===n&&o===Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){const o=n/t;u.x=-e*Math.cos(i+o*r)*Math.sin(s+v*a),u.y=e*Math.cos(s+v*a),u.z=e*Math.sin(i+o*r)*Math.sin(s+v*a),p.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(o+y,1-v),g.push(l++)}c.push(g)}for(let e=0;e<n;e++)for(let i=0;i<t;i++){const t=c[e][i+1],r=c[e][i],a=c[e+1][i],l=c[e+1][i+1];(0!==e||s>0)&&d.push(t,r,l),(e!==n-1||o<Math.PI)&&d.push(r,a,l)}this.setIndex(d),this.setAttribute("position",new So(p,3)),this.setAttribute("normal",new So(f,3)),this.setAttribute("uv",new So(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new gv(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}var vv=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},yv=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let bv=(()=>{let e,t,n,i,r=[Yt],s=[],a=mc,o=[],l=[],c=[],u=[];return class extends a{static{t=this}static{const h="function"==typeof Symbol&&Symbol.metadata?Object.create(a[Symbol.metadata]??null):void 0;n=[ct,Xt],i=[ct,Xt],vv(null,null,n,{kind:"field",name:"horizontalSegments",static:!1,private:!1,access:{has:e=>"horizontalSegments"in e,get:e=>e.horizontalSegments,set:(e,t)=>{e.horizontalSegments=t}},metadata:h},o,l),vv(null,null,i,{kind:"field",name:"verticalSegments",static:!1,private:!1,access:{has:e=>"verticalSegments"in e,get:e=>e.verticalSegments,set:(e,t)=>{e.verticalSegments=t}},metadata:h},c,u),vv(null,e={value:t},r,{kind:"class",name:t.name,metadata:h},null,s),t=e.value,h&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:h}),yv(t,s)}horizontalSegments=yv(this,o,32);verticalSegments=(yv(this,l),yv(this,c,32));_createComponent(){return new gv(this.element.calculatedSize.x/2,this.horizontalSegments,this.verticalSegments)}constructor(){super(...arguments),yv(this,u)}},t})();globalThis.window?.document&&!elementBehaviors.has("sphere-geometry")&&elementBehaviors.define("sphere-geometry",bv);class xv extends Do{constructor(e=1,t=.4,n=12,i=48,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const s=[],a=[],o=[],l=[],c=new an,u=new an,h=new an;for(let s=0;s<=n;s++)for(let d=0;d<=i;d++){const p=d/i*r,f=s/n*Math.PI*2;u.x=(e+t*Math.cos(f))*Math.cos(p),u.y=(e+t*Math.cos(f))*Math.sin(p),u.z=t*Math.sin(f),a.push(u.x,u.y,u.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),h.subVectors(u,c).normalize(),o.push(h.x,h.y,h.z),l.push(d/i),l.push(s/n)}for(let e=1;e<=n;e++)for(let t=1;t<=i;t++){const n=(i+1)*e+t-1,r=(i+1)*(e-1)+t-1,a=(i+1)*(e-1)+t,o=(i+1)*e+t;s.push(n,r,o),s.push(r,a,o)}this.setIndex(s),this.setAttribute("position",new So(a,3)),this.setAttribute("normal",new So(o,3)),this.setAttribute("uv",new So(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new xv(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}var _v=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},wv=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let Sv=(()=>{let e,t,n,i,r,s,a=[Yt],o=[],l=mc,c=[],u=[],h=[],d=[],p=[],f=[],m=[],g=[];return class extends l{static{t=this}static{const v="function"==typeof Symbol&&Symbol.metadata?Object.create(l[Symbol.metadata]??null):void 0;n=[ct,Xt],i=[ct,Xt],r=[ct,Xt],s=[ct,Xt],_v(null,null,n,{kind:"field",name:"tubeThickness",static:!1,private:!1,access:{has:e=>"tubeThickness"in e,get:e=>e.tubeThickness,set:(e,t)=>{e.tubeThickness=t}},metadata:v},c,u),_v(null,null,i,{kind:"field",name:"radialSegments",static:!1,private:!1,access:{has:e=>"radialSegments"in e,get:e=>e.radialSegments,set:(e,t)=>{e.radialSegments=t}},metadata:v},h,d),_v(null,null,r,{kind:"field",name:"tubularSegments",static:!1,private:!1,access:{has:e=>"tubularSegments"in e,get:e=>e.tubularSegments,set:(e,t)=>{e.tubularSegments=t}},metadata:v},p,f),_v(null,null,s,{kind:"field",name:"arc",static:!1,private:!1,access:{has:e=>"arc"in e,get:e=>e.arc,set:(e,t)=>{e.arc=t}},metadata:v},m,g),_v(null,e={value:t},a,{kind:"class",name:t.name,metadata:v},null,o),t=e.value,v&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:v}),wv(t,o)}tubeThickness=wv(this,c,.1);radialSegments=(wv(this,u),wv(this,h,16));tubularSegments=(wv(this,d),wv(this,p,32));arc=(wv(this,f),wv(this,m,360));_createComponent(){const e=this.element.calculatedSize.x,t=e/2,{tubeThickness:n,radialSegments:i,tubularSegments:r,arc:s}=this,a=n*e;return new xv(t-a/2,a,i,r,qs(s))}constructor(){super(...arguments),wv(this,g)}},t})();globalThis.window?.document&&!elementBehaviors.has("torus-geometry")&&elementBehaviors.define("torus-geometry",Sv);const Mv={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Ev{constructor(e,t,n){const i=this;let r,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===s&&void 0!==i.onStart&&i.onStart(e,a,o),s=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,o),a===o&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}}const Tv=new Ev;class Av{constructor(e){this.manager=void 0!==e?e:Tv,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Av.DEFAULT_MATERIAL_NAME="__DEFAULT";class Cv extends Av{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=Mv.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;const a=Eo("img");function o(){c(),Mv.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){c(),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}class Rv extends Av{constructor(e){super(e)}load(e,t,n,i){const r=new fl,s=new Cv(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}var Pv=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0},kv=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0};let Iv=(()=>{let e,t,n,i,r,s,a,o,l,c,u,h,d,p=[Yt],f=[],m=fc,g=[],v=[],y=[],b=[],x=[],_=[],w=[],S=[],M=[],E=[],T=[],A=[],C=[],R=[],P=[],I=[],O=[],N=[],D=[];var z=class extends m{static{t=this}static{const k="function"==typeof Symbol&&Symbol.metadata?Object.create(m[Symbol.metadata]??null):void 0;n=[ct,Xt],i=[ht,Xt],r=[ht,Xt],s=[ht,Xt],a=[ht,Xt],o=[ht,Xt],l=[ht,Xt],c=[ot,Xt],u=[ct,Xt],h=[ot,Xt],d=[ot],kv(this,null,h,{kind:"getter",name:"color",static:!1,private:!1,access:{has:e=>"color"in e,get:e=>e.color},metadata:k},null,g),kv(this,null,d,{kind:"setter",name:"color",static:!1,private:!1,access:{has:e=>"color"in e,set:(e,t)=>{e.color=t}},metadata:k},null,g),kv(null,null,n,{kind:"field",name:"alphaTest",static:!1,private:!1,access:{has:e=>"alphaTest"in e,get:e=>e.alphaTest,set:(e,t)=>{e.alphaTest=t}},metadata:k},v,y),kv(null,null,i,{kind:"field",name:"colorWrite",static:!1,private:!1,access:{has:e=>"colorWrite"in e,get:e=>e.colorWrite,set:(e,t)=>{e.colorWrite=t}},metadata:k},b,x),kv(null,null,r,{kind:"field",name:"depthTest",static:!1,private:!1,access:{has:e=>"depthTest"in e,get:e=>e.depthTest,set:(e,t)=>{e.depthTest=t}},metadata:k},_,w),kv(null,null,s,{kind:"field",name:"depthWrite",static:!1,private:!1,access:{has:e=>"depthWrite"in e,get:e=>e.depthWrite,set:(e,t)=>{e.depthWrite=t}},metadata:k},S,M),kv(null,null,a,{kind:"field",name:"dithering",static:!1,private:!1,access:{has:e=>"dithering"in e,get:e=>e.dithering,set:(e,t)=>{e.dithering=t}},metadata:k},E,T),kv(null,null,o,{kind:"field",name:"fog",static:!1,private:!1,access:{has:e=>"fog"in e,get:e=>e.fog,set:(e,t)=>{e.fog=t}},metadata:k},A,C),kv(null,null,l,{kind:"field",name:"wireframe",static:!1,private:!1,access:{has:e=>"wireframe"in e,get:e=>e.wireframe,set:(e,t)=>{e.wireframe=t}},metadata:k},R,P),kv(null,null,c,{kind:"field",name:"sidedness",static:!1,private:!1,access:{has:e=>"sidedness"in e,get:e=>e.sidedness,set:(e,t)=>{e.sidedness=t}},metadata:k},I,O),kv(null,null,u,{kind:"field",name:"materialOpacity",static:!1,private:!1,access:{has:e=>"materialOpacity"in e,get:e=>e.materialOpacity,set:(e,t)=>{e.materialOpacity=t}},metadata:k},N,D),kv(null,e={value:t},p,{kind:"class",name:t.name,metadata:k},null,f),z=t=e.value,k&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:k})}type=(Pv(this,g),"material");alphaTest=Pv(this,v,0);colorWrite=(Pv(this,y),Pv(this,b,!0));depthTest=(Pv(this,x),Pv(this,_,!0));depthWrite=(Pv(this,w),Pv(this,S,!0));dithering=(Pv(this,M),Pv(this,E,!1));fog=(Pv(this,T),Pv(this,A,!0));wireframe=(Pv(this,C),Pv(this,R,!1));sidedness=(Pv(this,P),Pv(this,I,"front"));materialOpacity=(Pv(this,O),Pv(this,N,1));#Pt=(Pv(this,D),"white");get color(){return this.#Pt}set color(e){this.#Pt="object"==typeof e?e.getStyle():e}#kt=k((()=>this.element.opacity<1||this.materialOpacity<1));get transparent(){return this.#kt()}connectedCallback(){super.connectedCallback(),this.createEffect((()=>{const e=this.meshComponent;e&&(e.alphaTest=this.alphaTest,e.colorWrite=this.colorWrite,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.dithering=this.dithering,this.element.needsUpdate())})),this.createEffect((()=>{const e=this.meshComponent;e&&function(e){return"wireframe"in e}(e)&&(e.wireframe=this.wireframe,this.element.needsUpdate())})),this.createEffect((()=>{const e=this.meshComponent;if(!e||!("side"in e))return;let t;switch(this.sidedness){case"front":t=0;break;case"back":t=1;break;case"double":t=2}e.side=t,this.element.needsUpdate()})),this.createEffect((()=>{const e=this.meshComponent;e&&function(e){return"color"in e}(e)&&(e.color.set(this.color),this.element.needsUpdate())})),this.createEffect((()=>{const e=this.meshComponent;e&&(e.opacity=this.element.opacity*this.materialOpacity,e.transparent=this.transparent,this.element.needsUpdate())})),this.createEffect((()=>{const e=this.meshComponent;e&&(this.transparent,e.needsUpdate=!0)}))}_createComponent(){return new go}static textureCache={};_handleTexture(e,t,n,i,r=!1){const s=k(e),a=k((()=>this.meshComponent));this.createEffect((()=>{const e=a();if(!e)return;const o=s();if(!o)return;let l=z.textureCache[o];if(l)return l.refcount++,t(e,l.texture),e.needsUpdate=!0,this.element.needsUpdate(),i?.(),this.element.dispatchEvent(new Ov(o)),void L((()=>{l.refcount--,0===l.refcount&&(l.texture.dispose(),delete z.textureCache[o]),t(e,null),e.needsUpdate=!0,this.element.needsUpdate()}));let c=!1;const u=(new Rv).load(o,(()=>{c||(n(e)||(e.needsUpdate=!0),t(e,u),this.element.needsUpdate(),i?.(),this.element.dispatchEvent(new Ov(o)))}));r&&(u.colorSpace=Gi),e.needsUpdate=!0,this.element.needsUpdate(),l=z.textureCache[o]={texture:u,refcount:1},L((()=>{c=!0,l.refcount--,0===l.refcount&&(l.texture.dispose(),delete z.textureCache[o]),t(e,null),e.needsUpdate=!0,this.element.needsUpdate()}))}))}static{Pv(t,f)}};return z=t})();class Ov extends Event{static type="textureload";src="";constructor(e){super(Ov.type,{bubbles:!1,cancelable:!1}),this.src=e}}var Lv=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},Nv=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let Dv=(()=>{let e,t,n,i,r=[Yt],s=[],a=Iv,o=[],l=[],c=[],u=[];return class extends a{static{t=this}static{const h="function"==typeof Symbol&&Symbol.metadata?Object.create(a[Symbol.metadata]??null):void 0;n=[ot,Xt],i=[ot,Xt],Lv(null,null,n,{kind:"field",name:"texture",static:!1,private:!1,access:{has:e=>"texture"in e,get:e=>e.texture,set:(e,t)=>{e.texture=t}},metadata:h},o,l),Lv(null,null,i,{kind:"field",name:"specularMap",static:!1,private:!1,access:{has:e=>"specularMap"in e,get:e=>e.specularMap,set:(e,t)=>{e.specularMap=t}},metadata:h},c,u),Lv(null,e={value:t},r,{kind:"class",name:t.name,metadata:h},null,s),t=e.value,h&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:h}),Nv(t,s)}texture=Nv(this,o,"");specularMap=(Nv(this,l),Nv(this,c,""));_createComponent(){return new vo}connectedCallback(){super.connectedCallback(),this._handleTexture((()=>this.texture),((e,t)=>e.map=t),(e=>!!e.map),(()=>{}),!0),this._handleTexture((()=>this.specularMap),((e,t)=>e.specularMap=t),(e=>!!e.specularMap),(()=>{}),!0)}constructor(){super(...arguments),Nv(this,u)}},t})();globalThis.window?.document&&!elementBehaviors.has("basic-material")&&elementBehaviors.define("basic-material",Dv);class zv extends go{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new po(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new po(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new da(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new _r,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}var Uv=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},Fv=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let Bv=(()=>{let e,t,n,i,r=[Yt],s=[],a=Iv,o=[],l=[],c=[],u=[];return class extends a{static{t=this}static{const h="function"==typeof Symbol&&Symbol.metadata?Object.create(a[Symbol.metadata]??null):void 0;n=[ot,Xt],i=[ot,Xt],Uv(null,null,n,{kind:"field",name:"texture",static:!1,private:!1,access:{has:e=>"texture"in e,get:e=>e.texture,set:(e,t)=>{e.texture=t}},metadata:h},o,l),Uv(null,null,i,{kind:"field",name:"specularMap",static:!1,private:!1,access:{has:e=>"specularMap"in e,get:e=>e.specularMap,set:(e,t)=>{e.specularMap=t}},metadata:h},c,u),Uv(null,e={value:t},r,{kind:"class",name:t.name,metadata:h},null,s),t=e.value,h&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:h}),Fv(t,s)}texture=Fv(this,o,"");specularMap=(Fv(this,l),Fv(this,c,""));_createComponent(){return new zv({color:65280})}connectedCallback(){super.connectedCallback(),this._handleTexture((()=>this.texture),((e,t)=>e.map=t),(e=>!!e.map),(()=>{}),!0),this._handleTexture((()=>this.specularMap),((e,t)=>e.specularMap=t),(e=>!!e.specularMap),(()=>{}),!0)}constructor(){super(...arguments),Fv(this,u)}},t})();globalThis.window?.document&&!elementBehaviors.has("lambert-material")&&elementBehaviors.define("lambert-material",Bv);var Vv=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},jv=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let Hv=(()=>{let e,t,n,i=[Yt],r=[],s=Iv,a=[],o=[];return class extends s{static{t=this}static{const l="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;n=[ot,Xt],Vv(null,null,n,{kind:"field",name:"texture",static:!1,private:!1,access:{has:e=>"texture"in e,get:e=>e.texture,set:(e,t)=>{e.texture=t}},metadata:l},a,o),Vv(null,e={value:t},i,{kind:"class",name:t.name,metadata:l},null,r),t=e.value,l&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:l}),jv(t,r)}texture=jv(this,a,"");_createComponent(){return new Vl}connectedCallback(){super.connectedCallback(),this._handleTexture((()=>this.texture),((e,t)=>e.map=t),(e=>!!e.map),(()=>{}),!0)}constructor(){super(...arguments),jv(this,o)}},t})();globalThis.window?.document&&!elementBehaviors.has("line-material")&&elementBehaviors.define("line-material",Hv);class Gv extends go{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new po(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new po(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new da(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new _r,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Wv extends Gv{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new da(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return en(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new po(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new po(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new po(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}var Xv=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},qv=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let Yv=(()=>{let e,t,n,i,r,s,a,o,l,c,u,h,d,p,f,m,g,v,y,b,x=[Yt],_=[],w=Iv,S=[],M=[],E=[],T=[],A=[],C=[],R=[],P=[],k=[],I=[],O=[],L=[],N=[],D=[],z=[],U=[],F=[],B=[],V=[],j=[],H=[],G=[],W=[],X=[],q=[],Y=[],$=[],Z=[],K=[],J=[],Q=[],ee=[],te=[],ne=[],ie=[],re=[];return class extends w{static{t=this}static{const se="function"==typeof Symbol&&Symbol.metadata?Object.create(w[Symbol.metadata]??null):void 0;n=[ot,Xt],i=[ot,Xt],r=[ct,Xt],s=[ot,Xt],a=[ct,Xt],o=[ot,Xt],l=[ct,Xt],c=[ct,Xt],u=[ot,Xt],h=[ot,Xt],d=[ct,Xt],p=[ct,Xt],f=[ot,Xt],m=[ct,Xt],g=[ot,Xt],v=[ht,Xt],y=[ht,Xt],b=[ht,Xt],Xv(null,null,n,{kind:"field",name:"alphaMap",static:!1,private:!1,access:{has:e=>"alphaMap"in e,get:e=>e.alphaMap,set:(e,t)=>{e.alphaMap=t}},metadata:se},S,M),Xv(null,null,i,{kind:"field",name:"aoMap",static:!1,private:!1,access:{has:e=>"aoMap"in e,get:e=>e.aoMap,set:(e,t)=>{e.aoMap=t}},metadata:se},E,T),Xv(null,null,r,{kind:"field",name:"aoMapIntensity",static:!1,private:!1,access:{has:e=>"aoMapIntensity"in e,get:e=>e.aoMapIntensity,set:(e,t)=>{e.aoMapIntensity=t}},metadata:se},A,C),Xv(null,null,s,{kind:"field",name:"bumpMap",static:!1,private:!1,access:{has:e=>"bumpMap"in e,get:e=>e.bumpMap,set:(e,t)=>{e.bumpMap=t}},metadata:se},R,P),Xv(null,null,a,{kind:"field",name:"bumpScale",static:!1,private:!1,access:{has:e=>"bumpScale"in e,get:e=>e.bumpScale,set:(e,t)=>{e.bumpScale=t}},metadata:se},k,I),Xv(null,null,o,{kind:"field",name:"displacementMap",static:!1,private:!1,access:{has:e=>"displacementMap"in e,get:e=>e.displacementMap,set:(e,t)=>{e.displacementMap=t}},metadata:se},O,L),Xv(null,null,l,{kind:"field",name:"displacementScale",static:!1,private:!1,access:{has:e=>"displacementScale"in e,get:e=>e.displacementScale,set:(e,t)=>{e.displacementScale=t}},metadata:se},N,D),Xv(null,null,c,{kind:"field",name:"displacementBias",static:!1,private:!1,access:{has:e=>"displacementBias"in e,get:e=>e.displacementBias,set:(e,t)=>{e.displacementBias=t}},metadata:se},z,U),Xv(null,null,u,{kind:"field",name:"texture",static:!1,private:!1,access:{has:e=>"texture"in e,get:e=>e.texture,set:(e,t)=>{e.texture=t}},metadata:se},F,B),Xv(null,null,h,{kind:"field",name:"normalMap",static:!1,private:!1,access:{has:e=>"normalMap"in e,get:e=>e.normalMap,set:(e,t)=>{e.normalMap=t}},metadata:se},V,j),Xv(null,null,d,{kind:"field",name:"normalScale",static:!1,private:!1,access:{has:e=>"normalScale"in e,get:e=>e.normalScale,set:(e,t)=>{e.normalScale=t}},metadata:se},H,G),Xv(null,null,p,{kind:"field",name:"metalness",static:!1,private:!1,access:{has:e=>"metalness"in e,get:e=>e.metalness,set:(e,t)=>{e.metalness=t}},metadata:se},W,X),Xv(null,null,f,{kind:"field",name:"metalnessMap",static:!1,private:!1,access:{has:e=>"metalnessMap"in e,get:e=>e.metalnessMap,set:(e,t)=>{e.metalnessMap=t}},metadata:se},q,Y),Xv(null,null,m,{kind:"field",name:"roughness",static:!1,private:!1,access:{has:e=>"roughness"in e,get:e=>e.roughness,set:(e,t)=>{e.roughness=t}},metadata:se},$,Z),Xv(null,null,g,{kind:"field",name:"roughnessMap",static:!1,private:!1,access:{has:e=>"roughnessMap"in e,get:e=>e.roughnessMap,set:(e,t)=>{e.roughnessMap=t}},metadata:se},K,J),Xv(null,null,v,{kind:"field",name:"vertexTangents",static:!1,private:!1,access:{has:e=>"vertexTangents"in e,get:e=>e.vertexTangents,set:(e,t)=>{e.vertexTangents=t}},metadata:se},Q,ee),Xv(null,null,y,{kind:"field",name:"morphTargets",static:!1,private:!1,access:{has:e=>"morphTargets"in e,get:e=>e.morphTargets,set:(e,t)=>{e.morphTargets=t}},metadata:se},te,ne),Xv(null,null,b,{kind:"field",name:"morphNormals",static:!1,private:!1,access:{has:e=>"morphNormals"in e,get:e=>e.morphNormals,set:(e,t)=>{e.morphNormals=t}},metadata:se},ie,re),Xv(null,e={value:t},x,{kind:"class",name:t.name,metadata:se},null,_),t=e.value,se&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:se}),qv(t,_)}alphaMap=qv(this,S,"");aoMap=(qv(this,M),qv(this,E,""));aoMapIntensity=(qv(this,T),qv(this,A,1));bumpMap=(qv(this,C),qv(this,R,""));bumpScale=(qv(this,P),qv(this,k,1));displacementMap=(qv(this,I),qv(this,O,""));displacementScale=(qv(this,L),qv(this,N,1));displacementBias=(qv(this,D),qv(this,z,0));texture=(qv(this,U),qv(this,F,""));normalMap=(qv(this,B),qv(this,V,""));normalScale=(qv(this,j),qv(this,H,1));metalness=(qv(this,G),qv(this,W,0));metalnessMap=(qv(this,X),qv(this,q,""));roughness=(qv(this,Y),qv(this,$,1));roughnessMap=(qv(this,Z),qv(this,K,""));vertexTangents=(qv(this,J),qv(this,Q,!1));morphTargets=(qv(this,ee),qv(this,te,!1));morphNormals=(qv(this,ne),qv(this,ie,!1));_createComponent(){return new Gv}connectedCallback(){super.connectedCallback(),this.createEffect((()=>{const e=this.meshComponent;e&&(e.aoMapIntensity=this.aoMapIntensity,e.bumpScale=this.bumpScale,e.displacementScale=this.displacementScale,e.displacementBias=this.displacementBias,e.normalScale.set(this.normalScale,this.normalScale),e.metalness=this.metalness,e.roughness=this.roughness,this.element.needsUpdate())})),this._handleTexture((()=>this.alphaMap),((e,t)=>e.alphaMap=t),(e=>!!e.alphaMap)),this._handleTexture((()=>this.aoMap),((e,t)=>e.aoMap=t),(e=>!!e.aoMap)),this._handleTexture((()=>this.bumpMap),((e,t)=>e.bumpMap=t),(e=>!!e.bumpMap)),this._handleTexture((()=>this.displacementMap),((e,t)=>e.displacementMap=t),(e=>!!e.displacementMap)),this._handleTexture((()=>this.texture),((e,t)=>e.map=t),(e=>!!e.map),(()=>{}),!0),this._handleTexture((()=>this.normalMap),((e,t)=>e.normalMap=t),(e=>!!e.normalMap)),this._handleTexture((()=>this.metalnessMap),((e,t)=>e.metalnessMap=t),(e=>!!e.metalnessMap)),this._handleTexture((()=>this.roughnessMap),((e,t)=>e.roughnessMap=t),(e=>!!e.roughnessMap))}constructor(){super(...arguments),qv(this,re)}},t})();globalThis.window?.document&&!elementBehaviors.has("standard-material")&&elementBehaviors.define("standard-material",Yv);var $v=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},Zv=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let Kv=(()=>{let e,t,n,i,r,s,a,o,l=[Yt],c=[],u=Yv,h=[],d=[],p=[],f=[],m=[],g=[],v=[],y=[],b=[],x=[],_=[],w=[];return class extends u{static{t=this}static{const S="function"==typeof Symbol&&Symbol.metadata?Object.create(u[Symbol.metadata]??null):void 0;n=[ct,Xt],i=[ct,Xt],r=[ct,Xt],s=[ct,Xt],a=[ct,Xt],o=[ot,Xt],$v(null,null,n,{kind:"field",name:"clearcoat",static:!1,private:!1,access:{has:e=>"clearcoat"in e,get:e=>e.clearcoat,set:(e,t)=>{e.clearcoat=t}},metadata:S},h,d),$v(null,null,i,{kind:"field",name:"clearcoatRoughness",static:!1,private:!1,access:{has:e=>"clearcoatRoughness"in e,get:e=>e.clearcoatRoughness,set:(e,t)=>{e.clearcoatRoughness=t}},metadata:S},p,f),$v(null,null,r,{kind:"field",name:"refractiveIndex",static:!1,private:!1,access:{has:e=>"refractiveIndex"in e,get:e=>e.refractiveIndex,set:(e,t)=>{e.refractiveIndex=t}},metadata:S},m,g),$v(null,null,s,{kind:"field",name:"reflectivity",static:!1,private:!1,access:{has:e=>"reflectivity"in e,get:e=>e.reflectivity,set:(e,t)=>{e.reflectivity=t}},metadata:S},v,y),$v(null,null,a,{kind:"field",name:"transmission",static:!1,private:!1,access:{has:e=>"transmission"in e,get:e=>e.transmission,set:(e,t)=>{e.transmission=t}},metadata:S},b,x),$v(null,null,o,{kind:"field",name:"transmissionMap",static:!1,private:!1,access:{has:e=>"transmissionMap"in e,get:e=>e.transmissionMap,set:(e,t)=>{e.transmissionMap=t}},metadata:S},_,w),$v(null,e={value:t},l,{kind:"class",name:t.name,metadata:S},null,c),t=e.value,S&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:S}),Zv(t,c)}clearcoat=Zv(this,h,0);clearcoatRoughness=(Zv(this,d),Zv(this,p,0));refractiveIndex=(Zv(this,f),Zv(this,m,1.5));reflectivity=(Zv(this,g),Zv(this,v,.5));transmission=(Zv(this,y),Zv(this,b,0));transmissionMap=(Zv(this,x),Zv(this,_,""));_createComponent(){return new Wv({})}connectedCallback(){super.connectedCallback(),this.createEffect((()=>{const e=this.meshComponent;e&&(e.clearcoat=this.clearcoat,e.clearcoatRoughness=this.clearcoatRoughness,e.ior=this.refractiveIndex,e.reflectivity=this.reflectivity,e.transmission=this.transmission,this.element.needsUpdate())})),this._handleTexture((()=>this.transmissionMap),((e,t)=>e.transmissionMap=t),(e=>!!e.transmissionMap))}constructor(){super(...arguments),Zv(this,w)}},t})();globalThis.window?.document&&!elementBehaviors.has("physical-material")&&elementBehaviors.define("physical-material",Kv),globalThis.window?.document&&!elementBehaviors.has("mixedplane-material")&&elementBehaviors.define("mixedplane-material",class extends Kv{constructor(e){super(e),this.materialOpacity=.3,this.color="#444"}_createComponent(){return new Wv({blending:0})}});var Jv=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0},Qv=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0};let ey=(()=>{let e,t,n,i,r,s,a,o,l,c,u,h,d,p,f,m,g,v,y,b,x,_,w,S,M,E,T=[Yt],A=[],C=Iv,R=[],P=[],k=[],I=[],O=[],L=[],N=[],D=[],z=[],U=[],F=[],B=[],V=[],j=[],H=[],G=[],W=[],X=[],q=[],Y=[],$=[],Z=[],K=[],J=[],Q=[],ee=[],te=[],ne=[],ie=[],re=[],se=[],ae=[],oe=[],le=[],ce=[],ue=[],he=[],de=[],pe=[],fe=[],me=[];return class extends C{static{t=this}static{const ge="function"==typeof Symbol&&Symbol.metadata?Object.create(C[Symbol.metadata]??null):void 0;n=[ot,Xt],i=[ot,Xt],r=[ct,Xt],s=[ot,Xt],a=[ct,Xt],o=[ot,Xt],l=[ct,Xt],c=[ct,Xt],u=[ot,Xt],h=[ot,Xt],d=[ot],p=[ct,Xt],f=[ot,Xt],m=[ht,Xt],g=[ot,Xt],v=[ct,Xt],y=[ot,Xt],b=[ot,Xt],x=[ct,Xt],_=[ct,Xt],w=[ot,Xt],S=[ot,Xt],M=[ot],E=[ct,Xt],Qv(this,null,h,{kind:"getter",name:"emissive",static:!1,private:!1,access:{has:e=>"emissive"in e,get:e=>e.emissive},metadata:ge},null,R),Qv(this,null,d,{kind:"setter",name:"emissive",static:!1,private:!1,access:{has:e=>"emissive"in e,set:(e,t)=>{e.emissive=t}},metadata:ge},null,R),Qv(this,null,S,{kind:"getter",name:"specular",static:!1,private:!1,access:{has:e=>"specular"in e,get:e=>e.specular},metadata:ge},null,R),Qv(this,null,M,{kind:"setter",name:"specular",static:!1,private:!1,access:{has:e=>"specular"in e,set:(e,t)=>{e.specular=t}},metadata:ge},null,R),Qv(null,null,n,{kind:"field",name:"alphaMap",static:!1,private:!1,access:{has:e=>"alphaMap"in e,get:e=>e.alphaMap,set:(e,t)=>{e.alphaMap=t}},metadata:ge},P,k),Qv(null,null,i,{kind:"field",name:"aoMap",static:!1,private:!1,access:{has:e=>"aoMap"in e,get:e=>e.aoMap,set:(e,t)=>{e.aoMap=t}},metadata:ge},I,O),Qv(null,null,r,{kind:"field",name:"aoMapIntensity",static:!1,private:!1,access:{has:e=>"aoMapIntensity"in e,get:e=>e.aoMapIntensity,set:(e,t)=>{e.aoMapIntensity=t}},metadata:ge},L,N),Qv(null,null,s,{kind:"field",name:"bumpMap",static:!1,private:!1,access:{has:e=>"bumpMap"in e,get:e=>e.bumpMap,set:(e,t)=>{e.bumpMap=t}},metadata:ge},D,z),Qv(null,null,a,{kind:"field",name:"bumpScale",static:!1,private:!1,access:{has:e=>"bumpScale"in e,get:e=>e.bumpScale,set:(e,t)=>{e.bumpScale=t}},metadata:ge},U,F),Qv(null,null,o,{kind:"field",name:"displacementMap",static:!1,private:!1,access:{has:e=>"displacementMap"in e,get:e=>e.displacementMap,set:(e,t)=>{e.displacementMap=t}},metadata:ge},B,V),Qv(null,null,l,{kind:"field",name:"displacementScale",static:!1,private:!1,access:{has:e=>"displacementScale"in e,get:e=>e.displacementScale,set:(e,t)=>{e.displacementScale=t}},metadata:ge},j,H),Qv(null,null,c,{kind:"field",name:"displacementBias",static:!1,private:!1,access:{has:e=>"displacementBias"in e,get:e=>e.displacementBias,set:(e,t)=>{e.displacementBias=t}},metadata:ge},G,W),Qv(null,null,u,{kind:"field",name:"emissiveMap",static:!1,private:!1,access:{has:e=>"emissiveMap"in e,get:e=>e.emissiveMap,set:(e,t)=>{e.emissiveMap=t}},metadata:ge},X,q),Qv(null,null,p,{kind:"field",name:"emissiveIntensity",static:!1,private:!1,access:{has:e=>"emissiveIntensity"in e,get:e=>e.emissiveIntensity,set:(e,t)=>{e.emissiveIntensity=t}},metadata:ge},Y,$),Qv(null,null,f,{kind:"field",name:"envMap",static:!1,private:!1,access:{has:e=>"envMap"in e,get:e=>e.envMap,set:(e,t)=>{e.envMap=t}},metadata:ge},Z,K),Qv(null,null,m,{kind:"field",name:"flatShading",static:!1,private:!1,access:{has:e=>"flatShading"in e,get:e=>e.flatShading,set:(e,t)=>{e.flatShading=t}},metadata:ge},J,Q),Qv(null,null,g,{kind:"field",name:"lightMap",static:!1,private:!1,access:{has:e=>"lightMap"in e,get:e=>e.lightMap,set:(e,t)=>{e.lightMap=t}},metadata:ge},ee,te),Qv(null,null,v,{kind:"field",name:"lightMapIntensity",static:!1,private:!1,access:{has:e=>"lightMapIntensity"in e,get:e=>e.lightMapIntensity,set:(e,t)=>{e.lightMapIntensity=t}},metadata:ge},ne,ie),Qv(null,null,y,{kind:"field",name:"texture",static:!1,private:!1,access:{has:e=>"texture"in e,get:e=>e.texture,set:(e,t)=>{e.texture=t}},metadata:ge},re,se),Qv(null,null,b,{kind:"field",name:"normalMap",static:!1,private:!1,access:{has:e=>"normalMap"in e,get:e=>e.normalMap,set:(e,t)=>{e.normalMap=t}},metadata:ge},ae,oe),Qv(null,null,x,{kind:"field",name:"normalScale",static:!1,private:!1,access:{has:e=>"normalScale"in e,get:e=>e.normalScale,set:(e,t)=>{e.normalScale=t}},metadata:ge},le,ce),Qv(null,null,_,{kind:"field",name:"reflectivity",static:!1,private:!1,access:{has:e=>"reflectivity"in e,get:e=>e.reflectivity,set:(e,t)=>{e.reflectivity=t}},metadata:ge},ue,he),Qv(null,null,w,{kind:"field",name:"specularMap",static:!1,private:!1,access:{has:e=>"specularMap"in e,get:e=>e.specularMap,set:(e,t)=>{e.specularMap=t}},metadata:ge},de,pe),Qv(null,null,E,{kind:"field",name:"shininess",static:!1,private:!1,access:{has:e=>"shininess"in e,get:e=>e.shininess,set:(e,t)=>{e.shininess=t}},metadata:ge},fe,me),Qv(null,e={value:t},T,{kind:"class",name:t.name,metadata:ge},null,A),t=e.value,ge&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:ge}),Jv(t,A)}alphaMap=(Jv(this,R),Jv(this,P,""));aoMap=(Jv(this,k),Jv(this,I,""));aoMapIntensity=(Jv(this,O),Jv(this,L,1));bumpMap=(Jv(this,N),Jv(this,D,""));bumpScale=(Jv(this,z),Jv(this,U,1));displacementMap=(Jv(this,F),Jv(this,B,""));displacementScale=(Jv(this,V),Jv(this,j,1));displacementBias=(Jv(this,H),Jv(this,G,0));emissiveMap=(Jv(this,W),Jv(this,X,""));get emissive(){return this.#It}set emissive(e){this.#It="object"==typeof e?e.getStyle():e}#It=(Jv(this,q),"black");emissiveIntensity=Jv(this,Y,1);envMap=(Jv(this,$),Jv(this,Z,""));flatShading=(Jv(this,K),Jv(this,J,!1));lightMap=(Jv(this,Q),Jv(this,ee,""));lightMapIntensity=(Jv(this,te),Jv(this,ne,1));texture=(Jv(this,ie),Jv(this,re,""));normalMap=(Jv(this,se),Jv(this,ae,""));normalScale=(Jv(this,oe),Jv(this,le,1));reflectivity=(Jv(this,ce),Jv(this,ue,1));specularMap=(Jv(this,he),Jv(this,de,""));get specular(){return this.#Ot}set specular(e){this.#Ot="object"==typeof e?e.getStyle():e}#Ot=(Jv(this,pe),"#111");shininess=Jv(this,fe,30);_createComponent(){return new El({color:65280})}connectedCallback(){super.connectedCallback(),this.createEffect((()=>{const e=this.meshComponent;e&&(e.aoMapIntensity=this.aoMapIntensity,e.bumpScale=this.bumpScale,e.displacementScale=this.displacementScale,e.displacementBias=this.displacementBias,e.emissiveIntensity=this.emissiveIntensity,e.flatShading=this.flatShading,e.lightMapIntensity=this.lightMapIntensity,e.normalScale.set(this.normalScale,this.normalScale),e.reflectivity=this.reflectivity,e.shininess=this.shininess,this.element.needsUpdate())})),this.createEffect((()=>{this.meshComponent?.emissive.set(this.emissive),this.element.needsUpdate()})),this.createEffect((()=>{this.meshComponent?.specular.set(this.specular),this.element.needsUpdate()})),this._handleTexture((()=>this.alphaMap),((e,t)=>e.alphaMap=t),(e=>!!e.alphaMap)),this._handleTexture((()=>this.aoMap),((e,t)=>e.aoMap=t),(e=>!!e.aoMap)),this._handleTexture((()=>this.bumpMap),((e,t)=>e.bumpMap=t),(e=>!!e.bumpMap)),this._handleTexture((()=>this.displacementMap),((e,t)=>e.displacementMap=t),(e=>!!e.displacementMap)),this._handleTexture((()=>this.emissiveMap),((e,t)=>e.emissiveMap=t),(e=>!!e.emissiveMap),(()=>{}),!0),this._handleTexture((()=>this.envMap),((e,t)=>e.envMap=t),(e=>!!e.envMap)),this._handleTexture((()=>this.lightMap),((e,t)=>e.lightMap=t),(e=>!!e.lightMap)),this._handleTexture((()=>this.texture),((e,t)=>e.map=t),(e=>!!e.map),(()=>{}),!0),this._handleTexture((()=>this.normalMap),((e,t)=>e.normalMap=t),(e=>!!e.normalMap)),this._handleTexture((()=>this.specularMap),((e,t)=>e.specularMap=t),(e=>!!e.specularMap),(()=>{}),!0)}constructor(){super(...arguments),Jv(this,me)}},t})();globalThis.window?.document&&!elementBehaviors.has("phong-material")&&elementBehaviors.define("phong-material",ey);var ty=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},ny=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let iy=(()=>{let e,t,n,i,r,s=[Yt],a=[],o=Iv,l=[],c=[],u=[],h=[],d=[],p=[];return class extends o{static{t=this}static{const f="function"==typeof Symbol&&Symbol.metadata?Object.create(o[Symbol.metadata]??null):void 0;n=[ot,Xt],i=[ht,Xt],r=[ct,Xt],ty(null,null,n,{kind:"field",name:"texture",static:!1,private:!1,access:{has:e=>"texture"in e,get:e=>e.texture,set:(e,t)=>{e.texture=t}},metadata:f},l,c),ty(null,null,i,{kind:"field",name:"sizeAttenuation",static:!1,private:!1,access:{has:e=>"sizeAttenuation"in e,get:e=>e.sizeAttenuation,set:(e,t)=>{e.sizeAttenuation=t}},metadata:f},u,h),ty(null,null,r,{kind:"field",name:"pointSize",static:!1,private:!1,access:{has:e=>"pointSize"in e,get:e=>e.pointSize,set:(e,t)=>{e.pointSize=t}},metadata:f},d,p),ty(null,e={value:t},s,{kind:"class",name:t.name,metadata:f},null,a),t=e.value,f&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:f}),ny(t,a)}texture=ny(this,l,"");sizeAttenuation=(ny(this,c),ny(this,u,!0));pointSize=(ny(this,h),ny(this,d,1));_createComponent(){return new Qo({color:65280})}connectedCallback(){super.connectedCallback(),this.createEffect((()=>{const e=this.meshComponent;e&&(e.sizeAttenuation=this.sizeAttenuation,e.size=this.pointSize,this.element.needsUpdate())})),this._handleTexture((()=>this.texture),((e,t)=>e.map=t),(e=>!!e.map),(()=>{}),!0)}constructor(){super(...arguments),ny(this,p)}},t})();globalThis.window?.document&&!elementBehaviors.has("points-material")&&elementBehaviors.define("points-material",iy);class ry extends Br{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ur,this.projectionMatrix=new ur,this.projectionMatrixInverse=new ur,this.coordinateSystem=lr}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const sy=new an,ay=new da,oy=new da;class ly extends ry{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Jt*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Kt*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Jt*Math.atan(Math.tan(.5*Kt*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){sy.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(sy.x,sy.y).multiplyScalar(-e/sy.z),sy.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(sy.x,sy.y).multiplyScalar(-e/sy.z)}getViewSize(e,t){return this.getViewBounds(e,ay,oy),t.subVectors(oy,ay)}setViewOffset(e,t,n,i,r,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Kt*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const e=s.fullWidth,a=s.fullHeight;r+=s.offsetX*i/e,t-=s.offsetY*n/a,i*=s.width/e,n*=s.height/a}const a=this.filmOffset;0!==a&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}function cy(e,{defines:t={},header:n="",main:i="",...r}){let s=e;return Object.keys(r).forEach((e=>{var t,n,i;t=s,n=e,i=r[e],s=t.split(n).join(i)})),s=s.replace("void main() {",`\n\t\t\t${n}\n\t\t\tvoid main() {\n\t\t\t\t${i}\n\t\t`),`\n\t\t${Object.keys(t).map((e=>`#define ${e} ${t[e]}`)).join("\n")}\n\t\t${s}\n\t`}function uy(e,t){if(e.image&&0!==e.image.videoWidth&&0!==e.image.videoHeight)return;const n=setInterval((()=>{if(e.image&&0!==e.image.videoWidth&&0!==e.image.videoHeight)return clearInterval(n),t(e)}),16)}class hy extends Wv{static version="0.4.0";#Lt=new ly;#Nt="contain";#Dt=1;get camera(){return this.#Lt}set camera(e){if(!e||!e.isCamera)throw new Error("Invalid camera set to the ProjectedMaterial");this.#Lt=e,this.#zt(),this.needsUpdate=!0,this.onBeforeCompile=this.#Lt.isPerspectiveCamera?this.#Ut:this.#Ft}get texture(){return this.uniforms.projectedTexture.value}set texture(e){if(!e?.isTexture)throw new Error("Invalid texture set to the ProjectedMaterial");this.uniforms.projectedTexture.value=e,this.uniforms.isTextureLoaded.value=Boolean(e.image),this.uniforms.isTextureLoaded.value?this.#zt():uy(e,(()=>{this.uniforms.isTextureLoaded.value=!0,this.#zt()}))}get textureScale(){return this.#Dt}set textureScale(e){this.#Dt=e,this.#zt()}get textureOffset(){return this.uniforms.textureOffset.value}set textureOffset(e){this.uniforms.textureOffset.value=e}get fitment(){return this.#Nt}set fitment(e){this.#Nt=e,this.#zt()}get frontFacesOnly(){return this.uniforms.frontFacesOnly.value}set frontFacesOnly(e){this.uniforms.frontFacesOnly.value=e}uniforms;isProjectedMaterial=!0;constructor({camera:e,texture:t=new fl,textureScale:n,textureOffset:i=new da,fitment:r,frontFacesOnly:s=!0,...a}={}){if(!t.isTexture)throw new Error("Invalid texture passed to the ProjectedMaterial");if(e&&!e.isCamera)throw new Error("Invalid camera passed to the ProjectedMaterial");super(a),Object.defineProperty(this,"isProjectedMaterial",{value:this.isProjectedMaterial}),this.#Nt=r??this.#Nt,this.#Dt=n??this.#Dt,this.uniforms={projectedTexture:{value:t},isTextureLoaded:{value:Boolean(t.image)},isTextureProjected:{value:!1},backgroundOpacity:{value:1},viewMatrixCamera:{value:new ur},projectionMatrixCamera:{value:new ur},projPosition:{value:new an},projDirection:{value:new an(0,0,-1)},savedModelMatrix:{value:new ur},widthScaled:{value:1},heightScaled:{value:1},textureOffset:{value:i},frontFacesOnly:{value:s}},e&&(this.camera=e),this.#zt(),uy(t,(()=>{this.uniforms.isTextureLoaded.value=!0,this.#zt()}))}#Ut=(e,...t)=>{delete e.defines.ORTHOGRAPHIC,this.#Bt(e,...t)};#Ft=(e,...t)=>{e.defines.ORTHOGRAPHIC="",this.#Bt(e,...t)};#Bt=e=>{Object.assign(this.uniforms,e.uniforms),e.uniforms=this.uniforms,e.vertexShader=cy(e.vertexShader,{header:"\n\t\t\t\t\tuniform mat4 viewMatrixCamera;\n\t\t\t\t\tuniform mat4 projectionMatrixCamera;\n\n\t\t\t\t\t#ifdef USE_INSTANCING\n\t\t\t\t\tattribute vec4 savedModelMatrix0;\n\t\t\t\t\tattribute vec4 savedModelMatrix1;\n\t\t\t\t\tattribute vec4 savedModelMatrix2;\n\t\t\t\t\tattribute vec4 savedModelMatrix3;\n\t\t\t\t\t#else\n\t\t\t\t\tuniform mat4 savedModelMatrix;\n\t\t\t\t\t#endif\n\n\t\t\t\t\tvarying vec3 vSavedNormal;\n\t\t\t\t\tvarying vec4 vTexCoords;\n\t\t\t\t\t#ifndef ORTHOGRAPHIC\n\t\t\t\t\tvarying vec4 vWorldPosition;\n\t\t\t\t\t#endif\n\t\t\t\t",main:"\n\t\t\t\t\t#ifdef USE_INSTANCING\n\t\t\t\t\tmat4 savedModelMatrix = mat4(\n\t\t\t\t\t\tsavedModelMatrix0,\n\t\t\t\t\t\tsavedModelMatrix1,\n\t\t\t\t\t\tsavedModelMatrix2,\n\t\t\t\t\t\tsavedModelMatrix3\n\t\t\t\t\t);\n\t\t\t\t\t#endif\n\n\t\t\t\t\tvSavedNormal = mat3(savedModelMatrix) * normal;\n\t\t\t\t\tvTexCoords = projectionMatrixCamera * viewMatrixCamera * savedModelMatrix * vec4(position, 1.0);\n\t\t\t\t\t#ifndef ORTHOGRAPHIC\n\t\t\t\t\tvWorldPosition = savedModelMatrix * vec4(position, 1.0);\n\t\t\t\t\t#endif\n\t\t\t\t"}),e.fragmentShader=cy(e.fragmentShader,{header:"\n\t\t\t\t\tuniform sampler2D projectedTexture;\n\t\t\t\t\tuniform bool isTextureLoaded;\n\t\t\t\t\tuniform bool isTextureProjected;\n\t\t\t\t\tuniform float backgroundOpacity;\n\t\t\t\t\tuniform vec3 projPosition;\n\t\t\t\t\tuniform vec3 projDirection;\n\t\t\t\t\tuniform float widthScaled;\n\t\t\t\t\tuniform float heightScaled;\n\t\t\t\t\tuniform vec2 textureOffset;\n\t\t\t\t\tuniform bool frontFacesOnly;\n\n\t\t\t\t\tvarying vec3 vSavedNormal;\n\t\t\t\t\tvarying vec4 vTexCoords;\n\t\t\t\t\t#ifndef ORTHOGRAPHIC\n\t\t\t\t\tvarying vec4 vWorldPosition;\n\t\t\t\t\t#endif\n\n\t\t\t\t\tfloat mapRange(float value, float min1, float max1, float min2, float max2) {\n\t\t\t\t\t\treturn min2 + (value - min1) * (max2 - min2) / (max1 - min1);\n\t\t\t\t\t}\n\t\t\t\t","vec4 diffuseColor = vec4( diffuse, opacity );":"\n\t\t\t\t\t// clamp the w to make sure we don't project behind\n\t\t\t\t\tfloat w = max(vTexCoords.w, 0.0);\n\n\t\t\t\t\tvec2 uv = (vTexCoords.xy / w) * 0.5 + 0.5;\n\n\t\t\t\t\tuv += textureOffset;\n\n\t\t\t\t\t// apply the corrected width and height\n\t\t\t\t\tuv.x = mapRange(uv.x, 0.0, 1.0, 0.5 - widthScaled / 2.0, 0.5 + widthScaled / 2.0);\n\t\t\t\t\tuv.y = mapRange(uv.y, 0.0, 1.0, 0.5 - heightScaled / 2.0, 0.5 + heightScaled / 2.0);\n\n\t\t\t\t\t// this makes sure we don't sample out of the texture\n\t\t\t\t\tbool isInTexture = (max(uv.x, uv.y) <= 1.0 && min(uv.x, uv.y) >= 0.0);\n\n\t\t\t\t\t// this makes sure we don't render also the back of the object if frontFacesOnly is true\n\t\t\t\t\t// FIXME projection direction is wrong in some cases, namely\n\t\t\t\t\t// when the camera and the target are both a child and not at the\n\t\t\t\t\t// scene origin.\n\t\t\t\t\t#ifdef ORTHOGRAPHIC\n\t\t\t\t\tvec3 projectorDirection = projDirection;\n\t\t\t\t\t#else\n\t\t\t\t\tvec3 projectorDirection = normalize(projPosition - vWorldPosition.xyz);\n\t\t\t\t\t#endif\n\t\t\t\t\tfloat dotProduct = dot(vSavedNormal, projectorDirection);\n\t\t\t\t\tbool isFacingProjector = frontFacesOnly ? dotProduct > 0.0000001 : true;\n\n\n\t\t\t\t\tvec4 diffuseColor = vec4(diffuse, opacity * backgroundOpacity);\n\n\t\t\t\t\tif (isFacingProjector && isInTexture && isTextureLoaded && isTextureProjected) {\n\t\t\t\t\t\tvec4 textureColor = texture2D(projectedTexture, uv);\n\n\t\t\t\t\t\t// apply the material opacity\n\t\t\t\t\t\ttextureColor.a *= opacity;\n\n\t\t\t\t\t\t// https://learnopengl.com/Advanced-OpenGL/Blending\n\t\t\t\t\t\tdiffuseColor = textureColor * textureColor.a + diffuseColor * (1.0 - textureColor.a);\n\t\t\t\t\t}\n\t\t\t\t"})};updateFromCamera(){this.uniforms.projectionMatrixCamera.value.copy(this.camera.projectionMatrix),this.#zt()}#zt(){!function(e,t,n,i,r){if(!e.image)return r.x=1,void(r.y=1);if(0===e.image.videoWidth&&0===e.image.videoHeight)return r.x=1,void(r.y=1);const s=e.image.naturalWidth||e.image.videoWidth||e.image.clientWidth,a=e.image.naturalHeight||e.image.videoHeight||e.image.clientHeight,o=function(e){switch(e.type){case"PerspectiveCamera":return e.aspect;case"OrthographicCamera":return Math.abs(e.right-e.left)/Math.abs(e.top-e.bottom);default:throw new Error("The given type of camera is currently not supported in ProjectedMaterial")}}(t),l=1/o*1,c=s/a;if("cover"===i?c>o:c<o){const e=l*c;r.x=1/(e/1*n),r.y=1/n}else{const e=1/c*1;r.x=1/n,r.y=1/(e/l*n)}}(this.texture,this.camera,this.textureScale,this.fitment,dy),this.uniforms.widthScaled.value=dy.x,this.uniforms.heightScaled.value=dy.y}#Vt(e=!0){this.camera.updateProjectionMatrix(),e&&(this.camera.updateMatrixWorld(),this.camera.updateWorldMatrix(!0,!1));const t=this.camera.matrixWorldInverse,n=this.camera.projectionMatrix,i=this.camera.matrixWorld;this.uniforms.viewMatrixCamera.value.copy(t),this.uniforms.projectionMatrixCamera.value.copy(n),this.uniforms.projPosition.value.copy(this.camera.position),this.uniforms.projDirection.value.set(0,0,1).applyMatrix4(i),this.uniforms.isTextureProjected.value=!0}project(e,t=!0){if(!py(e.material))throw new Error("The mesh material must be a ProjectedMaterial");if(!(Array.isArray(e.material)?e.material.some((e=>e===this)):e.material===this))throw new Error("The provided mesh doesn't have the same material as where project() has been called from");if(t&&e.updateWorldMatrix(!0,!1),this.uniforms.savedModelMatrix.value.copy(e.matrixWorld),Array.isArray(e.material)){const t=e.material.indexOf(this);if(!e.material[t].transparent)throw new Error('You have to pass "transparent: true" to the ProjectedMaterial if you\'re working with multiple materials.');t>0&&(this.uniforms.backgroundOpacity.value=0)}this.#Vt(t)}projectInstanceAt(e,t,n,{forceCameraSave:i=!1}={}){if(!t.isInstancedMesh)throw new Error("The provided mesh is not an InstancedMesh");if(!py(t.material))throw new Error("The InstancedMesh material must be a ProjectedMaterial");if(!(Array.isArray(t.material)?t.material.some((e=>e===this)):t.material===this))throw new Error("The provided InstancedMeshhave't i samenclude thas e material where project() has been called from");if(!(t.geometry.attributes.savedModelMatrix0&&t.geometry.attributes.savedModelMatrix1&&t.geometry.attributes.savedModelMatrix2&&t.geometry.attributes.savedModelMatrix3))throw new Error("No allocated data found on the geometry, please call 'allocateProjectionData(geometry, instancesCount)'");if(t.geometry.attributes.savedModelMatrix0.setXYZW(e,n.elements[0],n.elements[1],n.elements[2],n.elements[3]),t.geometry.attributes.savedModelMatrix1.setXYZW(e,n.elements[4],n.elements[5],n.elements[6],n.elements[7]),t.geometry.attributes.savedModelMatrix2.setXYZW(e,n.elements[8],n.elements[9],n.elements[10],n.elements[11]),t.geometry.attributes.savedModelMatrix3.setXYZW(e,n.elements[12],n.elements[13],n.elements[14],n.elements[15]),Array.isArray(t.material)){const e=t.material.indexOf(this);if(!t.material[e].transparent)throw new Error('You have to pass "transparent: true" to the ProjectedMaterial if you\'re working with multiple materials.');e>0&&(this.uniforms.backgroundOpacity.value=0)}(0===e||i)&&this.#Vt()}copy(e){return super.copy(e),this.camera=e.camera,this.texture=e.texture,this.textureScale=e.textureScale,this.textureOffset=e.textureOffset,this.fitment=e.fitment,this}}const dy={x:1,y:1};function py(e){const t=e;return Array.isArray(t)?t.every((e=>e.isProjectedMaterial)):t.isProjectedMaterial}class fy extends ry{constructor(e=-1,t=1,n=1,i=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,s=n+e,a=i+t,o=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,s=r+e*this.view.width,a-=t*this.view.offsetY,o=a-t*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}var my=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},gy=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let vy=(()=>{let e,t,n,i,r,s,a=[pt("lume-texture-projector",oa)],o=[],l=ua,c=[],u=[],h=[],d=[],p=[],f=[],m=[],g=[];return class extends l{static{t=this}static{const v="function"==typeof Symbol&&Symbol.metadata?Object.create(l[Symbol.metadata]??null):void 0;n=[ot],i=[ot],r=[ht],s=[Ue],my(null,null,n,{kind:"field",name:"src",static:!1,private:!1,access:{has:e=>"src"in e,get:e=>e.src,set:(e,t)=>{e.src=t}},metadata:v},c,u),my(null,null,i,{kind:"field",name:"fitment",static:!1,private:!1,access:{has:e=>"fitment"in e,get:e=>e.fitment,set:(e,t)=>{e.fitment=t}},metadata:v},h,d),my(null,null,r,{kind:"field",name:"frontFacesOnly",static:!1,private:!1,access:{has:e=>"frontFacesOnly"in e,get:e=>e.frontFacesOnly,set:(e,t)=>{e.frontFacesOnly=t}},metadata:v},p,f),my(null,null,s,{kind:"field",name:"threeCamera",static:!1,private:!1,access:{has:e=>"threeCamera"in e,get:e=>e.threeCamera,set:(e,t)=>{e.threeCamera=t}},metadata:v},m,g),my(null,e={value:t},a,{kind:"class",name:t.name,metadata:v},null,o),t=e.value,v&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:v}),gy(t,o)}src=gy(this,c,"");fitment=(gy(this,u),gy(this,h,"cover"));frontFacesOnly=(gy(this,d),gy(this,p,!1));threeCamera=(gy(this,f),gy(this,m,null));connectedCallback(){super.connectedCallback(),this.threeCamera=new fy,this.three.add(this.threeCamera),this.createEffect((()=>{P((()=>{const e=this.calculatedSize,t=this.threeCamera;t instanceof fy?(t.left=-e.x/2,t.right=e.x/2,t.top=e.y/2,t.bottom=-e.y/2):(t.near=1,t.far=1e4,t.aspect=1,t.fov=45),t.updateProjectionMatrix(),this.needsUpdate()}))}))}disconnectedCallback(){super.disconnectedCallback(),this.three.remove(this.threeCamera),this.threeCamera=null}constructor(){super(...arguments),gy(this,g)}},t})();function*yy(e,t){if(t)for(const n of cc(e)){const e=n.querySelectorAll(t);for(let t=0,n=e.length;t<n;t+=1)yield e[t]}}function by(e,t){if(e.length!==t.length)return!1;for(const[n,i]of e.entries())if(i!==t[n])return!1;return!0}var xy=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0},_y=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},wy=function(e,t,n){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})};let Sy=(()=>{let e,t,n,i,r,s,a,o,l=[Yt],c=[],u=Kv,h=[],d=[],p=[];return class extends u{static{t=this}static{const f="function"==typeof Symbol&&Symbol.metadata?Object.create(u[Symbol.metadata]??null):void 0;n=[Ue],r=[ot,Xt],s=[ot],a=[ot,Xt],o=[ot],_y(this,i={get:wy((function(){return this.#jt}),"#associatedProjectors","get"),set:wy((function(e){this.#jt=e}),"#associatedProjectors","set")},n,{kind:"accessor",name:"#associatedProjectors",static:!1,private:!0,access:{has:e=>#Ht in e,get:e=>e.#Ht,set:(e,t)=>{e.#Ht=t}},metadata:f},d,p),_y(this,null,r,{kind:"getter",name:"textureProjectors",static:!1,private:!1,access:{has:e=>"textureProjectors"in e,get:e=>e.textureProjectors},metadata:f},null,h),_y(this,null,s,{kind:"setter",name:"textureProjectors",static:!1,private:!1,access:{has:e=>"textureProjectors"in e,set:(e,t)=>{e.textureProjectors=t}},metadata:f},null,h),_y(this,null,a,{kind:"getter",name:"projectedTextures",static:!1,private:!1,access:{has:e=>"projectedTextures"in e,get:e=>e.projectedTextures},metadata:f},null,h),_y(this,null,o,{kind:"setter",name:"projectedTextures",static:!1,private:!1,access:{has:e=>"projectedTextures"in e,set:(e,t)=>{e.projectedTextures=t}},metadata:f},null,h),_y(null,e={value:t},l,{kind:"class",name:t.name,metadata:f},null,c),t=e.value,f&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:f}),xy(t,c)}#jt=(xy(this,h),xy(this,d,[]));get#Ht(){return i.get.call(this)}set#Ht(e){return i.set.call(this,e)}get associatedProjectors(){return this.#Ht}#Gt=(xy(this,p),[]);get textureProjectors(){return this.#Gt}set textureProjectors(e){this.#Gt=e}get projectedTextures(){return this.textureProjectors}set projectedTextures(e){this.textureProjectors=e}_createComponent(){return new hy}#S=null;connectedCallback(){super.connectedCallback();let e=!1;this.#S=new MutationObserver((()=>{e||(e=!0,setTimeout((()=>{e=!1,this.textureProjectors=this.#Gt}),0))}));for(const e of cc(this.element))this.#S.observe(e,{childList:!0,subtree:!0});this.createEffect((()=>{const e=this.meshComponent;if(!e)return;const t=this.element.three;if(t.material!==e)return;P((()=>{this.textureProjectors;let e=[];if("string"==typeof this.#Gt)e=[this.#Gt.trim()];else{if(!Array.isArray(this.#Gt))throw new TypeError("Invalid value for textureProjectors");e=this.#Gt}const t=[];for(const n of e)if("string"==typeof n){if(n)for(const e of yy(this.element,n))e&&e.scene&&e instanceof vy&&t.push(e)}else n.scene&&n instanceof vy&&t.push(n);this.#Ht=t}));const n=function(e,t=[]){return k(e,t,{equals:by})}((()=>this.#Ht)),i=k((()=>n()[0])),r=k((()=>i()?.src??""));this._handleTexture(r,((e,t)=>e.texture=t||new fl),(e=>!!e.texture),(()=>{}),!0),P((()=>{const t=i();t&&P((()=>{e.fitment=t.fitment,e.frontFacesOnly=t.frontFacesOnly,this.element.needsUpdate()}))})),P((()=>{const n=i();if(!n)return;const r=n.threeCamera;r&&t.material===e&&(e.camera=r,e.updateFromCamera(),e.project(t,!1),this.element.needsUpdate(),L((()=>{const e=this.meshComponent;e&&t.material===e&&(e.camera=new fy(1e-8,1e-8,1e-8,1e-8),e.updateFromCamera(),e.project(t,!1),this.element.needsUpdate())})))})),P((()=>{const t=i();t&&P((()=>{t.calculatedSize,e.updateFromCamera(),this.element.needsUpdate()}))})),P((()=>{t.material===e&&(this.element.version,e.project(t,!1))})),P((()=>{const n=i();n&&P((()=>{t.material===e&&(n.version,e.project(t,!1),this.element.needsUpdate())}))}))}))}disconnectedCallback(){super.disconnectedCallback(),this.#S?.disconnect(),this.#S=null}},t})();function My(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][i]=null):t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function Ey(e){const t={};for(let n=0;n<e.length;n++){const i=My(e[n]);for(const e in i)t[e]=i[e]}return t}function Ty(e){const t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:so.workingColorSpace}globalThis.window?.document&&!elementBehaviors.has("projected-material")&&elementBehaviors.define("projected-material",Sy);const Ay={clone:My,merge:Ey},Cy="\nvoid main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",Ry="\nvoid main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}\n";class Py extends go{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Cy,this.fragmentShader=Ry,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=My(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}var ky=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0},Iy=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0};let Oy=(()=>{let e,t,n,i,r,s,a=[Yt],o=[],l=Iv,c=[],u=[],h=[],d=[],p=[];return class extends l{static{t=this}static{const f="function"==typeof Symbol&&Symbol.metadata?Object.create(l[Symbol.metadata]??null):void 0;n=[et,Xt],i=[et],r=[ot,Xt],s=[ot,Xt],Iy(this,null,n,{kind:"getter",name:"uniforms",static:!1,private:!1,access:{has:e=>"uniforms"in e,get:e=>e.uniforms},metadata:f},null,c),Iy(this,null,i,{kind:"setter",name:"uniforms",static:!1,private:!1,access:{has:e=>"uniforms"in e,set:(e,t)=>{e.uniforms=t}},metadata:f},null,c),Iy(null,null,r,{kind:"field",name:"vertexShader",static:!1,private:!1,access:{has:e=>"vertexShader"in e,get:e=>e.vertexShader,set:(e,t)=>{e.vertexShader=t}},metadata:f},u,h),Iy(null,null,s,{kind:"field",name:"fragmentShader",static:!1,private:!1,access:{has:e=>"fragmentShader"in e,get:e=>e.fragmentShader,set:(e,t)=>{e.fragmentShader=t}},metadata:f},d,p),Iy(null,e={value:t},a,{kind:"class",name:t.name,metadata:f},null,o),t=e.value,f&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:f}),ky(t,o)}get uniforms(){return this.#Wt}set uniforms(e){if(e)if("string"==typeof e)try{this.#Wt=JSON.parse(e)}catch(t){console.warn("Unparsable uniform value:",e)}else this.#Wt=e;else this.#Wt={}}#Wt=(ky(this,c),{});vertexShader=ky(this,u,Cy);fragmentShader=(ky(this,h),ky(this,d,Ry));_createComponent(){return O((()=>new Py({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader})))}connectedCallback(){this.createEffect((()=>{const e=this.meshComponent;e&&(e.uniforms=this.uniforms,e.vertexShader=this.vertexShader||Cy,e.fragmentShader=this.fragmentShader||Ry,e.needsUpdate=!0,this.element.needsUpdate())})),super.connectedCallback()}constructor(){super(...arguments),ky(this,p)}},t})();globalThis.window?.document&&!elementBehaviors.has("shader-material")&&elementBehaviors.define("shader-material",Oy);class Ly extends xm{constructor(e){super(e)}parse(e){if(e.length<19)throw new Error("THREE.TGALoader: Not enough data to contain header.");let t=0;const n=new Uint8Array(e),i={id_length:n[t++],colormap_type:n[t++],image_type:n[t++],colormap_index:n[t++]|n[t++]<<8,colormap_length:n[t++]|n[t++]<<8,colormap_size:n[t++],origin:[n[t++]|n[t++]<<8,n[t++]|n[t++]<<8],width:n[t++]|n[t++]<<8,height:n[t++]|n[t++]<<8,pixel_size:n[t++],flags:n[t++]};if(function(e){switch(e.image_type){case 1:case 9:if(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)throw new Error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case 2:case 3:case 10:case 11:if(e.colormap_type)throw new Error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case 0:throw new Error("THREE.TGALoader: No data.");default:throw new Error("THREE.TGALoader: Invalid type "+e.image_type)}if(e.width<=0||e.height<=0)throw new Error("THREE.TGALoader: Invalid image size.");if(8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size)throw new Error("THREE.TGALoader: Invalid pixel size "+e.pixel_size)}(i),i.id_length+t>e.length)throw new Error("THREE.TGALoader: No data.");t+=i.id_length;let r=!1,s=!1,a=!1;switch(i.image_type){case 9:r=!0,s=!0;break;case 1:s=!0;break;case 10:r=!0;break;case 2:break;case 11:r=!0,a=!0;break;case 3:a=!0}const o=new Uint8Array(i.width*i.height*4),l=function(e,t,n,i,r){let s,a;const o=n.pixel_size>>3,l=n.width*n.height*o;if(t&&(a=r.subarray(i,i+=n.colormap_length*(n.colormap_size>>3))),e){let e,t,n;s=new Uint8Array(l);let a=0;const c=new Uint8Array(o);for(;a<l;)if(e=r[i++],t=1+(127&e),128&e){for(n=0;n<o;++n)c[n]=r[i++];for(n=0;n<t;++n)s.set(c,a+n*o);a+=o*t}else{for(t*=o,n=0;n<t;++n)s[a+n]=r[i++];a+=t}}else s=r.subarray(i,i+=t?n.width*n.height:l);return{pixel_data:s,palettes:a}}(r,s,i,t,n);return function(e,t,n,r,s){let o,l,c,u,h,d;switch((48&i.flags)>>4){default:case 2:o=0,c=1,h=t,l=0,u=1,d=n;break;case 0:o=0,c=1,h=t,l=n-1,u=-1,d=-1;break;case 3:o=t-1,c=-1,h=-1,l=0,u=1,d=n;break;case 1:o=t-1,c=-1,h=-1,l=n-1,u=-1,d=-1}if(a)switch(i.pixel_size){case 8:!function(e,t,n,r,s,a,o,l){let c,u,h,d=0;const p=i.width;for(h=t;h!==r;h+=n)for(u=s;u!==o;u+=a,d++)c=l[d],e[4*(u+p*h)+0]=c,e[4*(u+p*h)+1]=c,e[4*(u+p*h)+2]=c,e[4*(u+p*h)+3]=255}(e,l,u,d,o,c,h,r);break;case 16:!function(e,t,n,r,s,a,o,l){let c,u,h=0;const d=i.width;for(u=t;u!==r;u+=n)for(c=s;c!==o;c+=a,h+=2)e[4*(c+d*u)+0]=l[h+0],e[4*(c+d*u)+1]=l[h+0],e[4*(c+d*u)+2]=l[h+0],e[4*(c+d*u)+3]=l[h+1]}(e,l,u,d,o,c,h,r);break;default:throw new Error("THREE.TGALoader: Format not supported.")}else switch(i.pixel_size){case 8:!function(e,t,n,r,s,a,o,l,c){const u=c;let h,d,p,f=0;const m=i.width;for(p=t;p!==r;p+=n)for(d=s;d!==o;d+=a,f++)h=l[f],e[4*(d+m*p)+3]=255,e[4*(d+m*p)+2]=u[3*h+0],e[4*(d+m*p)+1]=u[3*h+1],e[4*(d+m*p)+0]=u[3*h+2]}(e,l,u,d,o,c,h,r,s);break;case 16:!function(e,t,n,r,s,a,o,l){let c,u,h,d=0;const p=i.width;for(h=t;h!==r;h+=n)for(u=s;u!==o;u+=a,d+=2)c=l[d+0]+(l[d+1]<<8),e[4*(u+p*h)+0]=(31744&c)>>7,e[4*(u+p*h)+1]=(992&c)>>2,e[4*(u+p*h)+2]=(31&c)<<3,e[4*(u+p*h)+3]=32768&c?0:255}(e,l,u,d,o,c,h,r);break;case 24:!function(e,t,n,r,s,a,o,l){let c,u,h=0;const d=i.width;for(u=t;u!==r;u+=n)for(c=s;c!==o;c+=a,h+=3)e[4*(c+d*u)+3]=255,e[4*(c+d*u)+2]=l[h+0],e[4*(c+d*u)+1]=l[h+1],e[4*(c+d*u)+0]=l[h+2]}(e,l,u,d,o,c,h,r);break;case 32:!function(e,t,n,r,s,a,o,l){let c,u,h=0;const d=i.width;for(u=t;u!==r;u+=n)for(c=s;c!==o;c+=a,h+=4)e[4*(c+d*u)+2]=l[h+0],e[4*(c+d*u)+1]=l[h+1],e[4*(c+d*u)+0]=l[h+2],e[4*(c+d*u)+3]=l[h+3]}(e,l,u,d,o,c,h,r);break;default:throw new Error("THREE.TGALoader: Format not supported.")}}(o,i.width,i.height,l.pixel_data,l.palettes),{data:o,width:i.width,height:i.height,flipY:!0,generateMipmaps:!0,minFilter:Cc}}}class Ny extends mm{load(e,t,n,i){const r=this,s=""===r.path?zm.extractUrlBase(e):r.path,a=new ym(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,(function(n){try{t(r.parse(n,s))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e,t){function n(e,t){const n=[],i=e.childNodes;for(let e=0,r=i.length;e<r;e++){const r=i[e];r.nodeName===t&&n.push(r)}return n}function i(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let e=0,i=t.length;e<i;e++)n[e]=t[e];return n}function r(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let e=0,i=t.length;e<i;e++)n[e]=parseFloat(t[e]);return n}function s(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let e=0,i=t.length;e<i;e++)n[e]=parseInt(t[e]);return n}function a(e){return e.substring(1)}function o(e){return 0===Object.keys(e).length}function l(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function c(e){return void 0!==e?e.textContent:"Y_UP"}function u(e,t,i,r){const s=n(e,t)[0];if(void 0!==s){const e=n(s,i);for(let t=0;t<e.length;t++)r(e[t])}}function h(e,t){for(const n in e)e[n].build=t(e[n])}function d(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function p(e){const t={inputs:{}};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType&&"input"===i.nodeName){const e=a(i.getAttribute("source")),n=i.getAttribute("semantic");t.inputs[n]=e}}return t}function f(e){const t={};let n=e.getAttribute("target").split("/");const i=n.shift();let r=n.shift();const s=-1!==r.indexOf("("),o=-1!==r.indexOf(".");if(o)n=r.split("."),r=n.shift(),t.member=n.shift();else if(s){const e=r.split("(");r=e.shift();for(let t=0;t<e.length;t++)e[t]=parseInt(e[t].replace(/\)/,""));t.indices=e}return t.id=i,t.sid=r,t.arraySyntax=s,t.memberSyntax=o,t.sampler=a(e.getAttribute("source")),t}function m(e){const t=[],n=e.channels,i=e.samplers,r=e.sources;for(const e in n)if(n.hasOwnProperty(e)){const s=n[e],a=i[s.sampler],o=a.inputs.INPUT,l=a.inputs.OUTPUT;_(v(s,r[o],r[l]),t)}return t}function g(e){return d(Ze.animations[e],m)}function v(e,t,n){const i=Ze.nodes[e.id],r=De(i.id),s=i.transforms[e.sid],a=i.matrix.clone().transpose();let o,l,c,u,h,d;const p={};switch(s){case"matrix":for(c=0,u=t.array.length;c<u;c++)if(o=t.array[c],l=c*n.stride,void 0===p[o]&&(p[o]={}),!0===e.arraySyntax){const t=n.array[l],i=e.indices[0]+4*e.indices[1];p[o][i]=t}else for(h=0,d=n.stride;h<d;h++)p[o][h]=n.array[l+h];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',s)}const f=function(e,t){const n=[];for(const t in e)n.push({time:parseFloat(t),value:e[t]});n.sort((function(e,t){return e.time-t.time}));for(let e=0;e<16;e++)w(n,e,t.elements[e]);return n}(p,a);return{name:r.uuid,keyframes:f}}const y=new wu,b=new wu,x=new _u;function _(e,t){const n=e.keyframes,i=e.name,r=[],s=[],a=[],o=[];for(let e=0,t=n.length;e<t;e++){const t=n[e],i=t.time,l=t.value;Ee.fromArray(l).transpose(),Ee.decompose(y,x,b),r.push(i),s.push(y.x,y.y,y.z),a.push(x.x,x.y,x.z,x.w),o.push(b.x,b.y,b.z)}return s.length>0&&t.push(new cm(i+".position",r,s)),a.length>0&&t.push(new om(i+".quaternion",r,a)),o.length>0&&t.push(new cm(i+".scale",r,o)),t}function w(e,t,n){let i,r,s,a=!0;for(r=0,s=e.length;r<s;r++)i=e[r],void 0===i.value[t]?i.value[t]=null:a=!1;if(!0===a)for(r=0,s=e.length;r<s;r++)i=e[r],i.value[t]=n;else!function(e,t){let n,i;for(let r=0,s=e.length;r<s;r++){const s=e[r];if(null===s.value[t]){if(n=S(e,r,t),i=M(e,r,t),null===n){s.value[t]=i.value[t];continue}if(null===i){s.value[t]=n.value[t];continue}E(s,n,i,t)}}}(e,t)}function S(e,t,n){for(;t>=0;){const i=e[t];if(null!==i.value[n])return i;t--}return null}function M(e,t,n){for(;t<e.length;){const i=e[t];if(null!==i.value[n])return i;t++}return null}function E(e,t,n,i){n.time-t.time!=0?e.value[i]=(e.time-t.time)*(n.value[i]-t.value[i])/(n.time-t.time)+t.value[i]:e.value[i]=t.value[i]}function T(e){const t=[],n=e.name,i=e.end-e.start||-1,r=e.animations;for(let e=0,n=r.length;e<n;e++){const n=g(r[e]);for(let e=0,i=n.length;e<i;e++)t.push(n[e])}return new um(n,i,t)}function A(e){return d(Ze.clips[e],T)}function C(e){const t={sources:{}};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=r(i.textContent);break;case"source":const e=i.getAttribute("id");t.sources[e]=se(i);break;case"joints":t.joints=R(i);break;case"vertex_weights":t.vertexWeights=P(i)}}return t}function R(e){const t={inputs:{}};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType&&"input"===i.nodeName){const e=i.getAttribute("semantic"),n=a(i.getAttribute("source"));t.inputs[e]=n}}return t}function P(e){const t={inputs:{}};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":const e=i.getAttribute("semantic"),n=a(i.getAttribute("source")),r=parseInt(i.getAttribute("offset"));t.inputs[e]={id:n,offset:r};break;case"vcount":t.vcount=s(i.textContent);break;case"v":t.v=s(i.textContent)}}return t}function k(e){const t={id:e.id},n=Ze.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){const t={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},n=e.sources,i=e.vertexWeights,r=i.vcount,s=i.v,a=i.inputs.JOINT.offset,o=i.inputs.WEIGHT.offset,l=e.sources[e.joints.inputs.JOINT],c=e.sources[e.joints.inputs.INV_BIND_MATRIX],u=n[i.inputs.WEIGHT.id].array;let h,d,p,f=0;for(h=0,p=r.length;h<p;h++){const e=r[h],n=[];for(d=0;d<e;d++){const e=s[f+a],t=u[s[f+o]];n.push({index:e,weight:t}),f+=2}for(n.sort(m),d=0;d<4;d++){const e=n[d];void 0!==e?(t.indices.array.push(e.index),t.weights.array.push(e.weight)):(t.indices.array.push(0),t.weights.array.push(0))}}for(e.bindShapeMatrix?t.bindMatrix=(new Ju).fromArray(e.bindShapeMatrix).transpose():t.bindMatrix=(new Ju).identity(),h=0,p=l.array.length;h<p;h++){const e=l.array[h],n=(new Ju).fromArray(c.array,h*c.stride).transpose();t.joints.push({name:e,boneInverse:n})}return t;function m(e,t){return t.weight-e.weight}}(e.skin),n.sources.skinIndices=t.skin.indices,n.sources.skinWeights=t.skin.weights),t}function I(e){return void 0!==e.build?e.build:e.init_from}function O(e){const t=Ze.images[e];return void 0!==t?d(t,I):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function L(e){const t={surfaces:{},samplers:{}};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"newparam":N(i,t);break;case"technique":t.technique=U(i);break;case"extra":t.extra=G(i)}}return t}function N(e,t){const n=e.getAttribute("sid");for(let i=0,r=e.childNodes.length;i<r;i++){const r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"surface":t.surfaces[n]=D(r);break;case"sampler2D":t.samplers[n]=z(r)}}}function D(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];1===i.nodeType&&"init_from"===i.nodeName&&(t.init_from=i.textContent)}return t}function z(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];1===i.nodeType&&"source"===i.nodeName&&(t.source=i.textContent)}return t}function U(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=i.nodeName,t.parameters=F(i);break;case"extra":t.extra=G(i)}}return t}function F(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[i.nodeName]=B(i);break;case"transparent":t[i.nodeName]={opaque:i.hasAttribute("opaque")?i.getAttribute("opaque"):"A_ONE",data:B(i)}}}return t}function B(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"color":t[i.nodeName]=r(i.textContent);break;case"float":t[i.nodeName]=parseFloat(i.textContent);break;case"texture":t[i.nodeName]={id:i.getAttribute("texture"),extra:V(i)}}}return t}function V(e){const t={technique:{}};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];1===i.nodeType&&"extra"===i.nodeName&&j(i,t)}return t}function j(e,t){for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];1===i.nodeType&&"technique"===i.nodeName&&H(i,t)}}function H(e,t){for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=1:"FALSE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=0:t.technique[i.nodeName]=parseInt(i.textContent);break;case"bump":t[i.nodeName]=X(i)}}}function G(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];1===i.nodeType&&"technique"===i.nodeName&&(t.technique=W(i))}return t}function W(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"double_sided":t[i.nodeName]=parseInt(i.textContent);break;case"bump":t[i.nodeName]=X(i)}}return t}function X(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];1===i.nodeType&&"texture"===i.nodeName&&(t[i.nodeName]={id:i.getAttribute("texture"),texcoord:i.getAttribute("texcoord"),extra:V(i)})}return t}function q(e){return e}function Y(e){const t=(n=e.url,d(Ze.effects[n],q));var n;const i=t.profile.technique;let r;switch(i.type){case"phong":case"blinn":r=new Xf;break;case"lambert":r=new qf;break;default:r=new Yh}function s(e,n=null){const i=t.profile.samplers[e.id];let r=null;if(void 0!==i?r=O(t.profile.surfaces[i.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),r=O(e.id)),null!==r){const t=function(e){let t,n=e.slice(2+(e.lastIndexOf(".")-1>>>0));return n=n.toLowerCase(),t="tga"===n?We:Ge,t}(r);if(void 0!==t){const i=t.load(r),s=e.extra;if(void 0!==s&&void 0!==s.technique&&!1===o(s.technique)){const e=s.technique;i.wrapS=e.wrapU?Mc:Ec,i.wrapT=e.wrapV?Mc:Ec,i.offset.set(e.offsetU||0,e.offsetV||0),i.repeat.set(e.repeatU||1,e.repeatV||1)}else i.wrapS=Mc,i.wrapT=Mc;return null!==n&&(i.colorSpace=n),i}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",r),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}r.name=e.name||"";const a=i.parameters;for(const e in a){const t=a[e];switch(e){case"diffuse":t.color&&r.color.fromArray(t.color),t.texture&&(r.map=s(t.texture,Oc));break;case"specular":t.color&&r.specular&&r.specular.fromArray(t.color),t.texture&&(r.specularMap=s(t.texture));break;case"bump":t.texture&&(r.normalMap=s(t.texture));break;case"ambient":t.texture&&(r.lightMap=s(t.texture,Oc));break;case"shininess":t.float&&r.shininess&&(r.shininess=t.float);break;case"emission":t.color&&r.emissive&&r.emissive.fromArray(t.color),t.texture&&(r.emissiveMap=s(t.texture,Oc))}}uu.toWorkingColorSpace(r.color,Oc),r.specular&&uu.toWorkingColorSpace(r.specular,Oc),r.emissive&&uu.toWorkingColorSpace(r.emissive,Oc);let l=a.transparent,c=a.transparency;if(void 0===c&&l&&(c={float:1}),void 0===l&&c&&(l={opaque:"A_ONE",data:{color:[1,1,1,1]}}),l&&c)if(l.data.texture)r.transparent=!0;else{const e=l.data.color;switch(l.opaque){case"A_ONE":r.opacity=e[3]*c.float;break;case"RGB_ZERO":r.opacity=1-e[0]*c.float;break;case"A_ZERO":r.opacity=1-e[3]*c.float;break;case"RGB_ONE":r.opacity=e[0]*c.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',l.opaque)}r.opacity<1&&(r.transparent=!0)}if(void 0!==i.extra&&void 0!==i.extra.technique){const e=i.extra.technique;for(const t in e){const n=e[t];switch(t){case"double_sided":r.side=1===n?2:0;break;case"bump":r.normalMap=s(n.texture),r.normalScale=new nu(1,1)}}}return r}function $(e){return d(Ze.materials[e],Y)}function Z(e){for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];if("technique_common"===n.nodeName)return K(n)}return{}}function K(e){const t={};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];switch(i.nodeName){case"perspective":case"orthographic":t.technique=i.nodeName,t.parameters=J(i)}}return t}function J(e){const t={};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];switch(i.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[i.nodeName]=parseFloat(i.textContent)}}return t}function Q(e){let t;switch(e.optics.technique){case"perspective":t=new Cd(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":let n=e.optics.parameters.ymag,i=e.optics.parameters.xmag;const r=e.optics.parameters.aspect_ratio;i=void 0===i?n*r:i,n=void 0===n?i/r:n,i*=.5,n*=.5,t=new yp(-i,i,n,-n,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new Cd}return t.name=e.name||"",t}function ee(e){const t=Ze.cameras[e];return void 0!==t?d(t,Q):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function te(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=i.nodeName,t.parameters=ne(i)}}return t}function ne(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"color":const e=r(i.textContent);t.color=(new Gh).fromArray(e),uu.toWorkingColorSpace(t.color,Oc);break;case"falloff_angle":t.falloffAngle=parseFloat(i.textContent);break;case"quadratic_attenuation":const n=parseFloat(i.textContent);t.distance=n?Math.sqrt(1/n):0}}return t}function ie(e){let t;switch(e.technique){case"directional":t=new Nm;break;case"point":t=new Om;break;case"spot":t=new Cm;break;case"ambient":t=new Dm}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function re(e){const t=Ze.lights[e];return void 0!==t?d(t,ie):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function se(e){const t={array:[],stride:3};for(let s=0;s<e.childNodes.length;s++){const a=e.childNodes[s];if(1===a.nodeType)switch(a.nodeName){case"float_array":t.array=r(a.textContent);break;case"Name_array":t.array=i(a.textContent);break;case"technique_common":const e=n(a,"accessor")[0];void 0!==e&&(t.stride=parseInt(e.getAttribute("stride")))}}return t}function ae(e){const t={};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];1===i.nodeType&&(t[i.getAttribute("semantic")]=a(i.getAttribute("source")))}return t}function oe(e){const t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":const e=a(i.getAttribute("source")),n=i.getAttribute("semantic"),r=parseInt(i.getAttribute("offset")),o=parseInt(i.getAttribute("set")),l=o>0?n+o:n;t.inputs[l]={id:e,offset:r},t.stride=Math.max(t.stride,r+1),"TEXCOORD"===n&&(t.hasUV=!0);break;case"vcount":t.vcount=s(i.textContent);break;case"p":t.p=s(i.textContent)}}return t}function le(e){let t=0;for(let n=0,i=e.length;n<i;n++)!0===e[n].hasUV&&t++;t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function ce(e){const t={},n=e.sources,i=e.vertices,r=e.primitives;if(0===r.length)return{};const s=function(e){const t={};for(let n=0;n<e.length;n++){const i=e[n];void 0===t[i.type]&&(t[i.type]=[]),t[i.type].push(i)}return t}(r);for(const e in s){const r=s[e];le(r),t[e]=ue(r,n,i)}return t}function ue(e,t,n){const i={},r={array:[],stride:0},s={array:[],stride:0},a={array:[],stride:0},o={array:[],stride:0},l={array:[],stride:0},c=[],u=[],h=new ld,d=[];let p=0;for(let i=0;i<e.length;i++){const f=e[i],m=f.inputs;let g=0;switch(f.type){case"lines":case"linestrips":g=2*f.count;break;case"triangles":g=3*f.count;break;case"polylist":for(let e=0;e<f.count;e++){const t=f.vcount[e];switch(t){case 3:g+=3;break;case 4:g+=6;break;default:g+=3*(t-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",f.type)}h.addGroup(p,g,i),p+=g,f.material&&d.push(f.material);for(const i in m){const h=m[i];switch(i){case"VERTEX":for(const i in n){const d=n[i];switch(i){case"POSITION":const n=r.array.length;if(he(f,t[d],h.offset,r.array),r.stride=t[d].stride,t.skinWeights&&t.skinIndices&&(he(f,t.skinIndices,h.offset,c),he(f,t.skinWeights,h.offset,u)),!1===f.hasUV&&!0===e.uvsNeedsFix){const e=(r.array.length-n)/r.stride;for(let t=0;t<e;t++)a.array.push(0,0)}break;case"NORMAL":he(f,t[d],h.offset,s.array),s.stride=t[d].stride;break;case"COLOR":he(f,t[d],h.offset,l.array),l.stride=t[d].stride;break;case"TEXCOORD":he(f,t[d],h.offset,a.array),a.stride=t[d].stride;break;case"TEXCOORD1":he(f,t[d],h.offset,o.array),a.stride=t[d].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',i)}}break;case"NORMAL":he(f,t[h.id],h.offset,s.array),s.stride=t[h.id].stride;break;case"COLOR":he(f,t[h.id],h.offset,l.array,!0),l.stride=t[h.id].stride;break;case"TEXCOORD":he(f,t[h.id],h.offset,a.array),a.stride=t[h.id].stride;break;case"TEXCOORD1":he(f,t[h.id],h.offset,o.array),o.stride=t[h.id].stride}}}return r.array.length>0&&h.setAttribute("position",new ed(r.array,r.stride)),s.array.length>0&&h.setAttribute("normal",new ed(s.array,s.stride)),l.array.length>0&&h.setAttribute("color",new ed(l.array,l.stride)),a.array.length>0&&h.setAttribute("uv",new ed(a.array,a.stride)),o.array.length>0&&h.setAttribute("uv1",new ed(o.array,o.stride)),c.length>0&&h.setAttribute("skinIndex",new ed(c,4)),u.length>0&&h.setAttribute("skinWeight",new ed(u,4)),i.data=h,i.type=e[0].type,i.materialKeys=d,i}function he(e,t,n,i,r=!1){const s=e.p,a=e.stride,o=e.vcount;function l(e){let t=s[e+n]*u;const a=t+u;for(;t<a;t++)i.push(c[t]);if(r){const e=i.length-u-1;Xe.setRGB(i[e+0],i[e+1],i[e+2],Oc),i[e+0]=Xe.r,i[e+1]=Xe.g,i[e+2]=Xe.b}}const c=t.array,u=t.stride;if(void 0!==e.vcount){let e=0;for(let t=0,n=o.length;t<n;t++){const n=o[t];if(4===n){const t=e+1*a,n=e+2*a,i=e+3*a;l(e+0*a),l(t),l(i),l(t),l(n),l(i)}else if(3===n){const t=e+1*a,n=e+2*a;l(e+0*a),l(t),l(n)}else if(n>4)for(let t=1,i=n-2;t<=i;t++){const n=e+a*t,i=e+a*(t+1);l(e+0*a),l(n),l(i)}e+=a*n}}else for(let e=0,t=s.length;e<t;e+=a)l(e)}function de(e){return d(Ze.geometries[e],ce)}function pe(e){return void 0!==e.build?e.build:e}function fe(e,t){for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"joint":t.joints[i.getAttribute("sid")]=me(i);break;case"link":t.links.push(ve(i))}}}function me(e){let t;for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"prismatic":case"revolute":t=ge(i)}}return t}function ge(e){const t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new wu,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"axis":const e=r(i.textContent);t.axis.fromArray(e);break;case"limits":const n=i.getElementsByTagName("max")[0],s=i.getElementsByTagName("min")[0];t.limits.max=parseFloat(n.textContent),t.limits.min=parseFloat(s.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function ve(e){const t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"attachment_full":t.attachments.push(ye(i));break;case"matrix":case"translate":case"rotate":t.transforms.push(be(i))}}return t}function ye(e){const t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"link":t.links.push(ve(i));break;case"matrix":case"translate":case"rotate":t.transforms.push(be(i))}}return t}function be(e){const t={type:e.nodeName},n=r(e.textContent);switch(t.type){case"matrix":t.obj=new Ju,t.obj.fromArray(n).transpose();break;case"translate":t.obj=new wu,t.obj.fromArray(n);break;case"rotate":t.obj=new wu,t.obj.fromArray(n),t.angle=tu.degToRad(n[3])}return t}function xe(e,t){for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];1===i.nodeType&&"technique_common"===i.nodeName&&_e(i,t)}}function _e(e,t){for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"inertia":t.inertia=r(i.textContent);break;case"mass":t.mass=r(i.textContent)[0]}}}function we(e){const t={target:e.getAttribute("target").split("/").pop()};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1===i.nodeType&&"axis"===i.nodeName){const e=i.getElementsByTagName("param")[0];t.axis=e.textContent;const n=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=n.substring(0,n.length-1)}}return t}function Se(e){return void 0!==e.build?e.build:e}function Me(e){const t=[],n=Be.querySelector('[id="'+e.id+'"]');for(let e=0;e<n.childNodes.length;e++){const i=n.childNodes[e];if(1!==i.nodeType)continue;let s,a;switch(i.nodeName){case"matrix":s=r(i.textContent);const e=(new Ju).fromArray(s).transpose();t.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:e});break;case"translate":case"scale":s=r(i.textContent),a=(new wu).fromArray(s),t.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:a});break;case"rotate":s=r(i.textContent),a=(new wu).fromArray(s);const n=tu.degToRad(s[3]);t.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:a,angle:n})}}return t}const Ee=new Ju,Te=new wu;function Ae(e){const t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new Ju,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1!==i.nodeType)continue;let s;switch(i.nodeName){case"node":t.nodes.push(i.getAttribute("id")),Ae(i);break;case"instance_camera":t.instanceCameras.push(a(i.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Ce(i));break;case"instance_light":t.instanceLights.push(a(i.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Ce(i));break;case"instance_node":t.instanceNodes.push(a(i.getAttribute("url")));break;case"matrix":s=r(i.textContent),t.matrix.multiply(Ee.fromArray(s).transpose()),t.transforms[i.getAttribute("sid")]=i.nodeName;break;case"translate":s=r(i.textContent),Te.fromArray(s),t.matrix.multiply(Ee.makeTranslation(Te.x,Te.y,Te.z)),t.transforms[i.getAttribute("sid")]=i.nodeName;break;case"rotate":s=r(i.textContent);const e=tu.degToRad(s[3]);t.matrix.multiply(Ee.makeRotationAxis(Te.fromArray(s),e)),t.transforms[i.getAttribute("sid")]=i.nodeName;break;case"scale":s=r(i.textContent),t.matrix.scale(Te.fromArray(s)),t.transforms[i.getAttribute("sid")]=i.nodeName;break;case"extra":break;default:console.log(i)}}return Ne(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):Ze.nodes[t.id]=t,t}function Ce(e){const t={id:a(e.getAttribute("url")),materials:{},skeletons:[]};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];switch(i.nodeName){case"bind_material":const e=i.getElementsByTagName("instance_material");for(let n=0;n<e.length;n++){const i=e[n],r=i.getAttribute("symbol"),s=i.getAttribute("target");t.materials[r]=a(s)}break;case"skeleton":t.skeletons.push(a(i.textContent))}}return t}function Re(e,t){const n=[],i=[];let r,s,a;for(r=0;r<e.length;r++){const i=e[r];let s;if(Ne(i))s=De(i),Pe(s,t,n);else if(o=i,void 0!==Ze.visualScenes[o]){const e=Ze.visualScenes[i].children;for(let i=0;i<e.length;i++){const r=e[i];"JOINT"===r.type&&Pe(De(r.id),t,n)}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",i)}var o;for(r=0;r<t.length;r++)for(s=0;s<n.length;s++)if(a=n[s],a.bone.name===t[r].name){i[r]=a,a.processed=!0;break}for(r=0;r<n.length;r++)a=n[r],!1===a.processed&&(i.push(a),a.processed=!0);const l=[],c=[];for(r=0;r<i.length;r++)a=i[r],l.push(a.bone),c.push(a.boneInverse);return new Up(l,c)}function Pe(e,t,n){e.traverse((function(e){if(!0===e.isBone){let i;for(let n=0;n<t.length;n++){const r=t[n];if(r.name===e.name){i=r.boneInverse;break}}void 0===i&&(i=new Ju),n.push({bone:e,boneInverse:i,processed:!1})}}))}function ke(e){const t=[],n=e.matrix,i=e.nodes,r=e.type,s=e.instanceCameras,a=e.instanceControllers,o=e.instanceLights,l=e.instanceGeometries,c=e.instanceNodes;for(let e=0,n=i.length;e<n;e++)t.push(De(i[e]));for(let e=0,n=s.length;e<n;e++){const n=ee(s[e]);null!==n&&t.push(n.clone())}for(let e=0,n=a.length;e<n;e++){const n=a[e],i=(u=n.id,d(Ze.controllers[u],k)),r=Le(de(i.id),n.materials),s=Re(n.skeletons,i.skin.joints);for(let e=0,n=r.length;e<n;e++){const n=r[e];n.isSkinnedMesh&&(n.bind(s,i.skin.bindMatrix),n.normalizeSkinWeights()),t.push(n)}}var u;for(let e=0,n=o.length;e<n;e++){const n=re(o[e]);null!==n&&t.push(n.clone())}for(let e=0,n=l.length;e<n;e++){const n=l[e],i=Le(de(n.id),n.materials);for(let e=0,n=i.length;e<n;e++)t.push(i[e])}for(let e=0,n=c.length;e<n;e++)t.push(De(c[e]).clone());let h;if(0===i.length&&1===t.length)h=t[0];else{h="JOINT"===r?new Lp:new bp;for(let e=0;e<t.length;e++)h.add(t[e])}return h.name="JOINT"===r?e.sid:e.name,h.matrix.copy(n),h.matrix.decompose(h.position,h.quaternion,h.scale),h}const Ie=new Yh({name:mm.DEFAULT_MATERIAL_NAME,color:16711935});function Oe(e,t){const n=[];for(let i=0,r=e.length;i<r;i++){const r=t[e[i]];void 0===r?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[i]),n.push(Ie)):n.push($(r))}return n}function Le(e,t){const n=[];for(const i in e){const r=e[i],s=Oe(r.materialKeys,t);if(0===s.length&&("lines"===i||"linestrips"===i?s.push(new Yp):s.push(new Xf)),"lines"===i||"linestrips"===i)for(let e=0,t=s.length;e<t;e++){const t=s[e];if(!0===t.isMeshPhongMaterial||!0===t.isMeshLambertMaterial){const n=new Yp;n.color.copy(t.color),n.opacity=t.opacity,n.transparent=t.transparent,s[e]=n}}const a=void 0!==r.data.attributes.skinIndex,o=1===s.length?s[0]:s;let l;switch(i){case"lines":l=new of(r.data,o);break;case"linestrips":l=new nf(r.data,o);break;case"triangles":case"polylist":l=a?new Op(r.data,o):new xd(r.data,o)}n.push(l)}return n}function Ne(e){return void 0!==Ze.nodes[e]}function De(e){return d(Ze.nodes[e],ke)}function ze(e){const t=new bp;t.name=e.name;const n=e.children;for(let e=0;e<n.length;e++){const i=n[e];t.add(De(i.id))}return t}function Ue(e){return d(Ze.visualScenes[e],ze)}if(0===e.length)return{scene:new xp};const Fe=(new DOMParser).parseFromString(e,"application/xml"),Be=n(Fe,"COLLADA")[0],Ve=Fe.getElementsByTagName("parsererror")[0];if(void 0!==Ve){const e=n(Ve,"div")[0];let t;return t=e?e.textContent:function(e){let t="";const n=[e];for(;n.length;){const e=n.shift();e.nodeType===Node.TEXT_NODE?t+=e.textContent:(t+="\n",n.push.apply(n,e.childNodes))}return t.trim()}(Ve),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",t),null}const je=Be.getAttribute("version");console.debug("THREE.ColladaLoader: File version",je);const He=function(e){return{unit:l(n(e,"unit")[0]),upAxis:c(n(e,"up_axis")[0])}}(n(Be,"asset")[0]),Ge=new _m(this.manager);let We;Ge.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),Ly&&(We=new Ly(this.manager),We.setPath(this.resourcePath||t));const Xe=new Gh,qe=[];let Ye={},$e=0;const Ze={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};u(Be,"library_animations","animation",(function e(t){const n={sources:{},samplers:{},channels:{}};let i=!1;for(let r=0,s=t.childNodes.length;r<s;r++){const s=t.childNodes[r];if(1!==s.nodeType)continue;let a;switch(s.nodeName){case"source":a=s.getAttribute("id"),n.sources[a]=se(s);break;case"sampler":a=s.getAttribute("id"),n.samplers[a]=p(s);break;case"channel":a=s.getAttribute("target"),n.channels[a]=f(s);break;case"animation":e(s),i=!0;break;default:console.log(s)}}!1===i&&(Ze.animations[t.getAttribute("id")||tu.generateUUID()]=n)})),u(Be,"library_animation_clips","animation_clip",(function(e){const t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];1===i.nodeType&&"instance_animation"===i.nodeName&&t.animations.push(a(i.getAttribute("url")))}Ze.clips[e.getAttribute("id")]=t})),u(Be,"library_controllers","controller",(function(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"skin":t.id=a(i.getAttribute("source")),t.skin=C(i);break;case"morph":t.id=a(i.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Ze.controllers[e.getAttribute("id")]=t})),u(Be,"library_images","image",(function(e){const t={init_from:n(e,"init_from")[0].textContent};Ze.images[e.getAttribute("id")]=t})),u(Be,"library_effects","effect",(function(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];1===i.nodeType&&"profile_COMMON"===i.nodeName&&(t.profile=L(i))}Ze.effects[e.getAttribute("id")]=t})),u(Be,"library_materials","material",(function(e){const t={name:e.getAttribute("name")};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];1===i.nodeType&&"instance_effect"===i.nodeName&&(t.url=a(i.getAttribute("url")))}Ze.materials[e.getAttribute("id")]=t})),u(Be,"library_cameras","camera",(function(e){const t={name:e.getAttribute("name")};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];1===i.nodeType&&"optics"===i.nodeName&&(t.optics=Z(i))}Ze.cameras[e.getAttribute("id")]=t})),u(Be,"library_lights","light",(function(e){let t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];1===i.nodeType&&"technique_common"===i.nodeName&&(t=te(i))}Ze.lights[e.getAttribute("id")]=t})),u(Be,"library_geometries","geometry",(function(e){const t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},i=n(e,"mesh")[0];if(void 0!==i){for(let e=0;e<i.childNodes.length;e++){const n=i.childNodes[e];if(1!==n.nodeType)continue;const r=n.getAttribute("id");switch(n.nodeName){case"source":t.sources[r]=se(n);break;case"vertices":t.vertices=ae(n);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",n.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(oe(n));break;default:console.log(n)}}Ze.geometries[e.getAttribute("id")]=t}})),u(Be,"library_nodes","node",Ae),u(Be,"library_visual_scenes","visual_scene",(function(e){const t={name:e.getAttribute("name"),children:[]};!function(e){const t=e.getElementsByTagName("node");for(let e=0;e<t.length;e++){const n=t[e];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+$e++)}}(e);const i=n(e,"node");for(let e=0;e<i.length;e++)t.children.push(Ae(i[e]));Ze.visualScenes[e.getAttribute("id")]=t})),u(Be,"library_kinematics_models","kinematics_model",(function(e){const t={name:e.getAttribute("name")||"",joints:{},links:[]};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];1===i.nodeType&&"technique_common"===i.nodeName&&fe(i,t)}Ze.kinematicsModels[e.getAttribute("id")]=t})),u(Be,"library_physics_models","physics_model",(function(e){const t={name:e.getAttribute("name")||"",rigidBodies:{}};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];1===i.nodeType&&"rigid_body"===i.nodeName&&(t.rigidBodies[i.getAttribute("name")]={},xe(i,t.rigidBodies[i.getAttribute("name")]))}Ze.physicsModels[e.getAttribute("id")]=t})),u(Be,"scene","instance_kinematics_scene",(function(e){const t={bindJointAxis:[]};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];1===i.nodeType&&"bind_joint_axis"===i.nodeName&&t.bindJointAxis.push(we(i))}Ze.kinematicsScenes[a(e.getAttribute("url"))]=t})),h(Ze.animations,m),h(Ze.clips,T),h(Ze.controllers,k),h(Ze.images,I),h(Ze.effects,q),h(Ze.materials,Y),h(Ze.cameras,Q),h(Ze.lights,ie),h(Ze.geometries,ce),h(Ze.visualScenes,ze),function(){const e=Ze.clips;if(!0===o(e)){if(!1===o(Ze.animations)){const e=[];for(const t in Ze.animations){const n=g(t);for(let t=0,i=n.length;t<i;t++)e.push(n[t])}qe.push(new um("default",-1,e))}}else for(const t in e)qe.push(A(t))}(),function(){const e=Object.keys(Ze.kinematicsModels)[0],t=Object.keys(Ze.kinematicsScenes)[0],n=Object.keys(Ze.visualScenes)[0];if(void 0===e||void 0===t)return;const i=(r=e,d(Ze.kinematicsModels[r],pe));var r;const s=function(e){return d(Ze.kinematicsScenes[e],Se)}(t),a=Ue(n),o=s.bindJointAxis,l={};for(let e=0,t=o.length;e<t;e++){const t=o[e],n=Be.querySelector('[sid="'+t.target+'"]');if(n){const e=n.parentElement;c(t.jointIndex,e)}}function c(e,t){const n=t.getAttribute("name"),r=i.joints[e];a.traverse((function(i){i.name===n&&(l[e]={object:i,transforms:Me(t),joint:r,position:r.zeroPosition})}))}const u=new Ju;Ye={joints:i&&i.joints,getJointValue:function(e){const t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){const n=l[e];if(n){const i=n.joint;if(t>i.limits.max||t<i.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+i.limits.min+", max: "+i.limits.max+").");else if(i.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{const r=n.object,s=i.axis,a=n.transforms;Ee.identity();for(let n=0;n<a.length;n++){const r=a[n];if(r.sid&&-1!==r.sid.indexOf(e))switch(i.type){case"revolute":Ee.multiply(u.makeRotationAxis(s,tu.degToRad(t)));break;case"prismatic":Ee.multiply(u.makeTranslation(s.x*t,s.y*t,s.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+i.type)}else switch(r.type){case"matrix":Ee.multiply(r.obj);break;case"translate":Ee.multiply(u.makeTranslation(r.obj.x,r.obj.y,r.obj.z));break;case"scale":Ee.scale(r.obj);break;case"rotate":Ee.multiply(u.makeRotationAxis(r.obj,r.angle))}}r.matrix.copy(Ee),r.matrix.decompose(r.position,r.quaternion,r.scale),l[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}();const Ke=function(e){return Ue(a(n(e,"instance_visual_scene")[0].getAttribute("url")))}(n(Be,"scene")[0]);return Ke.animations=qe,"Z_UP"===He.upAxis&&(console.warn("THREE.ColladaLoader: You are loading an asset with a Z-UP coordinate system. The loader just rotates the asset to transform it into Y-UP. The vertex data are not converted, see #24289."),Ke.rotation.set(-Math.PI/2,0,0)),Ke.scale.multiplyScalar(He.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),qe},kinematics:Ye,library:Ze,scene:Ke}}}const Dy=new an,zy=new an;class Uy extends $l{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)Dy.fromBufferAttribute(t,e),zy.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+Dy.distanceTo(zy);e.setAttribute("lineDistance",new So(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}const Fy=new an,By=new ur,Vy=new ur;class jy extends Uy{constructor(e){const t=Hy(e),n=new Do,i=[],r=[],s=new po(0,0,1),a=new po(0,1,0);for(let e=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(s.r,s.g,s.b),r.push(a.r,a.g,a.b))}n.setAttribute("position",new So(i,3)),n.setAttribute("color",new So(r,3)),super(n,new Vl({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");Vy.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<t.length;e++){const r=t[e];r.parent&&r.parent.isBone&&(By.multiplyMatrices(Vy,r.matrixWorld),Fy.setFromMatrixPosition(By),i.setXYZ(n,Fy.x,Fy.y,Fy.z),By.multiplyMatrices(Vy,r.parent.matrixWorld),Fy.setFromMatrixPosition(By),i.setXYZ(n+1,Fy.x,Fy.y,Fy.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function Hy(e){const t=[];!0===e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,Hy(e.children[n]));return t}class Gy extends Br{constructor(){super(),this.isGroup=!0,this.type="Group"}}var Wy=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},Xy=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let qy=(()=>{let e,t,n,i=[Ge],r=[],s=ua,a=[],o=[];return class extends s{static{t=this}static{const l="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;n=[Ue],Wy(null,null,n,{kind:"field",name:"threeModel",static:!1,private:!1,access:{has:e=>"threeModel"in e,get:e=>e.threeModel,set:(e,t)=>{e.threeModel=t}},metadata:l},a,o),Wy(null,e={value:t},i,{kind:"class",name:t.name,metadata:l},null,r),t=e.value,l&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:l}),Xy(t,r)}threeModel=Xy(this,a,null);connectedCallback(){super.connectedCallback(),this.createEffect((()=>{this.scene&&this.debug&&function(e){const t=e.scene;if(!t)return;const n=t.three,i=function(e){const t=(n=e,i=(e,t)=>e.endsWith("-model")&&t instanceof Zy,k((()=>n.behaviors.find(i))));var n,i;return k((()=>{const e=t();if(!e)return;const n=e.model;return n?{root:n instanceof Gy?n:n.scene,clips:"animations"in n?n.animations:n.scene.animations}:void 0}))}(e);P((()=>{const e=i();if(!e)return;const{root:t}=e,r=new jy(t);n.add(r);const s=Kr.addRenderTask((()=>{t.updateWorldMatrix(!0,!0),r.updateMatrixWorld(!0)}));L((()=>{Kr.removeRenderTask(s),r.dispose(),n.remove(r)}))}))}(this)}))}constructor(){super(...arguments),Xy(this,o)}},t})();var Yy=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},$y=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let Zy=(()=>{let e,t,n,i=[Ge],r=[],s=ha,a=[],o=[];return class extends s{static{t=this}static{const l="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;n=[Ue],Yy(null,null,n,{kind:"field",name:"model",static:!1,private:!1,access:{has:e=>"model"in e,get:e=>e.model,set:(e,t)=>{e.model=t}},metadata:l},a,o),Yy(null,e={value:t},i,{kind:"class",name:t.name,metadata:l},null,r),t=e.value,l&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:l}),$y(t,r)}requiredElementType(){return[qy]}model=$y(this,a,null);constructor(){super(...arguments),$y(this,o)}},t})();let Ky=(()=>{let e,t,n=[pt("lume-collada-model",oa)],i=[],r=qy;return class extends r{static{t=this}static{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(r[Symbol.metadata]??null):void 0;(function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0})(null,e={value:t},n,{kind:"class",name:t.name,metadata:s},null,i),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e)}(t,i)}initialBehaviors={model:"collada"}},t})();var Jy=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},Qy=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let eb=(()=>{let e,t,n,i=[Yt],r=[],s=Zy,a=[],o=[];return class extends s{static{t=this}static{const l="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;n=[ot,Xt],Jy(null,null,n,{kind:"field",name:"src",static:!1,private:!1,access:{has:e=>"src"in e,get:e=>e.src,set:(e,t)=>{e.src=t}},metadata:l},a,o),Jy(null,e={value:t},i,{kind:"class",name:t.name,metadata:l},null,r),t=e.value,l&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:l}),Qy(t,r)}src=Qy(this,a,"");loader=(Qy(this,o),new Ny);requiredElementType(){return[Ky]}#Mt=0;connectedCallback(){super.connectedCallback(),this.createEffect((()=>{this.src,this.#Et(),L((()=>{this.element.threeModel&&Gs(this.element.threeModel.scene),this.model=void 0,this.element.threeModel=null,this.#Mt++}))}))}#Et(){const{src:e}=this,t=this.#Mt;e&&this.loader.load(e,(e=>t===this.#Mt&&this.#Tt(e)),(e=>t===this.#Mt&&(this.element.emit($m.PROGRESS,e),this.element.dispatchEvent(e))),(e=>t===this.#Mt&&this.#At(e)))}#At(e){const t=`Failed to load ${this.element.tagName.toLowerCase()} with src "${this.src}". See the following error.`;console.warn(t);const n=Qm(e);console.error(n),this.element.emit($m.MODEL_ERROR,n),this.element.dispatchEvent(new Jm(n))}#Tt(e){this.element.three.add(e.scene),this.model=e,this.element.threeModel=e,this.element.emit($m.MODEL_LOAD,{format:"collada",model:e}),this.element.dispatchEvent(new Zm),this.element.needsUpdate()}},t})();globalThis.window?.document&&!elementBehaviors.has("collada-model")&&elementBehaviors.define("collada-model",eb);var tb=Uint8Array,nb=Uint16Array,ib=Int32Array,rb=new tb([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),sb=new tb([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ab=new tb([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ob=function(e,t){for(var n=new nb(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];var r=new ib(n[30]);for(i=1;i<30;++i)for(var s=n[i];s<n[i+1];++s)r[s]=s-n[i]<<5|i;return{b:n,r}},lb=ob(rb,2),cb=lb.b,ub=lb.r;cb[28]=258,ub[258]=28;for(var hb=ob(sb,0),db=hb.b,pb=(hb.r,new nb(32768)),fb=0;fb<32768;++fb){var mb=(43690&fb)>>1|(21845&fb)<<1;mb=(61680&(mb=(52428&mb)>>2|(13107&mb)<<2))>>4|(3855&mb)<<4,pb[fb]=((65280&mb)>>8|(255&mb)<<8)>>1}var gb=function(e,t,n){for(var i=e.length,r=0,s=new nb(t);r<i;++r)e[r]&&++s[e[r]-1];var a,o=new nb(t);for(r=1;r<t;++r)o[r]=o[r-1]+s[r-1]<<1;if(n){a=new nb(1<<t);var l=15-t;for(r=0;r<i;++r)if(e[r])for(var c=r<<4|e[r],u=t-e[r],h=o[e[r]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)a[pb[h]>>l]=c}else for(a=new nb(i),r=0;r<i;++r)e[r]&&(a[r]=pb[o[e[r]-1]++]>>15-e[r]);return a},vb=new tb(288);for(fb=0;fb<144;++fb)vb[fb]=8;for(fb=144;fb<256;++fb)vb[fb]=9;for(fb=256;fb<280;++fb)vb[fb]=7;for(fb=280;fb<288;++fb)vb[fb]=8;var yb=new tb(32);for(fb=0;fb<32;++fb)yb[fb]=5;var bb=gb(vb,9,1),xb=gb(yb,5,1),_b=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},wb=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&n},Sb=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},Mb=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Eb=function(e,t,n){var i=new Error(t||Mb[e]);if(i.code=e,Error.captureStackTrace&&Error.captureStackTrace(i,Eb),!n)throw i;return i},Tb=function(e,t,n,i){var r=e.length,s=i?i.length:0;if(!r||t.f&&!t.l)return n||new tb(0);var a=!n,o=a||2!=t.i,l=t.i;a&&(n=new tb(3*r));var c,u=function(e){var t=n.length;if(e>t){var i=new tb(Math.max(2*t,e));i.set(n),n=i}},h=t.f||0,d=t.p||0,p=t.b||0,f=t.l,m=t.d,g=t.m,v=t.n,y=8*r;do{if(!f){h=wb(e,d,1);var b=wb(e,d+1,3);if(d+=3,!b){var x=e[(c=d,(k=4+((c+7)/8|0))-4)]|e[k-3]<<8,_=k+x;if(_>r){l&&Eb(0);break}o&&u(p+x),n.set(e.subarray(k,_),p),t.b=p+=x,t.p=d=8*_,t.f=h;continue}if(1==b)f=bb,m=xb,g=9,v=5;else if(2==b){var w=wb(e,d,31)+257,S=wb(e,d+10,15)+4,M=w+wb(e,d+5,31)+1;d+=14;for(var E=new tb(M),T=new tb(19),A=0;A<S;++A)T[ab[A]]=wb(e,d+3*A,7);d+=3*S;var C=_b(T),R=(1<<C)-1,P=gb(T,C,1);for(A=0;A<M;){var k,I=P[wb(e,d,R)];if(d+=15&I,(k=I>>4)<16)E[A++]=k;else{var O=0,L=0;for(16==k?(L=3+wb(e,d,3),d+=2,O=E[A-1]):17==k?(L=3+wb(e,d,7),d+=3):18==k&&(L=11+wb(e,d,127),d+=7);L--;)E[A++]=O}}var N=E.subarray(0,w),D=E.subarray(w);g=_b(N),v=_b(D),f=gb(N,g,1),m=gb(D,v,1)}else Eb(1);if(d>y){l&&Eb(0);break}}o&&u(p+131072);for(var z=(1<<g)-1,U=(1<<v)-1,F=d;;F=d){var B=(O=f[Sb(e,d)&z])>>4;if((d+=15&O)>y){l&&Eb(0);break}if(O||Eb(2),B<256)n[p++]=B;else{if(256==B){F=d,f=null;break}var V=B-254;if(B>264){var j=rb[A=B-257];V=wb(e,d,(1<<j)-1)+cb[A],d+=j}var H=m[Sb(e,d)&U],G=H>>4;if(H||Eb(3),d+=15&H,D=db[G],G>3&&(j=sb[G],D+=Sb(e,d)&(1<<j)-1,d+=j),d>y){l&&Eb(0);break}o&&u(p+131072);var W=p+V;if(p<D){var X=s-D,q=Math.min(D,W);for(X+p<0&&Eb(3);p<q;++p)n[p]=i[X+p]}for(;p<W;++p)n[p]=n[p-D]}}t.l=f,t.p=F,t.b=p,t.f=h,f&&(h=1,t.m=g,t.d=m,t.n=v)}while(!h);return p!=n.length&&a?function(e,t,n){return(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length),new tb(e.subarray(t,n))}(n,0,p):n.subarray(0,p)},Ab=new tb(0);function Cb(e,t){return Tb(e.subarray((n=e,i=t&&t.dictionary,(8!=(15&n[0])||n[0]>>4>7||(n[0]<<8|n[1])%31)&&Eb(6,"invalid zlib data"),(n[1]>>5&1)==+!i&&Eb(6,"invalid zlib data: "+(32&n[1]?"need":"unexpected")+" dictionary"),2+(n[1]>>3&4)),-4),{i:2},t&&t.out,t&&t.dictionary);var n,i}var Rb="undefined"!=typeof TextDecoder&&new TextDecoder;try{Rb.decode(Ab,{stream:!0})}catch(e){}function Pb(e,t,n){const i=n.length-e-1;if(t>=n[i])return i-1;if(t<=n[e])return e;let r=e,s=i,a=Math.floor((r+s)/2);for(;t<n[a]||t>=n[a+1];)t<n[a]?s=a:r=a,a=Math.floor((r+s)/2);return a}function kb(e,t){let n=1;for(let t=2;t<=e;++t)n*=t;let i=1;for(let e=2;e<=t;++e)i*=e;for(let n=2;n<=e-t;++n)i*=n;return n/i}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;class Ib extends gf{constructor(e,t,n,i,r){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=r||this.knots.length-1;for(let e=0;e<n.length;++e){const t=n[e];this.controlPoints[e]=new xu(t.x,t.y,t.z,t.w)}}getPoint(e,t=new wu){const n=t,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=function(e,t,n,i){const r=Pb(e,i,t),s=function(e,t,n,i){const r=[],s=[],a=[];r[0]=1;for(let o=1;o<=n;++o){s[o]=t-i[e+1-o],a[o]=i[e+o]-t;let n=0;for(let e=0;e<o;++e){const t=a[e+1],i=s[o-e],l=r[e]/(t+i);r[e]=n+t*l,n=i*l}r[o]=n}return r}(r,i,e,t),a=new xu(0,0,0,0);for(let t=0;t<=e;++t){const i=n[r-e+t],o=s[t],l=i.w*o;a.x+=i.x*l,a.y+=i.y*l,a.z+=i.z*l,a.w+=i.w*o}return a}(this.degree,this.knots,this.controlPoints,i);return 1!==r.w&&r.divideScalar(r.w),n.set(r.x,r.y,r.z)}getTangent(e,t=new wu){const n=t,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=function(e,t,n,i,r){const s=function(e,t,n,i,r){const s=r<e?r:e,a=[],o=Pb(e,i,t),l=function(e,t,n,i,r){const s=[];for(let e=0;e<=n;++e)s[e]=0;const a=[];for(let e=0;e<=i;++e)a[e]=s.slice(0);const o=[];for(let e=0;e<=n;++e)o[e]=s.slice(0);o[0][0]=1;const l=s.slice(0),c=s.slice(0);for(let i=1;i<=n;++i){l[i]=t-r[e+1-i],c[i]=r[e+i]-t;let n=0;for(let e=0;e<i;++e){const t=c[e+1],r=l[i-e];o[i][e]=t+r;const s=o[e][i-1]/o[i][e];o[e][i]=n+t*s,n=r*s}o[i][i]=n}for(let e=0;e<=n;++e)a[0][e]=o[e][n];for(let e=0;e<=n;++e){let t=0,r=1;const l=[];for(let e=0;e<=n;++e)l[e]=s.slice(0);l[0][0]=1;for(let s=1;s<=i;++s){let i=0;const c=e-s,u=n-s;e>=s&&(l[r][0]=l[t][0]/o[u+1][c],i=l[r][0]*o[c][u]);const h=e-1<=u?s-1:n-e;for(let e=c>=-1?1:-c;e<=h;++e)l[r][e]=(l[t][e]-l[t][e-1])/o[u+1][c+e],i+=l[r][e]*o[c+e][u];e<=u&&(l[r][s]=-l[t][s-1]/o[u+1][e],i+=l[r][s]*o[e][u]),a[s][e]=i;const d=t;t=r,r=d}}let u=n;for(let e=1;e<=i;++e){for(let t=0;t<=n;++t)a[e][t]*=u;u*=n-e}return a}(o,i,e,s,t),c=[];for(let e=0;e<n.length;++e){const t=n[e].clone(),i=t.w;t.x*=i,t.y*=i,t.z*=i,c[e]=t}for(let t=0;t<=s;++t){const n=c[o-e].clone().multiplyScalar(l[t][0]);for(let i=1;i<=e;++i)n.add(c[o-e+i].clone().multiplyScalar(l[t][i]));a[t]=n}for(let e=s+1;e<=r+1;++e)a[e]=new xu(0,0,0);return a}(e,t,n,i,r);return function(e){const t=e.length,n=[],i=[];for(let r=0;r<t;++r){const t=e[r];n[r]=new wu(t.x,t.y,t.z),i[r]=t.w}const r=[];for(let e=0;e<t;++e){const t=n[e].clone();for(let n=1;n<=e;++n)t.sub(r[e-n].clone().multiplyScalar(kb(e,n)*i[n]));r[e]=t.divideScalar(i[0])}return r}(s)}(this.degree,this.knots,this.controlPoints,i,1);return n.copy(r[1]).normalize(),n}}let Ob,Lb,Nb;class Db extends mm{constructor(e){super(e)}load(e,t,n,i){const r=this,s=""===r.path?zm.extractUrlBase(e):r.path,a=new ym(this.manager);a.setPath(r.path),a.setResponseType("arraybuffer"),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,(function(n){try{t(r.parse(n,s))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e,t){if(function(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=21&&t===Qb(e,0,21)}(e))Ob=(new Vb).parse(e);else{const t=Qb(e);if(!function(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function i(t){const i=e[t-1];return e=e.slice(n+t),n++,i}for(let e=0;e<t.length;++e)if(i(1)===t[e])return!1;return!0}(t))throw new Error("THREE.FBXLoader: Unknown format.");if(Gb(t)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Gb(t));Ob=(new Bb).parse(t)}const n=new _m(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new zb(n,this.manager).parse(Ob)}}class zb{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){Lb=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),i=this.parseDeformers(),r=(new Ub).parse(i);return this.parseScene(i,r,n),Nb}parseConnections(){const e=new Map;return"Connections"in Ob&&Ob.Connections.connections.forEach((function(t){const n=t[0],i=t[1],r=t[2];e.has(n)||e.set(n,{parents:[],children:[]});const s={ID:i,relationship:r};e.get(n).parents.push(s),e.has(i)||e.set(i,{parents:[],children:[]});const a={ID:n,relationship:r};e.get(i).children.push(a)})),e}parseImages(){const e={},t={};if("Video"in Ob.Objects){const n=Ob.Objects.Video;for(const i in n){const r=n[i];if(e[parseInt(i)]=r.RelativeFilename||r.Filename,"Content"in r){const e=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,s="string"==typeof r.Content&&""!==r.Content;if(e||s){const e=this.parseImage(n[i]);t[r.RelativeFilename||r.Filename]=e}}}}for(const n in e){const i=e[n];void 0!==t[i]?e[n]=t[i]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();let r;switch(i){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),r="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof t)return"data:"+r+";base64,"+t;{const e=new Uint8Array(t);return window.URL.createObjectURL(new Blob([e],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in Ob.Objects){const n=Ob.Objects.Texture;for(const i in n){const r=this.parseTexture(n[i],e);t.set(parseInt(i),r)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const i=e.WrapModeU,r=e.WrapModeV,s=void 0!==i?i.value:0,a=void 0!==r?r.value:0;if(n.wrapS=0===s?Mc:Ec,n.wrapT=0===a?Mc:Ec,"Scaling"in e){const t=e.Scaling.value;n.repeat.x=t[0],n.repeat.y=t[1]}if("Translation"in e){const t=e.Translation.value;n.offset.x=t[0],n.offset.y=t[1]}return n}loadTexture(e,t){const n=new Set(["tga","tif","tiff","exr","dds","hdr","ktx2"]),i=e.FileName.split(".").pop().toLowerCase(),r=n.has(i)?this.manager.getHandler(`.${i}`):this.textureLoader;if(!r)return console.warn(`FBXLoader: ${i.toUpperCase()} loader not found, creating placeholder texture for`,e.RelativeFilename),new bu;const s=r.path;s||r.setPath(this.textureLoader.path);const a=Lb.get(e.id).children;let o;void 0!==a&&a.length>0&&void 0!==t[a[0].ID]&&(o=t[a[0].ID],0!==o.indexOf("blob:")&&0!==o.indexOf("data:")||r.setPath(void 0));const l=r.load(o);return r.setPath(s),l}parseMaterials(e){const t=new Map;if("Material"in Ob.Objects){const n=Ob.Objects.Material;for(const i in n){const r=this.parseMaterial(n[i],e);null!==r&&t.set(parseInt(i),r)}}return t}parseMaterial(e,t){const n=e.id,i=e.attrName;let r=e.ShadingModel;if("object"==typeof r&&(r=r.value),!Lb.has(n))return null;const s=this.parseParameters(e,t,n);let a;switch(r.toLowerCase()){case"phong":a=new Xf;break;case"lambert":a=new qf;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),a=new Xf}return a.setValues(s),a.name=i,a}parseParameters(e,t,n){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=uu.toWorkingColorSpace((new Gh).fromArray(e.Diffuse.value),Oc):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(i.color=uu.toWorkingColorSpace((new Gh).fromArray(e.DiffuseColor.value),Oc)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=uu.toWorkingColorSpace((new Gh).fromArray(e.Emissive.value),Oc):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(i.emissive=uu.toWorkingColorSpace((new Gh).fromArray(e.EmissiveColor.value),Oc)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=uu.toWorkingColorSpace((new Gh).fromArray(e.Specular.value),Oc):e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=uu.toWorkingColorSpace((new Gh).fromArray(e.SpecularColor.value),Oc));const r=this;return Lb.get(n).children.forEach((function(e){const n=e.relationship;switch(n){case"Bump":i.bumpMap=r.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=r.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=r.getTexture(t,e.ID),void 0!==i.map&&(i.map.colorSpace=Oc);break;case"DisplacementColor":i.displacementMap=r.getTexture(t,e.ID);break;case"EmissiveColor":i.emissiveMap=r.getTexture(t,e.ID),void 0!==i.emissiveMap&&(i.emissiveMap.colorSpace=Oc);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=r.getTexture(t,e.ID);break;case"ReflectionColor":i.envMap=r.getTexture(t,e.ID),void 0!==i.envMap&&(i.envMap.mapping=303,i.envMap.colorSpace=Oc);break;case"SpecularColor":i.specularMap=r.getTexture(t,e.ID),void 0!==i.specularMap&&(i.specularMap.colorSpace=Oc);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=r.getTexture(t,e.ID),i.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n)}})),i}getTexture(e,t){return"LayeredTexture"in Ob.Objects&&t in Ob.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Lb.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Ob.Objects){const n=Ob.Objects.Deformer;for(const i in n){const r=n[i],s=Lb.get(parseInt(i));if("Skin"===r.attrType){const t=this.parseSkeleton(s,n);t.ID=i,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=s.parents[0].ID,e[i]=t}else if("BlendShape"===r.attrType){const e={id:i};e.rawTargets=this.parseMorphTargets(s,n),e.id=i,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach((function(e){const i=t[e.ID];if("Cluster"!==i.attrType)return;const r={ID:e.ID,indices:[],weights:[],transformLink:(new Ju).fromArray(i.TransformLink.a)};"Indexes"in i&&(r.indices=i.Indexes.a,r.weights=i.Weights.a),n.push(r)})),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let i=0;i<e.children.length;i++){const r=e.children[i],s=t[r.ID],a={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if("BlendShapeChannel"!==s.attrType)return;a.geoID=Lb.get(parseInt(r.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,n.push(a)}return n}parseScene(e,t,n){Nb=new bp;const i=this.parseModels(e.skeletons,t,n),r=Ob.Objects.Model,s=this;i.forEach((function(e){const t=r[e.ID];s.setLookAtProperties(e,t),Lb.get(e.ID).parents.forEach((function(t){const n=i.get(t.ID);void 0!==n&&n.add(e)})),null===e.parent&&Nb.add(e)})),this.bindSkeleton(e.skeletons,t,i),this.addGlobalSceneSettings(),Nb.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=Zb(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));const a=(new Fb).parse();1===Nb.children.length&&Nb.children[0].isGroup&&(Nb.children[0].animations=a,Nb=Nb.children[0]),Nb.animations=a}parseModels(e,t,n){const i=new Map,r=Ob.Objects.Model;for(const s in r){const a=parseInt(s),o=r[s],l=Lb.get(a);let c=this.buildSkeleton(l,e,a,o.attrName);if(!c){switch(o.attrType){case"Camera":c=this.createCamera(l);break;case"Light":c=this.createLight(l);break;case"Mesh":c=this.createMesh(l,t,n);break;case"NurbsCurve":c=this.createCurve(l,t);break;case"LimbNode":case"Root":c=new Lp;break;default:c=new bp}c.name=o.attrName?Wm.sanitizeNodeName(o.attrName):"",c.userData.originalName=o.attrName,c.ID=a}this.getTransformData(c,o),i.set(a,c)}return i}buildSkeleton(e,t,n,i){let r=null;return e.parents.forEach((function(e){for(const s in t){const a=t[s];a.rawBones.forEach((function(t,s){if(t.ID===e.ID){const e=r;r=new Lp,r.matrixWorld.copy(t.transformLink),r.name=i?Wm.sanitizeNodeName(i):"",r.userData.originalName=i,r.ID=n,a.bones[s]=r,null!==e&&r.add(e)}}))}})),r}createCamera(e){let t,n;if(e.children.forEach((function(e){const t=Ob.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new Eh;else{let e=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(e=1);let i=1;void 0!==n.NearPlane&&(i=n.NearPlane.value/1e3);let r=1e3;void 0!==n.FarPlane&&(r=n.FarPlane.value/1e3);let s=window.innerWidth,a=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,a=n.AspectHeight.value);const o=s/a;let l=45;void 0!==n.FieldOfView&&(l=n.FieldOfView.value);const c=n.FocalLength?n.FocalLength.value:null;switch(e){case 0:t=new Cd(l,o,i,r),null!==c&&t.setFocalLength(c);break;case 1:console.warn("THREE.FBXLoader: Orthographic cameras not supported yet."),t=new Eh;break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new Eh}}return t}createLight(e){let t,n;if(e.children.forEach((function(e){const t=Ob.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new Eh;else{let e;e=void 0===n.LightType?0:n.LightType.value;let i=16777215;void 0!==n.Color&&(i=uu.toWorkingColorSpace((new Gh).fromArray(n.Color.value),Oc));let r=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(r=0);let s=0;void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);const a=1;switch(e){case 0:t=new Om(i,r,s,a);break;case 1:t=new Nm(i,r);break;case 2:let e=Math.PI/3;void 0!==n.InnerAngle&&(e=tu.degToRad(n.InnerAngle.value));let o=0;void 0!==n.OuterAngle&&(o=tu.degToRad(n.OuterAngle.value),o=Math.max(o,1)),t=new Cm(i,r,s,e,o,a);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new Om(i,r)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,n){let i,r=null,s=null;const a=[];return e.children.forEach((function(e){t.has(e.ID)&&(r=t.get(e.ID)),n.has(e.ID)&&a.push(n.get(e.ID))})),a.length>1?s=a:a.length>0?s=a[0]:(s=new Xf({name:mm.DEFAULT_MATERIAL_NAME,color:13421772}),a.push(s)),"color"in r.attributes&&a.forEach((function(e){e.vertexColors=!0})),r.FBX_Deformer?(i=new Op(r,s),i.normalizeSkinWeights()):i=new xd(r,s),i}createCurve(e,t){const n=e.children.reduce((function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e}),null),i=new Yp({name:mm.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new nf(n,i)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder=Kb("RotationOrder"in t?t.RotationOrder.value:0),"Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&Lb.get(e.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){const n=Ob.Objects.Model[t.ID];if("Lcl_Translation"in n){const t=n.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),Nb.add(e.target)):e.lookAt((new wu).fromArray(t))}}}))}bindSkeleton(e,t,n){const i=this.parsePoseNodes();for(const r in e){const s=e[r];Lb.get(parseInt(s.ID)).parents.forEach((function(e){if(t.has(e.ID)){const t=e.ID;Lb.get(t).parents.forEach((function(e){n.has(e.ID)&&n.get(e.ID).bind(new Up(s.bones),i[e.ID])}))}}))}}parsePoseNodes(){const e={};if("Pose"in Ob.Objects){const t=Ob.Objects.Pose;for(const n in t)if("BindPose"===t[n].attrType&&t[n].NbPoseNodes>0){const i=t[n].PoseNode;Array.isArray(i)?i.forEach((function(t){e[t.Node]=(new Ju).fromArray(t.Matrix.a)})):e[i.Node]=(new Ju).fromArray(i.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in Ob){if("AmbientColor"in Ob.GlobalSettings){const e=Ob.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],i=e[2];if(0!==t||0!==n||0!==i){const e=(new Gh).setRGB(t,n,i,Oc);Nb.add(new Dm(e,1))}}"UnitScaleFactor"in Ob.GlobalSettings&&(Nb.userData.unitScaleFactor=Ob.GlobalSettings.UnitScaleFactor.value)}}}class Ub{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in Ob.Objects){const n=Ob.Objects.Geometry;for(const i in n){const r=Lb.get(parseInt(i)),s=this.parseGeometry(r,n[i],e);t.set(parseInt(i),s)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const i=n.skeletons,r=[],s=e.parents.map((function(e){return Ob.Objects.Model[e.ID]}));if(0===s.length)return;const a=e.children.reduce((function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e}),null);e.children.forEach((function(e){void 0!==n.morphTargets[e.ID]&&r.push(n.morphTargets[e.ID])}));const o=s[0],l={};"RotationOrder"in o&&(l.eulerOrder=Kb(o.RotationOrder.value)),"InheritType"in o&&(l.inheritType=parseInt(o.InheritType.value)),"GeometricTranslation"in o&&(l.translation=o.GeometricTranslation.value),"GeometricRotation"in o&&(l.rotation=o.GeometricRotation.value),"GeometricScaling"in o&&(l.scale=o.GeometricScaling.value);const c=Zb(l);return this.genGeometry(t,a,r,c)}genGeometry(e,t,n,i){const r=new ld;e.attrName&&(r.name=e.attrName);const s=this.parseGeoNode(e,t),a=this.genBuffers(s),o=new ed(a.vertex,3);if(o.applyMatrix4(i),r.setAttribute("position",o),a.colors.length>0&&r.setAttribute("color",new ed(a.colors,3)),t&&(r.setAttribute("skinIndex",new Jh(a.weightsIndices,4)),r.setAttribute("skinWeight",new ed(a.vertexWeights,4)),r.FBX_Deformer=t),a.normal.length>0){const e=(new iu).getNormalMatrix(i),t=new ed(a.normal,3);t.applyNormalMatrix(e),r.setAttribute("normal",t)}if(a.uvs.forEach((function(e,t){const n=0===t?"uv":`uv${t}`;r.setAttribute(n,new ed(a.uvs[t],2))})),s.material&&"AllSame"!==s.material.mappingType){let e=a.materialIndex[0],t=0;if(a.materialIndex.forEach((function(n,i){n!==e&&(r.addGroup(t,i-t,e),e=n,t=i)})),r.groups.length>0){const t=r.groups[r.groups.length-1],n=t.start+t.count;n!==a.materialIndex.length&&r.addGroup(n,a.materialIndex.length-n,e)}0===r.groups.length&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,e,n,i),r}parseGeoNode(e,t){const n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(i,r){void 0===n.weightTable[i]&&(n.weightTable[i]=[]),n.weightTable[i].push({id:t,weight:e.weights[r]})}))}))),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,i=0,r=!1,s=[],a=[],o=[],l=[],c=[],u=[];const h=this;return e.vertexIndices.forEach((function(d,p){let f,m=!1;d<0&&(d=~d,m=!0);let g=[],v=[];if(s.push(3*d,3*d+1,3*d+2),e.color){const t=qb(p,n,d,e.color);o.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach((function(e){v.push(e.weight),g.push(e.id)})),v.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const e=[0,0,0,0],t=[0,0,0,0];v.forEach((function(n,i){let r=n,s=g[i];t.forEach((function(t,n,i){if(r>t){i[n]=r,r=t;const a=e[n];e[n]=s,s=a}}))})),g=e,v=t}for(;v.length<4;)v.push(0),g.push(0);for(let e=0;e<4;++e)c.push(v[e]),u.push(g[e])}if(e.normal){const t=qb(p,n,d,e.normal);a.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(f=qb(p,n,d,e.material)[0],f<0&&(h.negativeMaterialIndices=!0,f=0)),e.uv&&e.uv.forEach((function(e,t){const i=qb(p,n,d,e);void 0===l[t]&&(l[t]=[]),l[t].push(i[0]),l[t].push(i[1])})),i++,m&&(h.genFace(t,e,s,f,a,o,l,c,u,i),n++,i=0,s=[],a=[],o=[],l=[],c=[],u=[])})),t}getNormalNewell(e){const t=new wu(0,0,0);for(let n=0;n<e.length;n++){const i=e[n],r=e[(n+1)%e.length];t.x+=(i.y-r.y)*(i.z+r.z),t.y+=(i.z-r.z)*(i.x+r.x),t.z+=(i.x-r.x)*(i.y+r.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){const t=this.getNormalNewell(e),n=(Math.abs(t.z)>.5?new wu(0,1,0):new wu(0,0,1)).cross(t).normalize(),i=t.clone().cross(n).normalize();return{normal:t,tangent:n,bitangent:i}}flattenVertex(e,t,n){return new nu(e.dot(t),e.dot(n))}genFace(e,t,n,i,r,s,a,o,l,c){let u;if(c>3){const e=[],i=t.baseVertexPositions||t.vertexPositions;for(let t=0;t<n.length;t+=3)e.push(new wu(i[n[t]],i[n[t+1]],i[n[t+2]]));const{tangent:r,bitangent:s}=this.getNormalTangentAndBitangent(e),a=[];for(const t of e)a.push(this.flattenVertex(t,r,s));u=Vf.triangulateShape(a,[])}else u=[[0,1,2]];for(const[c,h,d]of u)e.vertex.push(t.vertexPositions[n[3*c]]),e.vertex.push(t.vertexPositions[n[3*c+1]]),e.vertex.push(t.vertexPositions[n[3*c+2]]),e.vertex.push(t.vertexPositions[n[3*h]]),e.vertex.push(t.vertexPositions[n[3*h+1]]),e.vertex.push(t.vertexPositions[n[3*h+2]]),e.vertex.push(t.vertexPositions[n[3*d]]),e.vertex.push(t.vertexPositions[n[3*d+1]]),e.vertex.push(t.vertexPositions[n[3*d+2]]),t.skeleton&&(e.vertexWeights.push(o[4*c]),e.vertexWeights.push(o[4*c+1]),e.vertexWeights.push(o[4*c+2]),e.vertexWeights.push(o[4*c+3]),e.vertexWeights.push(o[4*h]),e.vertexWeights.push(o[4*h+1]),e.vertexWeights.push(o[4*h+2]),e.vertexWeights.push(o[4*h+3]),e.vertexWeights.push(o[4*d]),e.vertexWeights.push(o[4*d+1]),e.vertexWeights.push(o[4*d+2]),e.vertexWeights.push(o[4*d+3]),e.weightsIndices.push(l[4*c]),e.weightsIndices.push(l[4*c+1]),e.weightsIndices.push(l[4*c+2]),e.weightsIndices.push(l[4*c+3]),e.weightsIndices.push(l[4*h]),e.weightsIndices.push(l[4*h+1]),e.weightsIndices.push(l[4*h+2]),e.weightsIndices.push(l[4*h+3]),e.weightsIndices.push(l[4*d]),e.weightsIndices.push(l[4*d+1]),e.weightsIndices.push(l[4*d+2]),e.weightsIndices.push(l[4*d+3])),t.color&&(e.colors.push(s[3*c]),e.colors.push(s[3*c+1]),e.colors.push(s[3*c+2]),e.colors.push(s[3*h]),e.colors.push(s[3*h+1]),e.colors.push(s[3*h+2]),e.colors.push(s[3*d]),e.colors.push(s[3*d+1]),e.colors.push(s[3*d+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(r[3*c]),e.normal.push(r[3*c+1]),e.normal.push(r[3*c+2]),e.normal.push(r[3*h]),e.normal.push(r[3*h+1]),e.normal.push(r[3*h+2]),e.normal.push(r[3*d]),e.normal.push(r[3*d+1]),e.normal.push(r[3*d+2])),t.uv&&t.uv.forEach((function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(a[n][2*c]),e.uvs[n].push(a[n][2*c+1]),e.uvs[n].push(a[n][2*h]),e.uvs[n].push(a[n][2*h+1]),e.uvs[n].push(a[n][2*d]),e.uvs[n].push(a[n][2*d+1])}))}addMorphTargets(e,t,n,i){if(0===n.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;n.forEach((function(n){n.rawTargets.forEach((function(n){const s=Ob.Objects.Geometry[n.geoID];void 0!==s&&r.genMorphGeometry(e,t,s,i,n.name)}))}))}genMorphGeometry(e,t,n,i,r){const s=void 0!==t.Vertices?t.Vertices.a:[],a=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],o=void 0!==n.Vertices?n.Vertices.a:[],l=void 0!==n.Indexes?n.Indexes.a:[],c=3*e.attributes.position.count,u=new Float32Array(c);for(let e=0;e<l.length;e++){const t=3*l[e];u[t]=o[3*e],u[t+1]=o[3*e+1],u[t+2]=o[3*e+2]}const h={vertexIndices:a,vertexPositions:u,baseVertexPositions:s},d=this.genBuffers(h),p=new ed(d.vertex,3);p.name=r||n.attrName,p.applyMatrix4(i),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Normals.a;let r=[];return"IndexToDirect"===n&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:r,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.UV.a;let r=[];return"IndexToDirect"===n&&(r=e.UVIndex.a),{dataSize:2,buffer:i,indices:r,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Colors.a;let r=[];"IndexToDirect"===n&&(r=e.ColorIndex.a);for(let e=0,t=new Gh;e<i.length;e+=4)t.fromArray(i,e),uu.toWorkingColorSpace(t,Oc),t.toArray(i,e);return{dataSize:4,buffer:i,indices:r,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const i=e.Materials.a,r=[];for(let e=0;e<i.length;++e)r.push(e);return{dataSize:1,buffer:i,indices:r,mappingType:t,referenceType:n}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new ld;const n=t-1,i=e.KnotVector.a,r=[],s=e.Points.a;for(let e=0,t=s.length;e<t;e+=4)r.push((new xu).fromArray(s,e));let a,o;if("Closed"===e.Form)r.push(r[0]);else if("Periodic"===e.Form){a=n,o=i.length-1-a;for(let e=0;e<n;++e)r.push(r[e])}const l=new Ib(n,i,r,a,o).getPoints(12*r.length);return(new ld).setFromPoints(l)}}class Fb{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const n in t){const i=t[n],r=this.addClip(i);e.push(r)}return e}parseClips(){if(void 0===Ob.Objects.AnimationCurve)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Ob.Objects.AnimationCurveNode,t=new Map;for(const n in e){const i=e[n];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){const e={id:i.id,attr:i.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){const t=Ob.Objects.AnimationCurve;for(const n in t){const i={id:t[n].id,times:t[n].KeyTime.a.map(Wb),values:t[n].KeyValueFloat.a},r=Lb.get(i.id);if(void 0!==r){const t=r.parents[0].ID,n=r.parents[0].relationship;n.match(/X/)?e.get(t).curves.x=i:n.match(/Y/)?e.get(t).curves.y=i:n.match(/Z/)?e.get(t).curves.z=i:n.match(/DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=i)}}}parseAnimationLayers(e){const t=Ob.Objects.AnimationLayer,n=new Map;for(const i in t){const t=[],r=Lb.get(parseInt(i));void 0!==r&&(r.children.forEach((function(n,i){if(e.has(n.ID)){const r=e.get(n.ID);if(void 0!==r.curves.x||void 0!==r.curves.y||void 0!==r.curves.z){if(void 0===t[i]){const e=Lb.get(n.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==e){const r=Ob.Objects.Model[e.toString()];if(void 0===r)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",n);const s={modelName:r.attrName?Wm.sanitizeNodeName(r.attrName):"",ID:r.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Nb.traverse((function(e){e.ID===r.id&&(s.transform=e.matrix,e.userData.transformData&&(s.eulerOrder=e.userData.transformData.eulerOrder))})),s.transform||(s.transform=new Ju),"PreRotation"in r&&(s.preRotation=r.PreRotation.value),"PostRotation"in r&&(s.postRotation=r.PostRotation.value),t[i]=s}}t[i]&&(t[i][r.attr]=r)}else if(void 0!==r.curves.morph){if(void 0===t[i]){const e=Lb.get(n.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,r=Lb.get(e).parents[0].ID,s=Lb.get(r).parents[0].ID,a=Lb.get(s).parents[0].ID,o=Ob.Objects.Model[a],l={modelName:o.attrName?Wm.sanitizeNodeName(o.attrName):"",morphName:Ob.Objects.Deformer[e].attrName};t[i]=l}t[i][r.attr]=r}}})),n.set(parseInt(i),t))}return n}parseAnimStacks(e){const t=Ob.Objects.AnimationStack,n={};for(const i in t){const r=Lb.get(parseInt(i)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const s=e.get(r[0].ID);n[i]={name:t[i].attrName,layer:s}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach((function(e){t=t.concat(n.generateTracks(e))})),new um(e.name,-1,t)}generateTracks(e){const t=[];let n=new wu,i=new wu;if(e.transform&&e.transform.decompose(n,new _u,i),n=n.toArray(),i=i.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==i&&t.push(i)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){const n=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);void 0!==n&&t.push(n)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){const n=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");void 0!==n&&t.push(n)}if(void 0!==e.DeformPercent){const n=this.generateMorphTrack(e);void 0!==n&&t.push(n)}return t}generateVectorTrack(e,t,n,i){const r=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(r,t,n);return new cm(e+"."+i,r,s)}generateRotationTrack(e,t,n,i,r){let s,a;if(void 0!==t.x&&void 0!==t.y&&void 0!==t.z){const e=this.interpolateRotations(t.x,t.y,t.z,r);s=e[0],a=e[1]}const o=Kb(0);void 0!==n&&((n=n.map(tu.degToRad)).push(o),n=(new lh).fromArray(n),n=(new _u).setFromEuler(n)),void 0!==i&&((i=i.map(tu.degToRad)).push(o),i=(new lh).fromArray(i),i=(new _u).setFromEuler(i).invert());const l=new _u,c=new lh,u=[];if(!a||!s)return new om(e+".quaternion",[0],[0]);for(let e=0;e<a.length;e+=3)c.set(a[e],a[e+1],a[e+2],r),l.setFromEuler(c),void 0!==n&&l.premultiply(n),void 0!==i&&l.multiply(i),e>2&&(new _u).fromArray(u,(e-3)/3*4).dot(l)<0&&l.set(-l.x,-l.y,-l.z,-l.w),l.toArray(u,e/3*4);return new om(e+".quaternion",s,u)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map((function(e){return e/100})),i=Nb.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new sm(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){let e=1,n=t[0];for(let i=1;i<t.length;i++){const r=t[i];r!==n&&(t[e]=r,n=r,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,n){const i=n,r=[];let s=-1,a=-1,o=-1;return e.forEach((function(e){if(t.x&&(s=t.x.times.indexOf(e)),t.y&&(a=t.y.times.indexOf(e)),t.z&&(o=t.z.times.indexOf(e)),-1!==s){const e=t.x.values[s];r.push(e),i[0]=e}else r.push(i[0]);if(-1!==a){const e=t.y.values[a];r.push(e),i[1]=e}else r.push(i[1]);if(-1!==o){const e=t.z.values[o];r.push(e),i[2]=e}else r.push(i[2])})),r}interpolateRotations(e,t,n,i){const r=[],s=[];r.push(e.times[0]),s.push(tu.degToRad(e.values[0])),s.push(tu.degToRad(t.values[0])),s.push(tu.degToRad(n.values[0]));for(let a=1;a<e.values.length;a++){const o=[e.values[a-1],t.values[a-1],n.values[a-1]];if(isNaN(o[0])||isNaN(o[1])||isNaN(o[2]))continue;const l=o.map(tu.degToRad),c=[e.values[a],t.values[a],n.values[a]];if(isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))continue;const u=c.map(tu.degToRad),h=[c[0]-o[0],c[1]-o[1],c[2]-o[2]],d=[Math.abs(h[0]),Math.abs(h[1]),Math.abs(h[2])];if(d[0]>=180||d[1]>=180||d[2]>=180){const t=Math.max(...d)/180,n=new lh(...l,i),o=new lh(...u,i),c=(new _u).setFromEuler(n),h=(new _u).setFromEuler(o);c.dot(h)&&h.set(-h.x,-h.y,-h.z,-h.w);const p=e.times[a-1],f=e.times[a]-p,m=new _u,g=new lh;for(let e=0;e<1;e+=1/t)m.copy(c.clone().slerp(h.clone(),e)),r.push(p+e*f),g.setFromQuaternion(m,i),s.push(g.x),s.push(g.y),s.push(g.z)}else r.push(e.times[a]),s.push(tu.degToRad(e.values[a])),s.push(tu.degToRad(t.values[a])),s.push(tu.degToRad(n.values[a]))}return[r,s]}}class Bb{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Hb,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach((function(e,i){const r=e.match(/^[\s\t]*;/),s=e.match(/^[\s\t]*$/);if(r||s)return;const a=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),o=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");a?t.parseNodeBegin(e,a):o?t.parseNodeProperty(e,o,n[++i]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)})),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),r={name:n},s=this.parseNodeAttr(i),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,r):n in a?("PoseNode"===n?a.PoseNode.push(r):void 0!==a[n].id&&(a[n]={},a[n][a[n].id]=a[n]),""!==s.id&&(a[n][s.id]=r)):"number"==typeof s.id?(a[n]={},a[n][s.id]=r):"Properties70"!==n&&(a[n]="PoseNode"===n?[r]:r),"number"==typeof s.id&&(r.id=s.id),""!==s.name&&(r.attrName=s.name),""!==s.type&&(r.attrType=s.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",i="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:n,type:i}}parseNodeProperty(e,t,n){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===i&&","===r&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());const s=this.getCurrentNode();if("Properties70"!==s.name){if("C"===i){const e=r.split(",").slice(1),t=parseInt(e[0]),n=parseInt(e[1]);let a=r.split(",").slice(3);a=a.map((function(e){return e.trim().replace(/^"/,"")})),i="connections",r=[t,n],function(e,t){for(let n=0,i=e.length,r=t.length;n<r;n++,i++)e[i]=t[n]}(r,a),void 0===s[i]&&(s[i]=[])}"Node"===i&&(s.id=r),i in s&&Array.isArray(s[i])?s[i].push(r):"a"!==i?s[i]=r:s.a=r,this.setCurrentProp(s,i),"a"===i&&","!==r.slice(-1)&&(s.a=Jb(r))}else this.parseNodeSpecialProperty(e,i,r)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=Jb(t.a))}parseNodeSpecialProperty(e,t,n){const i=n.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),r=i[0],s=i[1],a=i[2],o=i[3];let l=i[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=Jb(l)}this.getPrevNode()[r]={type:s,type2:a,flag:o,value:l},this.setCurrentProp(this.getPrevNode(),r)}}class Vb{parse(e){const t=new jb(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const i=new Hb;for(;!this.endOfContent(t);){const e=this.parseNode(t,n);null!==e&&i.add(e.name,e)}return i}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},i=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const s=e.getUint8(),a=e.getString(s);if(0===i)return null;const o=[];for(let t=0;t<r;t++)o.push(this.parseProperty(e));const l=o.length>0?o[0]:"",c=o.length>1?o[1]:"",u=o.length>2?o[2]:"";for(n.singleProperty=1===r&&e.getOffset()===i;i>e.getOffset();){const i=this.parseNode(e,t);null!==i&&this.parseSubNode(a,n,i)}return n.propertyList=o,"number"==typeof l&&(n.id=l),""!==c&&(n.attrName=c),""!==u&&(n.attrType=u),""!==a&&(n.name=a),n}parseSubNode(e,t,n){if(!0===n.singleProperty){const e=n.propertyList[0];Array.isArray(e)?(t[n.name]=n,n.a=e):t[n.name]=e}else if("Connections"===e&&"C"===n.name){const e=[];n.propertyList.forEach((function(t,n){0!==n&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===n.name)Object.keys(n).forEach((function(e){t[e]=n[e]}));else if("Properties70"===e&&"P"===n.name){let e=n.propertyList[0],i=n.propertyList[1];const r=n.propertyList[2],s=n.propertyList[3];let a;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===i.indexOf("Lcl ")&&(i=i.replace("Lcl ","Lcl_")),a="Color"===i||"ColorRGB"===i||"Vector"===i||"Vector3D"===i||0===i.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[e]={type:i,type2:r,flag:s,value:a}}else void 0===t[n.name]?"number"==typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=e.getUint32(),r=e.getUint32(),s=e.getUint32();if(0===r)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}const a=Cb(new Uint8Array(e.getArrayBuffer(s))),o=new jb(a.buffer);switch(t){case"b":case"c":return o.getBooleanArray(i);case"d":return o.getFloat64Array(i);case"f":return o.getFloat32Array(i);case"i":return o.getInt32Array(i);case"l":return o.getInt64Array(i)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class jb{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return!(1&~this.getUint8())}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let n=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const i=n.indexOf(0);return i>=0&&(n=new Uint8Array(this.dv.buffer,t,i)),this._textDecoder.decode(n)}}class Hb{add(e,t){this[e]=t}}function Gb(e){const t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Wb(e){return e/46186158e3}const Xb=[];function qb(e,t,n,i){let r;switch(i.mappingType){case"ByPolygonVertex":r=e;break;case"ByPolygon":r=t;break;case"ByVertice":r=n;break;case"AllSame":r=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}"IndexToDirect"===i.referenceType&&(r=i.indices[r]);const s=r*i.dataSize,a=s+i.dataSize;return function(e,t,n,i){for(let r=n,s=0;r<i;r++,s++)e[s]=t[r];return e}(Xb,i.buffer,s,a)}const Yb=new lh,$b=new wu;function Zb(e){const t=new Ju,n=new Ju,i=new Ju,r=new Ju,s=new Ju,a=new Ju,o=new Ju,l=new Ju,c=new Ju,u=new Ju,h=new Ju,d=new Ju,p=e.inheritType?e.inheritType:0;e.translation&&t.setPosition($b.fromArray(e.translation));const f=Kb(0);if(e.preRotation){const t=e.preRotation.map(tu.degToRad);t.push(f),n.makeRotationFromEuler(Yb.fromArray(t))}if(e.rotation){const t=e.rotation.map(tu.degToRad);t.push(e.eulerOrder||f),i.makeRotationFromEuler(Yb.fromArray(t))}if(e.postRotation){const t=e.postRotation.map(tu.degToRad);t.push(f),r.makeRotationFromEuler(Yb.fromArray(t)),r.invert()}e.scale&&s.scale($b.fromArray(e.scale)),e.scalingOffset&&o.setPosition($b.fromArray(e.scalingOffset)),e.scalingPivot&&a.setPosition($b.fromArray(e.scalingPivot)),e.rotationOffset&&l.setPosition($b.fromArray(e.rotationOffset)),e.rotationPivot&&c.setPosition($b.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h.copy(e.parentMatrix),u.copy(e.parentMatrixWorld));const m=n.clone().multiply(i).multiply(r),g=new Ju;g.extractRotation(u);const v=new Ju;v.copyPosition(u);const y=v.clone().invert().multiply(u),b=g.clone().invert().multiply(y),x=s,_=new Ju;if(0===p)_.copy(g).multiply(m).multiply(b).multiply(x);else if(1===p)_.copy(g).multiply(b).multiply(m).multiply(x);else{const e=(new Ju).scale((new wu).setFromMatrixScale(h)).clone().invert(),t=b.clone().multiply(e);_.copy(g).multiply(m).multiply(t).multiply(x)}const w=c.clone().invert(),S=a.clone().invert();let M=t.clone().multiply(l).multiply(c).multiply(n).multiply(i).multiply(r).multiply(w).multiply(o).multiply(a).multiply(s).multiply(S);const E=(new Ju).copyPosition(M),T=u.clone().multiply(E);return d.copyPosition(T),M=d.clone().multiply(_),M.premultiply(u.invert()),M}function Kb(e){const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function Jb(e){return e.split(",").map((function(e){return parseFloat(e)}))}function Qb(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),(new TextDecoder).decode(new Uint8Array(e,t,n))}let ex=(()=>{let e,t,n=[pt("lume-fbx-model",oa)],i=[],r=qy;return class extends r{static{t=this}static{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(r[Symbol.metadata]??null):void 0;(function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0})(null,e={value:t},n,{kind:"class",name:t.name,metadata:s},null,i),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e)}(t,i)}initialBehaviors={model:"fbx"}},t})();var tx=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},nx=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let ix=(()=>{let e,t,n,i,r=[Yt],s=[],a=Zy,o=[],l=[],c=[],u=[];return class extends a{static{t=this}static{const h="function"==typeof Symbol&&Symbol.metadata?Object.create(a[Symbol.metadata]??null):void 0;n=[ot,Xt],i=[ht,Xt],tx(null,null,n,{kind:"field",name:"src",static:!1,private:!1,access:{has:e=>"src"in e,get:e=>e.src,set:(e,t)=>{e.src=t}},metadata:h},o,l),tx(null,null,i,{kind:"field",name:"centerGeometry",static:!1,private:!1,access:{has:e=>"centerGeometry"in e,get:e=>e.centerGeometry,set:(e,t)=>{e.centerGeometry=t}},metadata:h},c,u),tx(null,e={value:t},r,{kind:"class",name:t.name,metadata:h},null,s),t=e.value,h&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:h}),nx(t,s)}src=nx(this,o,"");centerGeometry=(nx(this,l),nx(this,c,!1));loader=(nx(this,u),new Db);requiredElementType(){return[ex]}#Mt=0;connectedCallback(){super.connectedCallback(),this.createEffect((()=>{const e=k((()=>this.src)),t=k((()=>this.centerGeometry));P((()=>{e(),t(),O((()=>this.#Et())),L((()=>{this.element.threeModel&&Gs(this.element.threeModel),this.model=void 0,this.element.threeModel=null,this.#Mt++}))}))}))}#Et(){const{src:e}=this,t=this.#Mt;e&&this.loader.load(e,(e=>t===this.#Mt&&this.#Tt(e)),(e=>t===this.#Mt&&(this.element.emit($m.PROGRESS,e),this.element.dispatchEvent(e))),(e=>t===this.#Mt&&this.#At(e)))}#At(e){const t=`Failed to load ${this.element.tagName.toLowerCase()} with src "${this.src}". See the following error.`;console.warn(t);const n=Qm(e);console.error(n),this.element.emit($m.MODEL_ERROR,n),this.element.dispatchEvent(new Jm(n))}#Tt(e){if(this.centerGeometry){const t=new pa;t.setFromObject(e);const n=new an;t.getCenter(n),e.position.copy(n.negate())}this.element.three.add(e),this.model=e,this.element.threeModel=e,this.element.emit($m.MODEL_LOAD,{format:"fbx",model:e}),this.element.dispatchEvent(new Zm),this.element.needsUpdate()}},t})();globalThis.window?.document&&!elementBehaviors.has("fbx-model")&&elementBehaviors.define("fbx-model",ix);class rx extends Br{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new _r,this.environmentIntensity=1,this.environmentRotation=new _r,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}const sx=new WeakMap;class ax extends mm{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,i){const r=new ym(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(e=>{this.parse(e,t,i)}),n,i)}parse(e,t,n=()=>{}){this.decodeDracoFile(e,t,null,null,Oc,n).catch(n)}decodeDracoFile(e,t,n,i,r=Lc,s=()=>{}){const a={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n,vertexColorSpace:r};return this.decodeGeometry(e,a).then(t).catch(s)}decodeGeometry(e,t){const n=JSON.stringify(t);if(sx.has(e)){const t=sx.get(e);if(t.key===n)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const r=this.workerNextTaskID++,s=e.byteLength,a=this._getWorker(r,s).then((n=>(i=n,new Promise(((n,s)=>{i._callbacks[r]={resolve:n,reject:s},i.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return a.catch((()=>!0)).then((()=>{i&&r&&this._releaseTask(i,r)})),sx.set(e,{key:n,promise:a}),a}_createGeometry(e){const t=new ld;e.index&&t.setIndex(new Kh(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n],r=i.name,s=i.array,a=i.itemSize,o=new Kh(s,a);"color"===r&&(this._assignVertexColorSpace(o,i.vertexColorSpace),o.normalized=s instanceof Float32Array==0),t.setAttribute(r,o)}return t}_assignVertexColorSpace(e,t){if(t!==Oc)return;const n=new Gh;for(let t=0,i=e.count;t<i;t++)n.fromBufferAttribute(e,t),uu.toWorkingColorSpace(n,Oc),e.setXYZ(t,n.r,n.g,n.b)}_loadLibrary(e,t){const n=new ym(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise(((t,i)=>{n.load(e,t,void 0,i)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{const n=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const i=ox.toString(),r=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const n=t.data;switch(n.type){case"decode":e._callbacks[n.id].resolve(n);break;case"error":e._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function ox(){let e,t;function n(e,t,n,i,r,s){const a=s.num_components(),o=n.num_points()*a,l=o*r.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,r),u=e._malloc(l);t.GetAttributeDataArrayForAllPoints(n,s,c,l,u);const h=new r(e.HEAPF32.buffer,u,o).slice();return e._free(u),{name:i,array:h,itemSize:a}}onmessage=function(i){const r=i.data;switch(r.type){case"init":e=r.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":const i=r.buffer,s=r.taskConfig;t.then((e=>{const t=e.draco,a=new t.Decoder;try{const e=function(e,t,i,r){const s=r.attributeIDs,a=r.attributeTypes;let o,l;const c=t.GetEncodedGeometryType(i);if(c===e.TRIANGULAR_MESH)o=new e.Mesh,l=t.DecodeArrayToMesh(i,i.byteLength,o);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new e.PointCloud,l=t.DecodeArrayToPointCloud(i,i.byteLength,o)}if(!l.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const u={index:null,attributes:[]};for(const i in s){const l=self[a[i]];let c,h;if(r.useUniqueIDs)h=s[i],c=t.GetAttributeByUniqueId(o,h);else{if(h=t.GetAttributeId(o,e[s[i]]),-1===h)continue;c=t.GetAttribute(o,h)}const d=n(e,t,o,i,l,c);"color"===i&&(d.vertexColorSpace=r.vertexColorSpace),u.attributes.push(d)}return c===e.TRIANGULAR_MESH&&(u.index=function(e,t,n){const i=3*n.num_faces(),r=4*i,s=e._malloc(r);t.GetTrianglesUInt32Array(n,r,s);const a=new Uint32Array(e.HEAPF32.buffer,s,i).slice();return e._free(s),{array:a,itemSize:1}}(e,t,o)),e.destroy(o),u}(t,a,new Int8Array(i),s),o=e.attributes.map((e=>e.array.buffer));e.index&&o.push(e.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:e},o)}catch(e){console.error(e),self.postMessage({type:"error",id:r.id,error:e.message})}finally{t.destroy(a)}}))}}}function lx(e,t){if(0===t)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(2===t||1===t){let n=e.getIndex();if(null===n){const t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const i=n.count-2,r=[];if(2===t)for(let e=1;e<=i;e++)r.push(n.getX(0)),r.push(n.getX(e)),r.push(n.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(r.push(n.getX(e)),r.push(n.getX(e+1)),r.push(n.getX(e+2))):(r.push(n.getX(e+2)),r.push(n.getX(e+1)),r.push(n.getX(e)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=e.clone();return s.setIndex(r),s.clearGroups(),s}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}class cx extends mm{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new mx(e)})),this.register((function(e){return new gx(e)})),this.register((function(e){return new Ex(e)})),this.register((function(e){return new Tx(e)})),this.register((function(e){return new Ax(e)})),this.register((function(e){return new yx(e)})),this.register((function(e){return new bx(e)})),this.register((function(e){return new xx(e)})),this.register((function(e){return new _x(e)})),this.register((function(e){return new fx(e)})),this.register((function(e){return new wx(e)})),this.register((function(e){return new vx(e)})),this.register((function(e){return new Mx(e)})),this.register((function(e){return new Sx(e)})),this.register((function(e){return new dx(e)})),this.register((function(e){return new Cx(e)})),this.register((function(e){return new Rx(e)}))}load(e,t,n,i){const r=this;let s;if(""!==this.resourcePath)s=this.resourcePath;else if(""!==this.path){const t=zm.extractUrlBase(e);s=zm.resolveURL(t,this.path)}else s=zm.extractUrlBase(e);this.manager.itemStart(e);const a=function(t){i?i(t):console.error(t),r.manager.itemError(e),r.manager.itemEnd(e)},o=new ym(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{r.parse(n,s,(function(n){t(n),r.manager.itemEnd(e)}),a)}catch(e){a(e)}}),n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let r;const s={},a={},o=new TextDecoder;if("string"==typeof e)r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(o.decode(new Uint8Array(e,0,4))===Px){try{s[hx.KHR_BINARY_GLTF]=new kx(e)}catch(e){return void(i&&i(e))}r=JSON.parse(s[hx.KHR_BINARY_GLTF].content)}else r=JSON.parse(o.decode(e));else r=e;if(void 0===r.asset||r.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new e_(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](l);t.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[t.name]=t,s[t.name]=!0}if(r.extensionsUsed)for(let e=0;e<r.extensionsUsed.length;++e){const t=r.extensionsUsed[e],n=r.extensionsRequired||[];switch(t){case hx.KHR_MATERIALS_UNLIT:s[t]=new px;break;case hx.KHR_DRACO_MESH_COMPRESSION:s[t]=new Ix(r,this.dracoLoader);break;case hx.KHR_TEXTURE_TRANSFORM:s[t]=new Ox;break;case hx.KHR_MESH_QUANTIZATION:s[t]=new Lx;break;default:n.indexOf(t)>=0&&void 0===a[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(s),l.setPlugins(a),l.parse(n,i)}parseAsync(e,t){const n=this;return new Promise((function(i,r){n.parse(e,t,i,r)}))}}function ux(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const hx={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class dx{constructor(e){this.parser=e,this.name=hx.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const i=t[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const r=t.json,s=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let a;const o=new Gh(16777215);void 0!==s.color&&o.setRGB(s.color[0],s.color[1],s.color[2],Lc);const l=void 0!==s.range?s.range:0;switch(s.type){case"directional":a=new Nm(o),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new Om(o),a.distance=l;break;case"spot":a=new Cm(o),a.distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,a.angle=s.spot.outerConeAngle,a.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return a.position.set(0,0,0),a.decay=2,Yx(a,s),void 0!==s.intensity&&(a.intensity=s.intensity),a.name=t.createUniqueName(s.name||"light_"+e),i=Promise.resolve(a),t.cache.add(n,i),i}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,i=n.json.nodes[e],r=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(e){return n._getNodeRef(t.cache,r,e)}))}}class px{constructor(){this.name=hx.KHR_MATERIALS_UNLIT}getMaterialType(){return Yh}extendParams(e,t,n){const i=[];e.color=new Gh(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const t=r.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],Lc),e.opacity=t[3]}void 0!==r.baseColorTexture&&i.push(n.assignTexture(e,"map",r.baseColorTexture,Oc))}return Promise.all(i)}}class fx{constructor(e){this.parser=e,this.name=hx.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}}class mx{constructor(e){this.parser=e,this.name=hx.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Wf:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];if(void 0!==s.clearcoatFactor&&(t.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&r.push(n.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(r.push(n.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const e=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new nu(e,e)}return Promise.all(r)}}class gx{constructor(e){this.parser=e,this.name=hx.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Wf:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.dispersion=void 0!==i.dispersion?i.dispersion:0,Promise.resolve()}}class vx{constructor(e){this.parser=e,this.name=hx.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Wf:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.iridescenceFactor&&(t.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&r.push(n.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(t.iridescenceIOR=s.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&r.push(n.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(r)}}class yx{constructor(e){this.parser=e,this.name=hx.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Wf:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new Gh(0,0,0),t.sheenRoughness=0,t.sheen=1;const s=i.extensions[this.name];if(void 0!==s.sheenColorFactor){const e=s.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],Lc)}return void 0!==s.sheenRoughnessFactor&&(t.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&r.push(n.assignTexture(t,"sheenColorMap",s.sheenColorTexture,Oc)),void 0!==s.sheenRoughnessTexture&&r.push(n.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(r)}}class bx{constructor(e){this.parser=e,this.name=hx.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Wf:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&r.push(n.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(r)}}class xx{constructor(e){this.parser=e,this.name=hx.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Wf:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];t.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&r.push(n.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||1/0;const a=s.attenuationColor||[1,1,1];return t.attenuationColor=(new Gh).setRGB(a[0],a[1],a[2],Lc),Promise.all(r)}}class _x{constructor(e){this.parser=e,this.name=hx.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Wf:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class wx{constructor(e){this.parser=e,this.name=hx.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Wf:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];t.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&r.push(n.assignTexture(t,"specularIntensityMap",s.specularTexture));const a=s.specularColorFactor||[1,1,1];return t.specularColor=(new Gh).setRGB(a[0],a[1],a[2],Lc),void 0!==s.specularColorTexture&&r.push(n.assignTexture(t,"specularColorMap",s.specularColorTexture,Oc)),Promise.all(r)}}class Sx{constructor(e){this.parser=e,this.name=hx.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Wf:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return t.bumpScale=void 0!==s.bumpFactor?s.bumpFactor:1,void 0!==s.bumpTexture&&r.push(n.assignTexture(t,"bumpMap",s.bumpTexture)),Promise.all(r)}}class Mx{constructor(e){this.parser=e,this.name=hx.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Wf:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.anisotropyStrength&&(t.anisotropy=s.anisotropyStrength),void 0!==s.anisotropyRotation&&(t.anisotropyRotation=s.anisotropyRotation),void 0!==s.anisotropyTexture&&r.push(n.assignTexture(t,"anisotropyMap",s.anisotropyTexture)),Promise.all(r)}}class Ex{constructor(e){this.parser=e,this.name=hx.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,s)}}class Tx{constructor(e){this.parser=e,this.name=hx.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const s=r.extensions[t],a=i.images[s.source];let o=n.textureLoader;if(a.uri){const e=n.options.manager.getHandler(a.uri);null!==e&&(o=e)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(e,s.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Ax{constructor(e){this.parser=e,this.name=hx.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const s=r.extensions[t],a=i.images[s.source];let o=n.textureLoader;if(a.uri){const e=n.options.manager.getHandler(a.uri);null!==e&&(o=e)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(e,s.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Cx{constructor(e){this.name=hx.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then((function(t){const n=e.byteOffset||0,i=e.byteLength||0,s=e.count,a=e.byteStride,o=new Uint8Array(t,n,i);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(s,a,o,e.mode,e.filter).then((function(e){return e.buffer})):r.ready.then((function(){const t=new ArrayBuffer(s*a);return r.decodeGltfBuffer(new Uint8Array(t),s,a,o,e.mode,e.filter),t}))}))}return null}}class Rx{constructor(e){this.name=hx.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const i=t.meshes[n.mesh];for(const e of i.primitives)if(e.mode!==Ux.TRIANGLES&&e.mode!==Ux.TRIANGLE_STRIP&&e.mode!==Ux.TRIANGLE_FAN&&void 0!==e.mode)return null;const r=n.extensions[this.name].attributes,s=[],a={};for(const e in r)s.push(this.parser.getDependency("accessor",r[e]).then((t=>(a[e]=t,a[e]))));return s.length<1?null:(s.push(this.parser.createNodeMesh(e)),Promise.all(s).then((e=>{const t=e.pop(),n=t.isGroup?t.children:[t],i=e[0].count,r=[];for(const e of n){const t=new Ju,n=new wu,s=new _u,o=new wu(1,1,1),l=new qp(e.geometry,e.material,i);for(let e=0;e<i;e++)a.TRANSLATION&&n.fromBufferAttribute(a.TRANSLATION,e),a.ROTATION&&s.fromBufferAttribute(a.ROTATION,e),a.SCALE&&o.fromBufferAttribute(a.SCALE,e),l.setMatrixAt(e,t.compose(n,s,o));for(const t in a)if("_COLOR_0"===t){const e=a[t];l.instanceColor=new Fp(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,a[t]);Eh.prototype.copy.call(l,e),this.parser.assignFinalMaterial(l),r.push(l)}return t.isGroup?(t.clear(),t.add(...r),t):r[0]})))}}const Px="glTF";class kx{constructor(e){this.name=hx.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Px)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,r=new DataView(e,12);let s=0;for(;s<i;){const t=r.getUint32(s,!0);s+=4;const i=r.getUint32(s,!0);if(s+=4,1313821514===i){const i=new Uint8Array(e,12+s,t);this.content=n.decode(i)}else if(5130562===i){const n=12+s;this.body=e.slice(n,n+t)}s+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ix{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=hx.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,a={},o={},l={};for(const e in s){const t=Hx[e]||e.toLowerCase();a[t]=s[e]}for(const t in e.attributes){const i=Hx[t]||t.toLowerCase();if(void 0!==s[t]){const r=n.accessors[e.attributes[t]],s=Fx[r.componentType];l[i]=s.name,o[i]=!0===r.normalized}}return t.getDependency("bufferView",r).then((function(e){return new Promise((function(t,n){i.decodeDracoFile(e,(function(e){for(const t in e.attributes){const n=e.attributes[t],i=o[t];void 0!==i&&(n.normalized=i)}t(e)}),a,l,Lc,n)}))}))}}class Ox{constructor(){this.name=hx.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class Lx{constructor(){this.name=hx.KHR_MESH_QUANTIZATION}}class Nx extends Jf{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i;for(let e=0;e!==i;e++)t[e]=n[r+e];return t}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=2*a,l=3*a,c=i-t,u=(n-t)/c,h=u*u,d=h*u,p=e*l,f=p-l,m=-2*d+3*h,g=d-h,v=1-m,y=g-h+u;for(let e=0;e!==a;e++){const t=s[f+e+a],n=s[f+e+o]*c,i=s[p+e+a],l=s[p+e]*c;r[e]=v*t+y*n+m*i+g*l}return r}}const Dx=new _u;class zx extends Nx{interpolate_(e,t,n,i){const r=super.interpolate_(e,t,n,i);return Dx.fromArray(r).normalize().toArray(r),r}}const Ux={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Fx={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Bx={9728:1003,9729:Ac,9984:1004,9985:1007,9986:1005,9987:Cc},Vx={33071:Ec,33648:Tc,10497:Mc},jx={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Hx={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Gx={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Wx={CUBICSPLINE:void 0,LINEAR:kc,STEP:Pc};function Xx(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new Gf({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),e.DefaultMaterial}function qx(e,t,n){for(const i in n.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=n.extensions[i])}function Yx(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function $x(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,i=t.weights.length;n<i;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,i=n.length;t<i;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Zx(e){let t;const n=e.extensions&&e.extensions[hx.KHR_DRACO_MESH_COMPRESSION];if(t=n?"draco:"+n.bufferView+":"+n.indices+":"+Kx(n.attributes):e.indices+":"+Kx(e.attributes)+":"+e.mode,void 0!==e.targets)for(let n=0,i=e.targets.length;n<i;n++)t+=":"+Kx(e.targets[n]);return t}function Kx(e){let t="";const n=Object.keys(e).sort();for(let i=0,r=n.length;i<r;i++)t+=n[i]+":"+e[n[i]]+";";return t}function Jx(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const Qx=new Ju;class e_{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new ux,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=-1,r=!1,s=-1;if("undefined"!=typeof navigator){const e=navigator.userAgent;n=!0===/^((?!chrome|android).)*safari/i.test(e);const t=e.match(/Version\/(\d+)/);i=n&&t?parseInt(t[1],10):-1,r=e.indexOf("Firefox")>-1,s=r?e.match(/Firefox\/([0-9]+)\./)[1]:-1}"undefined"==typeof createImageBitmap||n&&i<17||r&&s<98?this.textureLoader=new _m(this.options.manager):this.textureLoader=new Um(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ym(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){const s={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:n,userData:{}};return qx(r,s,i),Yx(s,i),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(s)}))).then((function(){for(const e of s.scenes)e.updateMatrixWorld();e(s)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let n=0,i=t.length;n<i;n++){const i=t[n].joints;for(let t=0,n=i.length;t<n;t++)e[i[t]].isBone=!0}for(let t=0,i=e.length;t<i;t++){const i=e[t];void 0!==i.mesh&&(this._addNodeRef(this.meshCache,i.mesh),void 0!==i.skin&&(n[i.mesh].isSkinnedMesh=!0)),void 0!==i.camera&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),r=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[n,i]of e.children.entries())r(i,t.children[n])};return r(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const r=e(t[i]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":i=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":i=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne((function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)})),!i)throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map((function(t,i){return n.getDependency(e,i)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[hx.KHR_BINARY_GLTF].body);const i=this.options;return new Promise((function(e,r){n.load(zm.resolveURL(t.uri,i.path),e,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const n=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+n)}))}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){const e=jx[i.type],t=Fx[i.componentType],n=!0===i.normalized,r=new t(i.count*e);return Promise.resolve(new Kh(r,e,n))}const r=[];return void 0!==i.bufferView?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),void 0!==i.sparse&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then((function(e){const r=e[0],s=jx[i.type],a=Fx[i.componentType],o=a.BYTES_PER_ELEMENT,l=o*s,c=i.byteOffset||0,u=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,h=!0===i.normalized;let d,p;if(u&&u!==l){const e=Math.floor(c/u),n="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count;let l=t.cache.get(n);l||(d=new a(r,e*u,i.count*u/o),l=new _p(d,u/o),t.cache.add(n,l)),p=new Sp(l,s,c%u/o,h)}else d=null===r?new a(i.count*s):new a(r,c,i.count*s),p=new Kh(d,s,h);if(void 0!==i.sparse){const t=jx.SCALAR,n=Fx[i.sparse.indices.componentType],o=i.sparse.indices.byteOffset||0,l=i.sparse.values.byteOffset||0,c=new n(e[1],o,i.sparse.count*t),u=new a(e[2],l,i.sparse.count*s);null!==r&&(p=new Kh(p.array.slice(),p.itemSize,p.normalized)),p.normalized=!1;for(let e=0,t=c.length;e<t;e++){const t=c[e];if(p.setX(t,u[e*s]),s>=2&&p.setY(t,u[e*s+1]),s>=3&&p.setZ(t,u[e*s+2]),s>=4&&p.setW(t,u[e*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}p.normalized=h}return p}))}loadTexture(e){const t=this.json,n=this.options,i=t.textures[e].source,r=t.images[i];let s=this.textureLoader;if(r.uri){const e=n.manager.getHandler(r.uri);null!==e&&(s=e)}return this.loadTextureImage(e,i,s)}loadTextureImage(e,t,n){const i=this,r=this.json,s=r.textures[e],a=r.images[t],o=(a.uri||a.bufferView)+":"+s.sampler;if(this.textureCache[o])return this.textureCache[o];const l=this.loadImageSource(t,n).then((function(t){t.flipY=!1,t.name=s.name||a.name||"",""===t.name&&"string"==typeof a.uri&&!1===a.uri.startsWith("data:image/")&&(t.name=a.uri);const n=(r.samplers||{})[s.sampler]||{};return t.magFilter=Bx[n.magFilter]||Ac,t.minFilter=Bx[n.minFilter]||Cc,t.wrapS=Vx[n.wrapS]||Mc,t.wrapT=Vx[n.wrapT]||Mc,i.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[o]=l,l}loadImageSource(e,t){const n=this.json,i=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const r=n.images[e],s=self.URL||self.webkitURL;let a=r.uri||"",o=!1;if(void 0!==r.bufferView)a=this.getDependency("bufferView",r.bufferView).then((function(e){o=!0;const t=new Blob([e],{type:r.mimeType});return a=s.createObjectURL(t),a}));else if(void 0===r.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(a).then((function(e){return new Promise((function(n,r){let s=n;!0===t.isImageBitmapLoader&&(s=function(e){const t=new bu(e);t.needsUpdate=!0,n(t)}),t.load(zm.resolveURL(e,i.path),s,void 0,r)}))})).then((function(e){var t;return!0===o&&s.revokeObjectURL(a),Yx(e,r),e.userData.mimeType=r.mimeType||((t=r.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),e}));return this.sourceCache[e]=l,l}assignTexture(e,t,n,i){const r=this;return this.getDependency("texture",n.index).then((function(s){if(!s)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((s=s.clone()).channel=n.texCoord),r.extensions[hx.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[hx.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=r.associations.get(s);s=r.extensions[hx.KHR_TEXTURE_TRANSFORM].extendTexture(s,e),r.associations.set(s,t)}}return void 0!==i&&(s.colorSpace=i),e[t]=s,s}))}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=void 0===t.attributes.tangent,r=void 0!==t.attributes.color,s=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new cf,qh.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new Yp,qh.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,this.cache.add(e,t)),n=t}if(i||r||s){let e="ClonedMaterial:"+n.uuid+":";i&&(e+="derivative-tangents:"),r&&(e+="vertex-colors:"),s&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),r&&(t.vertexColors=!0),s&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}e.material=n}getMaterialType(){return Gf}loadMaterial(e){const t=this,n=this.json,i=this.extensions,r=n.materials[e];let s;const a={},o=[];if((r.extensions||{})[hx.KHR_MATERIALS_UNLIT]){const e=i[hx.KHR_MATERIALS_UNLIT];s=e.getMaterialType(),o.push(e.extendParams(a,r,t))}else{const n=r.pbrMetallicRoughness||{};if(a.color=new Gh(1,1,1),a.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;a.color.setRGB(e[0],e[1],e[2],Lc),a.opacity=e[3]}void 0!==n.baseColorTexture&&o.push(t.assignTexture(a,"map",n.baseColorTexture,Oc)),a.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,a.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(o.push(t.assignTexture(a,"metalnessMap",n.metallicRoughnessTexture)),o.push(t.assignTexture(a,"roughnessMap",n.metallicRoughnessTexture))),s=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),o.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)}))))}!0===r.doubleSided&&(a.side=2);const l=r.alphaMode||"OPAQUE";if("BLEND"===l?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,"MASK"===l&&(a.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&s!==Yh&&(o.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new nu(1,1),void 0!==r.normalTexture.scale)){const e=r.normalTexture.scale;a.normalScale.set(e,e)}if(void 0!==r.occlusionTexture&&s!==Yh&&(o.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(a.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&s!==Yh){const e=r.emissiveFactor;a.emissive=(new Gh).setRGB(e[0],e[1],e[2],Lc)}return void 0!==r.emissiveTexture&&s!==Yh&&o.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture,Oc)),Promise.all(o).then((function(){const n=new s(a);return r.name&&(n.name=r.name),Yx(n,r),t.associations.set(n,{materials:e}),r.extensions&&qx(i,n,r),n}))}createUniqueName(e){const t=Wm.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function r(e){return n[hx.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return t_(n,e,t)}))}const s=[];for(let n=0,a=e.length;n<a;n++){const a=e[n],o=Zx(a),l=i[o];if(l)s.push(l.promise);else{let e;e=a.extensions&&a.extensions[hx.KHR_DRACO_MESH_COMPRESSION]?r(a):t_(new ld,a,t),i[o]={primitive:a,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){const t=this,n=this.json,i=this.extensions,r=n.meshes[e],s=r.primitives,a=[];for(let e=0,t=s.length;e<t;e++){const t=void 0===s[e].material?Xx(this.cache):this.getDependency("material",s[e].material);a.push(t)}return a.push(t.loadGeometries(s)),Promise.all(a).then((function(n){const a=n.slice(0,n.length-1),o=n[n.length-1],l=[];for(let n=0,c=o.length;n<c;n++){const c=o[n],u=s[n];let h;const d=a[n];if(u.mode===Ux.TRIANGLES||u.mode===Ux.TRIANGLE_STRIP||u.mode===Ux.TRIANGLE_FAN||void 0===u.mode)h=!0===r.isSkinnedMesh?new Op(c,d):new xd(c,d),!0===h.isSkinnedMesh&&h.normalizeSkinWeights(),u.mode===Ux.TRIANGLE_STRIP?h.geometry=lx(h.geometry,1):u.mode===Ux.TRIANGLE_FAN&&(h.geometry=lx(h.geometry,2));else if(u.mode===Ux.LINES)h=new of(c,d);else if(u.mode===Ux.LINE_STRIP)h=new nf(c,d);else if(u.mode===Ux.LINE_LOOP)h=new lf(c,d);else{if(u.mode!==Ux.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);h=new ff(c,d)}Object.keys(h.geometry.morphAttributes).length>0&&$x(h,r),h.name=t.createUniqueName(r.name||"mesh_"+e),Yx(h,r),u.extensions&&qx(i,h,u),t.assignFinalMaterial(h),l.push(h)}for(let n=0,i=l.length;n<i;n++)t.associations.set(l[n],{meshes:e,primitives:n});if(1===l.length)return r.extensions&&qx(i,l[0],r),l[0];const c=new bp;r.extensions&&qx(i,c,r),t.associations.set(c,{meshes:e});for(let e=0,t=l.length;e<t;e++)c.add(l[e]);return c}))}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new Cd(tu.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new yp(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Yx(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n=[];for(let e=0,i=t.joints.length;e<i;e++)n.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then((function(e){const n=e.pop(),i=e,r=[],s=[];for(let e=0,a=i.length;e<a;e++){const a=i[e];if(a){r.push(a);const t=new Ju;null!==n&&t.fromArray(n.array,16*e),s.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}return new Up(r,s)}))}loadAnimation(e){const t=this.json,n=this,i=t.animations[e],r=i.name?i.name:"animation_"+e,s=[],a=[],o=[],l=[],c=[];for(let e=0,t=i.channels.length;e<t;e++){const t=i.channels[e],n=i.samplers[t.sampler],r=t.target,u=r.node,h=void 0!==i.parameters?i.parameters[n.input]:n.input,d=void 0!==i.parameters?i.parameters[n.output]:n.output;void 0!==r.node&&(s.push(this.getDependency("node",u)),a.push(this.getDependency("accessor",h)),o.push(this.getDependency("accessor",d)),l.push(n),c.push(r))}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(o),Promise.all(l),Promise.all(c)]).then((function(e){const t=e[0],i=e[1],s=e[2],a=e[3],o=e[4],l=[];for(let e=0,r=t.length;e<r;e++){const r=t[e],c=i[e],u=s[e],h=a[e],d=o[e];if(void 0===r)continue;r.updateMatrix&&r.updateMatrix();const p=n._createAnimationTracks(r,c,u,h,d);if(p)for(let e=0;e<p.length;e++)l.push(p[e])}return new um(r,void 0,l)}))}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then((function(e){const t=n._getNodeRef(n.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,n=i.weights.length;t<n;t++)e.morphTargetInfluences[t]=i.weights[t]})),t}))}loadNode(e){const t=this,n=this.json.nodes[e],i=t._loadNodeShallow(e),r=[],s=n.children||[];for(let e=0,n=s.length;e<n;e++)r.push(t.getDependency("node",s[e]));const a=void 0===n.skin?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([i,Promise.all(r),a]).then((function(e){const t=e[0],n=e[1],i=e[2];null!==i&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(i,Qx)}));for(let e=0,i=n.length;e<i;e++)t.add(n[e]);return t}))}_loadNodeShallow(e){const t=this.json,n=this.extensions,i=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const r=t.nodes[e],s=r.name?i.createUniqueName(r.name):"",a=[],o=i._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return o&&a.push(o),void 0!==r.camera&&a.push(i.getDependency("camera",r.camera).then((function(e){return i._getNodeRef(i.cameraCache,r.camera,e)}))),i._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){a.push(e)})),this.nodeCache[e]=Promise.all(a).then((function(t){let a;if(a=!0===r.isBone?new Lp:t.length>1?new bp:1===t.length?t[0]:new Eh,a!==t[0])for(let e=0,n=t.length;e<n;e++)a.add(t[e]);if(r.name&&(a.userData.name=r.name,a.name=s),Yx(a,r),r.extensions&&qx(n,a,r),void 0!==r.matrix){const e=new Ju;e.fromArray(r.matrix),a.applyMatrix4(e)}else void 0!==r.translation&&a.position.fromArray(r.translation),void 0!==r.rotation&&a.quaternion.fromArray(r.rotation),void 0!==r.scale&&a.scale.fromArray(r.scale);return i.associations.has(a)||i.associations.set(a,{}),i.associations.get(a).nodes=e,a})),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],i=this,r=new bp;n.name&&(r.name=i.createUniqueName(n.name)),Yx(r,n),n.extensions&&qx(t,r,n);const s=n.nodes||[],a=[];for(let e=0,t=s.length;e<t;e++)a.push(i.getDependency("node",s[e]));return Promise.all(a).then((function(e){for(let t=0,n=e.length;t<n;t++)r.add(e[t]);return i.associations=(e=>{const t=new Map;for(const[e,n]of i.associations)(e instanceof qh||e instanceof bu)&&t.set(e,n);return e.traverse((e=>{const n=i.associations.get(e);null!=n&&t.set(e,n)})),t})(r),r}))}_createAnimationTracks(e,t,n,i,r){const s=[],a=e.name?e.name:e.uuid,o=[];let l;switch(Gx[r.path]===Gx.weights?e.traverse((function(e){e.morphTargetInfluences&&o.push(e.name?e.name:e.uuid)})):o.push(a),Gx[r.path]){case Gx.weights:l=sm;break;case Gx.rotation:l=om;break;case Gx.position:case Gx.scale:l=cm;break;default:l=1===n.itemSize?sm:cm}const c=void 0!==i.interpolation?Wx[i.interpolation]:kc,u=this._getArrayFromAccessor(n);for(let e=0,n=o.length;e<n;e++){const n=new l(o[e]+"."+Gx[r.path],t.array,u,c);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(n),s.push(n)}return s}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=Jx(t.constructor),n=new Float32Array(t.length);for(let i=0,r=t.length;i<r;i++)n[i]=t[i]*e;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof om?zx:Nx)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function t_(e,t,n){const i=t.attributes,r=[];function s(t,i){return n.getDependency("accessor",t).then((function(t){e.setAttribute(i,t)}))}for(const t in i){const n=Hx[t]||t.toLowerCase();n in e.attributes||r.push(s(i[t],n))}if(void 0!==t.indices&&!e.index){const i=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));r.push(i)}return uu.workingColorSpace!==Lc&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${uu.workingColorSpace}" not supported.`),Yx(e,t),function(e,t,n){const i=t.attributes,r=new Eu;if(void 0===i.POSITION)return;{const e=n.json.accessors[i.POSITION],t=e.min,s=e.max;if(void 0===t||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new wu(t[0],t[1],t[2]),new wu(s[0],s[1],s[2])),e.normalized){const t=Jx(Fx[e.componentType]);r.min.multiplyScalar(t),r.max.multiplyScalar(t)}}const s=t.targets;if(void 0!==s){const e=new wu,t=new wu;for(let i=0,r=s.length;i<r;i++){const r=s[i];if(void 0!==r.POSITION){const i=n.json.accessors[r.POSITION],s=i.min,a=i.max;if(void 0!==s&&void 0!==a){if(t.setX(Math.max(Math.abs(s[0]),Math.abs(a[0]))),t.setY(Math.max(Math.abs(s[1]),Math.abs(a[1]))),t.setZ(Math.max(Math.abs(s[2]),Math.abs(a[2]))),i.normalized){const e=Jx(Fx[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(e)}e.boundingBox=r;const a=new Hu;r.getCenter(a.center),a.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=a}(e,t,n),Promise.all(r).then((function(){return void 0!==t.targets?function(e,t,n){let i=!1,r=!1,s=!1;for(let e=0,n=t.length;e<n;e++){const n=t[e];if(void 0!==n.POSITION&&(i=!0),void 0!==n.NORMAL&&(r=!0),void 0!==n.COLOR_0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(e);const a=[],o=[],l=[];for(let c=0,u=t.length;c<u;c++){const u=t[c];if(i){const t=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):e.attributes.position;a.push(t)}if(r){const t=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):e.attributes.normal;o.push(t)}if(s){const t=void 0!==u.COLOR_0?n.getDependency("accessor",u.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l)]).then((function(t){const n=t[0],a=t[1],o=t[2];return i&&(e.morphAttributes.position=n),r&&(e.morphAttributes.normal=a),s&&(e.morphAttributes.color=o),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}let n_=(()=>{let e,t,n=[pt("lume-gltf-model",oa)],i=[],r=qy;return class extends r{static{t=this}static{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(r[Symbol.metadata]??null):void 0;(function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0})(null,e={value:t},n,{kind:"class",name:t.name,metadata:s},null,i),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e)}(t,i)}initialBehaviors={model:"gltf"}},t})();var i_=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},r_=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let s_=new Map,a_=(()=>{let e,t,n,i,r,s=[Yt],a=[],o=Zy,l=[],c=[],u=[],h=[],d=[],p=[];return class extends o{static{t=this}static{const f="function"==typeof Symbol&&Symbol.metadata?Object.create(o[Symbol.metadata]??null):void 0;n=[et,Xt],i=[ot,Xt],r=[ht,Xt],i_(null,null,n,{kind:"field",name:"src",static:!1,private:!1,access:{has:e=>"src"in e,get:e=>e.src,set:(e,t)=>{e.src=t}},metadata:f},l,c),i_(null,null,i,{kind:"field",name:"dracoDecoder",static:!1,private:!1,access:{has:e=>"dracoDecoder"in e,get:e=>e.dracoDecoder,set:(e,t)=>{e.dracoDecoder=t}},metadata:f},u,h),i_(null,null,r,{kind:"field",name:"centerGeometry",static:!1,private:!1,access:{has:e=>"centerGeometry"in e,get:e=>e.centerGeometry,set:(e,t)=>{e.centerGeometry=t}},metadata:f},d,p),i_(null,e={value:t},s,{kind:"class",name:t.name,metadata:f},null,a),t=e.value,f&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:f}),r_(t,a)}src=r_(this,l,"");dracoDecoder=(r_(this,c),r_(this,u,"https://www.gstatic.com/draco/v1/decoders/"));centerGeometry=(r_(this,h),r_(this,d,!1));loader=(r_(this,p),new cx);requiredElementType(){return[n_]}#Mt=0;connectedCallback(){super.connectedCallback(),this.createEffect((()=>{const e=k((()=>this.dracoDecoder));P((()=>{if(!e())return;const t=function(e){let t;if(s_.has(e)){const n=s_.get(e);n.count++,t=n.dracoLoader}else t=new ax,t.setDecoderPath(e),s_.set(e,{count:1,dracoLoader:t});return t}(e());this.loader.dracoLoader=t,L((()=>{!function(e){if(!s_.has(e))return;const t=s_.get(e);t.count--,t.count||(t.dracoLoader.dispose(),s_.delete(e))}(e()),this.loader.dracoLoader=null}))}));const t=k((()=>this.src)),n=k((()=>this.centerGeometry));P((()=>{t(),e(),n(),O((()=>this.#Et())),L((()=>{this.element.threeModel&&Gs(this.element.threeModel.scene),this.model=null,this.element.threeModel=null,this.#Mt++}))}))}))}#Et(){const{src:e}=this,t=this.#Mt;e&&this.loader.load(e,(e=>t==this.#Mt&&this.#Tt(e)),(e=>t==this.#Mt&&(this.element.emit($m.PROGRESS,e),this.element.dispatchEvent(e))),(e=>t==this.#Mt&&this.#At(e)))}#At(e){const t=`Failed to load ${this.element.tagName.toLowerCase()} with src "${this.src}" and dracoDecoder "${this.dracoDecoder}". See the following error.`;console.warn(t);const n=Qm(e);console.error(n),this.element.emit($m.MODEL_ERROR,n),this.element.dispatchEvent(new Jm(n))}#Tt(e){if(e.scene=e.scene||(new rx).add(...e.scenes),this.centerGeometry){const t=new pa;t.setFromObject(e.scene);const n=new an;t.getCenter(n),e.scene.position.copy(n.negate())}this.element.three.add(e.scene),this.model=e,this.element.threeModel=e,this.element.emit($m.MODEL_LOAD,{format:"gltf",model:e}),this.element.dispatchEvent(new Zm),this.element.needsUpdate()}},t})();globalThis.window?.document&&!elementBehaviors.has("gltf-model")&&elementBehaviors.define("gltf-model",a_);const o_=/^[og]\s*(.+)?/,l_=/^mtllib /,c_=/^usemtl /,u_=/^usemap /,h_=/\s+/,d_=new wu,p_=new wu,f_=new wu,m_=new wu,g_=new wu,v_=new Gh;function y_(){const e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);const n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){const n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);const i={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){const t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){const t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(let e=this.materials.length-1;e>=0;e--)this.materials[e].groupCount<=0&&this.materials.splice(e,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"==typeof n.clone){const e=n.clone(0);e.inherited=!0,this.object.materials.push(e)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){const n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){const i=this.vertices,r=this.object.geometry.vertices;r.push(i[e+0],i[e+1],i[e+2]),r.push(i[t+0],i[t+1],i[t+2]),r.push(i[n+0],i[n+1],i[n+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){const i=this.normals,r=this.object.geometry.normals;r.push(i[e+0],i[e+1],i[e+2]),r.push(i[t+0],i[t+1],i[t+2]),r.push(i[n+0],i[n+1],i[n+2])},addFaceNormal:function(e,t,n){const i=this.vertices,r=this.object.geometry.normals;d_.fromArray(i,e),p_.fromArray(i,t),f_.fromArray(i,n),g_.subVectors(f_,p_),m_.subVectors(d_,p_),g_.cross(m_),g_.normalize(),r.push(g_.x,g_.y,g_.z),r.push(g_.x,g_.y,g_.z),r.push(g_.x,g_.y,g_.z)},addColor:function(e,t,n){const i=this.colors,r=this.object.geometry.colors;void 0!==i[e]&&r.push(i[e+0],i[e+1],i[e+2]),void 0!==i[t]&&r.push(i[t+0],i[t+1],i[t+2]),void 0!==i[n]&&r.push(i[n+0],i[n+1],i[n+2])},addUV:function(e,t,n){const i=this.uvs,r=this.object.geometry.uvs;r.push(i[e+0],i[e+1]),r.push(i[t+0],i[t+1]),r.push(i[n+0],i[n+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,i,r,s,a,o,l){const c=this.vertices.length;let u=this.parseVertexIndex(e,c),h=this.parseVertexIndex(t,c),d=this.parseVertexIndex(n,c);if(this.addVertex(u,h,d),this.addColor(u,h,d),void 0!==a&&""!==a){const e=this.normals.length;u=this.parseNormalIndex(a,e),h=this.parseNormalIndex(o,e),d=this.parseNormalIndex(l,e),this.addNormal(u,h,d)}else this.addFaceNormal(u,h,d);if(void 0!==i&&""!==i){const e=this.uvs.length;u=this.parseUVIndex(i,e),h=this.parseUVIndex(r,e),d=this.parseUVIndex(s,e),this.addUV(u,h,d),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let n=0,i=e.length;n<i;n++){const i=this.parseVertexIndex(e[n],t);this.addVertexPoint(i),this.addColor(i)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const n=this.vertices.length,i=this.uvs.length;for(let t=0,i=e.length;t<i;t++)this.addVertexLine(this.parseVertexIndex(e[t],n));for(let e=0,n=t.length;e<n;e++)this.addUVLine(this.parseUVIndex(t[e],i))}};return e.startObject("",!1),e}class b_ extends mm{constructor(e){super(e),this.materials=null}load(e,t,n,i){const r=this,s=new ym(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{t(r.parse(n))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}setMaterials(e){return this.materials=e,this}parse(e){const t=new y_;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));const n=e.split("\n");let i=[];for(let e=0,r=n.length;e<r;e++){const r=n[e].trimStart();if(0===r.length)continue;const s=r.charAt(0);if("#"!==s)if("v"===s){const e=r.split(h_);switch(e[0]){case"v":t.vertices.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])),e.length>=7?(v_.setRGB(parseFloat(e[4]),parseFloat(e[5]),parseFloat(e[6]),Oc),t.colors.push(v_.r,v_.g,v_.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"vt":t.uvs.push(parseFloat(e[1]),parseFloat(e[2]))}}else if("f"===s){const e=r.slice(1).trim().split(h_),n=[];for(let t=0,i=e.length;t<i;t++){const i=e[t];if(i.length>0){const e=i.split("/");n.push(e)}}const i=n[0];for(let e=1,r=n.length-1;e<r;e++){const r=n[e],s=n[e+1];t.addFace(i[0],r[0],s[0],i[1],r[1],s[1],i[2],r[2],s[2])}}else if("l"===s){const e=r.substring(1).trim().split(" ");let n=[];const i=[];if(-1===r.indexOf("/"))n=e;else for(let t=0,r=e.length;t<r;t++){const r=e[t].split("/");""!==r[0]&&n.push(r[0]),""!==r[1]&&i.push(r[1])}t.addLineGeometry(n,i)}else if("p"===s){const e=r.slice(1).trim().split(" ");t.addPointGeometry(e)}else if(null!==(i=o_.exec(r))){const e=(" "+i[0].slice(1).trim()).slice(1);t.startObject(e)}else if(c_.test(r))t.object.startMaterial(r.substring(7).trim(),t.materialLibraries);else if(l_.test(r))t.materialLibraries.push(r.substring(7).trim());else if(u_.test(r))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===s){if(i=r.split(" "),i.length>1){const e=i[1].trim().toLowerCase();t.object.smooth="0"!==e&&"off"!==e}else t.object.smooth=!0;const e=t.object.currentMaterial();e&&(e.smooth=t.object.smooth)}else{if("\0"===r)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+r+'"')}}t.finalize();const r=new bp;if(r.materialLibraries=[].concat(t.materialLibraries),!0==!(1===t.objects.length&&0===t.objects[0].geometry.vertices.length))for(let e=0,n=t.objects.length;e<n;e++){const n=t.objects[e],i=n.geometry,s=n.materials,a="Line"===i.type,o="Points"===i.type;let l=!1;if(0===i.vertices.length)continue;const c=new ld;c.setAttribute("position",new ed(i.vertices,3)),i.normals.length>0&&c.setAttribute("normal",new ed(i.normals,3)),i.colors.length>0&&(l=!0,c.setAttribute("color",new ed(i.colors,3))),!0===i.hasUVIndices&&c.setAttribute("uv",new ed(i.uvs,2));const u=[];for(let e=0,n=s.length;e<n;e++){const n=s[e],i=n.name+"_"+n.smooth+"_"+l;let r=t.materials[i];if(null!==this.materials)if(r=this.materials.create(n.name),!a||!r||r instanceof Yp){if(o&&r&&!(r instanceof cf)){const e=new cf({size:10,sizeAttenuation:!1});qh.prototype.copy.call(e,r),e.color.copy(r.color),e.map=r.map,r=e}}else{const e=new Yp;qh.prototype.copy.call(e,r),e.color.copy(r.color),r=e}void 0===r&&(r=a?new Yp:o?new cf({size:1,sizeAttenuation:!1}):new Xf,r.name=n.name,r.flatShading=!n.smooth,r.vertexColors=l,t.materials[i]=r),u.push(r)}let h;if(u.length>1){for(let e=0,t=s.length;e<t;e++){const t=s[e];c.addGroup(t.groupStart,t.groupCount,e)}h=a?new of(c,u):o?new ff(c,u):new xd(c,u)}else h=a?new of(c,u[0]):o?new ff(c,u[0]):new xd(c,u[0]);h.name=n.name,r.add(h)}else if(t.vertices.length>0){const e=new cf({size:1,sizeAttenuation:!1}),n=new ld;n.setAttribute("position",new ed(t.vertices,3)),t.colors.length>0&&void 0!==t.colors[0]&&(n.setAttribute("color",new ed(t.colors,3)),e.vertexColors=!0);const i=new ff(n,e);r.add(i)}return r}}class x_ extends mm{constructor(e){super(e)}load(e,t,n,i){const r=this,s=""===this.path?zm.extractUrlBase(e):this.path,a=new ym(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{t(r.parse(n,s))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const n=e.split("\n");let i={};const r=/\s+/,s={};for(let e=0;e<n.length;e++){let t=n[e];if(t=t.trim(),0===t.length||"#"===t.charAt(0))continue;const a=t.indexOf(" ");let o=a>=0?t.substring(0,a):t;o=o.toLowerCase();let l=a>=0?t.substring(a+1):"";if(l=l.trim(),"newmtl"===o)i={name:l},s[l]=i;else if("ka"===o||"kd"===o||"ks"===o||"ke"===o){const e=l.split(r,3);i[o]=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])]}else i[o]=l}const a=new __(this.resourcePath||t,this.materialOptions);return a.setCrossOrigin(this.crossOrigin),a.setManager(this.manager),a.setMaterials(s),a}}class __{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=void 0!==this.options.side?this.options.side:0,this.wrap=void 0!==this.options.wrap?this.options.wrap:Mc}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const n in e){const i=e[n],r={};t[n]=r;for(const e in i){let t=!0,n=i[e];const s=e.toLowerCase();switch(s){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(n=[n[0]/255,n[1]/255,n[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===n[0]&&0===n[1]&&0===n[2]&&(t=!1)}t&&(r[s]=n)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const t=this,n=this.materialsInfo[e],i={name:e,side:this.side};function r(e,n){if(i[e])return;const r=t.getTextureParams(n,i),s=t.loadTexture((a=t.baseUrl,"string"!=typeof(o=r.url)||""===o?"":/^https?:\/\//i.test(o)?o:a+o));var a,o;s.repeat.copy(r.scale),s.offset.copy(r.offset),s.wrapS=t.wrap,s.wrapT=t.wrap,"map"!==e&&"emissiveMap"!==e||(s.colorSpace=Oc),i[e]=s}for(const e in n){const t=n[e];let s;if(""!==t)switch(e.toLowerCase()){case"kd":i.color=uu.toWorkingColorSpace((new Gh).fromArray(t),Oc);break;case"ks":i.specular=uu.toWorkingColorSpace((new Gh).fromArray(t),Oc);break;case"ke":i.emissive=uu.toWorkingColorSpace((new Gh).fromArray(t),Oc);break;case"map_kd":r("map",t);break;case"map_ks":r("specularMap",t);break;case"map_ke":r("emissiveMap",t);break;case"norm":r("normalMap",t);break;case"map_bump":case"bump":r("bumpMap",t);break;case"map_d":r("alphaMap",t),i.transparent=!0;break;case"ns":i.shininess=parseFloat(t);break;case"d":s=parseFloat(t),s<1&&(i.opacity=s,i.transparent=!0);break;case"tr":s=parseFloat(t),this.options&&this.options.invertTrProperty&&(s=1-s),s>0&&(i.opacity=1-s,i.transparent=!0)}}return this.materials[e]=new Xf(i),this.materials[e]}getTextureParams(e,t){const n={scale:new nu(1,1),offset:new nu(0,0)},i=e.split(/\s+/);let r;return r=i.indexOf("-bm"),r>=0&&(t.bumpScale=parseFloat(i[r+1]),i.splice(r,2)),r=i.indexOf("-s"),r>=0&&(n.scale.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),r=i.indexOf("-o"),r>=0&&(n.offset.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),n.url=i.join(" ").trim(),n}loadTexture(e,t,n,i,r){const s=void 0!==this.manager?this.manager:fm;let a=s.getHandler(e);null===a&&(a=new _m(s)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin);const o=a.load(e,n,i,r);return void 0!==t&&(o.mapping=t),o}}function w_(e,t,n=!0){Ls(e)&&(n&&e.material&&js(e),e.material=t)}let S_=(()=>{let e,t,n=[pt("lume-obj-model",oa)],i=[],r=qy;return class extends r{static{t=this}static{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(r[Symbol.metadata]??null):void 0;(function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0})(null,e={value:t},n,{kind:"class",name:t.name,metadata:s},null,i),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e)}(t,i)}initialBehaviors={model:"obj"}},t})();var M_=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},E_=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let T_=(()=>{let e,t,n,i,r=[Yt],s=[],a=Zy,o=[],l=[],c=[],u=[];return class extends a{static{t=this}static{const h="function"==typeof Symbol&&Symbol.metadata?Object.create(a[Symbol.metadata]??null):void 0;n=[ot,Xt],i=[ot,Xt],M_(null,null,n,{kind:"field",name:"obj",static:!1,private:!1,access:{has:e=>"obj"in e,get:e=>e.obj,set:(e,t)=>{e.obj=t}},metadata:h},o,l),M_(null,null,i,{kind:"field",name:"mtl",static:!1,private:!1,access:{has:e=>"mtl"in e,get:e=>e.mtl,set:(e,t)=>{e.mtl=t}},metadata:h},c,u),M_(null,e={value:t},r,{kind:"class",name:t.name,metadata:h},null,s),t=e.value,h&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:h}),E_(t,s)}obj=E_(this,o,"");mtl=(E_(this,l),E_(this,c,""));requiredElementType(){return[S_]}objLoader=(E_(this,u),(()=>{const e=new b_;return e.manager.onLoad=()=>this.element.needsUpdate(),e})());mtlLoader=(()=>{const e=new x_(this.objLoader.manager);return e.crossOrigin="",e})();#Mt=0;connectedCallback(){super.connectedCallback(),this.createEffect((()=>{this.mtl,this.obj,this.#Et(),L((()=>{this.element.threeModel&&Gs(this.element.threeModel,{destroyMaterial:!this.#Xt}),this.#Xt=!1,this.model=void 0,this.element.threeModel=null,this.#Mt++}))}))}#Xt=!1;#Et(){const{obj:e,mtl:t,mtlLoader:n,objLoader:i}=this,r=this.#Mt;e&&(t?(n.setResourcePath(t.substr(0,t.lastIndexOf("/")+1)),n.load(t,(e=>{r===this.#Mt&&(e.preload(),i.setMaterials(e),this.#qt(r,!0))}))):this.#qt(r,!1))}#qt(e,t){this.objLoader.load(this.obj,(n=>e==this.#Mt&&this.#Tt(n,t)),(t=>e===this.#Mt&&(this.element.emit($m.PROGRESS,t),this.element.dispatchEvent(t))),(t=>e===this.#Mt&&this.#At(t)))}#At(e){const t=`Failed to load ${this.element.tagName.toLowerCase()} with obj value "${this.obj}" and mtl value "${this.mtl}". See the following error.`;console.warn(t);const n=Qm(e);console.error(n),this.element.emit($m.MODEL_ERROR,n),this.element.dispatchEvent(new Jm(n))}#Tt(e,t){if(!t){let t=this.element.behaviors.get("basic-material");t||(t=this.element.behaviors.get("phong-material")),t||(t=this.element.behaviors.get("standard-material")),t||(t=this.element.behaviors.get("lambert-material")),t?(this.#Xt=!0,e.traverse((e=>{Ls(e)&&(e.material=t.meshComponent||A_(new Error("Expected a material")))}))):function(e,t,n,i=!0){const r=new El;r.color=new po(t),i?e.traverse((e=>w_(e,r,n))):w_(e,r,n)}(e,5592405*Math.random()+5592405,n,i)}var n,i;this.element.three.add(e),this.model=e,this.element.threeModel=e,this.element.emit($m.MODEL_LOAD,{format:"obj",model:e}),this.element.dispatchEvent(new Zm),this.element.needsUpdate()}},t})();globalThis.window?.document&&!elementBehaviors.has("obj-model")&&elementBehaviors.define("obj-model",T_);const A_=e=>{throw e};class C_ extends mm{constructor(e){super(e),this.debug=!1,this.group=null,this.materials=[],this.meshes=[]}load(e,t,n,i){const r=this,s=""===this.path?zm.extractUrlBase(e):this.path,a=new ym(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{t(r.parse(n,s))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e,t){this.group=new bp,this.materials=[],this.meshes=[],this.readFile(e,t);for(let e=0;e<this.meshes.length;e++)this.group.add(this.meshes[e]);return this.group}readFile(e,t){const n=new DataView(e),i=new R_(n,0,this.debugMessage);if(i.id===k_||i.id===I_||i.id===P_){let e=i.readChunk();for(;e;){if(e.id===O_){const t=e.readDWord();this.debugMessage("3DS file version: "+t)}else e.id===B_?this.readMeshData(e,t):this.debugMessage("Unknown main chunk: "+e.hexId);e=i.readChunk()}}this.debugMessage("Parsed "+this.meshes.length+" meshes")}readMeshData(e,t){let n=e.readChunk();for(;n;){if(n.id===V_){const e=+n.readDWord();this.debugMessage("Mesh Version: "+e)}else if(n.id===j_){const e=n.readFloat();this.debugMessage("Master scale: "+e),this.group.scale.set(e,e,e)}else n.id===cw?(this.debugMessage("Named Object"),this.readNamedObject(n)):n.id===H_?(this.debugMessage("Material"),this.readMaterialEntry(n,t)):this.debugMessage("Unknown MDATA chunk: "+n.hexId);n=e.readChunk()}}readNamedObject(e){const t=e.readString();let n=e.readChunk();for(;n;){if(n.id===uw){const e=this.readMesh(n);e.name=t,this.meshes.push(e)}else this.debugMessage("Unknown named object chunk: "+n.hexId);n=e.readChunk()}}readMaterialEntry(e,t){let n=e.readChunk();const i=new Xf;for(;n;){if(n.id===G_)i.name=n.readString(),this.debugMessage("   Name: "+i.name);else if(n.id===J_)this.debugMessage("   Wireframe"),i.wireframe=!0;else if(n.id===Q_){const e=n.readByte();i.wireframeLinewidth=e,this.debugMessage("   Wireframe Thickness: "+e)}else if(n.id===Z_)i.side=2,this.debugMessage("   DoubleSided");else if(n.id===K_)this.debugMessage("   Additive Blending"),i.blending=2;else if(n.id===X_)this.debugMessage("   Diffuse Color"),i.color=this.readColor(n);else if(n.id===q_)this.debugMessage("   Specular Color"),i.specular=this.readColor(n);else if(n.id===W_)this.debugMessage("   Ambient color"),i.color=this.readColor(n);else if(n.id===Y_){const e=this.readPercentage(n);i.shininess=100*e,this.debugMessage("   Shininess : "+e)}else if(n.id===$_){const e=this.readPercentage(n);i.opacity=1-e,this.debugMessage("  Transparency : "+e),i.transparent=i.opacity<1}else n.id===ew?(this.debugMessage("   ColorMap"),i.map=this.readMap(n,t)):n.id===nw?(this.debugMessage("   BumpMap"),i.bumpMap=this.readMap(n,t)):n.id===tw?(this.debugMessage("   OpacityMap"),i.alphaMap=this.readMap(n,t)):n.id===iw?(this.debugMessage("   SpecularMap"),i.specularMap=this.readMap(n,t)):this.debugMessage("   Unknown material chunk: "+n.hexId);n=e.readChunk()}this.materials[i.name]=i}readMesh(e){let t=e.readChunk();const n=new ld,i=new Xf,r=new xd(n,i);for(r.name="mesh";t;){if(t.id===hw){const e=t.readWord();this.debugMessage("   Vertex: "+e);const i=[];for(let n=0;n<e;n++)i.push(t.readFloat()),i.push(t.readFloat()),i.push(t.readFloat());n.setAttribute("position",new ed(i,3))}else if(t.id===dw)this.readFaceArray(t,r);else if(t.id===fw){const e=t.readWord();this.debugMessage("   UV: "+e);const i=[];for(let n=0;n<e;n++)i.push(t.readFloat()),i.push(t.readFloat());n.setAttribute("uv",new ed(i,2))}else if(t.id===mw){this.debugMessage("   Tranformation Matrix (TODO)");const e=[];for(let n=0;n<12;n++)e[n]=t.readFloat();const i=new Ju;i.elements[0]=e[0],i.elements[1]=e[6],i.elements[2]=e[3],i.elements[3]=e[9],i.elements[4]=e[2],i.elements[5]=e[8],i.elements[6]=e[5],i.elements[7]=e[11],i.elements[8]=e[1],i.elements[9]=e[7],i.elements[10]=e[4],i.elements[11]=e[10],i.elements[12]=0,i.elements[13]=0,i.elements[14]=0,i.elements[15]=1,i.transpose();const s=new Ju;s.copy(i).invert(),n.applyMatrix4(s),i.decompose(r.position,r.quaternion,r.scale)}else this.debugMessage("   Unknown mesh chunk: "+t.hexId);t=e.readChunk()}return n.computeVertexNormals(),r}readFaceArray(e,t){const n=e.readWord();this.debugMessage("   Faces: "+n);const i=[];for(let t=0;t<n;++t)i.push(e.readWord(),e.readWord(),e.readWord()),e.readWord();t.geometry.setIndex(i);let r=0,s=0;for(;!e.endOfChunk;){const n=e.readChunk();if(n.id===pw){this.debugMessage("      Material Group");const e=this.readMaterialGroup(n),i=3*e.index.length;t.geometry.addGroup(s,i,r),s+=i,r++;const a=this.materials[e.name];!1===Array.isArray(t.material)&&(t.material=[]),void 0!==a&&t.material.push(a)}else this.debugMessage("      Unknown face array chunk: "+n.hexId)}1===t.material.length&&(t.material=t.material[0])}readMap(e,t){let n=e.readChunk(),i={};const r=new _m(this.manager);for(r.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);n;){if(n.id===rw){const e=n.readString();i=r.load(e),this.debugMessage("      File: "+t+e)}else n.id===ow?(i.offset.x=n.readFloat(),this.debugMessage("      OffsetX: "+i.offset.x)):n.id===lw?(i.offset.y=n.readFloat(),this.debugMessage("      OffsetY: "+i.offset.y)):n.id===sw?(i.repeat.x=n.readFloat(),this.debugMessage("      RepeatX: "+i.repeat.x)):n.id===aw?(i.repeat.y=n.readFloat(),this.debugMessage("      RepeatY: "+i.repeat.y)):this.debugMessage("      Unknown map chunk: "+n.hexId);n=e.readChunk()}return i}readMaterialGroup(e){const t=e.readString(),n=e.readWord();this.debugMessage("         Name: "+t),this.debugMessage("         Faces: "+n);const i=[];for(let t=0;t<n;++t)i.push(e.readWord());return{name:t,index:i}}readColor(e){const t=e.readChunk(),n=new Gh;if(t.id===N_||t.id===D_){const e=t.readByte(),i=t.readByte(),r=t.readByte();n.setRGB(e/255,i/255,r/255),this.debugMessage("      Color: "+n.r+", "+n.g+", "+n.b)}else if(t.id===L_||t.id===z_){const e=t.readFloat(),i=t.readFloat(),r=t.readFloat();n.setRGB(e,i,r),this.debugMessage("      Color: "+n.r+", "+n.g+", "+n.b)}else this.debugMessage("      Unknown color chunk: "+t.hexId);return n}readPercentage(e){const t=e.readChunk();switch(t.id){case U_:return t.readShort()/100;case F_:return t.readFloat();default:return this.debugMessage("      Unknown percentage chunk: "+t.hexId),0}}debugMessage(e){this.debug&&console.log(e)}}class R_{constructor(e,t,n){this.data=e,this.offset=t,this.position=t,this.debugMessage=n,this.debugMessage instanceof Function&&(this.debugMessage=function(){}),this.id=this.readWord(),this.size=this.readDWord(),this.end=this.offset+this.size,this.end>e.byteLength&&this.debugMessage("Bad chunk size for chunk at "+t)}readChunk(){if(this.endOfChunk)return null;try{const e=new R_(this.data,this.position,this.debugMessage);return this.position+=e.size,e}catch(e){return this.debugMessage("Unable to read chunk at "+this.position),null}}get hexId(){return this.id.toString(16)}get endOfChunk(){return this.position>=this.end}readByte(){const e=this.data.getUint8(this.position,!0);return this.position+=1,e}readFloat(){try{const e=this.data.getFloat32(this.position,!0);return this.position+=4,e}catch(e){return this.debugMessage(e+" "+this.position+" "+this.data.byteLength),0}}readInt(){const e=this.data.getInt32(this.position,!0);return this.position+=4,e}readShort(){const e=this.data.getInt16(this.position,!0);return this.position+=2,e}readDWord(){const e=this.data.getUint32(this.position,!0);return this.position+=4,e}readWord(){const e=this.data.getUint16(this.position,!0);return this.position+=2,e}readString(){let e="",t=this.readByte();for(;t;)e+=String.fromCharCode(t),t=this.readByte();return e}}const P_=19789,k_=15786,I_=49725,O_=2,L_=16,N_=17,D_=18,z_=19,U_=48,F_=49,B_=15677,V_=15678,j_=256,H_=45055,G_=40960,W_=40976,X_=40992,q_=41008,Y_=41024,$_=41040,Z_=41089,K_=41091,J_=41093,Q_=41095,ew=41472,tw=41488,nw=41520,iw=41476,rw=41728,sw=41812,aw=41814,ow=41816,lw=41818,cw=16384,uw=16640,hw=16656,dw=16672,pw=16688,fw=16704,mw=16736;let gw=(()=>{let e,t,n=[pt("lume-3ds-model",oa)],i=[],r=qy;return class extends r{static{t=this}static{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(r[Symbol.metadata]??null):void 0;(function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0})(null,e={value:t},n,{kind:"class",name:t.name,metadata:s},null,i),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e)}(t,i)}initialBehaviors={model:"3ds"}},t})();var vw=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},yw=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let bw=(()=>{let e,t,n,i=[Yt],r=[],s=Zy,a=[],o=[];return class extends s{static{t=this}static{const l="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;n=[ot,Xt],vw(null,null,n,{kind:"field",name:"src",static:!1,private:!1,access:{has:e=>"src"in e,get:e=>e.src,set:(e,t)=>{e.src=t}},metadata:l},a,o),vw(null,e={value:t},i,{kind:"class",name:t.name,metadata:l},null,r),t=e.value,l&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:l}),yw(t,r)}src=yw(this,a,"");loader=(yw(this,o),new C_);requiredElementType(){return[gw]}#Mt=0;connectedCallback(){super.connectedCallback(),this.createEffect((()=>{this.src,this.#Et(),L((()=>{this.element.threeModel&&Gs(this.element.threeModel),this.model=void 0,this.element.threeModel=null,this.#Mt++}))}))}#Et(){const{src:e}=this,t=this.#Mt;e&&this.loader.load(e,(e=>t===this.#Mt&&this.#Tt(e)),(e=>t===this.#Mt&&(this.element.emit($m.PROGRESS,e),this.element.dispatchEvent(e))),(e=>t===this.#Mt&&this.#At(e)))}#At(e){const t=`Failed to load ${this.element.tagName.toLowerCase()} with src "${this.src}". See the following error.`;console.warn(t);const n=Qm(e);console.error(n),this.element.emit($m.MODEL_ERROR,n),this.element.dispatchEvent(new Jm(n))}#Tt(e){this.element.three.add(e),this.model=e,this.element.threeModel=e,this.element.emit($m.MODEL_LOAD,{format:"3ds",model:e}),this.element.dispatchEvent(new Zm),this.element.needsUpdate()}},t})();globalThis.window?.document&&!elementBehaviors.has("3ds-model")&&elementBehaviors.define("3ds-model",bw);const xw=/(?:<!--[\S\s]*?-->|<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>)/g,_w=/(?:\s(?<boolean>[^/\s><=]+?)(?=[\s/>]))|(?:(?<name>\S+?)(?:\s*=\s*(?:(['"])(?<quotedValue>[\s\S]*?)\3|(?<unquotedValue>[^\s>]+))))/g,ww={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuitem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};function Sw(e,t,n){const i=t.indexOf("<",n),r=t.slice(n,-1===i?void 0:i);/^\s*$/.test(r)||e.push({type:"text",content:r})}function Mw(e,t){switch(t.type){case"text":return e+t.content;case"tag":return e+="<"+t.name+(t.attrs?function(e){const t=[];for(const n of e)t.push(n.name+'="'+n.value.replace(/"/g,"&quot;")+'"');return t.length?" "+t.join(" "):""}(t.attrs):"")+(t.voidElement?"/>":">"),t.voidElement?e:e+t.children.reduce(Mw,"")+"</"+t.name+">";case"comment":return e+"\x3c!--"+t.content+"--\x3e"}}const Ew=new Map,Tw=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,Aw=" \\f\\n\\r\\t",Cw="[^"+Aw+"\\/>\"'=]+",Rw="[ "+Aw+"]+(?:use:\x3c!--#--\x3e|"+Cw+")",Pw="<([A-Za-z$#]+[A-Za-z0-9:_-]*)((?:",kw="(?:\\s*=\\s*(?:'[^']*?'|\"[^\"]*?\"|\\([^)]*?\\)|<[^>]*?>|"+Cw+"))?)",Iw=new RegExp(Pw+Rw+kw+"+)([ "+Aw+"]*/?>)","g"),Ow=new RegExp("("+Rw+"\\s*=\\s*)(\x3c!--#--\x3e|['\"(]([\\w\\s]*\x3c!--#--\x3e[\\w\\s]*)*['\")])","gi"),Lw=new RegExp(Pw+Rw+kw+"*)([ "+Aw+"]*/>)","g"),Nw="\x3c!--#--\x3e",Dw=new Set(["class","on","oncapture","style","use","prop","attr"]);function zw(e,t,n,i){return"<"+t+n.replace(Ow,Uw)+i}function Uw(e,t,n){return t.replace(/<!--#-->/g,"###")+('"'===n[0]||"'"===n[0]?n.replace(/<!--#-->/g,"###"):'"###"')}function Fw(e,t,n){return Tw.test(t)?e:"<"+t+n+"></"+t+">"}function Bw(e,t,n,i){if("use:###"!==e||"###"!==t)throw new Error(`Not support syntax ${e} must be use:{function}`);{const e=i.counter++;i.exprs.push(`typeof exprs[${e}] === "function" ? r.use(exprs[${e}], ${n}, exprs[${i.counter++}]) : (()=>{throw new Error("use:### must be a function")})()`)}}const Vw=function(e,{delegateEvents:t=!0,functionBuilder:n=(...e)=>new Function(...e)}={}){let i=1;function r(t,n){let r=0,s="";for(;r<t.length-1;r++)s=s+t[r]+"\x3c!--#--\x3e";s+=t[r],s=[[Lw,Fw],[/<(<!--#-->)/g,"<###"],[/\.\.\.(<!--#-->)/g,"###"],[Iw,zw],[/>\n+\s*/g,">"],[/\n+\s*</g,"<"],[/\s+</g," <"],[/>\s+/g,"> "]].reduce(((e,t)=>e.replace(t[0],t[1])),s);const a=function(e){const t=[];let n,i=-1;const r=[],s={};return e.replace(xw,((a,o)=>{const l="/"!==a.charAt(1),c="\x3c!--"===a.slice(0,4),u=o+a.length,h=e.charAt(u);let d;l&&!c&&(i++,n=function(e){const t={type:"tag",name:"",voidElement:!1,attrs:[],children:[]},n=e.match(/<\/?([^\s]+?)[/\s>]/);if(n&&(t.name=n[1],(ww[n[1].toLowerCase()]||"/"===e.charAt(e.length-2))&&(t.voidElement=!0),t.name.startsWith("!--"))){const t=e.indexOf("--\x3e");return{type:"comment",comment:-1!==t?e.slice(4,t):""}}const i=new RegExp(_w);for(const n of e.matchAll(i))(n[1]||n[2]).startsWith("use:")?t.attrs.push({type:"directive",name:n[1]||n[2],value:n[4]||n[5]||""}):t.attrs.push({type:"attr",name:n[1]||n[2],value:n[4]||n[5]||""});return t}(a),!n.voidElement&&h&&"<"!==h&&Sw(n.children,e,u),s[n.tagName]=n,0===i&&t.push(n),d=r[i-1],d&&d.children.push(n),r[i]=n),c&&function(e,t){const n=t.replace("\x3c!--","").replace("--\x3e","");/^\s*$/.test(n)||e.push({type:"comment",content:n})}(i<0?t:r[i].children,a),(c||!l||n.voidElement)&&(c||i--,"<"!==h&&h&&(d=-1===i?t:r[i].children,Sw(d,e,u)))})),t}(s),[c,u]=function(t,n){const r={path:"",decl:[],exprs:[],delegatedEvents:new Set,counter:0,first:!0,multi:!1,templateId:0,templateNodes:[]},s=i,a=t;let c;return t.length>1&&(t=[{type:"fragment",children:t}]),"###"===t[0].name?(c=!0,o(t[0],r)):l(t[0],r),e.delegateEvents(Array.from(r.delegatedEvents)),[[a].concat(r.templateNodes).map((e=>e.reduce((function(e,t){return e+Mw("",t)}),""))),n("tmpls","exprs","r",r.decl.join(",\n")+";\n"+r.exprs.join(";\n")+(c?"":`;\nreturn _$el${s};\n`))]}(a,n.funcBuilder),h=[];for(let e=0;e<c.length;e++){h.push(document.createElement("template")),h[e].innerHTML=c[e];const t=h[e].content.querySelectorAll("script,style");for(let n=0;n<t.length;n++){const i=t[n].firstChild?.data||"";if(i.indexOf(Nw)>-1){const n=i.split(Nw).reduce(((e,t,n)=>(n&&e.push(""),e.push(t),e)),[]);t[e].firstChild.replaceWith(...n)}}}return h[0].create=u,Ew.set(t,h),h}function s(n,r,s,a,o,l,c){if("on"===s.slice(0,2))if(s.includes(":")){let e=s.startsWith("oncapture:");c.exprs.push(`${r}.addEventListener("${s.slice(e?10:3)}",exprs[${c.counter++}]${e?",true":""})`)}else{const n=s.slice(2).toLowerCase(),i=t&&e.DelegatedEvents.has(n);c.exprs.push(`r.addEventListener(${r},"${n}",exprs[${c.counter++}],${i})`),i&&c.delegatedEvents.add(n)}else if("ref"===s)c.exprs.push(`exprs[${c.counter++}](${r})`);else{const t=Object.assign({},c,{exprs:[]}),u=c.counter;if(function(t,n,r,s,a,o,l){let c,u,h="###"===s?`!doNotWrap ? exprs[${l.counter}]() : exprs[${l.counter++}]`:s.split("###").map(((e,t)=>t?` + (typeof exprs[${l.counter}] === "function" ? exprs[${l.counter}]() : exprs[${l.counter++}]) + "${e}"`:`"${e}"`)).join("");(c=r.split(":"))&&c[1]&&Dw.has(c[0])&&(r=c[1],u=c[0]);const d=e.ChildProperties.has(r),p=e.Properties.has(r);if("style"===r){const e="_$v"+i++;l.decl.push(`${e}={}`),l.exprs.push(`r.style(${n},${h},${e})`)}else if("classList"===r){const e="_$v"+i++;l.decl.push(`${e}={}`),l.exprs.push(`r.classList(${n},${h},${e})`)}else if("attr"!==u&&(d||!a&&(e.getPropAlias(r,t.name.toUpperCase())||p)||o||"prop"===u))!o||d||p||"prop"===u||(r=function(e){return e.toLowerCase().replace(/-([a-z])/g,((e,t)=>t.toUpperCase()))}(r)),l.exprs.push(`${n}.${e.getPropAlias(r,t.name.toUpperCase())||r} = ${h}`);else{const t=a&&r.indexOf(":")>-1&&e.SVGNamespace[r.split(":")[0]];t?l.exprs.push(`r.setAttributeNS(${n},"${t}","${r}",${h})`):l.exprs.push(`r.setAttribute(${n},"${e.Aliases[r]||r}",${h})`)}}(n,r,s,a,o,l,t),c.decl.push(`_fn${u} = (${"###"===a?"doNotWrap":""}) => {\n${t.exprs.join(";\n")};\n}`),"###"===a)c.exprs.push(`typeof exprs[${u}] === "function" ? r.effect(_fn${u}) : _fn${u}(true)`);else{let e="";for(let n=u;n<t.counter;n++)n!==u&&(e+=" || "),e+=`typeof exprs[${n}] === "function"`;c.exprs.push(e+` ? r.effect(_fn${u}) : _fn${u}()`)}c.counter=t.counter,c.wrap=!1}}function a(e){let t=[];for(const n of e)if(Array.isArray(n)){if(!n.length)continue;t.push(`r.wrapProps({${n.join(",")||""}})`)}else t.push(n);return t.length>1?`r.mergeProps(${t.join(",")})`:t[0]}function o(e,t){let n=[];const r=Object.keys(e.attrs),s=[n],o=t.counter++;for(let a=0;a<r.length;a++){const{type:r,name:o,value:l}=e.attrs[a];if("attr"===r)"###"===o?(s.push(`exprs[${t.counter++}]`),s.push(n=[])):"###"===l?n.push(`${o}: exprs[${t.counter++}]`):n.push(`${o}: "${l}"`);else if("directive"===r){const e="_$el"+i++,n=!t.decl.length;t.decl.push(n?"":`${e} = ${t.path}.${t.first?"firstChild":"nextSibling"}`),Bw(o,l,e,t)}}if(1===e.children.length&&"comment"===e.children[0].type&&"#"===e.children[0].content)n.push(`children: () => exprs[${t.counter++}]`);else if(e.children.length){const i={type:"fragment",children:e.children},r=Object.assign({},t,{first:!0,decl:[],exprs:[],parent:!1});l(i,r),n.push(`children: () => { ${r.exprs.join(";\n")}}`),t.templateId=r.templateId,t.counter=r.counter}let c;t.multi&&(c="_$el"+i++,t.decl.push(`${c} = ${t.path}.${t.first?"firstChild":"nextSibling"}`)),t.parent?t.exprs.push(`r.insert(${t.parent}, r.createComponent(exprs[${o}],${a(s)})${c?`, ${c}`:""})`):t.exprs.push(`${t.fragment?"":"return "}r.createComponent(exprs[${o}],${a(s)})`),t.path=c,t.first=!1}function l(t,n){if("fragment"===t.type){const e=[];t.children.forEach((t=>{if("tag"===t.type){if("###"===t.name){const i=Object.assign({},n,{first:!0,fragment:!0,decl:[],exprs:[]});return o(t,i),e.push(i.exprs[0]),n.counter=i.counter,void(n.templateId=i.templateId)}n.templateId++;const r=i,s=Object.assign({},n,{first:!0,decl:[],exprs:[]});n.templateNodes.push([t]),l(t,s),e.push(`function() { ${s.decl.join(",\n")+";\n"+s.exprs.join(";\n")+`;\nreturn _$el${r};\n`}}()`),n.counter=s.counter,n.templateId=s.templateId}else if("text"===t.type)e.push(`"${t.content}"`);else if("comment"===t.type)if("#"===t.content)e.push(`exprs[${n.counter++}]`);else if(t.content)for(let i=0;i<t.content.split("###").length-1;i++)e.push(`exprs[${n.counter++}]`)})),n.exprs.push(`return [${e.join(", \n")}]`)}else if("tag"===t.type){const r="_$el"+i++,a=!n.decl.length,c=n.templateId;n.decl.push(a?"":`${r} = ${n.path}.${n.first?"firstChild":"nextSibling"}`);const u=e.SVGElements.has(t.name),h=t.name.includes("-")||t.attrs.some((e=>"is"===e.name));if(n.hasCustomElement=h,n.isImportNode=("img"===t.name||"iframe"===t.name)&&t.attrs.some((e=>"loading"===e.name&&"lazy"===e.value)),t.attrs.some((e=>"###"===e.name))){const e=[];let i="";const s=[];for(let a=0;a<t.attrs.length;a++){const{type:o,name:l,value:c}=t.attrs[a];if("attr"===o)if(c.includes("###")){let e=n.counter++;i+=`${l}: ${"ref"!==l?`typeof exprs[${e}] === "function" ? exprs[${e}]() : `:""}exprs[${e}],`}else"###"===l?(i.length&&(e.push(`()=>({${i}})`),i=""),e.push(`exprs[${n.counter++}]`)):s.push(t.attrs[a]);else"directive"===o&&Bw(l,c,r,n)}t.attrs=s,i.length&&e.push(`()=>({${i}})`),n.exprs.push(`r.spread(${r},${1===e.length?`typeof ${e[0]} === "function" ? r.mergeProps(${e[0]}) : ${e[0]}`:`r.mergeProps(${e.join(",")})`},${u},${!!t.children.length})`)}else for(let e=0;e<t.attrs.length;e++){const{type:i,name:a,value:o}=t.attrs[e];"directive"===i?(Bw(a,o,r,n),t.attrs.splice(e,1),e--):"attr"===i&&o.includes("###")&&(t.attrs.splice(e,1),e--,s(t,r,a,o,u,h,n))}n.path=r,n.first=!1,function(e,t){const n=Object.assign({},t,{first:!0,multi:!1,parent:t.path});if(e.children.length>1)for(let t=0;t<e.children.length;t++){const i=e.children[t];if("comment"===i.type&&"#"===i.content||"tag"===i.type&&"###"===i.name){n.multi=!0;break}}let i=0;for(;i<e.children.length;){const t=e.children[i];"###"!==t.name?(l(t,n),n.multi||"comment"!==t.type||"#"!==t.content?i++:e.children.splice(i,1)):(n.multi?(e.children[i]={type:"comment",content:"#"},i++):e.children.splice(i,1),o(t,n))}t.counter=n.counter,t.templateId=n.templateId,t.hasCustomElement=t.hasCustomElement||n.hasCustomElement,t.isImportNode=t.isImportNode||n.isImportNode}(t,n),a&&(n.decl[0]=n.hasCustomElement||n.isImportNode?`const ${r} = r.untrack(() => document.importNode(tmpls[${c}].content.firstChild, true))`:`const ${r} = tmpls[${c}].content.firstChild.cloneNode(true)`)}else if("text"===t.type){const e="_$el"+i++;n.decl.push(`${e} = ${n.path}.${n.first?"firstChild":"nextSibling"}`),n.path=e,n.first=!1}else if("comment"===t.type){const e="_$el"+i++;n.decl.push(`${e} = ${n.path}.${n.first?"firstChild":"nextSibling"}`),"#"===t.content&&(n.multi?n.exprs.push(`r.insert(${n.parent}, exprs[${n.counter++}], ${e})`):n.exprs.push(`r.insert(${n.parent}, exprs[${n.counter++}])`)),n.path=e,n.first=!1}}return e.wrapProps=t=>{const n=Object.getOwnPropertyDescriptors(t);for(const i in n)"function"!=typeof n[i].value||n[i].value.length||e.dynamicProperty(t,i);return t},function(t,...i){const s=Ew.get(t)||r(t,{funcBuilder:n});return s[0].create(s,i,e)}}({effect:R,style:ye,insert:be,untrack:O,spread:function(e,t={},n,i){const r={};return i||R((()=>r.children=Me(e,t.children,r.children))),R((()=>{return"function"==typeof t.ref&&(n=t.ref,i=e,O((()=>n(i,undefined))));var n,i})),R((()=>function(e,t,n,i,r={},s=!1){t||(t={});for(const i in r)if(!(i in t)){if("children"===i)continue;r[i]=we(e,i,null,r[i],n,s,t)}for(const a in t){if("children"===a){i||Me(e,t.children);continue}const o=t[a];r[a]=we(e,a,o,r[a],n,s,t)}}(e,t,n,!0,r,!0))),r},createComponent:function(e,t){return O((()=>e(t||{})))},delegateEvents:pe,classList:ve,mergeProps:function(...e){let t=!1;for(let n=0;n<e.length;n++){const i=e[n];t=t||!!i&&u in i,e[n]="function"==typeof i?(t=!0,k(i)):i}if(h&&t)return new Proxy({get(t){for(let n=e.length-1;n>=0;n--){const i=ne(e[n])[t];if(void 0!==i)return i}},has(t){for(let n=e.length-1;n>=0;n--)if(t in ne(e[n]))return!0;return!1},keys(){const t=[];for(let n=0;n<e.length;n++)t.push(...Object.keys(ne(e[n])));return[...new Set(t)]}},te);const n={},i=Object.create(null);for(let t=e.length-1;t>=0;t--){const r=e[t];if(!r)continue;const s=Object.getOwnPropertyNames(r);for(let e=s.length-1;e>=0;e--){const t=s[e];if("__proto__"===t||"constructor"===t)continue;const a=Object.getOwnPropertyDescriptor(r,t);if(i[t]){const e=n[t];e&&(a.get?e.push(a.get.bind(r)):void 0!==a.value&&e.push((()=>a.value)))}else i[t]=a.get?{enumerable:!0,configurable:!0,get:ie.bind(n[t]=[a.get.bind(r)])}:void 0!==a.value?a:void 0}}const r={},s=Object.keys(i);for(let e=s.length-1;e>=0;e--){const t=s[e],n=i[t];n&&n.get?Object.defineProperty(r,t,n):r[t]=n?n.value:void 0}return r},dynamicProperty:function(e,t){const n=e[t];return Object.defineProperty(e,t,{get:()=>n(),enumerable:!0}),e},setAttribute:fe,setAttributeNS:me,addEventListener:ge,Aliases:ae,getPropAlias:le,Properties:re,ChildProperties:se,DelegatedEvents:ce,SVGElements:ue,SVGNamespace:he});function jw(e,t,n){return Math.max(Math.min(e,n),t)}var Hw=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},Gw=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let Ww=(()=>{let e,t,n,i,r,s,a=[Ge],o=[],l=Xs(qe),c=[],u=[],h=[],d=[],p=[],f=[],m=[],g=[];return class extends l{static{t=this}static{const v="function"==typeof Symbol&&Symbol.metadata?Object.create(l[Symbol.metadata]??null):void 0;n=[Ue],i=[Ue],r=[Ue],s=[Ue],Hw(null,null,n,{kind:"field",name:"_x",static:!1,private:!1,access:{has:e=>"_x"in e,get:e=>e._x,set:(e,t)=>{e._x=t}},metadata:v},c,u),Hw(null,null,i,{kind:"field",name:"_y",static:!1,private:!1,access:{has:e=>"_y"in e,get:e=>e._y,set:(e,t)=>{e._y=t}},metadata:v},h,d),Hw(null,null,r,{kind:"field",name:"target",static:!1,private:!1,access:{has:e=>"target"in e,get:e=>e.target,set:(e,t)=>{e.target=t}},metadata:v},p,f),Hw(null,null,s,{kind:"field",name:"pointerTypes",static:!1,private:!1,access:{has:e=>"pointerTypes"in e,get:e=>e.pointerTypes,set:(e,t)=>{e.pointerTypes=t}},metadata:v},m,g),Hw(null,e={value:t},a,{kind:"class",name:t.name,metadata:v},null,o),t=e.value,v&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:v}),Gw(t,o)}_x=Gw(this,c,0);get x(){return this._x}set x(e){this.#Yt(),this._x=e}_y=(Gw(this,u),Gw(this,h,0));get y(){return this._y}set y(e){this.#Yt(),this._y=e}minX=(Gw(this,d),-1/0);maxX=1/0;minY=-1/0;maxY=1/0;target=Gw(this,p,document.documentElement);sensitivity=(Gw(this,f),1);epsilon=.01;slowdownAmount=.05;invertY=!1;invertX=!1;pointerTypes=Gw(this,m,["mouse","pen","touch"]);#$t=Gw(this,g);#Zt=(()=>{const[e,t]=A(!1);return{get:e,set:t}})();get interacting(){return this.#Zt.get()}#Kt=(()=>{const[e,t]=A(!1);return{get:e,set:t}})();get isStarted(){return this.#Kt.get()}#Jt=new AbortController;#Qt=-1;#en=0;#tn=0;#nn=0;#in=0;#rn=0;#sn=0;#an=e=>{this.pointerTypes.includes(e.pointerType)&&("mouse"===e.pointerType&&0!==e.button||(this.#en++,1===this.#en&&(this.#Qt=e.pointerId,"mouse"===e.pointerType&&this.target.setPointerCapture(this.#Qt),this.#Yt(),this.#tn=e.x,this.#nn=e.y,this.#in=0,this.#rn=0,this.target.addEventListener("pointermove",this.#on,{signal:this.#Jt.signal}),this.target.addEventListener("pointerup",this.#ln,{signal:this.#Jt.signal}),this.#Zt.set(!0))))};#on=e=>{if(e.pointerId!==this.#Qt)return;this.#sn=performance.now();const t=e.x-this.#tn,n=e.y-this.#nn;this.#tn=e.x,this.#nn=e.y,this.#in=t*this.sensitivity*(this.invertX?-1:1),this._x=jw(this._x+this.#in,this.minX,this.maxX),this.#rn=n*this.sensitivity*(this.invertY?-1:1),this._y=jw(this._y+this.#rn,this.minY,this.maxY)};#ln=()=>{this.#en--,0===this.#en&&(this.target.hasPointerCapture(this.#Qt)&&this.target.releasePointerCapture(this.#Qt),this.#Qt=-1,this.target.removeEventListener("pointerup",this.#ln)),this.target.removeEventListener("pointermove",this.#on),this.#Zt.set(!1),0===this.#in&&0===this.#rn||performance.now()-this.#sn>100||Kr.addRenderTask(((e,t)=>{const n=t/16.6666;if(this.#in*=1-n*this.slowdownAmount,this.#rn*=1-n*this.slowdownAmount,Math.abs(this.#in)<this.epsilon&&Math.abs(this.#rn)<this.epsilon)return!1;this._x=jw(this._x+this.#in,this.minX,this.maxX),this._y=jw(this._y+this.#rn,this.minY,this.maxY)}))};#cn=e=>e.preventDefault();start(){return O(this.#Kt.get)||(this.#Kt.set(!0),this.createEffect((()=>{this.target,this.pointerTypes,this.#Jt=new AbortController,this.target.addEventListener("pointerdown",this.#an,{signal:this.#Jt.signal}),this.target.addEventListener("dragstart",this.#cn,{signal:this.#Jt.signal}),this.target.addEventListener("pointercancel",(()=>{console.error("Pointercancel should not be happening. If so, please kindly open an issue at https://github.com/lume/lume/issues.")}),{signal:this.#Jt.signal}),L((()=>{this.#Qt=-1,this.#en=0,this.#Yt(),this.#Jt.abort(),this.#Zt.set(!1)}))}))),this}stop(){return O(this.#Kt.get)?(this.#Kt.set(!1),this.stopEffects(),this):this}#Yt(){this.#$t&&Kr.removeRenderTask(this.#$t)}},t})();var Xw=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},qw=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let Yw=(()=>{let e,t,n,i,r,s,a,o,l,c,u,h,d,p=[Ge],f=[],m=Xs(qe),g=[],v=[],y=[],b=[],x=[],_=[],w=[],S=[],M=[],E=[],T=[],A=[],C=[],R=[],k=[],I=[],O=[],N=[],D=[],z=[],U=[],F=[];return class extends m{static{t=this}static{const P="function"==typeof Symbol&&Symbol.metadata?Object.create(m[Symbol.metadata]??null):void 0;n=[Ue],i=[Ue],r=[Ue],s=[Ue],a=[Ue],o=[Ue],l=[Ue],c=[Ue],u=[Ue],h=[Ue],d=[Ue],Xw(null,null,n,{kind:"field",name:"rotationYTarget",static:!1,private:!1,access:{has:e=>"rotationYTarget"in e,get:e=>e.rotationYTarget,set:(e,t)=>{e.rotationYTarget=t}},metadata:P},g,v),Xw(null,null,i,{kind:"field",name:"rotationXTarget",static:!1,private:!1,access:{has:e=>"rotationXTarget"in e,get:e=>e.rotationXTarget,set:(e,t)=>{e.rotationXTarget=t}},metadata:P},y,b),Xw(null,null,r,{kind:"field",name:"target",static:!1,private:!1,access:{has:e=>"target"in e,get:e=>e.target,set:(e,t)=>{e.target=t}},metadata:P},x,_),Xw(null,null,s,{kind:"field",name:"minRotationX",static:!1,private:!1,access:{has:e=>"minRotationX"in e,get:e=>e.minRotationX,set:(e,t)=>{e.minRotationX=t}},metadata:P},w,S),Xw(null,null,a,{kind:"field",name:"maxRotationX",static:!1,private:!1,access:{has:e=>"maxRotationX"in e,get:e=>e.maxRotationX,set:(e,t)=>{e.maxRotationX=t}},metadata:P},M,E),Xw(null,null,o,{kind:"field",name:"minRotationY",static:!1,private:!1,access:{has:e=>"minRotationY"in e,get:e=>e.minRotationY,set:(e,t)=>{e.minRotationY=t}},metadata:P},T,A),Xw(null,null,l,{kind:"field",name:"maxRotationY",static:!1,private:!1,access:{has:e=>"maxRotationY"in e,get:e=>e.maxRotationY,set:(e,t)=>{e.maxRotationY=t}},metadata:P},C,R),Xw(null,null,c,{kind:"field",name:"sensitivity",static:!1,private:!1,access:{has:e=>"sensitivity"in e,get:e=>e.sensitivity,set:(e,t)=>{e.sensitivity=t}},metadata:P},k,I),Xw(null,null,u,{kind:"field",name:"epsilon",static:!1,private:!1,access:{has:e=>"epsilon"in e,get:e=>e.epsilon,set:(e,t)=>{e.epsilon=t}},metadata:P},O,N),Xw(null,null,h,{kind:"field",name:"slowdownAmount",static:!1,private:!1,access:{has:e=>"slowdownAmount"in e,get:e=>e.slowdownAmount,set:(e,t)=>{e.slowdownAmount=t}},metadata:P},D,z),Xw(null,null,d,{kind:"field",name:"pointerTypes",static:!1,private:!1,access:{has:e=>"pointerTypes"in e,get:e=>e.pointerTypes,set:(e,t)=>{e.pointerTypes=t}},metadata:P},U,F),Xw(null,e={value:t},p,{kind:"class",name:t.name,metadata:P},null,f),t=e.value,P&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:P}),qw(t,f)}rotationYTarget=qw(this,g,void 0);rotationXTarget=(qw(this,v),qw(this,y,void 0));target=(qw(this,b),qw(this,x,void 0));minRotationX=(qw(this,_),qw(this,w,-90));maxRotationX=(qw(this,S),qw(this,M,90));minRotationY=(qw(this,E),qw(this,T,-1/0));maxRotationY=(qw(this,A),qw(this,C,1/0));sensitivity=(qw(this,R),qw(this,k,1));epsilon=(qw(this,I),qw(this,O,.01));slowdownAmount=(qw(this,N),qw(this,D,.05));pointerTypes=(qw(this,z),qw(this,U,["mouse","pen","touch"]));#Kt=(qw(this,F),!1);start(){return this.#Kt||(this.#Kt=!0,this.createEffect((()=>{if(!(this.rotationYTarget&&this.rotationXTarget&&this.target))return;const e=(new Ww).set({target:this.target,pointerTypes:this.pointerTypes});e.start(),L((()=>e.stop())),P((()=>{e.set({minX:this.minRotationY,maxX:this.maxRotationY,minY:this.minRotationX,maxY:this.maxRotationX,sensitivity:.15*this.sensitivity,epsilon:this.epsilon,slowdownAmount:this.slowdownAmount})})),P((()=>{this.rotationXTarget.rotation.x=e.y,this.rotationYTarget.rotation.y=-e.x}))}))),this}stop(){return this.#Kt?(this.#Kt=!1,this.stopEffects(),this):this}},t})();var $w=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},Zw=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0},Kw=function(e,t,n){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})};let Jw=(()=>{let e,t,n,i,r,s,a,o,l,c,u,h=[Ge],d=[],p=Xs(qe),f=[],m=[],g=[],v=[],y=[],b=[],x=[],_=[],w=[],S=[],M=[],E=[];return class extends p{static{t=this}static{const T="function"==typeof Symbol&&Symbol.metadata?Object.create(p[Symbol.metadata]??null):void 0;n=[Ue],r=[Ue],a=[Ue],o=[Ue],l=[Ue],c=[Ue],$w(this,i={get:Kw((function(){return this.#B}),"#x","get"),set:Kw((function(e){this.#B=e}),"#x","set")},n,{kind:"accessor",name:"#x",static:!1,private:!0,access:{has:e=>#V in e,get:e=>e.#V,set:(e,t)=>{e.#V=t}},metadata:T},f,m),$w(this,s={get:Kw((function(){return this.#j}),"#y","get"),set:Kw((function(e){this.#j=e}),"#y","set")},r,{kind:"accessor",name:"#y",static:!1,private:!0,access:{has:e=>#H in e,get:e=>e.#H,set:(e,t)=>{e.#H=t}},metadata:T},g,v),$w(this,u={get:Kw((function(){return this.#un}),"#isStarted","get"),set:Kw((function(e){this.#un=e}),"#isStarted","set")},c,{kind:"accessor",name:"#isStarted",static:!1,private:!0,access:{has:e=>#Kt in e,get:e=>e.#Kt,set:(e,t)=>{e.#Kt=t}},metadata:T},M,E),$w(null,null,a,{kind:"field",name:"target",static:!1,private:!1,access:{has:e=>"target"in e,get:e=>e.target,set:(e,t)=>{e.target=t}},metadata:T},y,b),$w(null,null,o,{kind:"field",name:"hasInteracted",static:!1,private:!1,access:{has:e=>"hasInteracted"in e,get:e=>e.hasInteracted,set:(e,t)=>{e.hasInteracted=t}},metadata:T},x,_),$w(null,null,l,{kind:"field",name:"passive",static:!1,private:!1,access:{has:e=>"passive"in e,get:e=>e.passive,set:(e,t)=>{e.passive=t}},metadata:T},w,S),$w(null,e={value:t},h,{kind:"class",name:t.name,metadata:T},null,d),t=e.value,T&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:T}),Zw(t,d)}#B=Zw(this,f,0);get#V(){return i.get.call(this)}set#V(e){return i.set.call(this,e)}get x(){return this.#V}set x(e){this.#Yt(),this.#hn=e,this.#V=e}#j=(Zw(this,m),Zw(this,g,0));get#H(){return s.get.call(this)}set#H(e){return s.set.call(this,e)}get y(){return this.#H}set y(e){this.#Yt(),this.#H=e,this.#dn=e}minX=(Zw(this,v),-1/0);maxX=1/0;minY=-1/0;maxY=1/0;target=Zw(this,y,document.documentElement);sensitivity=(Zw(this,b),1);epsilon=.01;lerpAmount=.3;hasInteracted=Zw(this,x,!1);passive=(Zw(this,_),Zw(this,w,!1));#hn=(Zw(this,S),0);#dn=0;#$t;#un=Zw(this,M,!1);get#Kt(){return u.get.call(this)}set#Kt(e){return u.set.call(this,e)}get isStarted(){return this.#Kt}#Jt=(Zw(this,E),new AbortController);#pn=e=>{this.hasInteracted=!0,e.preventDefault();const t=e.deltaX*this.sensitivity,n=e.deltaY*this.sensitivity;this.#hn=jw(this.#hn+t,this.minX,this.maxX),this.#dn=jw(this.#dn+n,this.minY,this.maxY),this.#Yt(),this.#$t=Kr.addRenderTask(((e,t)=>{const n=this.#hn-this.#V,i=this.#dn-this.#H,r=t/16.6666;if(this.#V+=n*r*this.lerpAmount,this.#H+=i*r*this.lerpAmount,Math.abs(n)<this.epsilon&&Math.abs(i)<this.epsilon)return!1}))};start(){return O((()=>this.#Kt))||(this.#Kt=!0,this.createEffect((()=>{this.target,this.passive,this.#Jt=new AbortController,this.target.addEventListener("wheel",this.#pn,{signal:this.#Jt.signal,passive:this.passive}),L((()=>{this.#Yt(),this.#Jt.abort()}))}))),this}stop(){return O((()=>this.#Kt))?(this.#Kt=!1,this.stopEffects(),this):this}#Yt(){this.#$t&&Kr.removeRenderTask(this.#$t)}},t})();var Qw=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},eS=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0},tS=function(e,t,n){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})};let nS=(()=>{let e,t,n,i,r,s,a,o,l,c=[Ge],u=[],h=Xs(qe),d=[],p=[],f=[],m=[],g=[],v=[],y=[],b=[],x=[],_=[];return class extends h{static{t=this}static{const w="function"==typeof Symbol&&Symbol.metadata?Object.create(h[Symbol.metadata]??null):void 0;n=[Ue],i=[Ue],r=[Ue],s=[Ue],o=[Ue],Qw(this,a={get:tS((function(){return this.#fn}),"#interacting","get"),set:tS((function(e){this.#fn=e}),"#interacting","set")},s,{kind:"accessor",name:"#interacting",static:!1,private:!0,access:{has:e=>#Zt in e,get:e=>e.#Zt,set:(e,t)=>{e.#Zt=t}},metadata:w},y,b),Qw(this,l={get:tS((function(){return this.#un}),"#isStarted","get"),set:tS((function(e){this.#un=e}),"#isStarted","set")},o,{kind:"accessor",name:"#isStarted",static:!1,private:!0,access:{has:e=>#Kt in e,get:e=>e.#Kt,set:(e,t)=>{e.#Kt=t}},metadata:w},x,_),Qw(null,null,n,{kind:"field",name:"x",static:!1,private:!1,access:{has:e=>"x"in e,get:e=>e.x,set:(e,t)=>{e.x=t}},metadata:w},d,p),Qw(null,null,i,{kind:"field",name:"target",static:!1,private:!1,access:{has:e=>"target"in e,get:e=>e.target,set:(e,t)=>{e.target=t}},metadata:w},f,m),Qw(null,null,r,{kind:"field",name:"hasInteracted",static:!1,private:!1,access:{has:e=>"hasInteracted"in e,get:e=>e.hasInteracted,set:(e,t)=>{e.hasInteracted=t}},metadata:w},g,v),Qw(null,e={value:t},c,{kind:"class",name:t.name,metadata:w},null,u),t=e.value,w&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:w}),eS(t,u)}x=eS(this,d,0);minX=(eS(this,p),-1/0);maxX=1/0;target=eS(this,f,document.documentElement);sensitivity=(eS(this,m),1);hasInteracted=eS(this,g,!1);epsilon=(eS(this,v),.01);slowdownAmount=.05;#$t;#fn=eS(this,y,!1);get#Zt(){return a.get.call(this)}set#Zt(e){return a.set.call(this,e)}get interacting(){return this.#Zt}#un=(eS(this,b),eS(this,x,!1));get#Kt(){return l.get.call(this)}set#Kt(e){return l.set.call(this,e)}get isStarted(){return this.#Kt}#Jt=(eS(this,_),new AbortController);#mn=e=>{this.hasInteracted=!0,e*=this.sensitivity,this.x=jw(this.x+e,this.minX,this.maxX),0!==e&&(this.#$t&&Kr.removeRenderTask(this.#$t),this.#$t=Kr.addRenderTask(((t,n)=>{if(e*=1-n/16.6666*this.slowdownAmount,this.x=jw(this.x+e,this.minX,this.maxX),Math.abs(e)<this.epsilon)return!1})))};#gn=new Map;#an=e=>{e.clientX,this.#gn.set(e.pointerId,{id:e.pointerId,x:e.clientX,y:e.clientY}),2===this.#gn.size&&(this.target.addEventListener("pointermove",this.#on,{signal:this.#Jt.signal}),this.#Zt=!0)};#vn=-1;#on=e=>{if(!this.#gn.has(e.pointerId))return;if(this.#gn.size<2)return;const[t,n]=this.#gn.values();if(!t||!n)throw"not possible";e.pointerId===t.id?(t.x=e.clientX,t.y=e.clientY):(n.x=e.clientX,n.y=e.clientY);const i=Math.abs(Math.sqrt((n.x-t.x)**2+(n.y-t.y)**2));-1===this.#vn&&(this.#vn=i);const r=this.#vn-i;this.#mn(r),this.#vn=i};#ln=e=>{this.#gn.has(e.pointerId)&&(this.#gn.delete(e.pointerId),this.#vn=-1,1===this.#gn.size&&(this.target.removeEventListener("pointermove",this.#on),this.#Zt=!1))};start(){return O((()=>this.#Kt))||(this.#Kt=!0,this.createEffect((()=>{this.target,this.#Jt=new AbortController,this.target.addEventListener("pointerdown",this.#an,{signal:this.#Jt.signal}),this.target.addEventListener("pointerup",this.#ln,{signal:this.#Jt.signal}),L((()=>{this.#$t&&Kr.removeRenderTask(this.#$t),this.#Jt.abort(),this.#Zt=!1}))}))),this}stop(){return O((()=>this.#Kt))?(this.#Kt=!1,this.stopEffects(),this):this}},t})();const iS=800;var rS=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0},sS=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},aS=function(e,t,n){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})};(()=>{let e,t,n,i,r,s,a,o,l,c,u,h,d,p,f,m,g,v,y,b,x,_,w,S,M,E,T,A,C,R,P,k,O,N,D,z,U,F,B,V=[pt("lume-camera-rig",oa)],j=[],H=ua,G=[],W=[],X=[],q=[],Y=[],$=[],Z=[],K=[],J=[],Q=[],ee=[],te=[],ne=[],ie=[],re=[],se=[],ae=[],oe=[],le=[],ce=[],ue=[],he=[],de=[],pe=[],fe=[],me=[],ge=[],ve=[],ye=[],be=[],xe=[],_e=[],we=[],Se=[],Me=[],Ee=[],Te=[],Ae=[],Ce=[],Re=[],Pe=[],ke=[],Ie=[],Oe=[],Le=[],Ne=[],De=[],ze=[],Fe=[],Be=[],Ve=[],je=[],He=[];(class extends H{static{t=this}static{const I="function"==typeof Symbol&&Symbol.metadata?Object.create(H[Symbol.metadata]??null):void 0;n=[ct],i=[ct],r=[ct],s=[ct],a=[ct],o=[ct],l=[ct],c=[ct],u=[ct],h=[ct],d=[ct],p=[ct],f=[ct],m=[Ue],v=[ct],y=[ct],b=[ct],x=[Ue],w=[ct],S=[Ue],E=[ht],T=[ct],A=[ht],C=[ct],R=[ht],P=[ht],k=[ct],O=[ct],N=[ct],D=[ct],z=[ct],U=[Ue],F=[Ue],B=[Ue],sS(this,null,i,{kind:"getter",name:"initialPolarAngle",static:!1,private:!1,access:{has:e=>"initialPolarAngle"in e,get:e=>e.initialPolarAngle},metadata:I},null,G),sS(this,null,r,{kind:"setter",name:"initialPolarAngle",static:!1,private:!1,access:{has:e=>"initialPolarAngle"in e,set:(e,t)=>{e.initialPolarAngle=t}},metadata:I},null,G),sS(this,null,a,{kind:"getter",name:"minPolarAngle",static:!1,private:!1,access:{has:e=>"minPolarAngle"in e,get:e=>e.minPolarAngle},metadata:I},null,G),sS(this,null,o,{kind:"setter",name:"minPolarAngle",static:!1,private:!1,access:{has:e=>"minPolarAngle"in e,set:(e,t)=>{e.minPolarAngle=t}},metadata:I},null,G),sS(this,null,c,{kind:"getter",name:"maxPolarAngle",static:!1,private:!1,access:{has:e=>"maxPolarAngle"in e,get:e=>e.maxPolarAngle},metadata:I},null,G),sS(this,null,u,{kind:"setter",name:"maxPolarAngle",static:!1,private:!1,access:{has:e=>"maxPolarAngle"in e,set:(e,t)=>{e.maxPolarAngle=t}},metadata:I},null,G),sS(this,g={get:aS((function(){return this.#yn}),"#appliedDistance","get"),set:aS((function(e){this.#yn=e}),"#appliedDistance","set")},m,{kind:"accessor",name:"#appliedDistance",static:!1,private:!0,access:{has:e=>#bn in e,get:e=>e.#bn,set:(e,t)=>{e.#bn=t}},metadata:I},se,ae),sS(this,null,v,{kind:"getter",name:"initialDistance",static:!1,private:!1,access:{has:e=>"initialDistance"in e,get:e=>e.initialDistance},metadata:I},null,G),sS(this,null,y,{kind:"setter",name:"initialDistance",static:!1,private:!1,access:{has:e=>"initialDistance"in e,set:(e,t)=>{e.initialDistance=t}},metadata:I},null,G),sS(this,_={get:aS((function(){return this.#xn}),"#appliedMinDistance","get"),set:aS((function(e){this.#xn=e}),"#appliedMinDistance","set")},x,{kind:"accessor",name:"#appliedMinDistance",static:!1,private:!0,access:{has:e=>#_n in e,get:e=>e.#_n,set:(e,t)=>{e.#_n=t}},metadata:I},ce,ue),sS(this,M={get:aS((function(){return this.#wn}),"#appliedMaxDistance","get"),set:aS((function(e){this.#wn=e}),"#appliedMaxDistance","set")},S,{kind:"accessor",name:"#appliedMaxDistance",static:!1,private:!0,access:{has:e=>#Sn in e,get:e=>e.#Sn,set:(e,t)=>{e.#Sn=t}},metadata:I},pe,fe),sS(null,null,n,{kind:"field",name:"verticalAngle",static:!1,private:!1,access:{has:e=>"verticalAngle"in e,get:e=>e.verticalAngle,set:(e,t)=>{e.verticalAngle=t}},metadata:I},W,X),sS(null,null,s,{kind:"field",name:"minVerticalAngle",static:!1,private:!1,access:{has:e=>"minVerticalAngle"in e,get:e=>e.minVerticalAngle,set:(e,t)=>{e.minVerticalAngle=t}},metadata:I},q,Y),sS(null,null,l,{kind:"field",name:"maxVerticalAngle",static:!1,private:!1,access:{has:e=>"maxVerticalAngle"in e,get:e=>e.maxVerticalAngle,set:(e,t)=>{e.maxVerticalAngle=t}},metadata:I},$,Z),sS(null,null,h,{kind:"field",name:"horizontalAngle",static:!1,private:!1,access:{has:e=>"horizontalAngle"in e,get:e=>e.horizontalAngle,set:(e,t)=>{e.horizontalAngle=t}},metadata:I},K,J),sS(null,null,d,{kind:"field",name:"minHorizontalAngle",static:!1,private:!1,access:{has:e=>"minHorizontalAngle"in e,get:e=>e.minHorizontalAngle,set:(e,t)=>{e.minHorizontalAngle=t}},metadata:I},Q,ee),sS(null,null,p,{kind:"field",name:"maxHorizontalAngle",static:!1,private:!1,access:{has:e=>"maxHorizontalAngle"in e,get:e=>e.maxHorizontalAngle,set:(e,t)=>{e.maxHorizontalAngle=t}},metadata:I},te,ne),sS(null,null,f,{kind:"field",name:"distance",static:!1,private:!1,access:{has:e=>"distance"in e,get:e=>e.distance,set:(e,t)=>{e.distance=t}},metadata:I},ie,re),sS(null,null,b,{kind:"field",name:"minDistance",static:!1,private:!1,access:{has:e=>"minDistance"in e,get:e=>e.minDistance,set:(e,t)=>{e.minDistance=t}},metadata:I},oe,le),sS(null,null,w,{kind:"field",name:"maxDistance",static:!1,private:!1,access:{has:e=>"maxDistance"in e,get:e=>e.maxDistance,set:(e,t)=>{e.maxDistance=t}},metadata:I},he,de),sS(null,null,E,{kind:"field",name:"active",static:!1,private:!1,access:{has:e=>"active"in e,get:e=>e.active,set:(e,t)=>{e.active=t}},metadata:I},me,ge),sS(null,null,T,{kind:"field",name:"dollySpeed",static:!1,private:!1,access:{has:e=>"dollySpeed"in e,get:e=>e.dollySpeed,set:(e,t)=>{e.dollySpeed=t}},metadata:I},ve,ye),sS(null,null,A,{kind:"field",name:"interactive",static:!1,private:!1,access:{has:e=>"interactive"in e,get:e=>e.interactive,set:(e,t)=>{e.interactive=t}},metadata:I},be,xe),sS(null,null,C,{kind:"field",name:"rotationSpeed",static:!1,private:!1,access:{has:e=>"rotationSpeed"in e,get:e=>e.rotationSpeed,set:(e,t)=>{e.rotationSpeed=t}},metadata:I},_e,we),sS(null,null,R,{kind:"field",name:"dynamicDolly",static:!1,private:!1,access:{has:e=>"dynamicDolly"in e,get:e=>e.dynamicDolly,set:(e,t)=>{e.dynamicDolly=t}},metadata:I},Se,Me),sS(null,null,P,{kind:"field",name:"dynamicRotation",static:!1,private:!1,access:{has:e=>"dynamicRotation"in e,get:e=>e.dynamicRotation,set:(e,t)=>{e.dynamicRotation=t}},metadata:I},Ee,Te),sS(null,null,k,{kind:"field",name:"dollyEpsilon",static:!1,private:!1,access:{has:e=>"dollyEpsilon"in e,get:e=>e.dollyEpsilon,set:(e,t)=>{e.dollyEpsilon=t}},metadata:I},Ae,Ce),sS(null,null,O,{kind:"field",name:"dollyScrollLerp",static:!1,private:!1,access:{has:e=>"dollyScrollLerp"in e,get:e=>e.dollyScrollLerp,set:(e,t)=>{e.dollyScrollLerp=t}},metadata:I},Re,Pe),sS(null,null,N,{kind:"field",name:"dollyPinchSlowdown",static:!1,private:!1,access:{has:e=>"dollyPinchSlowdown"in e,get:e=>e.dollyPinchSlowdown,set:(e,t)=>{e.dollyPinchSlowdown=t}},metadata:I},ke,Ie),sS(null,null,D,{kind:"field",name:"rotationEpsilon",static:!1,private:!1,access:{has:e=>"rotationEpsilon"in e,get:e=>e.rotationEpsilon,set:(e,t)=>{e.rotationEpsilon=t}},metadata:I},Oe,Le),sS(null,null,z,{kind:"field",name:"rotationSlowdown",static:!1,private:!1,access:{has:e=>"rotationSlowdown"in e,get:e=>e.rotationSlowdown,set:(e,t)=>{e.rotationSlowdown=t}},metadata:I},Ne,De),sS(null,null,U,{kind:"field",name:"threeCamera",static:!1,private:!1,access:{has:e=>"threeCamera"in e,get:e=>e.threeCamera,set:(e,t)=>{e.threeCamera=t}},metadata:I},ze,Fe),sS(null,null,F,{kind:"field",name:"rotationYTarget",static:!1,private:!1,access:{has:e=>"rotationYTarget"in e,get:e=>e.rotationYTarget,set:(e,t)=>{e.rotationYTarget=t}},metadata:I},Be,Ve),sS(null,null,B,{kind:"field",name:"rotationXTarget",static:!1,private:!1,access:{has:e=>"rotationXTarget"in e,get:e=>e.rotationXTarget,set:(e,t)=>{e.rotationXTarget=t}},metadata:I},je,He),sS(null,e={value:t},V,{kind:"class",name:t.name,metadata:I},null,j),t=e.value,I&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:I}),rS(t,j)}hasShadow=(rS(this,G),!0);verticalAngle=rS(this,W,0);get initialPolarAngle(){return this.verticalAngle}set initialPolarAngle(e){this.verticalAngle=e}minVerticalAngle=(rS(this,X),rS(this,q,-90));get minPolarAngle(){return this.minVerticalAngle}set minPolarAngle(e){this.minVerticalAngle=e}maxVerticalAngle=(rS(this,Y),rS(this,$,90));get maxPolarAngle(){return this.maxVerticalAngle}set maxPolarAngle(e){this.maxVerticalAngle=e}horizontalAngle=(rS(this,Z),rS(this,K,0));minHorizontalAngle=(rS(this,J),rS(this,Q,-1/0));maxHorizontalAngle=(rS(this,ee),rS(this,te,1/0));distance=(rS(this,ne),rS(this,ie,-1));#yn=(rS(this,re),rS(this,se,iS));get#bn(){return g.get.call(this)}set#bn(e){return g.set.call(this,e)}get initialDistance(){return this.distance}set initialDistance(e){this.distance=e}minDistance=(rS(this,ae),rS(this,oe,-1));#xn=(rS(this,le),rS(this,ce,200));get#_n(){return _.get.call(this)}set#_n(e){return _.set.call(this,e)}maxDistance=(rS(this,ue),rS(this,he,-1));#wn=(rS(this,de),rS(this,pe,800));get#Sn(){return M.get.call(this)}set#Sn(e){return M.set.call(this,e)}active=(rS(this,fe),rS(this,me,!0));dollySpeed=(rS(this,ge),rS(this,ve,1));interactive=(rS(this,ye),rS(this,be,!0));rotationSpeed=(rS(this,xe),rS(this,_e,1));dynamicDolly=(rS(this,we),rS(this,Se,!1));dynamicRotation=(rS(this,Me),rS(this,Ee,!1));dollyEpsilon=(rS(this,Te),rS(this,Ae,.01));dollyScrollLerp=(rS(this,Ce),rS(this,Re,.3));dollyPinchSlowdown=(rS(this,Pe),rS(this,ke,.05));rotationEpsilon=(rS(this,Ie),rS(this,Oe,.01));rotationSlowdown=(rS(this,Le),rS(this,Ne,.05));threeCamera=(rS(this,De),rS(this,ze,void 0));get cam(){return this.threeCamera}rotationYTarget=(rS(this,Fe),rS(this,Be,void 0));rotationXTarget=(rS(this,Ve),rS(this,je,void 0));flingRotation=(rS(this,He),new Yw);scrollFling=new Jw;pinchFling=new nS;get#Mn(){return-1!==this.distance?this.distance:this.scene?.perspective??iS}connectedCallback(){super.connectedCallback(),this.createEffect((()=>{const{scene:e,rotationYTarget:t,rotationXTarget:n,threeCamera:i}=this;if(!(e&&t&&n&&i))return;this.createEffect((()=>{this.#bn=this.#Mn,this.#_n=-1!==this.minDistance?this.minDistance:this.#Mn/2,this.#Sn=-1!==this.maxDistance?this.maxDistance:2*this.#Mn})),this.createEffect((()=>i.position.z=this.#bn));const{scrollFling:r,pinchFling:s,flingRotation:a}=this;I((()=>{a.target=e,a.rotationYTarget=t,a.rotationXTarget=n,r.target=e,s.target=e})),Ye((()=>this.#bn),(e=>this.#bn=e),(()=>this.scrollFling.y),(e=>this.scrollFling.y=e)),Ye((()=>this.scrollFling.y),(e=>this.scrollFling.y=e),(()=>this.pinchFling.x),(e=>this.pinchFling.x=e)),this.createEffect((()=>{a.minRotationX=this.minVerticalAngle,a.maxRotationX=this.maxVerticalAngle,a.minRotationY=this.minHorizontalAngle,a.maxRotationY=this.maxHorizontalAngle,a.sensitivity=this.rotationSpeed,a.epsilon=this.rotationEpsilon,a.slowdownAmount=this.rotationSlowdown,r.minY=s.minX=this.#_n,r.maxY=s.maxX=this.#Sn,r.sensitivity=s.sensitivity=this.dollySpeed,r.epsilon=s.epsilon=this.dollyEpsilon,r.lerpAmount=this.dollyScrollLerp,s.slowdownAmount=this.dollyPinchSlowdown})),this.createEffect((()=>{if(!this.dynamicDolly)return;const e=.001,t=(2*this.dollySpeed-e)/(this.maxDistance-this.minDistance)*(this.threeCamera.position.z-this.minDistance)+e;r.sensitivity=t<e?e:t})),this.createEffect((()=>{if(!this.dynamicRotation)return;const e=1/.15*(180/((this.threeCamera.three.fov?this.scene.calculatedSize.y/2/Math.tan(this.threeCamera.three.fov*Math.PI/360):this.scene.perspective)*(2*this.minDistance)/this.threeCamera.position.z))*this.rotationSpeed;this.flingRotation.sensitivity=e<=0?1:e})),this.createEffect((()=>{this.interactive&&!this.pinchFling?.interacting?a.start():a.stop()})),this.createEffect((()=>{this.interactive?(r.start(),s.start()):(r.stop(),s.stop())})),L((()=>{this.flingRotation.stop(),this.scrollFling.stop(),this.pinchFling.stop()}))}))}template=()=>Vw`
		<lume-element3d
			id="cameraY"
			ref=${e=>this.rotationYTarget=e}
			size="1 1 1"
			size-mode="proportional proportional proportional"
			rotation=${()=>[0,this.horizontalAngle,0]}
		>
			<lume-element3d
				id="cameraX"
				ref=${e=>this.rotationXTarget=e}
				size="1 1 1"
				rotation=${()=>[this.verticalAngle,0,0]}
				size-mode="proportional proportional proportional"
			>
				<slot
					name="camera"
					TODO="determine semantics for overriding the internal camera (this slot is not documented yet)"
				>
					<lume-perspective-camera
						ref=${e=>this.threeCamera=e}
						id="camera-rig-perspective-camera"
						active=${()=>this.active}
						comment="We don't set position here because it triggers the pre-upgrade handling due to the template running before perspective-camera is upgraded (due to Solid specifics) which causes the initial value to override the initial position calculated from scene.perspective."
						xposition=${()=>[0,0,this.#bn]}
						align-point="0.5 0.5 0.5"
						far="100000"
					>
						<slot name="camera-child"></slot>
					</lume-perspective-camera>
				</slot>
			</lume-element3d>
		</lume-element3d>

		<slot></slot>
	`})})();var oS=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},lS=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let cS=(()=>{let e,t,n,i,r,s,a,o=[pt],l=[],c=ua,u=[],h=[],d=[],p=[],f=[],m=[],g=[],v=[],y=[],b=[];return class extends c{static{t=this}static{const x="function"==typeof Symbol&&Symbol.metadata?Object.create(c[Symbol.metadata]??null):void 0;n=[ct],i=[ct],r=[ct],s=[ht],a=[ct],oS(null,null,n,{kind:"field",name:"aspect",static:!1,private:!1,access:{has:e=>"aspect"in e,get:e=>e.aspect,set:(e,t)=>{e.aspect=t}},metadata:x},u,h),oS(null,null,i,{kind:"field",name:"near",static:!1,private:!1,access:{has:e=>"near"in e,get:e=>e.near,set:(e,t)=>{e.near=t}},metadata:x},d,p),oS(null,null,r,{kind:"field",name:"far",static:!1,private:!1,access:{has:e=>"far"in e,get:e=>e.far,set:(e,t)=>{e.far=t}},metadata:x},f,m),oS(null,null,s,{kind:"field",name:"active",static:!1,private:!1,access:{has:e=>"active"in e,get:e=>e.active,set:(e,t)=>{e.active=t}},metadata:x},g,v),oS(null,null,a,{kind:"field",name:"zoom",static:!1,private:!1,access:{has:e=>"zoom"in e,get:e=>e.zoom,set:(e,t)=>{e.zoom=t}},metadata:x},y,b),oS(null,e={value:t},o,{kind:"class",name:t.name,metadata:x},null,l),t=e.value,x&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:x}),lS(t,l)}aspect=lS(this,u,0);near=(lS(this,h),lS(this,d,1));far=(lS(this,p),lS(this,f,3e3));active=(lS(this,m),lS(this,g,!1));zoom=(lS(this,v),lS(this,y,1));connectedCallback(){super.connectedCallback();let e=this.scene;this.createEffect((()=>{this.scene&&this.active&&(e=this.scene,O((()=>this.scene._addCamera(this))),L((()=>{e._removeCamera(this),e=null})))}))}makeThreeObject3d(){return new ry}constructor(){super(...arguments),lS(this,b)}},t})();var uS=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},hS=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};(()=>{let e,t,n,i=[pt("lume-perspective-camera",oa)],r=[],s=cS,a=[],o=[];(class extends s{static{t=this}static{const l="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;n=[ct],uS(null,null,n,{kind:"field",name:"fov",static:!1,private:!1,access:{has:e=>"fov"in e,get:e=>e.fov,set:(e,t)=>{e.fov=t}},metadata:l},a,o),uS(null,e={value:t},i,{kind:"class",name:t.name,metadata:l},null,r),t=e.value,l&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:l}),hS(t,r)}fov=hS(this,a,0);connectedCallback(){super.connectedCallback(),this.createEffect((()=>{if(0!==this.fov)return this.three.fov=this.fov,this.three.updateProjectionMatrix(),void this.needsUpdate();const e=this.scene?.perspective??iS,t=this.scene?.calculatedSize??{x:1,y:1,z:0};this.three.fov=2*Math.atan(t.y/2/e)*180/Math.PI,this.three.updateProjectionMatrix(),this.needsUpdate()})),this.createEffect((()=>{if(0!==this.aspect)return this.three.aspect=this.aspect,this.three.updateProjectionMatrix(),void this.needsUpdate();const e=this.scene?.calculatedSize||{x:1,y:1};this.three.aspect=e.x/e.y||1,this.three.updateProjectionMatrix(),this.needsUpdate()})),this.createEffect((()=>{this.three.near=this.near,this.three.updateProjectionMatrix(),this.needsUpdate()})),this.createEffect((()=>{this.three.far=this.far,this.three.updateProjectionMatrix(),this.needsUpdate()})),this.createEffect((()=>{this.three.zoom=this.zoom,this.three.updateProjectionMatrix(),this.needsUpdate()}))}makeThreeObject3d(){return new ly(75,16/9,1,1e3)}constructor(){super(...arguments),hS(this,o)}})})();let dS=(()=>{let e,t,n=[pt("lume-node",oa)],i=[],r=ua;return class extends r{static{t=this}static{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(r[Symbol.metadata]??null):void 0;(function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0})(null,e={value:t},n,{kind:"class",name:t.name,metadata:s},null,i),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e)}(t,i)}isNode=!0},t})();dS.prototype.isNode=!0;class pS{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new po(e),this.near=t,this.far=n}clone(){return new pS(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class fS{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new po(e),this.density=t}clone(){return new fS(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}const mS=new ka,gS=new an;class vS{constructor(e=new rc,t=new rc,n=new rc,i=new rc,r=new rc,s=new rc){this.planes=[e,t,n,i,r,s]}set(e,t,n,i,r,s){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(s),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=2e3){const n=this.planes,i=e.elements,r=i[0],s=i[1],a=i[2],o=i[3],l=i[4],c=i[5],u=i[6],h=i[7],d=i[8],p=i[9],f=i[10],m=i[11],g=i[12],v=i[13],y=i[14],b=i[15];if(n[0].setComponents(o-r,h-l,m-d,b-g).normalize(),n[1].setComponents(o+r,h+l,m+d,b+g).normalize(),n[2].setComponents(o+s,h+c,m+p,b+v).normalize(),n[3].setComponents(o-s,h-c,m-p,b-v).normalize(),n[4].setComponents(o-a,h-u,m-f,b-y).normalize(),t===lr)n[5].setComponents(o+a,h+u,m+f,b+y).normalize();else{if(t!==cr)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(a,u,f,y).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),mS.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),mS.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(mS)}intersectsSprite(e){return mS.center.set(0,0,0),mS.radius=.7071067811865476,mS.applyMatrix4(e.matrixWorld),this.intersectsSphere(mS)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(gS.x=i.normal.x>0?e.max.x:e.min.x,gS.y=i.normal.y>0?e.max.y:e.min.y,gS.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(gS)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function yS(){let e=null,t=!1,n=null,i=null;function r(t,s){n(t,s),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function bS(e){const t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const i=t.get(n);i&&(e.deleteBuffer(i.buffer),t.delete(n))},update:function(n,i){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){const e=t.get(n);return void((!e||e.version<n.version)&&t.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}const r=t.get(n);if(void 0===r)t.set(n,function(t,n){const i=t.array,r=t.usage,s=i.byteLength,a=e.createBuffer();let o;if(e.bindBuffer(n,a),e.bufferData(n,i,r),t.onUploadCallback(),i instanceof Float32Array)o=e.FLOAT;else if(i instanceof Uint16Array)o=t.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(i instanceof Int16Array)o=e.SHORT;else if(i instanceof Uint32Array)o=e.UNSIGNED_INT;else if(i instanceof Int32Array)o=e.INT;else if(i instanceof Int8Array)o=e.BYTE;else if(i instanceof Uint8Array)o=e.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);o=e.UNSIGNED_BYTE}return{buffer:a,type:o,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version,size:s}}(n,i));else if(r.version<n.version){if(r.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,n,i){const r=n.array,s=n.updateRanges;if(e.bindBuffer(i,t),0===s.length)e.bufferSubData(i,0,r);else{s.sort(((e,t)=>e.start-t.start));let t=0;for(let e=1;e<s.length;e++){const n=s[t],i=s[e];i.start<=n.start+n.count+1?n.count=Math.max(n.count,i.start+i.count-n.start):(++t,s[t]=i)}s.length=t+1;for(let t=0,n=s.length;t<n;t++){const n=s[t];e.bufferSubData(i,n.start*r.BYTES_PER_ELEMENT,r,n.start,n.count)}n.clearUpdateRanges()}n.onUploadCallback()}(r.buffer,n,i),r.version=n.version}}}}const xS={alphahash_fragment:"\n#ifdef USE_ALPHAHASH\n\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n\n#endif\n",alphahash_pars_fragment:"\n#ifdef USE_ALPHAHASH\n\n\t/**\n\t * See: https://casual-effects.com/research/Wyman2017Hashed/index.html\n\t */\n\n\tconst float ALPHA_HASH_SCALE = 0.05; // Derived from trials only, and may be changed.\n\n\tfloat hash2D( vec2 value ) {\n\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\n\t}\n\n\tfloat hash3D( vec3 value ) {\n\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\n\t}\n\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\n\t\t// Find the discretized derivatives of our coordinates\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\n\t\t// Find two nearest log-discretized noise scales\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\n\t\t// Compute alpha thresholds at our two noise scales\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\n\t\t// Factor to interpolate lerp with\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\n\t\t// Interpolate alpha threshold from noise at two scales\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\n\t\t// Pass into CDF to compute uniformly distrib threshold\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\n\t\t// Find our final, uniformly distributed alpha threshold (ατ)\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\n\t\t// Avoids ατ == 0. Could also do ατ =1-ατ\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\n\t}\n\n#endif\n",alphamap_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n\n#endif\n",alphamap_pars_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",alphatest_fragment:"\n#ifdef USE_ALPHATEST\n\n\t#ifdef ALPHA_TO_COVERAGE\n\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\n\t#else\n\n\tif ( diffuseColor.a < alphaTest ) discard;\n\n\t#endif\n\n#endif\n",alphatest_pars_fragment:"\n#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif\n",aomap_fragment:"\n#ifdef USE_AOMAP\n\n\t// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\n\t#endif\n\n#endif\n",aomap_pars_fragment:"\n#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\n#endif\n",batching_pars_vertex:"\n#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\n\t}\n\n\tfloat getIndirectIndex( const in int i ) {\n\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\n\t}\n\n#endif\n\n#ifdef USE_BATCHING_COLOR\n\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\n\t}\n\n#endif\n",batching_vertex:"\n#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif\n",begin_vertex:"\nvec3 transformed = vec3( position );\n\n#ifdef USE_ALPHAHASH\n\n\tvPosition = vec3( position );\n\n#endif\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n\n#ifdef USE_TANGENT\n\n\tvec3 objectTangent = vec3( tangent.xyz );\n\n#endif\n",bsdfs:"\n\nfloat G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\n\n\t// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\n\treturn 0.25;\n\n}\n\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\n\tfloat G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n",iridescence_fragment:"\n\n#ifdef USE_IRIDESCENCE\n\n\t// XYZ to linear-sRGB color space\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\n\t// Assume air interface for top\n\t// Note: We don't handle the case fresnel0 == 1\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\n\t}\n\n\t// Conversion FO/IOR\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\n\t}\n\n\t// ior is a value between 1.0 and 3.0. 1.0 is air interface\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\n\t}\n\n\t// Fresnel equations for dielectric/dielectric interfaces.\n\t// Ref: https://belcour.github.io/blog/research/2017/05/01/brdf-thin-film.html\n\t// Evaluation XYZ sensitivity curves in Fourier space\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\n\t}\n\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\n\t\tvec3 I;\n\n\t\t// Force iridescenceIOR -> outsideIOR when thinFilmThickness -> 0.0\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\t// Evaluate the cosTheta on the base layer (Snell law)\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\n\t\t// Handle TIR:\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\n\t\t\treturn vec3( 1.0 );\n\n\t\t}\n\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\n\t\t// First interface\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\n\t\t// Second interface\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) ); // guard against 1.0\n\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\n\t\t// Phase shift\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\n\t\t// Compound terms\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\n\t\t// Reflectance term for m = 0 (DC term amplitude)\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\n\t\t// Reflectance term for m > 0 (pairs of diracs)\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\n\t\t}\n\n\t\t// Since out of gamut colors might be produced, negative color values are clamped to 0.\n\t\treturn max( I, vec3( 0.0 ) );\n\n\t}\n\n#endif\n\n",bumpmap_pars_fragment:"\n#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n\t// https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\n\t\t// normalize is done to ensure that the bump map looks the same regardless of the texture's scale\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm; // normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",clipping_planes_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvec4 plane;\n\n\t#ifdef ALPHA_TO_COVERAGE\n\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\n\t\t\tfloat unionClipOpacity = 1.0;\n\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\n\t\t#endif\n\n\t\tdiffuseColor.a *= clipOpacity;\n\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\n\t#else\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\n\t\t\tbool clipped = true;\n\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\n\t\t\tif ( clipped ) discard;\n\n\t\t#endif\n\n\t#endif\n\n#endif\n",clipping_planes_pars_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n\n#endif\n",clipping_planes_pars_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n#endif\n",clipping_planes_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvClipPosition = - mvPosition.xyz;\n\n#endif\n",color_fragment:"\n#if defined( USE_COLOR_ALPHA )\n\n\tdiffuseColor *= vColor;\n\n#elif defined( USE_COLOR )\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif\n",color_pars_fragment:"\n#if defined( USE_COLOR_ALPHA )\n\n\tvarying vec4 vColor;\n\n#elif defined( USE_COLOR )\n\n\tvarying vec3 vColor;\n\n#endif\n",color_pars_vertex:"\n#if defined( USE_COLOR_ALPHA )\n\n\tvarying vec4 vColor;\n\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\n\tvarying vec3 vColor;\n\n#endif\n",color_vertex:"\n#if defined( USE_COLOR_ALPHA )\n\n\tvColor = vec4( 1.0 );\n\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\n\tvColor = vec3( 1.0 );\n\n#endif\n\n#ifdef USE_COLOR\n\n\tvColor *= color;\n\n#endif\n\n#ifdef USE_INSTANCING_COLOR\n\n\tvColor.xyz *= instanceColor.xyz;\n\n#endif\n\n#ifdef USE_BATCHING_COLOR\n\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\n\tvColor.xyz *= batchingColor.xyz;\n\n#endif\n",common:"\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n// <tonemapping_pars_fragment> may have defined saturate() already\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\n\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\n\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( const in vec2 uv ) {\n\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\n\treturn fract( sin( sn ) * c );\n\n}\n\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\n\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\n\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n\n#ifdef USE_ALPHAHASH\n\n\tvarying vec3 vPosition;\n\n#endif\n\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n}\n\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t// dir can be either a direction vector or a normal vector\n\t// upper-left 3x3 of matrix is assumed to be orthogonal\n\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n\n}\n\nmat3 transposeMat3( const in mat3 m ) {\n\n\tmat3 tmp;\n\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\n\treturn tmp;\n\n}\n\nbool isPerspectiveMatrix( mat4 m ) {\n\n\treturn m[ 2 ][ 3 ] == - 1.0;\n\n}\n\nvec2 equirectUv( in vec3 dir ) {\n\n\t// dir is assumed to be unit length\n\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\treturn vec2( u, v );\n\n}\n\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\n\treturn RECIPROCAL_PI * diffuseColor;\n\n} // validated\n\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\n\t// Original approximation by Christophe Schlick '94\n\t// float fresnel = pow( 1.0 - dotVH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH '13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n\n} // validated\n\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\n\t// Original approximation by Christophe Schlick '94\n\t// float fresnel = pow( 1.0 - dotVH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH '13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n\n} // validated\n",cube_uv_reflection_fragment:"\n#ifdef ENVMAP_TYPE_CUBE_UV\n\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\n\t// These shader functions convert between the UV coordinates of a single face of\n\t// a cubemap, the 0-5 integer index of a cube face, and the direction vector for\n\t// sampling a textureCube (not generally normalized ).\n\n\tfloat getFace( vec3 direction ) {\n\n\t\tvec3 absDirection = abs( direction );\n\n\t\tfloat face = - 1.0;\n\n\t\tif ( absDirection.x > absDirection.z ) {\n\n\t\t\tif ( absDirection.x > absDirection.y )\n\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\n\t\t\telse\n\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\n\t\t} else {\n\n\t\t\tif ( absDirection.z > absDirection.y )\n\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\n\t\t\telse\n\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\n\t\t}\n\n\t\treturn face;\n\n\t}\n\n\t// RH coordinate system; PMREM face-indexing convention\n\tvec2 getUV( vec3 direction, float face ) {\n\n\t\tvec2 uv;\n\n\t\tif ( face == 0.0 ) {\n\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x ); // pos x\n\n\t\t} else if ( face == 1.0 ) {\n\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y ); // pos y\n\n\t\t} else if ( face == 2.0 ) {\n\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z ); // pos z\n\n\t\t} else if ( face == 3.0 ) {\n\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x ); // neg x\n\n\t\t} else if ( face == 4.0 ) {\n\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y ); // neg y\n\n\t\t} else {\n\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z ); // neg z\n\n\t\t}\n\n\t\treturn 0.5 * ( uv + 1.0 );\n\n\t}\n\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\n\t\tfloat face = getFace( direction );\n\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\n\t\tfloat faceSize = exp2( mipInt );\n\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0; // #25071\n\n\t\tif ( face > 2.0 ) {\n\n\t\t\tuv.y += faceSize;\n\n\t\t\tface -= 3.0;\n\n\t\t}\n\n\t\tuv.x += face * faceSize;\n\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\n\t\t#ifdef texture2DGradEXT\n\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb; // disable anisotropic filtering\n\n\t\t#else\n\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\n\t\t#endif\n\n\t}\n\n\t// These defines must match with PMREMGenerator\n\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\n\tfloat roughnessToMip( float roughness ) {\n\n\t\tfloat mip = 0.0;\n\n\t\tif ( roughness >= cubeUV_r1 ) {\n\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\n\t\t} else {\n\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness ); // 1.16 = 1.79^0.25\n\t\t}\n\n\t\treturn mip;\n\n\t}\n\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\n\t\tfloat mipF = fract( mip );\n\n\t\tfloat mipInt = floor( mip );\n\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\n\t\tif ( mipF == 0.0 ) {\n\n\t\t\treturn vec4( color0, 1.0 );\n\n\t\t} else {\n\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\n\t\t}\n\n\t}\n\n#endif\n",defaultnormal_vertex:"\n\nvec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\n\tvec3 transformedTangent = objectTangent;\n\n#endif\n\n#ifdef USE_BATCHING\n\n\t// this is in lieu of a per-instance normal-matrix\n\t// shear transforms in the instance matrix are not supported\n\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\ttransformedTangent = bm * transformedTangent;\n\n\t#endif\n\n#endif\n\n#ifdef USE_INSTANCING\n\n\t// this is in lieu of a per-instance normal-matrix\n\t// shear transforms in the instance matrix are not supported\n\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\ttransformedTangent = im * transformedTangent;\n\n\t#endif\n\n#endif\n\ntransformedNormal = normalMatrix * transformedNormal;\n\n#ifdef FLIP_SIDED\n\n\ttransformedNormal = - transformedNormal;\n\n#endif\n\n#ifdef USE_TANGENT\n\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\n\t#ifdef FLIP_SIDED\n\n\t\ttransformedTangent = - transformedTangent;\n\n\t#endif\n\n#endif\n",displacementmap_pars_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n\n#endif\n",displacementmap_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n\n#endif\n",emissivemap_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n\n#endif\n",emissivemap_pars_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tuniform sampler2D emissiveMap;\n\n#endif\n",colorspace_fragment:"\ngl_FragColor = linearToOutputTexel( gl_FragColor );\n",colorspace_pars_fragment:"\n\n// http://www.russellcottrell.com/photo/matrixCalculator.htm\n\n// Linear sRGB => XYZ => Linear Display P3\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\n\n// Linear Display P3 => XYZ => Linear sRGB\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\n\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\n\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\n\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\n\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\n\n",envmap_fragment:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvec3 cameraToFrag;\n\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\n\t\t}\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#else\n\n\t\tvec4 envColor = vec4( 0.0 );\n\n\t#endif\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",envmap_common_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif\n",envmap_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n\n#endif\n",envmap_pars_vertex:"\n#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\n\t#endif\n\n#endif\n",envmap_physical_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\n\t\t#else\n\n\t\t\treturn vec3( 0.0 );\n\n\t\t#endif\n\n\t}\n\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\n\t\t\t// Mixing the reflection with the normal is more accurate and keeps rough objects from gathering light from behind their tangent plane.\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\n\t\t#else\n\n\t\t\treturn vec3( 0.0 );\n\n\t\t#endif\n\n\t}\n\n\t#ifdef USE_ANISOTROPY\n\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\n\t\t\t  // https://google.github.io/filament/Filament.md.html#lighting/imagebasedlights/anisotropy\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\n\t\t\t#else\n\n\t\t\t\treturn vec3( 0.0 );\n\n\t\t\t#endif\n\n\t\t}\n\n\t#endif\n\n#endif\n",envmap_vertex:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvWorldPosition = worldPosition.xyz;\n\n\t#else\n\n\t\tvec3 cameraToVertex;\n\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t\t}\n\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\n\n\tvFogDepth = - mvPosition.z;\n\n#endif\n",fog_pars_vertex:"\n#ifdef USE_FOG\n\n\tvarying float vFogDepth;\n\n#endif\n",fog_fragment:"\n#ifdef USE_FOG\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\n\t#endif\n\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\n#endif\n",fog_pars_fragment:"\n#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\n\t#endif\n\n#endif\n",gradientmap_pars_fragment:"\n\n#ifdef USE_GRADIENTMAP\n\n\tuniform sampler2D gradientMap;\n\n#endif\n\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\n\t// dotNL will be from -1.0 to 1.0\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\n\t#ifdef USE_GRADIENTMAP\n\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\n\t#else\n\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\n\t#endif\n\n}\n",lightmap_pars_fragment:"\n#ifdef USE_LIGHTMAP\n\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n\n#endif\n",lights_lambert_fragment:"\nLambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;\n",lights_lambert_pars_fragment:"\nvarying vec3 vViewPosition;\n\nstruct LambertMaterial {\n\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n\n};\n\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert\n",lights_pars_begin:"\nuniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n\n#if defined( USE_LIGHT_PROBES )\n\n\tuniform vec3 lightProbe[ 9 ];\n\n#endif\n\n// get the irradiance (radiance convolved with cosine lobe) at the point 'normal' on the unit sphere\n// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\n\t// normal is assumed to have unit length\n\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\n\t// band 0\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\n\t// band 1\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\n\t// band 2\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\n\treturn result;\n\n}\n\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\n\treturn irradiance;\n\n}\n\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\n\tvec3 irradiance = ambientLightColor;\n\n\treturn irradiance;\n\n}\n\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\n\t// based upon Frostbite 3 Moving to Physically-based Rendering\n\t// page 32, equation 26: E[window1]\n\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\n\tif ( cutoffDistance > 0.0 ) {\n\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\n\t}\n\n\treturn distanceFalloff;\n\n}\n\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n\n}\n\n#if NUM_DIR_LIGHTS > 0\n\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\n\t}\n\n#endif\n\n\n#if NUM_POINT_LIGHTS > 0\n\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\n\t// light is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\n\t\tlight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\n\t}\n\n#endif\n\n\n#if NUM_SPOT_LIGHTS > 0\n\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\n\t// light is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\n\t\tlight.direction = normalize( lVector );\n\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\n\t\tif ( spotAttenuation > 0.0 ) {\n\n\t\t\tfloat lightDistance = length( lVector );\n\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\n\t\t} else {\n\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\n\t\t}\n\n\t}\n\n#endif\n\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\n\t// Pre-computed values of LinearTransformedCosine approximation of BRDF\n\t// BRDF approximation Texture is 64x64\n\tuniform sampler2D ltc_1; // RGBA Float\n\tuniform sampler2D ltc_2; // RGBA Float\n\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n\n#endif\n\n\n#if NUM_HEMI_LIGHTS > 0\n\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\n\t\treturn irradiance;\n\n\t}\n\n#endif\n",lights_toon_fragment:"\nToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\n",lights_toon_pars_fragment:"\nvarying vec3 vViewPosition;\n\nstruct ToonMaterial {\n\n\tvec3 diffuseColor;\n\n};\n\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n",lights_phong_fragment:"\nBlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"\nvarying vec3 vViewPosition;\n\nstruct BlinnPhongMaterial {\n\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n\n};\n\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n\n}\n\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n",lights_physical_fragment:"\nPhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\n\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\n\nmaterial.roughness = max( roughnessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.\nmaterial.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n\n#ifdef IOR\n\n\tmaterial.ior = ior;\n\n\t#ifdef USE_SPECULAR\n\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\n\t\t#endif\n\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\n\t\t#endif\n\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\n\t#else\n\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\n\t#endif\n\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n\n#else\n\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n\n#endif\n\n#ifdef USE_CLEARCOAT\n\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\n\t#ifdef USE_CLEARCOATMAP\n\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\n\t#endif\n\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\n\t#endif\n\n\tmaterial.clearcoat = saturate( material.clearcoat ); // Burley clearcoat model\n\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n\n#endif\n\n#ifdef USE_DISPERSION\n\n\tmaterial.dispersion = dispersion;\n\n#endif\n\n#ifdef USE_IRIDESCENCE\n\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\n\t#ifdef USE_IRIDESCENCEMAP\n\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\n\t#endif\n\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\n\t#else\n\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\n\t#endif\n\n#endif\n\n#ifdef USE_SHEEN\n\n\tmaterial.sheenColor = sheenColor;\n\n\t#ifdef USE_SHEEN_COLORMAP\n\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\n\t#endif\n\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\n\t#endif\n\n#endif\n\n#ifdef USE_ANISOTROPY\n\n\t#ifdef USE_ANISOTROPYMAP\n\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\n\t#else\n\n\t\tvec2 anisotropyV = anisotropyVector;\n\n\t#endif\n\n\tmaterial.anisotropy = length( anisotropyV );\n\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\n\t// Roughness along the anisotropy bitangent is the material roughness, while the tangent roughness increases with anisotropy.\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n\n#endif\n",lights_physical_pars_fragment:'\n\nstruct PhysicalMaterial {\n\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n\n};\n\n// temporary\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\n\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\n\treturn 0.5 / max( gv + gl, EPSILON );\n\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disney’s reparameterization\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1\n\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n\n}\n\n// https://google.github.io/filament/Filament.md.html#materialsystem/anisotropicmodel/anisotropicspecularbrdf\n#ifdef USE_ANISOTROPY\n\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\n\t\treturn saturate(v);\n\n\t}\n\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\n\t}\n\n#endif\n\n#ifdef USE_CLEARCOAT\n\n\t// GGX Distribution, Schlick Fresnel, GGX_SmithCorrelated Visibility\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\n\t\tfloat alpha = pow2( roughness ); // UE4\'s roughness\n\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\t\tfloat D = D_GGX( alpha, dotNH );\n\n\t\treturn F * ( V * D );\n\n\t}\n\n#endif\n\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\n\tfloat alpha = pow2( roughness ); // UE4\'s roughness\n\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\n\t#ifdef USE_IRIDESCENCE\n\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\n\t#endif\n\n\t#ifdef USE_ANISOTROPY\n\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\n\t#else\n\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\t\tfloat D = D_GGX( alpha, dotNH );\n\n\t#endif\n\n\treturn F * ( V * D );\n\n}\n\n// Rect Area Light\n\n// Real-Time Polygonal-Light Shading with Linearly Transformed Cosines\n// by Eric Heitz, Jonathan Dupuy, Stephen Hill and David Neubelt\n// code: https://github.com/selfshadow/ltc_code/\n\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\tfloat dotNV = saturate( dot( N, V ) );\n\n\t// texture parameterized by sqrt( GGX alpha ) and sqrt( 1 - cos( theta ) )\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\treturn uv;\n\n}\n\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\n\t// Real-Time Area Lighting: a Journey from Research to Production (p.102)\n\t// An approximation of the form factor of a horizon-clipped rectangle.\n\n\tfloat l = length( f );\n\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n\n}\n\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\n\tfloat x = dot( v1, v2 );\n\n\tfloat y = abs( x );\n\n\t// rational polynomial approximation to theta / sin( theta ) / 2PI\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\n\treturn cross( v1, v2 ) * theta_sintheta;\n\n}\n\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\n\t// bail if point is on back side of plane of light\n\t// assumes ccw winding order of light vertices\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\n\t// construct orthonormal basis around N\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 ); // negated from paper; possibly due to a different handedness of world coordinate system\n\n\t// compute transform\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\n\t// transform rect\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\n\t// project rect onto sphere\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\n\t// calculate vector form factor\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\n\t// adjust for horizon clipping\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\n/*\n\t// alternate method of adjusting for horizon clipping (see referece)\n\t// refactoring required\n\tfloat len = length( vectorFormFactor );\n\tfloat z = vectorFormFactor.z / len;\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\t// tabulated horizon-clipped sphere, apparently...\n\tvec2 uv = vec2( z * 0.5 + 0.5, len );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\tfloat scale = texture2D( ltc_2, uv ).w;\n\n\tfloat result = len * scale;\n*/\n\n\treturn vec3( result );\n\n}\n\n// End Rect Area Light\n\n#if defined( USE_SHEEN )\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs\nfloat D_Charlie( float roughness, float dotNH ) {\n\n\tfloat alpha = pow2( roughness );\n\n\t// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF"\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 ); // 2^(-14/2), so sin2h^2 > 0 in fp16\n\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n\n}\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\n\t// Neubelt and Pettineo 2013, "Crafting a Next-gen Material Pipeline for The Order: 1886"\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n\n}\n\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\n\treturn sheenColor * ( D * V );\n\n}\n\n#endif\n\n// This is a curve-fit approxmation to the "Charlie sheen" BRDF integrated over the hemisphere from \n// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF". The analysis can be found\n// in the Sheen section of https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\n\tfloat r2 = roughness * roughness;\n\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\n\treturn saturate( DG * RECIPROCAL_PI );\n\n}\n\n// Analytical approximation of the DFG LUT, one half of the\n// split-sum approximation used in indirect specular lighting.\n// via \'environmentBRDF\' from "Physically Based Shading on Mobile"\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\n\tvec4 r = roughness * c0 + c1;\n\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\n\treturn fab;\n\n}\n\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\n\treturn specularColor * fab.x + specularF90 * fab.y;\n\n}\n\n// Fdez-Agüera\'s "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"\n// Approximates multiscattering in order to preserve energy.\n// http://www.jcgt.org/published/0008/01/03/\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\n\t#ifdef USE_IRIDESCENCE\n\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\n\t#else\n\n\t\tvec3 Fr = specularColor;\n\n\t#endif\n\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619; // 1/21\n\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n\n}\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight; // counterclockwise; light shines in local neg z direction\n\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\n\t\t// LTC Fresnel Approximation by Stephen Hill\n\t\t// http://blog.selfshadow.com/publications/s2016-advances/s2016_ltc_fresnel.pdf\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\n\t}\n\n#endif\n\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifdef USE_CLEARCOAT\n\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\n\t#endif\n\n\t#ifdef USE_SHEEN\n\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\n\t#endif\n\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\n\t#ifdef USE_CLEARCOAT\n\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\n\t#endif\n\n\t#ifdef USE_SHEEN\n\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\n\t#endif\n\n\t// Both indirect specular and indirect diffuse light accumulate here\n\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\n\t#ifdef USE_IRIDESCENCE\n\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\n\t#else\n\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\n\t#endif\n\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n\n// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n\n}\n',lights_fragment_begin:"\n/**\n * This is a template that can be used to light a material, it uses pluggable\n * RenderEquations (RE)for specific lighting scenarios.\n *\n * Instructions for use:\n * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined\n * - Create a material parameter that is to be passed as the third parameter to your lighting functions.\n *\n * TODO:\n * - Add area light support.\n * - Add sphere light support.\n * - Add diffuse light probe (irradiance cubemap) support.\n */\n\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n\n#ifdef USE_CLEARCOAT\n\n\tgeometryClearcoatNormal = clearcoatNormal;\n\n#endif\n\n#ifdef USE_IRIDESCENCE\n\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\n\tif ( material.iridescenceThickness == 0.0 ) {\n\n\t\tmaterial.iridescence = 0.0;\n\n\t} else {\n\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\n\t}\n\n\tif ( material.iridescence > 0.0 ) {\n\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\n\t\t// Iridescence F0 approximation\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\n\t}\n\n#endif\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\n\t\t// spot lights are ordered [shadows with maps, shadows without maps, maps without shadows, none]\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n\tRectAreaLight rectAreaLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\tvec3 iblIrradiance = vec3( 0.0 );\n\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n\t#if defined( USE_LIGHT_PROBES )\n\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\n\t#endif\n\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t#endif\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n\n#endif\n",lights_fragment_maps:"\n#if defined( RE_IndirectDiffuse )\n\n\t#ifdef USE_LIGHTMAP\n\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\n\t\tirradiance += lightMapIrradiance;\n\n\t#endif\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\n\t#endif\n\n#endif\n\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\n\t#ifdef USE_ANISOTROPY\n\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\n\t#else\n\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\n\t#endif\n\n\t#ifdef USE_CLEARCOAT\n\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\n\t#endif\n\n#endif\n",lights_fragment_end:"\n#if defined( RE_IndirectDiffuse )\n\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\n#endif\n",logdepthbuf_fragment:"\n#if defined( USE_LOGDEPTHBUF )\n\n\t// Doing a strict comparison with == 1.0 can cause noise artifacts\n\t// on some platforms. See issue #17623.\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n\n#endif\n",logdepthbuf_pars_fragment:"\n#if defined( USE_LOGDEPTHBUF )\n\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n\n#endif\n",logdepthbuf_pars_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n\n#endif\n",logdepthbuf_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\n#endif\n",map_fragment:"\n#ifdef USE_MAP\n\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\n\t#ifdef DECODE_VIDEO_TEXTURE\n\n\t\t// use inline sRGB decode until browsers properly support SRGB8_ALPHA8 with video textures (#26516)\n\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\n\tdiffuseColor *= sampledDiffuseColor;\n\n#endif\n",map_pars_fragment:"\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n",map_particle_fragment:"\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\t#if defined( USE_POINTS_UV )\n\n\t\tvec2 uv = vUv;\n\n\t#else\n\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\n\t#endif\n\n#endif\n\n#ifdef USE_MAP\n\n\tdiffuseColor *= texture2D( map, uv );\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n\n#endif\n",map_particle_pars_fragment:"\n#if defined( USE_POINTS_UV )\n\n\tvarying vec2 vUv;\n\n#else\n\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\t\tuniform mat3 uvTransform;\n\n\t#endif\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",metalnessmap_fragment:"\nfloat metalnessFactor = metalness;\n\n#ifdef USE_METALNESSMAP\n\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\n\t// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tmetalnessFactor *= texelMetalness.b;\n\n#endif\n",metalnessmap_pars_fragment:"\n#ifdef USE_METALNESSMAP\n\n\tuniform sampler2D metalnessMap;\n\n#endif\n",morphinstance_vertex:"\n#ifdef USE_INSTANCING_MORPH\n\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\n\t}\n#endif\n",morphcolor_vertex:"\n#if defined( USE_MORPHCOLORS )\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\tvColor *= morphTargetBaseInfluence;\n\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\n\t\t#if defined( USE_COLOR_ALPHA )\n\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\n\t\t#elif defined( USE_COLOR )\n\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\n\t\t#endif\n\n\t}\n\n#endif\n",morphnormal_vertex:"\n#ifdef USE_MORPHNORMALS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\tobjectNormal *= morphTargetBaseInfluence;\n\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\n\t}\n\n#endif\n",morphtarget_pars_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_INSTANCING_MORPH\n\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\n\t#endif\n\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\n\t}\n\n#endif\n",morphtarget_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in position = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\ttransformed *= morphTargetBaseInfluence;\n\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\n\t}\n\n#endif\n",normal_fragment_begin:"\nfloat faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n\n#ifdef FLAT_SHADED\n\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#else\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal *= faceDirection;\n\n\t#endif\n\n#endif\n\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\n\t#ifdef USE_TANGENT\n\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\n\t#else\n\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\n\t#endif\n\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\n\t#endif\n\n#endif\n\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\t#ifdef USE_TANGENT\n\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\n\t#else\n\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\n\t#endif\n\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\n\t#endif\n\n#endif\n\n// non perturbed normal for clearcoat among others\n\nvec3 nonPerturbedNormal = normal;\n\n",normal_fragment_maps:"\n\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n\t#ifdef FLIP_SIDED\n\n\t\tnormal = - normal;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * faceDirection;\n\n\t#endif\n\n\tnormal = normalize( normalMatrix * normal );\n\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\n\tnormal = normalize( tbn * mapN );\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n\n#endif\n",normal_pars_fragment:"\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n",normal_pars_vertex:"\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n",normal_vertex:"\n#ifndef FLAT_SHADED // normal is computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n",normalmap_pars_fragment:"\n#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n#endif\n\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\n\tuniform mat3 normalMatrix;\n\n#endif\n\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\n\t// Normal Mapping Without Precomputed Tangents\n\t// http://www.thetenthplanet.de/archives/1180\n\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\n\t\tvec3 N = surf_norm; // normalized\n\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\n\t\treturn mat3( T * scale, B * scale, N );\n\n\t}\n\n#endif\n",clearcoat_normal_fragment_begin:"\n#ifdef USE_CLEARCOAT\n\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n\n#endif\n",clearcoat_normal_fragment_maps:"\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n\n#endif\n",clearcoat_pars_fragment:"\n\n#ifdef USE_CLEARCOATMAP\n\n\tuniform sampler2D clearcoatMap;\n\n#endif\n\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n\n#endif\n\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tuniform sampler2D clearcoatRoughnessMap;\n\n#endif\n",iridescence_pars_fragment:"\n\n#ifdef USE_IRIDESCENCEMAP\n\n\tuniform sampler2D iridescenceMap;\n\n#endif\n\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\n\tuniform sampler2D iridescenceThicknessMap;\n\n#endif\n",opaque_fragment:"\n#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\n\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n",packing:"\nvec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\n\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\n\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\nconst float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\n\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\n\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\n\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\n\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\t// the 0.9999 tweak is unimportant, very tiny empirical improvement\n\t// return vec3( vuf * Inv255, gf * PackUpscale, bf * 0.9999 );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\n\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\n\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\n\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\n\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\n\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\n\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\n\n// NOTE: viewZ, the z-coordinate in camera space, is negative for points in front of the camera\n\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\t// -near maps to 0; -far maps to 1\n\treturn ( viewZ + near ) / ( near - far );\n}\n\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\t// maps orthographic depth in [ 0, 1 ] to viewZ\n\treturn depth * ( near - far ) - near;\n}\n\n// NOTE: https://twitter.com/gonnavis/status/1377183786949959682\n\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\t// -near maps to 0; -far maps to 1\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\n\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\t// maps perspective depth in [ 0, 1 ] to viewZ\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}\n",premultiplied_alpha_fragment:"\n#ifdef PREMULTIPLIED_ALPHA\n\n\t// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.\n\tgl_FragColor.rgb *= gl_FragColor.a;\n\n#endif\n",project_vertex:"\nvec4 mvPosition = vec4( transformed, 1.0 );\n\n#ifdef USE_BATCHING\n\n\tmvPosition = batchingMatrix * mvPosition;\n\n#endif\n\n#ifdef USE_INSTANCING\n\n\tmvPosition = instanceMatrix * mvPosition;\n\n#endif\n\nmvPosition = modelViewMatrix * mvPosition;\n\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"\n#ifdef DITHERING\n\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n\n#endif\n",dithering_pars_fragment:"\n#ifdef DITHERING\n\n\t// based on https://www.shadertoy.com/view/MslGR8\n\tvec3 dithering( vec3 color ) {\n\t\t//Calculate grid position\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\n\t\t//Shift the individual colors differently, thus making it even harder to see the dithering pattern\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\n\t\t//modify shift according to grid position.\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\n\t\t//shift the color by dither_shift\n\t\treturn color + dither_shift_RGB;\n\t}\n\n#endif\n",roughnessmap_fragment:"\nfloat roughnessFactor = roughness;\n\n#ifdef USE_ROUGHNESSMAP\n\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\n\t// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\troughnessFactor *= texelRoughness.g;\n\n#endif\n",roughnessmap_pars_fragment:"\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform sampler2D roughnessMap;\n\n#endif\n",shadowmap_pars_fragment:"\n#if NUM_SPOT_LIGHT_COORDS > 0\n\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n\n#endif\n\n#if NUM_SPOT_LIGHT_MAPS > 0\n\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n\n#endif\n\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): create uniforms for area light shadows\n\n\t#endif\n\t*/\n\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n\t}\n\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n\t}\n\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n\t\tfloat occlusion = 1.0;\n\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\n\t\tfloat hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n\t\tif (hard_shadow != 1.0 ) {\n\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n\t\t}\n\t\treturn occlusion;\n\n\t}\n\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n\t\tfloat shadow = 1.0;\n\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\n\t\tif ( frustumTest ) {\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#else // no percentage-closer filtering:\n\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#endif\n\n\t\t}\n\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\n\t}\n\n\t// cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n\t// vector suitable for 2D texture mapping. This code uses the following layout for the\n\t// 2D texture:\n\t//\n\t// xzXZ\n\t//  y Y\n\t//\n\t// Y - Positive y direction\n\t// y - Negative y direction\n\t// X - Positive x direction\n\t// x - Negative x direction\n\t// Z - Positive z direction\n\t// z - Negative z direction\n\t//\n\t// Source and test bed:\n\t// https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n\t\t// Number of texels to avoid at the edge of each square\n\n\t\tvec3 absV = abs( v );\n\n\t\t// Intersect unit cube\n\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\n\t\t// Apply scale to avoid seams\n\n\t\t// two texels less per square (one texel will do for NEAREST)\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n\t\t// Unwrap\n\n\t\t// space: -1 ... 1 range for each square\n\t\t//\n\t\t// #X##\t\tdim    := ( 4 , 2 )\n\t\t//  # #\t\tcenter := ( 1 , 1 )\n\n\t\tvec2 planar = v.xy;\n\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\n\t\tif ( absV.z >= almostOne ) {\n\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\n\t\t} else if ( absV.x >= almostOne ) {\n\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\n\t\t} else if ( absV.y >= almostOne ) {\n\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\n\t\t}\n\n\t\t// Transform to UV space\n\n\t\t// scale := 0.5 / dim\n\t\t// translate := ( center + 0.5 ) / dim\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n\t}\n\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n\t\tfloat shadow = 1.0;\n\n\t\t// for point lights, the uniform @vShadowCoord is re-purposed to hold\n\t\t// the vector from the light to the world-space position of the fragment.\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\n\t\t\t// dp = normalized distance from light to fragment position\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n\t\t\tdp += shadowBias;\n\n\t\t\t// bd3D = base direction 3D\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t\t#else // no percentage-closer filtering\n\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\n\t\t\t#endif\n\n\t\t}\n\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\n\t}\n\n#endif\n",shadowmap_pars_vertex:"\n\n#if NUM_SPOT_LIGHT_COORDS > 0\n\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n\n#endif\n\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): uniforms for area light shadows\n\n\t#endif\n\t*/\n\n#endif\n",shadowmap_vertex:"\n\n#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\n\t// Offsetting the position used for querying occlusion along the world normal can be used to reduce shadow acne.\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n\n#endif\n\n#if defined( USE_SHADOWMAP )\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update vAreaShadowCoord with area light info\n\n\t#endif\n\t*/\n\n#endif\n\n// spot lights can be evaluated without active shadow mapping (when SpotLight.map is used)\n\n#if NUM_SPOT_LIGHT_COORDS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n\n",shadowmask_pars_fragment:"\nfloat getShadowMask() {\n\n\tfloat shadow = 1.0;\n\n\t#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\tDirectionalLightShadow directionalLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\tSpotLightShadow spotLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\tPointLightShadow pointLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update shadow for Area light\n\n\t#endif\n\t*/\n\n\t#endif\n\n\treturn shadow;\n\n}\n",skinbase_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif\n",skinning_pars_vertex:"\n#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\tuniform highp sampler2D boneTexture;\n\n\tmat4 getBoneMatrix( const in float i ) {\n\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\n\t\treturn mat4( v1, v2, v3, v4 );\n\n\t}\n\n#endif\n",skinning_vertex:"\n#ifdef USE_SKINNING\n\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n\n#endif\n",skinnormal_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n\t#ifdef USE_TANGENT\n\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#endif\n\n#endif\n",specularmap_fragment:"\nfloat specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif\n",specularmap_pars_fragment:"\n#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif\n",tonemapping_fragment:"\n#if defined( TONE_MAPPING )\n\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n\n#endif\n",tonemapping_pars_fragment:"\n#ifndef saturate\n// <common> may have defined saturate() already\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n\nuniform float toneMappingExposure;\n\n// exposure only\nvec3 LinearToneMapping( vec3 color ) {\n\n\treturn saturate( toneMappingExposure * color );\n\n}\n\n// source: https://www.cs.utah.edu/docs/techreports/2002/pdf/UUCS-02-001.pdf\nvec3 ReinhardToneMapping( vec3 color ) {\n\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n\n}\n\n// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/\nvec3 CineonToneMapping( vec3 color ) {\n\n\t// filmic operator by Jim Hejl and Richard Burgess-Dawson\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n\n}\n\n// source: https://github.com/selfshadow/ltc_code/blob/master/webgl/shaders/ltc/ltc_blit.fs\nvec3 RRTAndODTFit( vec3 v ) {\n\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n\n}\n\n// this implementation of ACES is modified to accommodate a brighter viewing environment.\n// the scale factor of 1/0.6 is subjective. see discussion in #19621.\n\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\n\t// sRGB => XYZ => D65_2_D60 => AP1 => RRT_SAT\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ), // transposed from source\n\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\n\t// ODT_SAT => XYZ => D60_2_D65 => sRGB\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ), // transposed from source\n\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\n\tcolor *= toneMappingExposure / 0.6;\n\n\tcolor = ACESInputMat * color;\n\n\t// Apply RRT and ODT\n\tcolor = RRTAndODTFit( color );\n\n\tcolor = ACESOutputMat * color;\n\n\t// Clamp to [0, 1]\n\treturn saturate( color );\n\n}\n\n// Matrices for rec 2020 <> rec 709 color space conversion\n// matrix provided in row-major order so it has been transposed\n// https://www.itu.int/pub/R-REP-BT.2407-2017\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\n\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\n\n// https://iolite-engine.com/blog_posts/minimal_agx_implementation\n// Mean error^2: 3.6705141e-06\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n\n}\n\n// AgX Tone Mapping implementation based on Filament, which in turn is based\n// on Blender's implementation using rec 2020 primaries\n// https://github.com/google/filament/pull/7236\n// Inputs and outputs are encoded as Linear-sRGB.\n\nvec3 AgXToneMapping( vec3 color ) {\n\n\t// AgX constants\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\n\t// explicit AgXOutsetMatrix generated from Filaments AgXOutsetMatrixInv\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\n\t// LOG2_MIN      = -10.0\n\t// LOG2_MAX      =  +6.5\n\t// MIDDLE_GRAY   =  0.18\n\tconst float AgxMinEv = - 12.47393;  // log2( pow( 2, LOG2_MIN ) * MIDDLE_GRAY )\n\tconst float AgxMaxEv = 4.026069;    // log2( pow( 2, LOG2_MAX ) * MIDDLE_GRAY )\n\n\tcolor *= toneMappingExposure;\n\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\n\tcolor = AgXInsetMatrix * color;\n\n\t// Log2 encoding\n\tcolor = max( color, 1e-10 ); // avoid 0 or negative numbers for log2\n\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\n\tcolor = clamp( color, 0.0, 1.0 );\n\n\t// Apply sigmoid\n\tcolor = agxDefaultContrastApprox( color );\n\n\t// Apply AgX look\n\t// v = agxLook(v, look);\n\n\tcolor = AgXOutsetMatrix * color;\n\n\t// Linearize\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\n\t// Gamut mapping. Simple clamp for now.\n\tcolor = clamp( color, 0.0, 1.0 );\n\n\treturn color;\n\n}\n\n// https://modelviewer.dev/examples/tone-mapping\n\nvec3 NeutralToneMapping( vec3 color ) {\n\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\n\tcolor *= toneMappingExposure;\n\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\n\tcolor -= offset;\n\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\n\tif ( peak < StartCompression ) return color;\n\n\tfloat d = 1. - StartCompression;\n\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\n\tcolor *= newPeak / peak;\n\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\n\treturn mix( color, vec3( newPeak ), g );\n\n}\n\nvec3 CustomToneMapping( vec3 color ) { return color; }\n",transmission_fragment:"\n#ifdef USE_TRANSMISSION\n\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\n\t#ifdef USE_TRANSMISSIONMAP\n\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\n\t#endif\n\n\t#ifdef USE_THICKNESSMAP\n\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\n\t#endif\n\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n\n#endif\n",transmission_pars_fragment:"\n#ifdef USE_TRANSMISSION\n\n\t// Transmission code is based on glTF-Sampler-Viewer\n\t// https://github.com/KhronosGroup/glTF-Sample-Viewer\n\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\n\t#ifdef USE_TRANSMISSIONMAP\n\n\t\tuniform sampler2D transmissionMap;\n\n\t#endif\n\n\t#ifdef USE_THICKNESSMAP\n\n\t\tuniform sampler2D thicknessMap;\n\n\t#endif\n\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\n\tvarying vec3 vWorldPosition;\n\n\t// Mipped Bicubic Texture Filtering by N8\n\t// https://www.shadertoy.com/view/Dl2SDW\n\n\tfloat w0( float a ) {\n\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\n\t}\n\n\tfloat w1( float a ) {\n\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\n\t}\n\n\tfloat w2( float a ){\n\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\n\t}\n\n\tfloat w3( float a ) {\n\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\n\t}\n\n\t// g0 and g1 are the two amplitude functions\n\tfloat g0( float a ) {\n\n\t\treturn w0( a ) + w1( a );\n\n\t}\n\n\tfloat g1( float a ) {\n\n\t\treturn w2( a ) + w3( a );\n\n\t}\n\n\t// h0 and h1 are the two offset functions\n\tfloat h0( float a ) {\n\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\n\t}\n\n\tfloat h1( float a ) {\n\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\n\t}\n\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\n\t\tuv = uv * texelSize.zw + 0.5;\n\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\n\t}\n\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\n\t}\n\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\n\t\t// Direction of refracted light.\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\n\t\t// Compute rotation-independant scaling of the model matrix.\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\n\t\t// The thickness is specified in local space.\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\n\t}\n\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\n\t\t// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and\n\t\t// an IOR of 1.5 results in the default amount of microfacet refraction.\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\n\t}\n\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\n\t}\n\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\n\t\tif ( isinf( attenuationDistance ) ) {\n\n\t\t\t// Attenuation distance is +∞, i.e. the transmitted color is not attenuated at all.\n\t\t\treturn vec3( 1.0 );\n\n\t\t} else {\n\n\t\t\t// Compute light attenuation using Beer's law.\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance ); // Beer's law\n\t\t\treturn transmittance;\n\n\t\t}\n\n\t}\n\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\n\t\t#ifdef USE_DISPERSION\n\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\n\t\t\t\t// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\n\t\t\t\t// Sample framebuffer to get pixel the refracted ray hits.\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\n\t\t\t}\n\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t\n\t\t#else\n\t\t\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\n\t\t\t// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\n\t\t\t// Sample framebuffer to get pixel the refracted ray hits.\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t\n\t\t#endif\n\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\n\t\t// Get the specular component.\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\n\t\t// As less light is transmitted, the opacity should be increased. This simple approximation does a decent job \n\t\t// of modulating a CSS background, and has no effect when the buffer is opaque, due to a solid object or clear color.\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\n\t}\n#endif\n",uv_pars_fragment:"\n#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\n\tvarying vec2 vUv;\n\n#endif\n#ifdef USE_MAP\n\n\tvarying vec2 vMapUv;\n\n#endif\n#ifdef USE_ALPHAMAP\n\n\tvarying vec2 vAlphaMapUv;\n\n#endif\n#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vLightMapUv;\n\n#endif\n#ifdef USE_AOMAP\n\n\tvarying vec2 vAoMapUv;\n\n#endif\n#ifdef USE_BUMPMAP\n\n\tvarying vec2 vBumpMapUv;\n\n#endif\n#ifdef USE_NORMALMAP\n\n\tvarying vec2 vNormalMapUv;\n\n#endif\n#ifdef USE_EMISSIVEMAP\n\n\tvarying vec2 vEmissiveMapUv;\n\n#endif\n#ifdef USE_METALNESSMAP\n\n\tvarying vec2 vMetalnessMapUv;\n\n#endif\n#ifdef USE_ROUGHNESSMAP\n\n\tvarying vec2 vRoughnessMapUv;\n\n#endif\n#ifdef USE_ANISOTROPYMAP\n\n\tvarying vec2 vAnisotropyMapUv;\n\n#endif\n#ifdef USE_CLEARCOATMAP\n\n\tvarying vec2 vClearcoatMapUv;\n\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tvarying vec2 vClearcoatNormalMapUv;\n\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tvarying vec2 vClearcoatRoughnessMapUv;\n\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\n\tvarying vec2 vIridescenceMapUv;\n\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\n\tvarying vec2 vIridescenceThicknessMapUv;\n\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\n\tvarying vec2 vSheenColorMapUv;\n\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\n\tvarying vec2 vSheenRoughnessMapUv;\n\n#endif\n#ifdef USE_SPECULARMAP\n\n\tvarying vec2 vSpecularMapUv;\n\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\n\tvarying vec2 vSpecularColorMapUv;\n\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\n\tvarying vec2 vSpecularIntensityMapUv;\n\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n\n#endif\n#ifdef USE_THICKNESSMAP\n\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n\n#endif\n",uv_pars_vertex:"\n#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\n\tvarying vec2 vUv;\n\n#endif\n#ifdef USE_MAP\n\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n\n#endif\n#ifdef USE_ALPHAMAP\n\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n\n#endif\n#ifdef USE_LIGHTMAP\n\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n\n#endif\n#ifdef USE_AOMAP\n\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n\n#endif\n#ifdef USE_BUMPMAP\n\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n\n#endif\n#ifdef USE_NORMALMAP\n\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n\n#endif\n#ifdef USE_EMISSIVEMAP\n\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n\n#endif\n#ifdef USE_METALNESSMAP\n\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n\n#endif\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n\n#endif\n#ifdef USE_ANISOTROPYMAP\n\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n\n#endif\n#ifdef USE_CLEARCOATMAP\n\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n\n#endif\n#ifdef USE_SPECULARMAP\n\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n\n#endif\n#ifdef USE_THICKNESSMAP\n\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n\n#endif\n",uv_vertex:"\n#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\n\tvUv = vec3( uv, 1 ).xy;\n\n#endif\n#ifdef USE_MAP\n\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_ALPHAMAP\n\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_LIGHTMAP\n\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_AOMAP\n\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_BUMPMAP\n\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_NORMALMAP\n\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_EMISSIVEMAP\n\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_METALNESSMAP\n\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_ROUGHNESSMAP\n\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_ANISOTROPYMAP\n\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_CLEARCOATMAP\n\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_SPECULARMAP\n\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_THICKNESSMAP\n\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n\n#endif\n",worldpos_vertex:"\n#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\n\t#ifdef USE_BATCHING\n\n\t\tworldPosition = batchingMatrix * worldPosition;\n\n\t#endif\n\n\t#ifdef USE_INSTANCING\n\n\t\tworldPosition = instanceMatrix * worldPosition;\n\n\t#endif\n\n\tworldPosition = modelMatrix * worldPosition;\n\n#endif\n",background_vert:"\nvarying vec2 vUv;\nuniform mat3 uvTransform;\n\nvoid main() {\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n\n}\n",background_frag:"\nuniform sampler2D t2D;\nuniform float backgroundIntensity;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n\tvec4 texColor = texture2D( t2D, vUv );\n\n\t#ifdef DECODE_VIDEO_TEXTURE\n\n\t\t// use inline sRGB decode until browsers properly support SRGB8_APLHA8 with video textures\n\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\n\t#endif\n\n\ttexColor.rgb *= backgroundIntensity;\n\n\tgl_FragColor = texColor;\n\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\n}\n",backgroundCube_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n\tgl_Position.z = gl_Position.w; // set z to camera.far\n\n}\n",backgroundCube_frag:"\n\n#ifdef ENVMAP_TYPE_CUBE\n\n\tuniform samplerCube envMap;\n\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\tuniform sampler2D envMap;\n\n#endif\n\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\n\nvarying vec3 vWorldDirection;\n\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\n\t#else\n\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t#endif\n\n\ttexColor.rgb *= backgroundIntensity;\n\n\tgl_FragColor = texColor;\n\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\n}\n",cube_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n\tgl_Position.z = gl_Position.w; // set z to camera.far\n\n}\n",cube_frag:"\nuniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\n\nvarying vec3 vWorldDirection;\n\nvoid main() {\n\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\n}\n",depth_vert:"\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n// This is used for computing an equivalent of gl_FragCoord.z that is as high precision as possible.\n// Some platforms compute gl_FragCoord at a lower precision which makes the manually computed value better for\n// depth-based postprocessing effects. Reproduced on iPad with A10 processor / iPadOS 13.3.1.\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\n\t#include <morphinstance_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvHighPrecisionZW = gl_Position.zw;\n\n}\n",depth_frag:"\n#if DEPTH_PACKING == 3200\n\n\tuniform float opacity;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tdiffuseColor.a = opacity;\n\n\t#endif\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\n\t#include <logdepthbuf_fragment>\n\n\t// Higher precision equivalent of gl_FragCoord.z. This assumes depthRange has been left to its default values.\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\n\t#elif DEPTH_PACKING == 3201\n\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\n\t#elif DEPTH_PACKING == 3202\n\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\n\t#elif DEPTH_PACKING == 3203\n\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\n\t#endif\n\n}\n",distanceRGBA_vert:"\n#define DISTANCE\n\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\n\t#include <morphinstance_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvWorldPosition = worldPosition.xyz;\n\n}\n",distanceRGBA_frag:"\n#define DISTANCE\n\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main () {\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist ); // clamp to [ 0, 1 ]\n\n\tgl_FragColor = packDepthToRGBA( dist );\n\n}\n",equirect_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n}\n",equirect_frag:"\nuniform sampler2D tEquirect;\n\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvec3 direction = normalize( vWorldDirection );\n\n\tvec2 sampleUV = equirectUv( direction );\n\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\n}\n",linedashed_vert:"\nuniform float scale;\nattribute float lineDistance;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\tvLineDistance = scale * lineDistance;\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n",linedashed_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\nuniform float dashSize;\nuniform float totalSize;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\n\t\tdiscard;\n\n\t}\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\n\toutgoingLight = diffuseColor.rgb; // simple shader\n\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",meshbasic_vert:"\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshbasic_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\n\t// accumulation (baked indirect lighting only)\n\t#ifdef USE_LIGHTMAP\n\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\n\t#endif\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshlambert_vert:"\n#define LAMBERT\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshlambert_frag:"\n#define LAMBERT\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshmatcap_vert:"\n#define MATCAP\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n}\n",meshmatcap_frag:"\n#define MATCAP\n\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\n\t#ifdef USE_MATCAP\n\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\n\t#else\n\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 ); // default if matcap is missing\n\n\t#endif\n\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshnormal_vert:"\n#define NORMAL\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\n\tvViewPosition = - mvPosition.xyz;\n\n#endif\n\n}\n",meshnormal_frag:"\n#define NORMAL\n\nuniform float opacity;\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\n\t#ifdef OPAQUE\n\n\t\tgl_FragColor.a = 1.0;\n\n\t#endif\n\n}\n",meshphong_vert:"\n#define PHONG\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphong_frag:"\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphysical_vert:"\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifdef USE_TRANSMISSION\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n#ifdef USE_TRANSMISSION\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif\n}\n",meshphysical_frag:"\n#define STANDARD\n\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef IOR\n\tuniform float ior;\n#endif\n\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\n\t#include <transmission_fragment>\n\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\n\t#ifdef USE_SHEEN\n\n\t\t// Sheen energy compensation approximation calculation can be found at the end of\n\t\t// https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\n\t#endif\n\n\t#ifdef USE_CLEARCOAT\n\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\n\t#endif\n\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshtoon_vert:"\n#define TOON\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshtoon_frag:"\n#define TOON\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",points_vert:"\nuniform float size;\nuniform float scale;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n#ifdef USE_POINTS_UV\n\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n\n#endif\n\nvoid main() {\n\n\t#ifdef USE_POINTS_UV\n\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n\t#endif\n\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\n\tgl_PointSize = size;\n\n\t#ifdef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\n\t#endif\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n\n}\n",points_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",shadow_vert:"\n#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\n\nvoid main() {\n\n\t#include <batching_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",shadow_frag:"\nuniform vec3 color;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n\nvoid main() {\n\n\t#include <logdepthbuf_fragment>\n\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\n}\n",sprite_vert:"\nuniform float rotation;\nuniform vec2 center;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\n\t#ifndef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\n\t#endif\n\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\n\tmvPosition.xy += rotatedPosition;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n",sprite_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\n}\n"},_S={common:{diffuse:{value:new po(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Sr},alphaMap:{value:null},alphaMapTransform:{value:new Sr},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Sr}},envmap:{envMap:{value:null},envMapRotation:{value:new Sr},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Sr}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Sr}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Sr},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Sr},normalScale:{value:new da(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Sr},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Sr}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Sr}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Sr}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new po(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new po(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Sr},alphaTest:{value:0},uvTransform:{value:new Sr}},sprite:{diffuse:{value:new po(16777215)},opacity:{value:1},center:{value:new da(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Sr},alphaMap:{value:null},alphaMapTransform:{value:new Sr},alphaTest:{value:0}}},wS={basic:{uniforms:Ey([_S.common,_S.specularmap,_S.envmap,_S.aomap,_S.lightmap,_S.fog]),vertexShader:xS.meshbasic_vert,fragmentShader:xS.meshbasic_frag},lambert:{uniforms:Ey([_S.common,_S.specularmap,_S.envmap,_S.aomap,_S.lightmap,_S.emissivemap,_S.bumpmap,_S.normalmap,_S.displacementmap,_S.fog,_S.lights,{emissive:{value:new po(0)}}]),vertexShader:xS.meshlambert_vert,fragmentShader:xS.meshlambert_frag},phong:{uniforms:Ey([_S.common,_S.specularmap,_S.envmap,_S.aomap,_S.lightmap,_S.emissivemap,_S.bumpmap,_S.normalmap,_S.displacementmap,_S.fog,_S.lights,{emissive:{value:new po(0)},specular:{value:new po(1118481)},shininess:{value:30}}]),vertexShader:xS.meshphong_vert,fragmentShader:xS.meshphong_frag},standard:{uniforms:Ey([_S.common,_S.envmap,_S.aomap,_S.lightmap,_S.emissivemap,_S.bumpmap,_S.normalmap,_S.displacementmap,_S.roughnessmap,_S.metalnessmap,_S.fog,_S.lights,{emissive:{value:new po(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:xS.meshphysical_vert,fragmentShader:xS.meshphysical_frag},toon:{uniforms:Ey([_S.common,_S.aomap,_S.lightmap,_S.emissivemap,_S.bumpmap,_S.normalmap,_S.displacementmap,_S.gradientmap,_S.fog,_S.lights,{emissive:{value:new po(0)}}]),vertexShader:xS.meshtoon_vert,fragmentShader:xS.meshtoon_frag},matcap:{uniforms:Ey([_S.common,_S.bumpmap,_S.normalmap,_S.displacementmap,_S.fog,{matcap:{value:null}}]),vertexShader:xS.meshmatcap_vert,fragmentShader:xS.meshmatcap_frag},points:{uniforms:Ey([_S.points,_S.fog]),vertexShader:xS.points_vert,fragmentShader:xS.points_frag},dashed:{uniforms:Ey([_S.common,_S.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:xS.linedashed_vert,fragmentShader:xS.linedashed_frag},depth:{uniforms:Ey([_S.common,_S.displacementmap]),vertexShader:xS.depth_vert,fragmentShader:xS.depth_frag},normal:{uniforms:Ey([_S.common,_S.bumpmap,_S.normalmap,_S.displacementmap,{opacity:{value:1}}]),vertexShader:xS.meshnormal_vert,fragmentShader:xS.meshnormal_frag},sprite:{uniforms:Ey([_S.sprite,_S.fog]),vertexShader:xS.sprite_vert,fragmentShader:xS.sprite_frag},background:{uniforms:{uvTransform:{value:new Sr},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:xS.background_vert,fragmentShader:xS.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Sr}},vertexShader:xS.backgroundCube_vert,fragmentShader:xS.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:xS.cube_vert,fragmentShader:xS.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:xS.equirect_vert,fragmentShader:xS.equirect_frag},distanceRGBA:{uniforms:Ey([_S.common,_S.displacementmap,{referencePosition:{value:new an},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:xS.distanceRGBA_vert,fragmentShader:xS.distanceRGBA_frag},shadow:{uniforms:Ey([_S.lights,_S.fog,{color:{value:new po(0)},opacity:{value:1}}]),vertexShader:xS.shadow_vert,fragmentShader:xS.shadow_frag}};wS.physical={uniforms:Ey([wS.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Sr},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Sr},clearcoatNormalScale:{value:new da(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Sr},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Sr},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Sr},sheen:{value:0},sheenColor:{value:new po(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Sr},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Sr},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Sr},transmissionSamplerSize:{value:new da},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Sr},attenuationDistance:{value:0},attenuationColor:{value:new po(0)},specularColor:{value:new po(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Sr},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Sr},anisotropyVector:{value:new da},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Sr}}]),vertexShader:xS.meshphysical_vert,fragmentShader:xS.meshphysical_frag};const SS={r:0,b:0,g:0},MS=new _r,ES=new ur;function TS(e,t,n,i,r,s,a){const o=new po(0);let l,c,u=!0===s?0:1,h=null,d=0,p=null;function f(e){let i=!0===e.isScene?e.background:null;return i&&i.isTexture&&(i=(e.backgroundBlurriness>0?n:t).get(i)),i}function m(t,n){t.getRGB(SS,Ty(e)),i.buffers.color.setClear(SS.r,SS.g,SS.b,n,a)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),u=t,m(o,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,m(o,u)},render:function(t){let n=!1;const r=f(t);null===r?m(o,u):r&&r.isColor&&(m(r,1),n=!0);const s=e.xr.getEnvironmentBlendMode();"additive"===s?i.buffers.color.setClear(0,0,0,1,a):"alpha-blend"===s&&i.buffers.color.setClear(0,0,0,0,a),(e.autoClear||n)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))},addToRenderList:function(t,n){const i=f(n);i&&(i.isCubeTexture||i.mapping===Bn)?(void 0===c&&(c=new Yo(new Ml(1,1,1),new Py({name:"BackgroundCubeMaterial",uniforms:My(wS.backgroundCube.uniforms),vertexShader:wS.backgroundCube.vertexShader,fragmentShader:wS.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),MS.copy(n.backgroundRotation),MS.x*=-1,MS.y*=-1,MS.z*=-1,i.isCubeTexture&&!1===i.isRenderTargetTexture&&(MS.y*=-1,MS.z*=-1),c.material.uniforms.envMap.value=i,c.material.uniforms.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(ES.makeRotationFromEuler(MS)),c.material.toneMapped=so.getTransfer(i.colorSpace)!==$i,h===i&&d===i.version&&p===e.toneMapping||(c.material.needsUpdate=!0,h=i,d=i.version,p=e.toneMapping),c.layers.enableAll(),t.unshift(c,c.geometry,c.material,0,0,null)):i&&i.isTexture&&(void 0===l&&(l=new Yo(new bc(2,2),new Py({name:"BackgroundMaterial",uniforms:My(wS.background.uniforms),vertexShader:wS.background.vertexShader,fragmentShader:wS.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=i,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.toneMapped=so.getTransfer(i.colorSpace)!==$i,!0===i.matrixAutoUpdate&&i.updateMatrix(),l.material.uniforms.uvTransform.value.copy(i.matrix),h===i&&d===i.version&&p===e.toneMapping||(l.material.needsUpdate=!0,h=i,d=i.version,p=e.toneMapping),l.layers.enableAll(),t.unshift(l,l.geometry,l.material,0,0,null))}}}function AS(e,t){const n=e.getParameter(e.MAX_VERTEX_ATTRIBS),i={},r=c(null);let s=r,a=!1;function o(t){return e.bindVertexArray(t)}function l(t){return e.deleteVertexArray(t)}function c(e){const t=[],i=[],r=[];for(let e=0;e<n;e++)t[e]=0,i[e]=0,r[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:r,object:e,attributes:{},index:null}}function u(){const e=s.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function h(e){d(e,0)}function d(t,n){const i=s.newAttributes,r=s.enabledAttributes,a=s.attributeDivisors;i[t]=1,0===r[t]&&(e.enableVertexAttribArray(t),r[t]=1),a[t]!==n&&(e.vertexAttribDivisor(t,n),a[t]=n)}function p(){const t=s.newAttributes,n=s.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function f(t,n,i,r,s,a,o){!0===o?e.vertexAttribIPointer(t,n,i,s,a):e.vertexAttribPointer(t,n,i,r,s,a)}function m(){g(),a=!0,s!==r&&(s=r,o(s.object))}function g(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:function(n,r,l,m,g){let v=!1;const y=function(t,n,r){const s=!0===r.wireframe;let a=i[t.id];void 0===a&&(a={},i[t.id]=a);let o=a[n.id];void 0===o&&(o={},a[n.id]=o);let l=o[s];return void 0===l&&(l=c(e.createVertexArray()),o[s]=l),l}(m,l,r);s!==y&&(s=y,o(s.object)),v=function(e,t,n,i){const r=s.attributes,a=t.attributes;let o=0;const l=n.getAttributes();for(const t in l)if(l[t].location>=0){const n=r[t];let i=a[t];if(void 0===i&&("instanceMatrix"===t&&e.instanceMatrix&&(i=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(i=e.instanceColor)),void 0===n)return!0;if(n.attribute!==i)return!0;if(i&&n.data!==i.data)return!0;o++}return s.attributesNum!==o||s.index!==i}(n,m,l,g),v&&function(e,t,n,i){const r={},a=t.attributes;let o=0;const l=n.getAttributes();for(const t in l)if(l[t].location>=0){let n=a[t];void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor));const i={};i.attribute=n,n&&n.data&&(i.data=n.data),r[t]=i,o++}s.attributes=r,s.attributesNum=o,s.index=i}(n,m,l,g),null!==g&&t.update(g,e.ELEMENT_ARRAY_BUFFER),(v||a)&&(a=!1,function(n,i,r,s){u();const a=s.attributes,o=r.getAttributes(),l=i.defaultAttributeValues;for(const i in o){const r=o[i];if(r.location>=0){let o=a[i];if(void 0===o&&("instanceMatrix"===i&&n.instanceMatrix&&(o=n.instanceMatrix),"instanceColor"===i&&n.instanceColor&&(o=n.instanceColor)),void 0!==o){const i=o.normalized,a=o.itemSize,l=t.get(o);if(void 0===l)continue;const c=l.buffer,u=l.type,p=l.bytesPerElement,m=u===e.INT||u===e.UNSIGNED_INT||o.gpuType===Jn;if(o.isInterleavedBufferAttribute){const t=o.data,l=t.stride,g=o.offset;if(t.isInstancedInterleavedBuffer){for(let e=0;e<r.locationSize;e++)d(r.location+e,t.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<r.locationSize;e++)h(r.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<r.locationSize;e++)f(r.location+e,a/r.locationSize,u,i,l*p,(g+a/r.locationSize*e)*p,m)}else{if(o.isInstancedBufferAttribute){for(let e=0;e<r.locationSize;e++)d(r.location+e,o.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let e=0;e<r.locationSize;e++)h(r.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<r.locationSize;e++)f(r.location+e,a/r.locationSize,u,i,a*p,a/r.locationSize*e*p,m)}}else if(void 0!==l){const t=l[i];if(void 0!==t)switch(t.length){case 2:e.vertexAttrib2fv(r.location,t);break;case 3:e.vertexAttrib3fv(r.location,t);break;case 4:e.vertexAttrib4fv(r.location,t);break;default:e.vertexAttrib1fv(r.location,t)}}}}p()}(n,r,l,m),null!==g&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(const e in i){const t=i[e];for(const e in t){const n=t[e];for(const e in n)l(n[e].object),delete n[e];delete t[e]}delete i[e]}},releaseStatesOfGeometry:function(e){if(void 0===i[e.id])return;const t=i[e.id];for(const e in t){const n=t[e];for(const e in n)l(n[e].object),delete n[e];delete t[e]}delete i[e.id]},releaseStatesOfProgram:function(e){for(const t in i){const n=i[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)l(r[e].object),delete r[e];delete n[e.id]}},initAttributes:u,enableAttribute:h,disableUnusedAttributes:p}}function CS(e,t,n){let i;function r(t,r,s){0!==s&&(e.drawArraysInstanced(i,t,r,s),n.update(r,i,s))}this.setMode=function(e){i=e},this.render=function(t,r){e.drawArrays(i,t,r),n.update(r,i,1)},this.renderInstances=r,this.renderMultiDraw=function(e,r,s){if(0===s)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,e,0,r,0,s);let a=0;for(let e=0;e<s;e++)a+=r[e];n.update(a,i,1)},this.renderMultiDrawInstances=function(e,s,a,o){if(0===a)return;const l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<e.length;t++)r(e[t],s[t],o[t]);else{l.multiDrawArraysInstancedWEBGL(i,e,0,s,0,o,0,a);let t=0;for(let e=0;e<a;e++)t+=s[e];for(let e=0;e<o.length;e++)n.update(t,i,o[e])}}}function RS(e,t,n,i){let r;function s(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let a=void 0!==n.precision?n.precision:"highp";const o=s(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);const l=!0===n.logarithmicDepthBuffer,c=!0===n.reverseDepthBuffer&&t.has("EXT_clip_control");if(!0===c){const e=t.get("EXT_clip_control");e.clipControlEXT(e.LOWER_LEFT_EXT,e.ZERO_TO_ONE_EXT)}const u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:s,textureFormatReadable:function(t){return t===si||i.convert(t)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){const r=n===ti&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(n!==Zn&&i.convert(n)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==ei&&!r)},precision:a,logarithmicDepthBuffer:l,reverseDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxCubemapSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexUniforms:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:e.getParameter(e.MAX_VARYING_VECTORS),maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:h>0,maxSamples:e.getParameter(e.MAX_SAMPLES)}}function PS(e){const t=this;let n=null,i=0,r=!1,s=!1;const a=new rc,o=new Sr,l={value:null,needsUpdate:!1};function c(e,n,i,r){const s=null!==e?e.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const t=i+4*s,r=n.matrixWorldInverse;o.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,n=i;t!==s;++t,n+=4)a.copy(e[t]).applyMatrix4(r,o),a.normal.toArray(c,n),c[n+3]=a.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==i||r;return r=t,i=e.length,n},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(a,o,u){const h=a.clippingPlanes,d=a.clipIntersection,p=a.clipShadows,f=e.get(a);if(!r||null===h||0===h.length||s&&!p)s?c(null):(l.value!==n&&(l.value=n,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0);else{const e=s?0:i,t=4*e;let r=f.clippingState||null;l.value=r,r=c(h,o,t,u);for(let e=0;e!==t;++e)r[e]=n[e];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}class kS extends yr{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Ba(0,0,e,t),this.scissorTest=!1,this.viewport=new Ba(0,0,e,t);const i={width:e,height:t,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:qn,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const r=new fl(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);r.flipY=!1,r.generateMipmaps=n.generateMipmaps,r.internalFormat=n.internalFormat,this.textures=[];const s=n.count;for(let e=0;e<s;e++)this.textures[e]=r.clone(),this.textures[e].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.textures.length;i<r;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++)this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new hl(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class IS extends kS{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}const OS=-90;class LS extends Br{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new ly(OS,1,e,t);i.layers=this.layers,this.add(i);const r=new ly(OS,1,e,t);r.layers=this.layers,this.add(r);const s=new ly(OS,1,e,t);s.layers=this.layers,this.add(s);const a=new ly(OS,1,e,t);a.layers=this.layers,this.add(a);const o=new ly(OS,1,e,t);o.layers=this.layers,this.add(o);const l=new ly(OS,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,r,s,a,o]=t;for(const e of t)this.remove(e);if(e===lr)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(e!==cr)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(const e of t)this.add(e),e.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,s,a,o,l,c]=this.children,u=e.getRenderTarget(),h=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,r),e.setRenderTarget(n,1,i),e.render(t,s),e.setRenderTarget(n,2,i),e.render(t,a),e.setRenderTarget(n,3,i),e.render(t,o),e.setRenderTarget(n,4,i),e.render(t,l),n.texture.generateMipmaps=f,e.setRenderTarget(n,5,i),e.render(t,c),e.setRenderTarget(u,h,d),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class NS extends fl{constructor(e,t,n,i,r,s,a,o,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:Un,n,i,r,s,a,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class DS extends IS{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new NS(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:qn}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",s=new Ml(5,5,5),a=new Py({name:"CubemapFromEquirect",uniforms:My(n),vertexShader:i,fragmentShader:r,side:1,blending:0});a.uniforms.tEquirect.value=t;const o=new Yo(s,a),l=t.minFilter;return t.minFilter===$n&&(t.minFilter=qn),new LS(1,10,this).update(e,o),t.minFilter=l,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,n,i);e.setRenderTarget(r)}}function zS(e){let t=new WeakMap;function n(e,t){return 303===t?e.mapping=Un:304===t&&(e.mapping=Fn),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping;if(303===s||304===s){if(t.has(r))return n(t.get(r).texture,r.mapping);{const s=r.image;if(s&&s.height>0){const a=new DS(s.height);return a.fromEquirectangularTexture(e,r),t.set(r,a),r.addEventListener("dispose",i),n(a.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}const US=[.125,.215,.35,.446,.526,.582],FS=new fy,BS=new po;let VS=null,jS=0,HS=0,GS=!1;const WS=(1+Math.sqrt(5))/2,XS=1/WS,qS=[new an(-WS,XS,0),new an(WS,XS,0),new an(-XS,0,WS),new an(XS,0,WS),new an(0,WS,-XS),new an(0,WS,XS),new an(-1,1,-1),new an(1,1,-1),new an(-1,1,1),new an(1,1,1)];class YS{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){VS=this._renderer.getRenderTarget(),jS=this._renderer.getActiveCubeFace(),HS=this._renderer.getActiveMipmapLevel(),GS=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=JS(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=KS(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(VS,jS,HS),this._renderer.xr.enabled=GS,e.scissorTest=!1,ZS(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Un||e.mapping===Fn?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),VS=this._renderer.getRenderTarget(),jS=this._renderer.getActiveCubeFace(),HS=this._renderer.getActiveMipmapLevel(),GS=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:qn,minFilter:qn,generateMipmaps:!1,type:ti,format:si,colorSpace:Wi,depthBuffer:!1},i=$S(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=$S(e,t,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],i=[];let r=e;const s=e-4+1+US.length;for(let a=0;a<s;a++){const s=Math.pow(2,r);n.push(s);let o=1/s;a>e-4?o=US[a-e+4-1]:0===a&&(o=0),i.push(o);const l=1/(s-2),c=-l,u=1+l,h=[c,c,u,c,u,u,c,c,u,u,c,u],d=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*d),y=new Float32Array(m*p*d),b=new Float32Array(g*p*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(i,f*p*e),y.set(h,m*p*e);const r=[e,e,e,e,e,e];b.set(r,g*p*e)}const x=new Do;x.setAttribute("position",new xo(v,f)),x.setAttribute("uv",new xo(y,m)),x.setAttribute("faceIndex",new xo(b,g)),t.push(x),r>4&&r--}return{lodPlanes:t,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(e,t,n){const i=new Float32Array(20),r=new an(0,1,0);return new Py({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(i,e,t)}return i}_compileMaterial(e){const t=new Yo(this._lodPlanes[0],e);this._renderer.compile(t,FS)}_sceneToCubeUV(e,t,n,i){const r=new ly(90,1,t,n),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(BS),o.toneMapping=0,o.autoClear=!1;const u=new vo({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),h=new Yo(new Ml,u);let d=!1;const p=e.background;p?p.isColor&&(u.color.copy(p),e.background=null,d=!0):(u.color.copy(BS),d=!0);for(let t=0;t<6;t++){const n=t%3;0===n?(r.up.set(0,s[t],0),r.lookAt(a[t],0,0)):1===n?(r.up.set(0,0,s[t]),r.lookAt(0,a[t],0)):(r.up.set(0,s[t],0),r.lookAt(0,0,a[t]));const l=this._cubeSize;ZS(i,n*l,t>2?l:0,l,l),o.setRenderTarget(i),d&&o.render(h,r),o.render(e,r)}h.geometry.dispose(),h.material.dispose(),o.toneMapping=c,o.autoClear=l,e.background=p}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===Un||e.mapping===Fn;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=JS()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=KS());const r=i?this._cubemapMaterial:this._equirectMaterial,s=new Yo(this._lodPlanes[0],r);r.uniforms.envMap.value=e;const a=this._cubeSize;ZS(t,0,0,3*a,2*a),n.setRenderTarget(t),n.render(s,FS)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let t=1;t<i;t++){const n=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),r=qS[(i-t-1)%qS.length];this._blur(e,t-1,t,n,r)}t.autoClear=n}_blur(e,t,n,i,r){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,n,i,"latitudinal",r),this._halfBlur(s,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,s,a){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Yo(this._lodPlanes[i],l),u=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let e=0;e<20;++e){const t=e/p,n=Math.exp(-t*t/2);m.push(n),0===e?g+=n:e<f&&(g+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===s,a&&(u.poleAxis.value=a);const{_lodMax:v}=this;u.dTheta.value=d,u.mipInt.value=v-n;const y=this._sizeLods[i];ZS(t,3*y*(i>v-4?i-v+4:0),4*(this._cubeSize-y),3*y,2*y),o.setRenderTarget(t),o.render(c,FS)}}function $S(e,t,n){const i=new IS(e,t,n);return i.texture.mapping=Bn,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function ZS(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function KS(){return new Py({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function JS(){return new Py({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function QS(e){let t=new WeakMap,n=null;function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping,a=303===s||304===s,o=s===Un||s===Fn;if(a||o){let s=t.get(r);const l=void 0!==s?s.texture.pmremVersion:0;if(r.isRenderTargetTexture&&r.pmremVersion!==l)return null===n&&(n=new YS(e)),s=a?n.fromEquirectangular(r,s):n.fromCubemap(r,s),s.texture.pmremVersion=r.pmremVersion,t.set(r,s),s.texture;if(void 0!==s)return s.texture;{const l=r.image;return a&&l&&l.height>0||o&&l&&function(e){let t=0;for(let n=0;n<6;n++)void 0!==e[n]&&t++;return 6===t}(l)?(null===n&&(n=new YS(e)),s=a?n.fromEquirectangular(r):n.fromCubemap(r),s.texture.pmremVersion=r.pmremVersion,t.set(r,s),r.addEventListener("dispose",i),s.texture):null}}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function eM(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(e){const t=n(e);return null===t&&Co("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function tM(e,t,n,i){const r={},s=new WeakMap;function a(e){const o=e.target;null!==o.index&&t.remove(o.index);for(const e in o.attributes)t.remove(o.attributes[e]);for(const e in o.morphAttributes){const n=o.morphAttributes[e];for(let e=0,i=n.length;e<i;e++)t.remove(n[e])}o.removeEventListener("dispose",a),delete r[o.id];const l=s.get(o);l&&(t.remove(l),s.delete(o)),i.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(e){const n=[],i=e.index,r=e.attributes.position;let a=0;if(null!==i){const e=i.array;a=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],r=e[t+1],s=e[t+2];n.push(i,r,r,s,s,i)}}else{if(void 0===r)return;{const e=r.array;a=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}}const o=new(Mo(n)?wo:_o)(n,1);o.version=a;const l=s.get(e);l&&t.remove(l),s.set(e,o)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",a),r[t.id]=!0,n.memory.geometries++),t},update:function(n){const i=n.attributes;for(const n in i)t.update(i[n],e.ARRAY_BUFFER);const r=n.morphAttributes;for(const n in r){const i=r[n];for(let n=0,r=i.length;n<r;n++)t.update(i[n],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=s.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&o(e)}else o(e);return s.get(e)}}}function nM(e,t,n){let i,r,s;function a(t,a,o){0!==o&&(e.drawElementsInstanced(i,a,r,t*s,o),n.update(a,i,o))}this.setMode=function(e){i=e},this.setIndex=function(e){r=e.type,s=e.bytesPerElement},this.render=function(t,a){e.drawElements(i,a,r,t*s),n.update(a,i,1)},this.renderInstances=a,this.renderMultiDraw=function(e,s,a){if(0===a)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,s,0,r,e,0,a);let o=0;for(let e=0;e<a;e++)o+=s[e];n.update(o,i,1)},this.renderMultiDrawInstances=function(e,o,l,c){if(0===l)return;const u=t.get("WEBGL_multi_draw");if(null===u)for(let t=0;t<e.length;t++)a(e[t]/s,o[t],c[t]);else{u.multiDrawElementsInstancedWEBGL(i,o,0,r,e,0,c,0,l);let t=0;for(let e=0;e<l;e++)t+=o[e];for(let e=0;e<c.length;e++)n.update(t,i,c[e])}}}function iM(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,i,r){switch(t.calls++,i){case e.TRIANGLES:t.triangles+=r*(n/3);break;case e.LINES:t.lines+=r*(n/2);break;case e.LINE_STRIP:t.lines+=r*(n-1);break;case e.LINE_LOOP:t.lines+=r*n;break;case e.POINTS:t.points+=r*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}class rM extends fl{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Gn,this.minFilter=Gn,this.wrapR=jn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}function sM(e,t,n){const i=new WeakMap,r=new Ba;return{update:function(s,a,o){const l=s.morphTargetInfluences,c=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,u=void 0!==c?c.length:0;let h=i.get(a);if(void 0===h||h.count!==u){void 0!==h&&h.texture.dispose();const d=void 0!==a.morphAttributes.position,p=void 0!==a.morphAttributes.normal,f=void 0!==a.morphAttributes.color,m=a.morphAttributes.position||[],g=a.morphAttributes.normal||[],v=a.morphAttributes.color||[];let y=0;!0===d&&(y=1),!0===p&&(y=2),!0===f&&(y=3);let b=a.attributes.position.count*y,x=1;b>t.maxTextureSize&&(x=Math.ceil(b/t.maxTextureSize),b=t.maxTextureSize);const _=new Float32Array(b*x*4*u),w=new rM(_,b,x,u);w.type=ei,w.needsUpdate=!0;const S=4*y;for(let E=0;E<u;E++){const T=m[E],A=g[E],C=v[E],R=b*x*4*E;for(let P=0;P<T.count;P++){const k=P*S;!0===d&&(r.fromBufferAttribute(T,P),_[R+k+0]=r.x,_[R+k+1]=r.y,_[R+k+2]=r.z,_[R+k+3]=0),!0===p&&(r.fromBufferAttribute(A,P),_[R+k+4]=r.x,_[R+k+5]=r.y,_[R+k+6]=r.z,_[R+k+7]=0),!0===f&&(r.fromBufferAttribute(C,P),_[R+k+8]=r.x,_[R+k+9]=r.y,_[R+k+10]=r.z,_[R+k+11]=4===C.itemSize?r.w:1)}}function M(){w.dispose(),i.delete(a),a.removeEventListener("dispose",M)}h={count:u,texture:w,size:new da(b,x)},i.set(a,h),a.addEventListener("dispose",M)}if(!0===s.isInstancedMesh&&null!==s.morphTexture)o.getUniforms().setValue(e,"morphTexture",s.morphTexture,n);else{let I=0;for(let L=0;L<l.length;L++)I+=l[L];const O=a.morphTargetsRelative?1:1-I;o.getUniforms().setValue(e,"morphTargetBaseInfluence",O),o.getUniforms().setValue(e,"morphTargetInfluences",l)}o.getUniforms().setValue(e,"morphTargetsTexture",h.texture,n),o.getUniforms().setValue(e,"morphTargetsTextureSize",h.size)}}}function aM(e,t,n,i){let r=new WeakMap;function s(e){const t=e.target;t.removeEventListener("dispose",s),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(a){const o=i.render.frame,l=a.geometry,c=t.get(a,l);if(r.get(c)!==o&&(t.update(c),r.set(c,o)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",s)&&a.addEventListener("dispose",s),r.get(a)!==o&&(n.update(a.instanceMatrix,e.ARRAY_BUFFER),null!==a.instanceColor&&n.update(a.instanceColor,e.ARRAY_BUFFER),r.set(a,o))),a.isSkinnedMesh){const e=a.skeleton;r.get(e)!==o&&(e.update(),r.set(e,o))}return c},dispose:function(){r=new WeakMap}}}class oM extends fl{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Gn,this.minFilter=Gn,this.wrapR=jn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class lM extends fl{constructor(e,t,n,i,r,s,a,o,l,c=1026){if(c!==ai&&c!==oi)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===ai&&(n=Qn),void 0===n&&c===oi&&(n=ri),super(null,i,r,s,a,o,c,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==a?a:Gn,this.minFilter=void 0!==o?o:Gn,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}const cM=new fl,uM=new lM(1,1),hM=new rM,dM=new oM,pM=new NS,fM=[],mM=[],gM=new Float32Array(16),vM=new Float32Array(9),yM=new Float32Array(4);function bM(e,t,n){const i=e[0];if(i<=0||i>0)return e;const r=t*n;let s=fM[r];if(void 0===s&&(s=new Float32Array(r),fM[r]=s),0!==t){i.toArray(s,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(s,r)}return s}function xM(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function _M(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function wM(e,t){let n=mM[t];void 0===n&&(n=new Int32Array(t),mM[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function SM(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function MM(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(xM(n,t))return;e.uniform2fv(this.addr,t),_M(n,t)}}function EM(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(xM(n,t))return;e.uniform3fv(this.addr,t),_M(n,t)}}function TM(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(xM(n,t))return;e.uniform4fv(this.addr,t),_M(n,t)}}function AM(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(xM(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),_M(n,t)}else{if(xM(n,i))return;yM.set(i),e.uniformMatrix2fv(this.addr,!1,yM),_M(n,i)}}function CM(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(xM(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),_M(n,t)}else{if(xM(n,i))return;vM.set(i),e.uniformMatrix3fv(this.addr,!1,vM),_M(n,i)}}function RM(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(xM(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),_M(n,t)}else{if(xM(n,i))return;gM.set(i),e.uniformMatrix4fv(this.addr,!1,gM),_M(n,i)}}function PM(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function kM(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(xM(n,t))return;e.uniform2iv(this.addr,t),_M(n,t)}}function IM(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(xM(n,t))return;e.uniform3iv(this.addr,t),_M(n,t)}}function OM(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(xM(n,t))return;e.uniform4iv(this.addr,t),_M(n,t)}}function LM(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function NM(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(xM(n,t))return;e.uniform2uiv(this.addr,t),_M(n,t)}}function DM(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(xM(n,t))return;e.uniform3uiv(this.addr,t),_M(n,t)}}function zM(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(xM(n,t))return;e.uniform4uiv(this.addr,t),_M(n,t)}}function UM(e,t,n){const i=this.cache,r=n.allocateTextureUnit();let s;i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),this.type===e.SAMPLER_2D_SHADOW?(uM.compareFunction=515,s=uM):s=cM,n.setTexture2D(t||s,r)}function FM(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||dM,r)}function BM(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||pM,r)}function VM(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||hM,r)}function jM(e,t){e.uniform1fv(this.addr,t)}function HM(e,t){const n=bM(t,this.size,2);e.uniform2fv(this.addr,n)}function GM(e,t){const n=bM(t,this.size,3);e.uniform3fv(this.addr,n)}function WM(e,t){const n=bM(t,this.size,4);e.uniform4fv(this.addr,n)}function XM(e,t){const n=bM(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function qM(e,t){const n=bM(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function YM(e,t){const n=bM(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function $M(e,t){e.uniform1iv(this.addr,t)}function ZM(e,t){e.uniform2iv(this.addr,t)}function KM(e,t){e.uniform3iv(this.addr,t)}function JM(e,t){e.uniform4iv(this.addr,t)}function QM(e,t){e.uniform1uiv(this.addr,t)}function eE(e,t){e.uniform2uiv(this.addr,t)}function tE(e,t){e.uniform3uiv(this.addr,t)}function nE(e,t){e.uniform4uiv(this.addr,t)}function iE(e,t,n){const i=this.cache,r=t.length,s=wM(n,r);xM(i,s)||(e.uniform1iv(this.addr,s),_M(i,s));for(let e=0;e!==r;++e)n.setTexture2D(t[e]||cM,s[e])}function rE(e,t,n){const i=this.cache,r=t.length,s=wM(n,r);xM(i,s)||(e.uniform1iv(this.addr,s),_M(i,s));for(let e=0;e!==r;++e)n.setTexture3D(t[e]||dM,s[e])}function sE(e,t,n){const i=this.cache,r=t.length,s=wM(n,r);xM(i,s)||(e.uniform1iv(this.addr,s),_M(i,s));for(let e=0;e!==r;++e)n.setTextureCube(t[e]||pM,s[e])}function aE(e,t,n){const i=this.cache,r=t.length,s=wM(n,r);xM(i,s)||(e.uniform1iv(this.addr,s),_M(i,s));for(let e=0;e!==r;++e)n.setTexture2DArray(t[e]||hM,s[e])}class oE{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return SM;case 35664:return MM;case 35665:return EM;case 35666:return TM;case 35674:return AM;case 35675:return CM;case 35676:return RM;case 5124:case 35670:return PM;case 35667:case 35671:return kM;case 35668:case 35672:return IM;case 35669:case 35673:return OM;case 5125:return LM;case 36294:return NM;case 36295:return DM;case 36296:return zM;case 35678:case 36198:case 36298:case 36306:case 35682:return UM;case 35679:case 36299:case 36307:return FM;case 35680:case 36300:case 36308:case 36293:return BM;case 36289:case 36303:case 36311:case 36292:return VM}}(t.type)}}class lE{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return jM;case 35664:return HM;case 35665:return GM;case 35666:return WM;case 35674:return XM;case 35675:return qM;case 35676:return YM;case 5124:case 35670:return $M;case 35667:case 35671:return ZM;case 35668:case 35672:return KM;case 35669:case 35673:return JM;case 5125:return QM;case 36294:return eE;case 36295:return tE;case 36296:return nE;case 35678:case 36198:case 36298:case 36306:case 35682:return iE;case 35679:case 36299:case 36307:return rE;case 35680:case 36300:case 36308:case 36293:return sE;case 36289:case 36303:case 36311:case 36292:return aE}}(t.type)}}class cE{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let r=0,s=i.length;r!==s;++r){const s=i[r];s.setValue(e,t[s.id],n)}}}const uE=/(\w+)(\])?(\[|\.)?/g;function hE(e,t){e.seq.push(t),e.map[t.id]=t}function dE(e,t,n){const i=e.name,r=i.length;for(uE.lastIndex=0;;){const s=uE.exec(i),a=uE.lastIndex;let o=s[1];const l="]"===s[2],c=s[3];if(l&&(o|=0),void 0===c||"["===c&&a+2===r){hE(n,void 0===c?new oE(o,e,t):new lE(o,e,t));break}{let e=n.map[o];void 0===e&&(e=new cE(o),hE(n,e)),n=e}}}class pE{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);dE(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,i){const r=this.map[t];void 0!==r&&r.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let r=0,s=t.length;r!==s;++r){const s=t[r],a=n[s.id];!1!==a.needsUpdate&&s.setValue(e,a.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const r=e[i];r.id in t&&n.push(r)}return n}}function fE(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}let mE=0;function gE(e,t,n){const i=e.getShaderParameter(t,e.COMPILE_STATUS),r=e.getShaderInfoLog(t).trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const i=parseInt(s[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){const n=e.split("\n"),i=[],r=Math.max(t-6,0),s=Math.min(t+6,n.length);for(let e=r;e<s;e++){const r=e+1;i.push(`${r===t?">":" "} ${r}: ${n[e]}`)}return i.join("\n")}(e.getShaderSource(t),i)}return r}function vE(e,t){const n=function(e){const t=so.getPrimaries(so.workingColorSpace),n=so.getPrimaries(e);let i;switch(t===n?i="":t===Ki&&n===Zi?i="LinearDisplayP3ToLinearSRGB":t===Zi&&n===Ki&&(i="LinearSRGBToLinearDisplayP3"),e){case Wi:case qi:return[i,"LinearTransferOETF"];case Gi:case Xi:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[i,"LinearTransferOETF"]}}(t);return`vec4 ${e}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function yE(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="Cineon";break;case 4:n="ACESFilmic";break;case 6:n="AgX";break;case 7:n="Neutral";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const bE=new an;function xE(e){return""!==e}function _E(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function wE(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const SE=/^[ \t]*#include +<([\w\d./]+)>/gm;function ME(e){return e.replace(SE,TE)}const EE=new Map;function TE(e,t){let n=xS[t];if(void 0===n){const e=EE.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=xS[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return ME(n)}const AE=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function CE(e){return e.replace(AE,RE)}function RE(e,t,n,i){let r="";for(let e=parseInt(t);e<parseInt(n);e++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return r}function PE(e){let t=`precision ${e.precision} float;\n\tprecision ${e.precision} int;\n\tprecision ${e.precision} sampler2D;\n\tprecision ${e.precision} samplerCube;\n\tprecision ${e.precision} sampler3D;\n\tprecision ${e.precision} sampler2DArray;\n\tprecision ${e.precision} sampler2DShadow;\n\tprecision ${e.precision} samplerCubeShadow;\n\tprecision ${e.precision} sampler2DArrayShadow;\n\tprecision ${e.precision} isampler2D;\n\tprecision ${e.precision} isampler3D;\n\tprecision ${e.precision} isamplerCube;\n\tprecision ${e.precision} isampler2DArray;\n\tprecision ${e.precision} usampler2D;\n\tprecision ${e.precision} usampler3D;\n\tprecision ${e.precision} usamplerCube;\n\tprecision ${e.precision} usampler2DArray;\n\t`;return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function kE(e,t,n,i){const r=e.getContext(),s=n.defines;let a=n.vertexShader,o=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Un:case Fn:t="ENVMAP_TYPE_CUBE";break;case Bn:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";return e.envMap&&e.envMapMode===Fn&&(t="ENVMAP_MODE_REFRACTION"),t}(n),h=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),d=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),p=function(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(xE).join("\n")}(n),f=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(s),m=r.createProgram();let g,v,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(xE).join("\n"),g.length>0&&(g+="\n"),v=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(xE).join("\n"),v.length>0&&(v+="\n")):(g=[PE(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(xE).join("\n"),v=[PE(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?xS.tonemapping_pars_fragment:"",0!==n.toneMapping?yE("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",xS.colorspace_pars_fragment,vE("linearToOutputTexel",n.outputColorSpace),(so.getLuminanceCoefficients(bE),["float luminance( const in vec3 rgb ) {",`\tconst vec3 weights = vec3( ${bE.x.toFixed(4)}, ${bE.y.toFixed(4)}, ${bE.z.toFixed(4)} );`,"\treturn dot( weights, rgb );","}"].join("\n")),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(xE).join("\n")),a=ME(a),a=_E(a,n),a=wE(a,n),o=ME(o),o=_E(o,n),o=wE(o,n),a=CE(a),o=CE(o),!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",n.glslVersion===or?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===or?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const b=y+g+a,x=y+v+o,_=fE(r,r.VERTEX_SHADER,b),w=fE(r,r.FRAGMENT_SHADER,x);function S(t){if(e.debug.checkShaderErrors){const n=r.getProgramInfoLog(m).trim(),i=r.getShaderInfoLog(_).trim(),s=r.getShaderInfoLog(w).trim();let a=!0,o=!0;if(!1===r.getProgramParameter(m,r.LINK_STATUS))if(a=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(r,m,_,w);else{const e=gE(r,_,"vertex"),i=gE(r,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(m,r.VALIDATE_STATUS)+"\n\nMaterial Name: "+t.name+"\nMaterial Type: "+t.type+"\n\nProgram Info Log: "+n+"\n"+e+"\n"+i)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==i&&""!==s||(o=!1);o&&(t.diagnostics={runnable:a,programLog:n,vertexShader:{log:i,prefix:g},fragmentShader:{log:s,prefix:v}})}r.deleteShader(_),r.deleteShader(w),M=new pE(r,m),E=function(e,t){const n={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r),s=i.name;let a=1;i.type===e.FLOAT_MAT2&&(a=2),i.type===e.FLOAT_MAT3&&(a=3),i.type===e.FLOAT_MAT4&&(a=4),n[s]={type:i.type,location:e.getAttribLocation(t,s),locationSize:a}}return n}(r,m)}let M,E;r.attachShader(m,_),r.attachShader(m,w),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),this.getUniforms=function(){return void 0===M&&S(this),M},this.getAttributes=function(){return void 0===E&&S(this),E};let T=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===T&&(T=r.getProgramParameter(m,37297)),T},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=mE++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=_,this.fragmentShader=w,this}let IE=0;class OE{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),s=this._getShaderCacheForMaterial(e);return!1===s.has(i)&&(s.add(i),i.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new LE(e),t.set(e,n)),n}}class LE{constructor(e){this.id=IE++,this.code=e,this.usedTimes=0}}function NE(e,t,n,i,r,s,a){const o=new wr,l=new OE,c=new Set,u=[],h=r.logarithmicDepthBuffer,d=r.reverseDepthBuffer,p=r.vertexTextures;let f=r.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(e){return c.add(e),0===e?"uv":`uv${e}`}return{getParameters:function(s,o,u,v,y){const b=v.fog,x=y.geometry,_=s.isMeshStandardMaterial?v.environment:null,w=(s.isMeshStandardMaterial?n:t).get(s.envMap||_),S=w&&w.mapping===Bn?w.image.height:null,M=m[s.type];null!==s.precision&&(f=r.getMaxPrecision(s.precision),f!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",f,"instead."));const E=x.morphAttributes.position||x.morphAttributes.normal||x.morphAttributes.color,T=void 0!==E?E.length:0;let A,C,R,P,k=0;if(void 0!==x.morphAttributes.position&&(k=1),void 0!==x.morphAttributes.normal&&(k=2),void 0!==x.morphAttributes.color&&(k=3),M){const e=wS[M];A=e.vertexShader,C=e.fragmentShader}else A=s.vertexShader,C=s.fragmentShader,l.update(s),R=l.getVertexShaderID(s),P=l.getFragmentShaderID(s);const I=e.getRenderTarget(),O=!0===y.isInstancedMesh,L=!0===y.isBatchedMesh,N=!!s.map,D=!!s.matcap,z=!!w,U=!!s.aoMap,F=!!s.lightMap,B=!!s.bumpMap,V=!!s.normalMap,j=!!s.displacementMap,H=!!s.emissiveMap,G=!!s.metalnessMap,W=!!s.roughnessMap,X=s.anisotropy>0,q=s.clearcoat>0,Y=s.dispersion>0,$=s.iridescence>0,Z=s.sheen>0,K=s.transmission>0,J=X&&!!s.anisotropyMap,Q=q&&!!s.clearcoatMap,ee=q&&!!s.clearcoatNormalMap,te=q&&!!s.clearcoatRoughnessMap,ne=$&&!!s.iridescenceMap,ie=$&&!!s.iridescenceThicknessMap,re=Z&&!!s.sheenColorMap,se=Z&&!!s.sheenRoughnessMap,ae=!!s.specularMap,oe=!!s.specularColorMap,le=!!s.specularIntensityMap,ce=K&&!!s.transmissionMap,ue=K&&!!s.thicknessMap,he=!!s.gradientMap,de=!!s.alphaMap,pe=s.alphaTest>0,fe=!!s.alphaHash,me=!!s.extensions;let ge=0;s.toneMapped&&(null!==I&&!0!==I.isXRRenderTarget||(ge=e.toneMapping));const ve={shaderID:M,shaderType:s.type,shaderName:s.name,vertexShader:A,fragmentShader:C,defines:s.defines,customVertexShaderID:R,customFragmentShaderID:P,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:f,batching:L,batchingColor:L&&null!==y._colorsTexture,instancing:O,instancingColor:O&&null!==y.instanceColor,instancingMorph:O&&null!==y.morphTexture,supportsVertexTextures:p,outputColorSpace:null===I?e.outputColorSpace:!0===I.isXRRenderTarget?I.texture.colorSpace:Wi,alphaToCoverage:!!s.alphaToCoverage,map:N,matcap:D,envMap:z,envMapMode:z&&w.mapping,envMapCubeUVHeight:S,aoMap:U,lightMap:F,bumpMap:B,normalMap:V,displacementMap:p&&j,emissiveMap:H,normalMapObjectSpace:V&&1===s.normalMapType,normalMapTangentSpace:V&&0===s.normalMapType,metalnessMap:G,roughnessMap:W,anisotropy:X,anisotropyMap:J,clearcoat:q,clearcoatMap:Q,clearcoatNormalMap:ee,clearcoatRoughnessMap:te,dispersion:Y,iridescence:$,iridescenceMap:ne,iridescenceThicknessMap:ie,sheen:Z,sheenColorMap:re,sheenRoughnessMap:se,specularMap:ae,specularColorMap:oe,specularIntensityMap:le,transmission:K,transmissionMap:ce,thicknessMap:ue,gradientMap:he,opaque:!1===s.transparent&&1===s.blending&&!1===s.alphaToCoverage,alphaMap:de,alphaTest:pe,alphaHash:fe,combine:s.combine,mapUv:N&&g(s.map.channel),aoMapUv:U&&g(s.aoMap.channel),lightMapUv:F&&g(s.lightMap.channel),bumpMapUv:B&&g(s.bumpMap.channel),normalMapUv:V&&g(s.normalMap.channel),displacementMapUv:j&&g(s.displacementMap.channel),emissiveMapUv:H&&g(s.emissiveMap.channel),metalnessMapUv:G&&g(s.metalnessMap.channel),roughnessMapUv:W&&g(s.roughnessMap.channel),anisotropyMapUv:J&&g(s.anisotropyMap.channel),clearcoatMapUv:Q&&g(s.clearcoatMap.channel),clearcoatNormalMapUv:ee&&g(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:te&&g(s.clearcoatRoughnessMap.channel),iridescenceMapUv:ne&&g(s.iridescenceMap.channel),iridescenceThicknessMapUv:ie&&g(s.iridescenceThicknessMap.channel),sheenColorMapUv:re&&g(s.sheenColorMap.channel),sheenRoughnessMapUv:se&&g(s.sheenRoughnessMap.channel),specularMapUv:ae&&g(s.specularMap.channel),specularColorMapUv:oe&&g(s.specularColorMap.channel),specularIntensityMapUv:le&&g(s.specularIntensityMap.channel),transmissionMapUv:ce&&g(s.transmissionMap.channel),thicknessMapUv:ue&&g(s.thicknessMap.channel),alphaMapUv:de&&g(s.alphaMap.channel),vertexTangents:!!x.attributes.tangent&&(V||X),vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!x.attributes.color&&4===x.attributes.color.itemSize,pointsUvs:!0===y.isPoints&&!!x.attributes.uv&&(N||de),fog:!!b,useFog:!0===s.fog,fogExp2:!!b&&b.isFogExp2,flatShading:!0===s.flatShading,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:h,reverseDepthBuffer:d,skinning:!0===y.isSkinnedMesh,morphTargets:void 0!==x.morphAttributes.position,morphNormals:void 0!==x.morphAttributes.normal,morphColors:void 0!==x.morphAttributes.color,morphTargetsCount:T,morphTextureStride:k,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numLightProbes:o.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:s.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:ge,decodeVideoTexture:N&&!0===s.map.isVideoTexture&&so.getTransfer(s.map.colorSpace)===$i,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionClipCullDistance:me&&!0===s.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(me&&!0===s.extensions.multiDraw||L)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:s.customProgramCacheKey()};return ve.vertexUv1s=c.has(1),ve.vertexUv2s=c.has(2),ve.vertexUv3s=c.has(3),c.clear(),ve},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){o.disableAll(),t.supportsVertexTextures&&o.enable(0),t.instancing&&o.enable(1),t.instancingColor&&o.enable(2),t.instancingMorph&&o.enable(3),t.matcap&&o.enable(4),t.envMap&&o.enable(5),t.normalMapObjectSpace&&o.enable(6),t.normalMapTangentSpace&&o.enable(7),t.clearcoat&&o.enable(8),t.iridescence&&o.enable(9),t.alphaTest&&o.enable(10),t.vertexColors&&o.enable(11),t.vertexAlphas&&o.enable(12),t.vertexUv1s&&o.enable(13),t.vertexUv2s&&o.enable(14),t.vertexUv3s&&o.enable(15),t.vertexTangents&&o.enable(16),t.anisotropy&&o.enable(17),t.alphaHash&&o.enable(18),t.batching&&o.enable(19),t.dispersion&&o.enable(20),t.batchingColor&&o.enable(21),e.push(o.mask),o.disableAll(),t.fog&&o.enable(0),t.useFog&&o.enable(1),t.flatShading&&o.enable(2),t.logarithmicDepthBuffer&&o.enable(3),t.reverseDepthBuffer&&o.enable(4),t.skinning&&o.enable(5),t.morphTargets&&o.enable(6),t.morphNormals&&o.enable(7),t.morphColors&&o.enable(8),t.premultipliedAlpha&&o.enable(9),t.shadowMapEnabled&&o.enable(10),t.doubleSided&&o.enable(11),t.flipSided&&o.enable(12),t.useDepthPacking&&o.enable(13),t.dithering&&o.enable(14),t.transmission&&o.enable(15),t.sheen&&o.enable(16),t.opaque&&o.enable(17),t.pointsUvs&&o.enable(18),t.decodeVideoTexture&&o.enable(19),t.alphaToCoverage&&o.enable(20),e.push(o.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=m[e.type];let n;if(t){const e=wS[t];n=Ay.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,t=u.length;e<t;e++){const t=u[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new kE(e,n,t,s),u.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){const t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:u,dispose:function(){l.dispose()}}}function DE(){let e=new WeakMap;return{has:function(t){return e.has(t)},get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function zE(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function UE(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function FE(){const e=[];let t=0;const n=[],i=[],r=[];function s(n,i,r,s,a,o){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:s,renderOrder:n.renderOrder,z:a,group:o},e[t]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=a,l.group=o),t++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){t=0,n.length=0,i.length=0,r.length=0},push:function(e,t,a,o,l,c){const u=s(e,t,a,o,l,c);a.transmission>0?i.push(u):!0===a.transparent?r.push(u):n.push(u)},unshift:function(e,t,a,o,l,c){const u=s(e,t,a,o,l,c);a.transmission>0?i.unshift(u):!0===a.transparent?r.unshift(u):n.unshift(u)},finish:function(){for(let n=t,i=e.length;n<i;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||zE),i.length>1&&i.sort(t||UE),r.length>1&&r.sort(t||UE)}}}function BE(){let e=new WeakMap;return{get:function(t,n){const i=e.get(t);let r;return void 0===i?(r=new FE,e.set(t,[r])):n>=i.length?(r=new FE,i.push(r)):r=i[n],r},dispose:function(){e=new WeakMap}}}function VE(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new an,color:new po};break;case"SpotLight":n={position:new an,direction:new an,color:new po,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new an,color:new po,distance:0,decay:0};break;case"HemisphereLight":n={direction:new an,skyColor:new po,groundColor:new po};break;case"RectAreaLight":n={color:new po,position:new an,halfWidth:new an,halfHeight:new an}}return e[t.id]=n,n}}}let jE=0;function HE(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function GE(e){const t=new VE,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new da};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new da,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let e=0;e<9;e++)i.probe.push(new an);const r=new an,s=new ur,a=new ur;return{setup:function(r){let s=0,a=0,o=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let l=0,c=0,u=0,h=0,d=0,p=0,f=0,m=0,g=0,v=0,y=0;r.sort(HE);for(let e=0,b=r.length;e<b;e++){const b=r[e],x=b.color,_=b.intensity,w=b.distance,S=b.shadow&&b.shadow.map?b.shadow.map.texture:null;if(b.isAmbientLight)s+=x.r*_,a+=x.g*_,o+=x.b*_;else if(b.isLightProbe){for(let e=0;e<9;e++)i.probe[e].addScaledVector(b.sh.coefficients[e],_);y++}else if(b.isDirectionalLight){const e=t.get(b);if(e.color.copy(b.color).multiplyScalar(b.intensity),b.castShadow){const e=b.shadow,t=n.get(b);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,i.directionalShadow[l]=t,i.directionalShadowMap[l]=S,i.directionalShadowMatrix[l]=b.shadow.matrix,p++}i.directional[l]=e,l++}else if(b.isSpotLight){const e=t.get(b);e.position.setFromMatrixPosition(b.matrixWorld),e.color.copy(x).multiplyScalar(_),e.distance=w,e.coneCos=Math.cos(b.angle),e.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),e.decay=b.decay,i.spot[u]=e;const r=b.shadow;if(b.map&&(i.spotLightMap[g]=b.map,g++,r.updateMatrices(b),b.castShadow&&v++),i.spotLightMatrix[u]=r.matrix,b.castShadow){const e=n.get(b);e.shadowIntensity=r.intensity,e.shadowBias=r.bias,e.shadowNormalBias=r.normalBias,e.shadowRadius=r.radius,e.shadowMapSize=r.mapSize,i.spotShadow[u]=e,i.spotShadowMap[u]=S,m++}u++}else if(b.isRectAreaLight){const e=t.get(b);e.color.copy(x).multiplyScalar(_),e.halfWidth.set(.5*b.width,0,0),e.halfHeight.set(0,.5*b.height,0),i.rectArea[h]=e,h++}else if(b.isPointLight){const e=t.get(b);if(e.color.copy(b.color).multiplyScalar(b.intensity),e.distance=b.distance,e.decay=b.decay,b.castShadow){const e=b.shadow,t=n.get(b);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,t.shadowCameraNear=e.camera.near,t.shadowCameraFar=e.camera.far,i.pointShadow[c]=t,i.pointShadowMap[c]=S,i.pointShadowMatrix[c]=b.shadow.matrix,f++}i.point[c]=e,c++}else if(b.isHemisphereLight){const e=t.get(b);e.skyColor.copy(b.color).multiplyScalar(_),e.groundColor.copy(b.groundColor).multiplyScalar(_),i.hemi[d]=e,d++}}h>0&&(!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=_S.LTC_FLOAT_1,i.rectAreaLTC2=_S.LTC_FLOAT_2):(i.rectAreaLTC1=_S.LTC_HALF_1,i.rectAreaLTC2=_S.LTC_HALF_2)),i.ambient[0]=s,i.ambient[1]=a,i.ambient[2]=o;const b=i.hash;b.directionalLength===l&&b.pointLength===c&&b.spotLength===u&&b.rectAreaLength===h&&b.hemiLength===d&&b.numDirectionalShadows===p&&b.numPointShadows===f&&b.numSpotShadows===m&&b.numSpotMaps===g&&b.numLightProbes===y||(i.directional.length=l,i.spot.length=u,i.rectArea.length=h,i.point.length=c,i.hemi.length=d,i.directionalShadow.length=p,i.directionalShadowMap.length=p,i.pointShadow.length=f,i.pointShadowMap.length=f,i.spotShadow.length=m,i.spotShadowMap.length=m,i.directionalShadowMatrix.length=p,i.pointShadowMatrix.length=f,i.spotLightMatrix.length=m+g-v,i.spotLightMap.length=g,i.numSpotLightShadowsWithMaps=v,i.numLightProbes=y,b.directionalLength=l,b.pointLength=c,b.spotLength=u,b.rectAreaLength=h,b.hemiLength=d,b.numDirectionalShadows=p,b.numPointShadows=f,b.numSpotShadows=m,b.numSpotMaps=g,b.numLightProbes=y,i.version=jE++)},setupView:function(e,t){let n=0,o=0,l=0,c=0,u=0;const h=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(d.matrixWorld),r.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(h),n++}else if(d.isSpotLight){const e=i.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(d.matrixWorld),r.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(h),l++}else if(d.isRectAreaLight){const e=i.rectArea[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),a.identity(),s.copy(d.matrixWorld),s.premultiply(h),a.extractRotation(s),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(d.isPointLight){const e=i.point[o];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),o++}else if(d.isHemisphereLight){const e=i.hemi[u];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(h),u++}}},state:i}}function WE(e){const t=new GE(e),n=[],i=[],r={lightsArray:n,shadowsArray:i,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(e){r.camera=e,n.length=0,i.length=0},state:r,setupLights:function(){t.setup(n)},setupLightsView:function(e){t.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){i.push(e)}}}function XE(e){let t=new WeakMap;return{get:function(n,i=0){const r=t.get(n);let s;return void 0===r?(s=new WE(e),t.set(n,[s])):i>=r.length?(s=new WE(e),r.push(s)):s=r[i],s},dispose:function(){t=new WeakMap}}}class qE extends go{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class YE extends go{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function $E(e,t,n){let i=new vS;const r=new da,s=new da,a=new Ba,o=new qE({depthPacking:3201}),l=new YE,c={},u=n.maxTextureSize,h={[cn]:1,[un]:0,[hn]:2},d=new Py({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new da},radius:{value:4}},vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:"\nuniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n\n#include <packing>\n\nvoid main() {\n\n\tconst float samples = float( VSM_SAMPLES );\n\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\n\t\t#ifdef HORIZONTAL_PASS\n\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\n\t\t#else\n\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\n\t\t#endif\n\n\t}\n\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n\n}\n"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new Do;f.setAttribute("position",new xo(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Yo(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let v=this.type;function y(n,i){const s=t.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new IS(r.x,r.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,s,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,s,p,m,null)}function b(t,n,i,r){let s=null;const a=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==a)s=a;else if(s=!0===i.isPointLight?l:o,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=s.uuid,t=n.uuid;let i=c[e];void 0===i&&(i={},c[e]=i);let r=i[t];void 0===r&&(r=s.clone(),i[t]=r,n.addEventListener("dispose",_)),s=r}return s.visible=n.visible,s.wireframe=n.wireframe,s.side=3===r?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],s.alphaMap=n.alphaMap,s.alphaTest=n.alphaTest,s.map=n.map,s.clipShadows=n.clipShadows,s.clippingPlanes=n.clippingPlanes,s.clipIntersection=n.clipIntersection,s.displacementMap=n.displacementMap,s.displacementScale=n.displacementScale,s.displacementBias=n.displacementBias,s.wireframeLinewidth=n.wireframeLinewidth,s.linewidth=n.linewidth,!0===i.isPointLight&&!0===s.isMeshDistanceMaterial&&(e.properties.get(s).light=i),s}function x(n,r,s,a,o){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===o)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const i=t.update(n),l=n.material;if(Array.isArray(l)){const t=i.groups;for(let c=0,u=t.length;c<u;c++){const u=t[c],h=l[u.materialIndex];if(h&&h.visible){const t=b(n,h,a,o);n.onBeforeShadow(e,n,r,s,i,t,u),e.renderBufferDirect(s,null,i,t,n,u),n.onAfterShadow(e,n,r,s,i,t,u)}}}else if(l.visible){const t=b(n,l,a,o);n.onBeforeShadow(e,n,r,s,i,t,null),e.renderBufferDirect(s,null,i,t,n,null),n.onAfterShadow(e,n,r,s,i,t,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)x(l[e],r,s,a,o)}function _(e){e.target.removeEventListener("dispose",_);for(const t in c){const n=c[t],i=e.target.uuid;i in n&&(n[i].dispose(),delete n[i])}}this.render=function(t,n,o){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const p=3!==v&&3===this.type,f=3===v&&3!==this.type;for(let l=0,c=t.length;l<c;l++){const c=t[l],h=c.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;r.copy(h.mapSize);const m=h.getFrameExtents();if(r.multiply(m),s.copy(h.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/m.x),r.x=s.x*m.x,h.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/m.y),r.y=s.y*m.y,h.mapSize.y=s.y)),null===h.map||!0===p||!0===f){const e=3!==this.type?{minFilter:Gn,magFilter:Gn}:{};null!==h.map&&h.map.dispose(),h.map=new IS(r.x,r.y,e),h.map.texture.name=c.name+".shadowMap",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const g=h.getViewportCount();for(let e=0;e<g;e++){const t=h.getViewport(e);a.set(s.x*t.x,s.y*t.y,s.x*t.z,s.y*t.w),d.viewport(a),h.updateMatrices(c,e),i=h.getFrustum(),x(n,o,h.camera,c,this.type)}!0!==h.isPointLightShadow&&3===this.type&&y(h,o),h.needsUpdate=!1}v=this.type,g.needsUpdate=!1,e.setRenderTarget(l,c,h)}}const ZE={[Pn]:1,[In]:6,[Ln]:7,[On]:5,[kn]:0,[Dn]:2,[zn]:4,[Nn]:3};function KE(e){const t=new function(){let t=!1;const n=new Ba;let i=null;const r=new Ba(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,s,a,o){!0===o&&(t*=a,i*=a,s*=a),n.set(t,i,s,a),!1===r.equals(n)&&(e.clearColor(t,i,s,a),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},n=new function(){let t=!1,n=!1,i=null,r=null,s=null;return{setReversed:function(e){n=e},setTest:function(t){t?F(e.DEPTH_TEST):B(e.DEPTH_TEST)},setMask:function(n){i===n||t||(e.depthMask(n),i=n)},setFunc:function(t){if(n&&(t=ZE[t]),r!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}r=t}},setLocked:function(e){t=e},setClear:function(t){s!==t&&(e.clearDepth(t),s=t)},reset:function(){t=!1,i=null,r=null,s=null}}},i=new function(){let t=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,c=null;return{setTest:function(n){t||(n?F(e.STENCIL_TEST):B(e.STENCIL_TEST))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,a){i===t&&r===n&&s===a||(e.stencilFunc(t,n,a),i=t,r=n,s=a)},setOp:function(t,n,i){a===t&&o===n&&l===i||(e.stencilOp(t,n,i),a=t,o=n,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,c=null}}},r=new WeakMap,s=new WeakMap;let a={},o={},l=new WeakMap,c=[],u=null,h=!1,d=null,p=null,f=null,m=null,g=null,v=null,y=null,b=new po(0,0,0),x=0,_=!1,w=null,S=null,M=null,E=null,T=null;const A=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let C=!1,R=0;const P=e.getParameter(e.VERSION);-1!==P.indexOf("WebGL")?(R=parseFloat(/^WebGL (\d)/.exec(P)[1]),C=R>=1):-1!==P.indexOf("OpenGL ES")&&(R=parseFloat(/^OpenGL ES (\d)/.exec(P)[1]),C=R>=2);let k=null,I={};const O=e.getParameter(e.SCISSOR_BOX),L=e.getParameter(e.VIEWPORT),N=(new Ba).fromArray(O),D=(new Ba).fromArray(L);function z(t,n,i,r){const s=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let a=0;a<i;a++)t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,r,0,e.RGBA,e.UNSIGNED_BYTE,s):e.texImage2D(n+a,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,s);return a}const U={};function F(t){!0!==a[t]&&(e.enable(t),a[t]=!0)}function B(t){!1!==a[t]&&(e.disable(t),a[t]=!1)}U[e.TEXTURE_2D]=z(e.TEXTURE_2D,e.TEXTURE_2D,1),U[e.TEXTURE_CUBE_MAP]=z(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),U[e.TEXTURE_2D_ARRAY]=z(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),U[e.TEXTURE_3D]=z(e.TEXTURE_3D,e.TEXTURE_3D,1,1),t.setClear(0,0,0,1),n.setClear(1),i.setClear(0),F(e.DEPTH_TEST),n.setFunc(3),G(!1),W(1),F(e.CULL_FACE),H(0);const V={[dn]:e.FUNC_ADD,[pn]:e.FUNC_SUBTRACT,[fn]:e.FUNC_REVERSE_SUBTRACT};V[103]=e.MIN,V[104]=e.MAX;const j={[mn]:e.ZERO,[gn]:e.ONE,[vn]:e.SRC_COLOR,[bn]:e.SRC_ALPHA,[En]:e.SRC_ALPHA_SATURATE,[Sn]:e.DST_COLOR,[_n]:e.DST_ALPHA,[yn]:e.ONE_MINUS_SRC_COLOR,[xn]:e.ONE_MINUS_SRC_ALPHA,[Mn]:e.ONE_MINUS_DST_COLOR,[wn]:e.ONE_MINUS_DST_ALPHA,[Tn]:e.CONSTANT_COLOR,[An]:e.ONE_MINUS_CONSTANT_COLOR,[Cn]:e.CONSTANT_ALPHA,[Rn]:e.ONE_MINUS_CONSTANT_ALPHA};function H(t,n,i,r,s,a,o,l,c,u){if(0!==t){if(!1===h&&(F(e.BLEND),h=!0),5===t)s=s||n,a=a||i,o=o||r,n===p&&s===g||(e.blendEquationSeparate(V[n],V[s]),p=n,g=s),i===f&&r===m&&a===v&&o===y||(e.blendFuncSeparate(j[i],j[r],j[a],j[o]),f=i,m=r,v=a,y=o),!1!==l.equals(b)&&c===x||(e.blendColor(l.r,l.g,l.b,c),b.copy(l),x=c),d=t,_=!1;else if(t!==d||u!==_){if(p===dn&&g===dn||(e.blendEquation(e.FUNC_ADD),p=dn,g=dn),u)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}f=null,m=null,v=null,y=null,b.set(0,0,0),x=0,d=t,_=u}}else!0===h&&(B(e.BLEND),h=!1)}function G(t){w!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),w=t)}function W(t){0!==t?(F(e.CULL_FACE),t!==S&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):B(e.CULL_FACE),S=t}function X(t,n,i){t?(F(e.POLYGON_OFFSET_FILL),E===n&&T===i||(e.polygonOffset(n,i),E=n,T=i)):B(e.POLYGON_OFFSET_FILL)}return{buffers:{color:t,depth:n,stencil:i},enable:F,disable:B,bindFramebuffer:function(t,n){return o[t]!==n&&(e.bindFramebuffer(t,n),o[t]=n,t===e.DRAW_FRAMEBUFFER&&(o[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(o[e.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(t,n){let i=c,r=!1;if(t){i=l.get(n),void 0===i&&(i=[],l.set(n,i));const s=t.textures;if(i.length!==s.length||i[0]!==e.COLOR_ATTACHMENT0){for(let t=0,n=s.length;t<n;t++)i[t]=e.COLOR_ATTACHMENT0+t;i.length=s.length,r=!0}}else i[0]!==e.BACK&&(i[0]=e.BACK,r=!0);r&&e.drawBuffers(i)},useProgram:function(t){return u!==t&&(e.useProgram(t),u=t,!0)},setBlending:H,setMaterial:function(r,s){2===r.side?B(e.CULL_FACE):F(e.CULL_FACE);let a=1===r.side;s&&(a=!a),G(a),1===r.blending&&!1===r.transparent?H(0):H(r.blending,r.blendEquation,r.blendSrc,r.blendDst,r.blendEquationAlpha,r.blendSrcAlpha,r.blendDstAlpha,r.blendColor,r.blendAlpha,r.premultipliedAlpha),n.setFunc(r.depthFunc),n.setTest(r.depthTest),n.setMask(r.depthWrite),t.setMask(r.colorWrite);const o=r.stencilWrite;i.setTest(o),o&&(i.setMask(r.stencilWriteMask),i.setFunc(r.stencilFunc,r.stencilRef,r.stencilFuncMask),i.setOp(r.stencilFail,r.stencilZFail,r.stencilZPass)),X(r.polygonOffset,r.polygonOffsetFactor,r.polygonOffsetUnits),!0===r.alphaToCoverage?F(e.SAMPLE_ALPHA_TO_COVERAGE):B(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:G,setCullFace:W,setLineWidth:function(t){t!==M&&(C&&e.lineWidth(t),M=t)},setPolygonOffset:X,setScissorTest:function(t){t?F(e.SCISSOR_TEST):B(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+A-1),k!==t&&(e.activeTexture(t),k=t)},bindTexture:function(t,n,i){void 0===i&&(i=null===k?e.TEXTURE0+A-1:k);let r=I[i];void 0===r&&(r={type:void 0,texture:void 0},I[i]=r),r.type===t&&r.texture===n||(k!==i&&(e.activeTexture(i),k=i),e.bindTexture(t,n||U[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=I[k];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,n){let i=s.get(n);void 0===i&&(i=new WeakMap,s.set(n,i));let r=i.get(t);void 0===r&&(r=e.getUniformBlockIndex(n,t.name),i.set(t,r))},uniformBlockBinding:function(t,n){const i=s.get(n).get(t);r.get(n)!==i&&(e.uniformBlockBinding(n,i,t.__bindingPointIndex),r.set(n,i))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===N.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),N.copy(t))},viewport:function(t){!1===D.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),D.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),a={},k=null,I={},o={},l=new WeakMap,c=[],u=null,h=!1,d=null,p=null,f=null,m=null,g=null,v=null,y=null,b=new po(0,0,0),x=0,_=!1,w=null,S=null,M=null,E=null,T=null,N.set(0,0,e.canvas.width,e.canvas.height),D.set(0,0,e.canvas.width,e.canvas.height),t.reset(),n.reset(),i.reset()}}}function JE(e,t,n,i){const r=function(e){switch(e){case Zn:case 1010:return{byteLength:1,components:1};case Kn:case 1011:case ti:return{byteLength:2,components:1};case ni:case ii:return{byteLength:2,components:4};case Qn:case Jn:case ei:return{byteLength:4,components:1};case 35902:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${e}.`)}(i);switch(n){case 1021:case 1024:return e*t;case 1025:return e*t*2;case li:case ci:return e*t/r.components*r.byteLength;case 1030:case ui:return e*t*2/r.components*r.byteLength;case 1022:return e*t*3/r.components*r.byteLength;case si:case hi:return e*t*4/r.components*r.byteLength;case di:case pi:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case fi:case mi:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case vi:case bi:return Math.max(e,16)*Math.max(t,8)/4;case gi:case yi:return Math.max(e,8)*Math.max(t,8)/2;case xi:case _i:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case wi:case Si:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case Mi:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case Ei:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case Ti:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case Ai:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case Ci:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case Ri:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case Pi:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case ki:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case Ii:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case Oi:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case Li:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case Ni:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case Di:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case zi:case Ui:case Fi:return Math.ceil(e/4)*Math.ceil(t/4)*16;case 36283:case Bi:return Math.ceil(e/4)*Math.ceil(t/4)*8;case Vi:case ji:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function QE(e,t,n,i,r,s,a){const o=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,l="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),c=new da,u=new WeakMap;let h;const d=new WeakMap;let p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function f(e,t){return p?new OffscreenCanvas(e,t):Eo("canvas")}function m(e,t,n){let i=1;const r=B(e);if((r.width>n||r.height>n)&&(i=n/Math.max(r.width,r.height)),i<1){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame){const n=Math.floor(i*r.width),s=Math.floor(i*r.height);void 0===h&&(h=f(n,s));const a=t?f(n,s):h;return a.width=n,a.height=s,a.getContext("2d").drawImage(e,0,0,n,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+r.width+"x"+r.height+") to ("+n+"x"+s+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+r.width+"x"+r.height+")."),e}return e}function g(e){return e.generateMipmaps&&e.minFilter!==Gn&&e.minFilter!==qn}function v(t){e.generateMipmap(t)}function y(n,i,r,s,a=!1){if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=i;if(i===e.RED&&(r===e.FLOAT&&(o=e.R32F),r===e.HALF_FLOAT&&(o=e.R16F),r===e.UNSIGNED_BYTE&&(o=e.R8)),i===e.RED_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.R8UI),r===e.UNSIGNED_SHORT&&(o=e.R16UI),r===e.UNSIGNED_INT&&(o=e.R32UI),r===e.BYTE&&(o=e.R8I),r===e.SHORT&&(o=e.R16I),r===e.INT&&(o=e.R32I)),i===e.RG&&(r===e.FLOAT&&(o=e.RG32F),r===e.HALF_FLOAT&&(o=e.RG16F),r===e.UNSIGNED_BYTE&&(o=e.RG8)),i===e.RG_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.RG8UI),r===e.UNSIGNED_SHORT&&(o=e.RG16UI),r===e.UNSIGNED_INT&&(o=e.RG32UI),r===e.BYTE&&(o=e.RG8I),r===e.SHORT&&(o=e.RG16I),r===e.INT&&(o=e.RG32I)),i===e.RGB_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.RGB8UI),r===e.UNSIGNED_SHORT&&(o=e.RGB16UI),r===e.UNSIGNED_INT&&(o=e.RGB32UI),r===e.BYTE&&(o=e.RGB8I),r===e.SHORT&&(o=e.RGB16I),r===e.INT&&(o=e.RGB32I)),i===e.RGBA_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.RGBA8UI),r===e.UNSIGNED_SHORT&&(o=e.RGBA16UI),r===e.UNSIGNED_INT&&(o=e.RGBA32UI),r===e.BYTE&&(o=e.RGBA8I),r===e.SHORT&&(o=e.RGBA16I),r===e.INT&&(o=e.RGBA32I)),i===e.RGB&&r===e.UNSIGNED_INT_5_9_9_9_REV&&(o=e.RGB9_E5),i===e.RGBA){const t=a?Yi:so.getTransfer(s);r===e.FLOAT&&(o=e.RGBA32F),r===e.HALF_FLOAT&&(o=e.RGBA16F),r===e.UNSIGNED_BYTE&&(o=t===$i?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(o=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(o=e.RGB5_A1)}return o!==e.R16F&&o!==e.R32F&&o!==e.RG16F&&o!==e.RG32F&&o!==e.RGBA16F&&o!==e.RGBA32F||t.get("EXT_color_buffer_float"),o}function b(t,n){let i;return t?null===n||n===Qn||n===ri?i=e.DEPTH24_STENCIL8:n===ei?i=e.DEPTH32F_STENCIL8:n===Kn&&(i=e.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===n||n===Qn||n===ri?i=e.DEPTH_COMPONENT24:n===ei?i=e.DEPTH_COMPONENT32F:n===Kn&&(i=e.DEPTH_COMPONENT16),i}function x(e,t){return!0===g(e)||e.isFramebufferTexture&&e.minFilter!==Gn&&e.minFilter!==qn?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function _(e){const t=e.target;t.removeEventListener("dispose",_),function(e){const t=i.get(e);if(void 0===t.__webglInit)return;const n=e.source,r=d.get(n);if(r){const i=r[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&S(e),0===Object.keys(r).length&&d.delete(n)}i.remove(e)}(t),t.isVideoTexture&&u.delete(t)}function w(t){const n=t.target;n.removeEventListener("dispose",w),function(t){const n=i.get(t);if(t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++){if(Array.isArray(n.__webglFramebuffer[t]))for(let i=0;i<n.__webglFramebuffer[t].length;i++)e.deleteFramebuffer(n.__webglFramebuffer[t][i]);else e.deleteFramebuffer(n.__webglFramebuffer[t]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[t])}else{if(Array.isArray(n.__webglFramebuffer))for(let t=0;t<n.__webglFramebuffer.length;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const r=t.textures;for(let t=0,n=r.length;t<n;t++){const n=i.get(r[t]);n.__webglTexture&&(e.deleteTexture(n.__webglTexture),a.memory.textures--),i.remove(r[t])}i.remove(t)}(n)}function S(t){const n=i.get(t);e.deleteTexture(n.__webglTexture);const r=t.source;delete d.get(r)[n.__cacheKey],a.memory.textures--}let M=0;function E(t,r){const s=i.get(t);if(t.isVideoTexture&&function(e){const t=a.render.frame;u.get(e)!==t&&(u.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&s.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void k(s,t,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,s.__webglTexture,e.TEXTURE0+r)}const T={[Vn]:e.REPEAT,[jn]:e.CLAMP_TO_EDGE,[Hn]:e.MIRRORED_REPEAT},A={[Gn]:e.NEAREST,[Wn]:e.NEAREST_MIPMAP_NEAREST,[Xn]:e.NEAREST_MIPMAP_LINEAR,[qn]:e.LINEAR,[Yn]:e.LINEAR_MIPMAP_NEAREST,[$n]:e.LINEAR_MIPMAP_LINEAR},C={[Qi]:e.NEVER,[ar]:e.ALWAYS,[er]:e.LESS,[nr]:e.LEQUAL,[tr]:e.EQUAL,[sr]:e.GEQUAL,[ir]:e.GREATER,[rr]:e.NOTEQUAL};function R(n,s){if(s.type!==ei||!1!==t.has("OES_texture_float_linear")||s.magFilter!==qn&&s.magFilter!==Yn&&s.magFilter!==Xn&&s.magFilter!==$n&&s.minFilter!==qn&&s.minFilter!==Yn&&s.minFilter!==Xn&&s.minFilter!==$n||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),e.texParameteri(n,e.TEXTURE_WRAP_S,T[s.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,T[s.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,T[s.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,A[s.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,A[s.minFilter]),s.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,C[s.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){if(s.magFilter===Gn)return;if(s.minFilter!==Xn&&s.minFilter!==$n)return;if(s.type===ei&&!1===t.has("OES_texture_float_linear"))return;if(s.anisotropy>1||i.get(s).__currentAnisotropy){const a=t.get("EXT_texture_filter_anisotropic");e.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy}}}function P(t,n){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",_));const r=n.source;let s=d.get(r);void 0===s&&(s={},d.set(r,s));const o=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(o!==t.__cacheKey){void 0===s[o]&&(s[o]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,i=!0),s[o].usedTimes++;const r=s[t.__cacheKey];void 0!==r&&(s[t.__cacheKey].usedTimes--,0===r.usedTimes&&S(n)),t.__cacheKey=o,t.__webglTexture=s[o].texture}return i}function k(t,a,o){let l=e.TEXTURE_2D;(a.isDataArrayTexture||a.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),a.isData3DTexture&&(l=e.TEXTURE_3D);const c=P(t,a),u=a.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+o);const h=i.get(u);if(u.version!==h.__version||!0===c){n.activeTexture(e.TEXTURE0+o);const t=so.getPrimaries(so.workingColorSpace),i=a.colorSpace===Hi?null:so.getPrimaries(a.colorSpace),d=a.colorSpace===Hi||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,a.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,a.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let p=m(a.image,!1,r.maxTextureSize);p=F(a,p);const f=s.convert(a.format,a.colorSpace),_=s.convert(a.type);let w,S=y(a.internalFormat,f,_,a.colorSpace,a.isVideoTexture);R(l,a);const M=a.mipmaps,E=!0!==a.isVideoTexture,T=void 0===h.__version||!0===c,A=u.dataReady,C=x(a,p);if(a.isDepthTexture)S=b(a.format===oi,a.type),T&&(E?n.texStorage2D(e.TEXTURE_2D,1,S,p.width,p.height):n.texImage2D(e.TEXTURE_2D,0,S,p.width,p.height,0,f,_,null));else if(a.isDataTexture)if(M.length>0){E&&T&&n.texStorage2D(e.TEXTURE_2D,C,S,M[0].width,M[0].height);for(let t=0,i=M.length;t<i;t++)w=M[t],E?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,w.width,w.height,f,_,w.data):n.texImage2D(e.TEXTURE_2D,t,S,w.width,w.height,0,f,_,w.data);a.generateMipmaps=!1}else E?(T&&n.texStorage2D(e.TEXTURE_2D,C,S,p.width,p.height),A&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,p.width,p.height,f,_,p.data)):n.texImage2D(e.TEXTURE_2D,0,S,p.width,p.height,0,f,_,p.data);else if(a.isCompressedTexture)if(a.isCompressedArrayTexture){E&&T&&n.texStorage3D(e.TEXTURE_2D_ARRAY,C,S,M[0].width,M[0].height,p.depth);for(let t=0,i=M.length;t<i;t++)if(w=M[t],a.format!==si)if(null!==f)if(E){if(A)if(a.layerUpdates.size>0){const i=JE(w.width,w.height,a.format,a.type);for(const r of a.layerUpdates){const s=w.data.subarray(r*i/w.data.BYTES_PER_ELEMENT,(r+1)*i/w.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,r,w.width,w.height,1,f,s,0,0)}a.clearLayerUpdates()}else n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,w.width,w.height,p.depth,f,w.data,0,0)}else n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,S,w.width,w.height,p.depth,0,w.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else E?A&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,w.width,w.height,p.depth,f,_,w.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,S,w.width,w.height,p.depth,0,f,_,w.data)}else{E&&T&&n.texStorage2D(e.TEXTURE_2D,C,S,M[0].width,M[0].height);for(let t=0,i=M.length;t<i;t++)w=M[t],a.format!==si?null!==f?E?A&&n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,w.width,w.height,f,w.data):n.compressedTexImage2D(e.TEXTURE_2D,t,S,w.width,w.height,0,w.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):E?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,w.width,w.height,f,_,w.data):n.texImage2D(e.TEXTURE_2D,t,S,w.width,w.height,0,f,_,w.data)}else if(a.isDataArrayTexture)if(E){if(T&&n.texStorage3D(e.TEXTURE_2D_ARRAY,C,S,p.width,p.height,p.depth),A)if(a.layerUpdates.size>0){const t=JE(p.width,p.height,a.format,a.type);for(const i of a.layerUpdates){const r=p.data.subarray(i*t/p.data.BYTES_PER_ELEMENT,(i+1)*t/p.data.BYTES_PER_ELEMENT);n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,i,p.width,p.height,1,f,_,r)}a.clearLayerUpdates()}else n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,f,_,p.data)}else n.texImage3D(e.TEXTURE_2D_ARRAY,0,S,p.width,p.height,p.depth,0,f,_,p.data);else if(a.isData3DTexture)E?(T&&n.texStorage3D(e.TEXTURE_3D,C,S,p.width,p.height,p.depth),A&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,f,_,p.data)):n.texImage3D(e.TEXTURE_3D,0,S,p.width,p.height,p.depth,0,f,_,p.data);else if(a.isFramebufferTexture){if(T)if(E)n.texStorage2D(e.TEXTURE_2D,C,S,p.width,p.height);else{let t=p.width,i=p.height;for(let r=0;r<C;r++)n.texImage2D(e.TEXTURE_2D,r,S,t,i,0,f,_,null),t>>=1,i>>=1}}else if(M.length>0){if(E&&T){const t=B(M[0]);n.texStorage2D(e.TEXTURE_2D,C,S,t.width,t.height)}for(let t=0,i=M.length;t<i;t++)w=M[t],E?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,f,_,w):n.texImage2D(e.TEXTURE_2D,t,S,f,_,w);a.generateMipmaps=!1}else if(E){if(T){const t=B(p);n.texStorage2D(e.TEXTURE_2D,C,S,t.width,t.height)}A&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,f,_,p)}else n.texImage2D(e.TEXTURE_2D,0,S,f,_,p);g(a)&&v(l),h.__version=u.version,a.onUpdate&&a.onUpdate(a)}t.__version=a.version}function I(t,r,a,l,c,u){const h=s.convert(a.format,a.colorSpace),d=s.convert(a.type),p=y(a.internalFormat,h,d,a.colorSpace);if(!i.get(r).__hasExternalTextures){const t=Math.max(1,r.width>>u),i=Math.max(1,r.height>>u);c===e.TEXTURE_3D||c===e.TEXTURE_2D_ARRAY?n.texImage3D(c,u,p,t,i,r.depth,0,h,d,null):n.texImage2D(c,u,p,t,i,0,h,d,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),U(r)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,l,c,i.get(a).__webglTexture,0,z(r)):(c===e.TEXTURE_2D||c>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,l,c,i.get(a).__webglTexture,u),n.bindFramebuffer(e.FRAMEBUFFER,null)}function O(t,n,i){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer){const r=n.depthTexture,s=r&&r.isDepthTexture?r.type:null,a=b(n.stencilBuffer,s),l=n.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,c=z(n);U(n)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,c,a,n.width,n.height):i?e.renderbufferStorageMultisample(e.RENDERBUFFER,c,a,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,a,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,t)}else{const t=n.textures;for(let r=0;r<t.length;r++){const a=t[r],l=s.convert(a.format,a.colorSpace),c=s.convert(a.type),u=y(a.internalFormat,l,c,a.colorSpace),h=z(n);i&&!1===U(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,h,u,n.width,n.height):U(n)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,h,u,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,u,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function L(t){const r=i.get(t),s=!0===t.isWebGLCubeRenderTarget;if(r.__boundDepthTexture!==t.depthTexture){const e=t.depthTexture;if(r.__depthDisposeCallback&&r.__depthDisposeCallback(),e){const t=()=>{delete r.__boundDepthTexture,delete r.__depthDisposeCallback,e.removeEventListener("dispose",t)};e.addEventListener("dispose",t),r.__depthDisposeCallback=t}r.__boundDepthTexture=e}if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),E(r.depthTexture,0);const s=i.get(r.depthTexture).__webglTexture,a=z(r);if(r.depthTexture.format===ai)U(r)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0,a):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0);else{if(r.depthTexture.format!==oi)throw new Error("Unknown depthTexture format");U(r)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0,a):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0)}}(r.__webglFramebuffer,t)}else if(s){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)if(n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[i]),void 0===r.__webglDepthbuffer[i])r.__webglDepthbuffer[i]=e.createRenderbuffer(),O(r.__webglDepthbuffer[i],t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,s=r.__webglDepthbuffer[i];e.bindRenderbuffer(e.RENDERBUFFER,s),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,s)}}else if(n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),void 0===r.__webglDepthbuffer)r.__webglDepthbuffer=e.createRenderbuffer(),O(r.__webglDepthbuffer,t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,i=r.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,i),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,i)}n.bindFramebuffer(e.FRAMEBUFFER,null)}const N=[],D=[];function z(e){return Math.min(r.maxSamples,e.samples)}function U(e){const n=i.get(e);return e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function F(e,t){const n=e.colorSpace,i=e.format,r=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||n!==Wi&&n!==Hi&&(so.getTransfer(n)===$i?i===si&&r===Zn||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),t}function B(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?(c.width=e.naturalWidth||e.width,c.height=e.naturalHeight||e.height):"undefined"!=typeof VideoFrame&&e instanceof VideoFrame?(c.width=e.displayWidth,c.height=e.displayHeight):(c.width=e.width,c.height=e.height),c}this.allocateTextureUnit=function(){const e=M;return e>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+r.maxTextures),M+=1,e},this.resetTextureUnits=function(){M=0},this.setTexture2D=E,this.setTexture2DArray=function(t,r){const s=i.get(t);t.version>0&&s.__version!==t.version?k(s,t,r):n.bindTexture(e.TEXTURE_2D_ARRAY,s.__webglTexture,e.TEXTURE0+r)},this.setTexture3D=function(t,r){const s=i.get(t);t.version>0&&s.__version!==t.version?k(s,t,r):n.bindTexture(e.TEXTURE_3D,s.__webglTexture,e.TEXTURE0+r)},this.setTextureCube=function(t,a){const o=i.get(t);t.version>0&&o.__version!==t.version?function(t,a,o){if(6!==a.image.length)return;const l=P(t,a),c=a.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+o);const u=i.get(c);if(c.version!==u.__version||!0===l){n.activeTexture(e.TEXTURE0+o);const t=so.getPrimaries(so.workingColorSpace),i=a.colorSpace===Hi?null:so.getPrimaries(a.colorSpace),h=a.colorSpace===Hi||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,a.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,a.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);const d=a.isCompressedTexture||a.image[0].isCompressedTexture,p=a.image[0]&&a.image[0].isDataTexture,f=[];for(let e=0;e<6;e++)f[e]=d||p?p?a.image[e].image:a.image[e]:m(a.image[e],!0,r.maxCubemapSize),f[e]=F(a,f[e]);const b=f[0],_=s.convert(a.format,a.colorSpace),w=s.convert(a.type),S=y(a.internalFormat,_,w,a.colorSpace),M=!0!==a.isVideoTexture,E=void 0===u.__version||!0===l,T=c.dataReady;let A,C=x(a,b);if(R(e.TEXTURE_CUBE_MAP,a),d){M&&E&&n.texStorage2D(e.TEXTURE_CUBE_MAP,C,S,b.width,b.height);for(let t=0;t<6;t++){A=f[t].mipmaps;for(let i=0;i<A.length;i++){const r=A[i];a.format!==si?null!==_?M?T&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,r.width,r.height,_,r.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,S,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):M?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,r.width,r.height,_,w,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,S,r.width,r.height,0,_,w,r.data)}}}else{if(A=a.mipmaps,M&&E){A.length>0&&C++;const t=B(f[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,C,S,t.width,t.height)}for(let t=0;t<6;t++)if(p){M?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,f[t].width,f[t].height,_,w,f[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,S,f[t].width,f[t].height,0,_,w,f[t].data);for(let i=0;i<A.length;i++){const r=A[i].image[t].image;M?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,r.width,r.height,_,w,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,S,r.width,r.height,0,_,w,r.data)}}else{M?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,_,w,f[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,S,_,w,f[t]);for(let i=0;i<A.length;i++){const r=A[i];M?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,_,w,r.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,S,_,w,r.image[t])}}}g(a)&&v(e.TEXTURE_CUBE_MAP),u.__version=c.version,a.onUpdate&&a.onUpdate(a)}t.__version=a.version}(o,t,a):n.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture,e.TEXTURE0+a)},this.rebindTextures=function(t,n,r){const s=i.get(t);void 0!==n&&I(s.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==r&&L(t)},this.setupRenderTarget=function(t){const r=t.texture,o=i.get(t),l=i.get(r);t.addEventListener("dispose",w);const c=t.textures,u=!0===t.isWebGLCubeRenderTarget,h=c.length>1;if(h||(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=r.version,a.memory.textures++),u){o.__webglFramebuffer=[];for(let t=0;t<6;t++)if(r.mipmaps&&r.mipmaps.length>0){o.__webglFramebuffer[t]=[];for(let n=0;n<r.mipmaps.length;n++)o.__webglFramebuffer[t][n]=e.createFramebuffer()}else o.__webglFramebuffer[t]=e.createFramebuffer()}else{if(r.mipmaps&&r.mipmaps.length>0){o.__webglFramebuffer=[];for(let t=0;t<r.mipmaps.length;t++)o.__webglFramebuffer[t]=e.createFramebuffer()}else o.__webglFramebuffer=e.createFramebuffer();if(h)for(let t=0,n=c.length;t<n;t++){const n=i.get(c[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),a.memory.textures++)}if(t.samples>0&&!1===U(t)){o.__webglMultisampledFramebuffer=e.createFramebuffer(),o.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,o.__webglMultisampledFramebuffer);for(let n=0;n<c.length;n++){const i=c[n];o.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,o.__webglColorRenderbuffer[n]);const r=s.convert(i.format,i.colorSpace),a=s.convert(i.type),l=y(i.internalFormat,r,a,i.colorSpace,!0===t.isXRRenderTarget),u=z(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,u,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,o.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(o.__webglDepthRenderbuffer=e.createRenderbuffer(),O(o.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(u){n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture),R(e.TEXTURE_CUBE_MAP,r);for(let n=0;n<6;n++)if(r.mipmaps&&r.mipmaps.length>0)for(let i=0;i<r.mipmaps.length;i++)I(o.__webglFramebuffer[n][i],t,r,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,i);else I(o.__webglFramebuffer[n],t,r,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);g(r)&&v(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(h){for(let r=0,s=c.length;r<s;r++){const s=c[r],a=i.get(s);n.bindTexture(e.TEXTURE_2D,a.__webglTexture),R(e.TEXTURE_2D,s),I(o.__webglFramebuffer,t,s,e.COLOR_ATTACHMENT0+r,e.TEXTURE_2D,0),g(s)&&v(e.TEXTURE_2D)}n.unbindTexture()}else{let i=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(i=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(i,l.__webglTexture),R(i,r),r.mipmaps&&r.mipmaps.length>0)for(let n=0;n<r.mipmaps.length;n++)I(o.__webglFramebuffer[n],t,r,e.COLOR_ATTACHMENT0,i,n);else I(o.__webglFramebuffer,t,r,e.COLOR_ATTACHMENT0,i,0);g(r)&&v(i),n.unbindTexture()}t.depthBuffer&&L(t)},this.updateRenderTargetMipmap=function(t){const r=t.textures;for(let s=0,a=r.length;s<a;s++){const a=r[s];if(g(a)){const r=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,s=i.get(a).__webglTexture;n.bindTexture(r,s),v(r),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.samples>0)if(!1===U(t)){const r=t.textures,s=t.width,a=t.height;let o=e.COLOR_BUFFER_BIT;const c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=i.get(t),h=r.length>1;if(h)for(let t=0;t<r.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<r.length;n++){if(t.resolveDepthBuffer&&(t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&t.resolveStencilBuffer&&(o|=e.STENCIL_BUFFER_BIT)),h){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[n]);const t=i.get(r[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,s,a,0,0,s,a,o,e.NEAREST),!0===l&&(N.length=0,D.length=0,N.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&!1===t.resolveDepthBuffer&&(N.push(c),D.push(c),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,D)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,N))}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),h)for(let t=0;t<r.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,u.__webglColorRenderbuffer[t]);const s=i.get(r[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,s,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}else if(t.depthBuffer&&!1===t.resolveDepthBuffer&&l){const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[n])}},this.setupDepthRenderbuffer=L,this.setupFrameBufferTexture=I,this.useMultisampledRTT=U}function eT(e,t){return{convert:function(n,i=""){let r;const s=so.getTransfer(i);if(n===Zn)return e.UNSIGNED_BYTE;if(n===ni)return e.UNSIGNED_SHORT_4_4_4_4;if(n===ii)return e.UNSIGNED_SHORT_5_5_5_1;if(35902===n)return e.UNSIGNED_INT_5_9_9_9_REV;if(1010===n)return e.BYTE;if(1011===n)return e.SHORT;if(n===Kn)return e.UNSIGNED_SHORT;if(n===Jn)return e.INT;if(n===Qn)return e.UNSIGNED_INT;if(n===ei)return e.FLOAT;if(n===ti)return e.HALF_FLOAT;if(1021===n)return e.ALPHA;if(1022===n)return e.RGB;if(n===si)return e.RGBA;if(1024===n)return e.LUMINANCE;if(1025===n)return e.LUMINANCE_ALPHA;if(n===ai)return e.DEPTH_COMPONENT;if(n===oi)return e.DEPTH_STENCIL;if(n===li)return e.RED;if(n===ci)return e.RED_INTEGER;if(1030===n)return e.RG;if(n===ui)return e.RG_INTEGER;if(n===hi)return e.RGBA_INTEGER;if(n===di||n===pi||n===fi||n===mi)if(s===$i){if(r=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(n===di)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===pi)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===fi)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===mi)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=t.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(n===di)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===pi)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===fi)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===mi)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===gi||n===vi||n===yi||n===bi){if(r=t.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(n===gi)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===vi)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===yi)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===bi)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===xi||n===_i||n===wi){if(r=t.get("WEBGL_compressed_texture_etc"),null===r)return null;if(n===xi||n===_i)return s===$i?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===wi)return s===$i?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(n===Si||n===Mi||n===Ei||n===Ti||n===Ai||n===Ci||n===Ri||n===Pi||n===ki||n===Ii||n===Oi||n===Li||n===Ni||n===Di){if(r=t.get("WEBGL_compressed_texture_astc"),null===r)return null;if(n===Si)return s===$i?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===Mi)return s===$i?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Ei)return s===$i?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Ti)return s===$i?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Ai)return s===$i?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===Ci)return s===$i?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Ri)return s===$i?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Pi)return s===$i?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===ki)return s===$i?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Ii)return s===$i?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Oi)return s===$i?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Li)return s===$i?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Ni)return s===$i?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Di)return s===$i?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===zi||n===Ui||n===Fi){if(r=t.get("EXT_texture_compression_bptc"),null===r)return null;if(n===zi)return s===$i?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===Ui)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===Fi)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===n||n===Bi||n===Vi||n===ji){if(r=t.get("EXT_texture_compression_rgtc"),null===r)return null;if(n===zi)return r.COMPRESSED_RED_RGTC1_EXT;if(n===Bi)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Vi)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===ji)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===ri?e.UNSIGNED_INT_24_8:void 0!==e[n]?e[n]:null}}}class tT extends ly{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}const nT={type:"move"};class iT{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Gy,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Gy,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new an,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new an),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Gy,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new an,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new an),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,s=null;const a=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){s=!0;for(const i of e.hand.values()){const e=t.getJointPose(i,n),r=this._getHandJoint(l,i);null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,r.jointRadius=e.radius),r.visible=null!==e}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=i.position.distanceTo(r.position),o=.02,c=.005;l.inputState.pinching&&a>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&a<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));null!==a&&(i=t.getPose(e.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(nT)))}return null!==a&&(a.visible=null!==i),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new Gy;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class rT{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(null===this.texture){const i=new fl;e.properties.get(i).__webglTexture=t.texture,t.depthNear==n.depthNear&&t.depthFar==n.depthFar||(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i}}getMesh(e){if(null!==this.texture&&null===this.mesh){const t=e.cameras[0].viewport,n=new Py({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Yo(new bc(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class sT extends yr{constructor(e,t){super();const n=this;let i=null,r=1,s=null,a="local-floor",o=1,l=null,c=null,u=null,h=null,d=null,p=null;const f=new rT,m=t.getContextAttributes();let g=null,v=null;const y=[],b=[],x=new da;let _=null;const w=new ly;w.layers.enable(1),w.viewport=new Ba;const S=new ly;S.layers.enable(2),S.viewport=new Ba;const M=[w,S],E=new tT;E.layers.enable(1),E.layers.enable(2);let T=null,A=null;function C(e){const t=b.indexOf(e.inputSource);if(-1===t)return;const n=y[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||s),n.dispatchEvent({type:e.type,data:e.inputSource}))}function R(){i.removeEventListener("select",C),i.removeEventListener("selectstart",C),i.removeEventListener("selectend",C),i.removeEventListener("squeeze",C),i.removeEventListener("squeezestart",C),i.removeEventListener("squeezeend",C),i.removeEventListener("end",R),i.removeEventListener("inputsourceschange",P);for(let e=0;e<y.length;e++){const t=b[e];null!==t&&(b[e]=null,y[e].disconnect(t))}T=null,A=null,f.reset(),e.setRenderTarget(g),d=null,h=null,u=null,i=null,v=null,N.stop(),n.isPresenting=!1,e.setPixelRatio(_),e.setSize(x.width,x.height,!1),n.dispatchEvent({type:"sessionend"})}function P(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=b.indexOf(n);i>=0&&(b[i]=null,y[i].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let i=b.indexOf(n);if(-1===i){for(let e=0;e<y.length;e++){if(e>=b.length){b.push(n),i=e;break}if(null===b[e]){b[e]=n,i=e;break}}if(-1===i)break}const r=y[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=y[e];return void 0===t&&(t=new iT,y[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=y[e];return void 0===t&&(t=new iT,y[e]=t),t.getGripSpace()},this.getHand=function(e){let t=y[e];return void 0===t&&(t=new iT,y[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==h?h:d},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(c){if(i=c,null!==i){if(g=e.getRenderTarget(),i.addEventListener("select",C),i.addEventListener("selectstart",C),i.addEventListener("selectend",C),i.addEventListener("squeeze",C),i.addEventListener("squeezestart",C),i.addEventListener("squeezeend",C),i.addEventListener("end",R),i.addEventListener("inputsourceschange",P),!0!==m.xrCompatible&&await t.makeXRCompatible(),_=e.getPixelRatio(),e.getSize(x),void 0===i.renderState.layers){const n={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(i,t,n),i.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),v=new IS(d.framebufferWidth,d.framebufferHeight,{format:si,type:Zn,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil})}else{let n=null,s=null,a=null;m.depth&&(a=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=m.stencil?oi:ai,s=m.stencil?ri:Qn);const o={colorFormat:t.RGBA8,depthFormat:a,scaleFactor:r};u=new XRWebGLBinding(i,t),h=u.createProjectionLayer(o),i.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),v=new IS(h.textureWidth,h.textureHeight,{format:si,type:Zn,depthTexture:new lM(h.textureWidth,h.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:!1===h.ignoreDepthValues})}v.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await i.requestReferenceSpace(a),N.setContext(i),N.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode},this.getDepthTexture=function(){return f.getDepthTexture()};const k=new an,I=new an;function O(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;let t=e.near,n=e.far;null!==f.texture&&(f.depthNear>0&&(t=f.depthNear),f.depthFar>0&&(n=f.depthFar)),E.near=S.near=w.near=t,E.far=S.far=w.far=n,T===E.near&&A===E.far||(i.updateRenderState({depthNear:E.near,depthFar:E.far}),T=E.near,A=E.far);const r=e.parent,s=E.cameras;O(E,r);for(let e=0;e<s.length;e++)O(s[e],r);2===s.length?function(e,t,n){k.setFromMatrixPosition(t.matrixWorld),I.setFromMatrixPosition(n.matrixWorld);const i=k.distanceTo(I),r=t.projectionMatrix.elements,s=n.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(s[8]+1)/s[0],d=a*u,p=a*h,f=i/(-u+h),m=f*-u;if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===r[10])e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{const t=a+f,n=o+f,r=d-m,s=p+(i-m),u=l*o/n*t,h=c*o/n*t;e.projectionMatrix.makePerspective(r,s,u,h,t,n),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(E,w,S):E.projectionMatrix.copy(w.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld)),e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*Jt*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,E,r)},this.getCamera=function(){return E},this.getFoveation=function(){if(null!==h||null!==d)return o},this.setFoveation=function(e){o=e,null!==h&&(h.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==f.texture},this.getDepthSensingMesh=function(){return f.getMesh(E)};let L=null;const N=new yS;N.setAnimationLoop((function(t,r){if(c=r.getViewerPose(l||s),p=r,null!==c){const t=c.views;null!==d&&(e.setRenderTargetFramebuffer(v,d.framebuffer),e.setRenderTarget(v));let n=!1;t.length!==E.cameras.length&&(E.cameras.length=0,n=!0);for(let i=0;i<t.length;i++){const r=t[i];let s=null;if(null!==d)s=d.getViewport(r);else{const t=u.getViewSubImage(h,r);s=t.viewport,0===i&&(e.setRenderTargetTextures(v,t.colorTexture,h.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(v))}let a=M[i];void 0===a&&(a=new ly,a.layers.enable(i),a.viewport=new Ba,M[i]=a),a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.quaternion,a.scale),a.projectionMatrix.fromArray(r.projectionMatrix),a.projectionMatrixInverse.copy(a.projectionMatrix).invert(),a.viewport.set(s.x,s.y,s.width,s.height),0===i&&(E.matrix.copy(a.matrix),E.matrix.decompose(E.position,E.quaternion,E.scale)),!0===n&&E.cameras.push(a)}const r=i.enabledFeatures;if(r&&r.includes("depth-sensing")){const n=u.getDepthInformation(t[0]);n&&n.isValid&&n.texture&&f.init(e,n,i.renderState)}}for(let e=0;e<y.length;e++){const t=b[e],n=y[e];null!==t&&void 0!==n&&n.update(t,r,l||s)}L&&L(t,r),r.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:r}),p=null})),this.setAnimationLoop=function(e){L=e},this.dispose=function(){}}}const aT=new _r,oT=new ur;function lT(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function i(e,i){e.opacity.value=i.opacity,i.color&&e.diffuse.value.copy(i.color),i.emissive&&e.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(e.map.value=i.map,n(i.map,e.mapTransform)),i.alphaMap&&(e.alphaMap.value=i.alphaMap,n(i.alphaMap,e.alphaMapTransform)),i.bumpMap&&(e.bumpMap.value=i.bumpMap,n(i.bumpMap,e.bumpMapTransform),e.bumpScale.value=i.bumpScale,1===i.side&&(e.bumpScale.value*=-1)),i.normalMap&&(e.normalMap.value=i.normalMap,n(i.normalMap,e.normalMapTransform),e.normalScale.value.copy(i.normalScale),1===i.side&&e.normalScale.value.negate()),i.displacementMap&&(e.displacementMap.value=i.displacementMap,n(i.displacementMap,e.displacementMapTransform),e.displacementScale.value=i.displacementScale,e.displacementBias.value=i.displacementBias),i.emissiveMap&&(e.emissiveMap.value=i.emissiveMap,n(i.emissiveMap,e.emissiveMapTransform)),i.specularMap&&(e.specularMap.value=i.specularMap,n(i.specularMap,e.specularMapTransform)),i.alphaTest>0&&(e.alphaTest.value=i.alphaTest);const r=t.get(i),s=r.envMap,a=r.envMapRotation;s&&(e.envMap.value=s,aT.copy(a),aT.x*=-1,aT.y*=-1,aT.z*=-1,s.isCubeTexture&&!1===s.isRenderTargetTexture&&(aT.y*=-1,aT.z*=-1),e.envMapRotation.value.setFromMatrix4(oT.makeRotationFromEuler(aT)),e.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,e.reflectivity.value=i.reflectivity,e.ior.value=i.ior,e.refractionRatio.value=i.refractionRatio),i.lightMap&&(e.lightMap.value=i.lightMap,e.lightMapIntensity.value=i.lightMapIntensity,n(i.lightMap,e.lightMapTransform)),i.aoMap&&(e.aoMap.value=i.aoMap,e.aoMapIntensity.value=i.aoMapIntensity,n(i.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,Ty(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,r,s,a,o){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(e,r):r.isMeshToonMaterial?(i(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,r)):r.isMeshPhongMaterial?(i(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,r)):r.isMeshStandardMaterial?(i(e,r),function(e,t){e.metalness.value=t.metalness,t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap,n(t.metalnessMap,e.metalnessMapTransform)),e.roughness.value=t.roughness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap,n(t.roughnessMap,e.roughnessMapTransform)),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}(e,r),r.isMeshPhysicalMaterial&&function(e,t,i){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform))),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),1===t.side&&e.clearcoatNormalScale.value.negate())),t.dispersion>0&&(e.dispersion.value=t.dispersion),t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform))),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform))),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform)),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,r,o)):r.isMeshMatcapMaterial?(i(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,r)):r.isMeshDepthMaterial?i(e,r):r.isMeshDistanceMaterial?(i(e,r),function(e,n){const i=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(i.matrixWorld),e.nearDistance.value=i.shadow.camera.near,e.farDistance.value=i.shadow.camera.far}(e,r)):r.isMeshNormalMaterial?i(e,r):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,i,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*r,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r,s,a):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function cT(e,t,n,i){let r={},s={},a=[];const o=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function l(e,t,n,i){const r=e.value,s=t+"_"+n;if(void 0===i[s])return i[s]="number"==typeof r||"boolean"==typeof r?r:r.clone(),!0;{const e=i[s];if("number"==typeof r||"boolean"==typeof r){if(e!==r)return i[s]=r,!0}else if(!1===e.equals(r))return e.copy(r),!0}return!1}function c(e){const t={boundary:0,storage:0};return"number"==typeof e||"boolean"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){const n=t.target;n.removeEventListener("dispose",u);const i=a.indexOf(n.__bindingPointIndex);a.splice(i,1),e.deleteBuffer(r[n.id]),delete r[n.id],delete s[n.id]}return{bind:function(e,t){const n=t.program;i.uniformBlockBinding(e,n)},update:function(n,h){let d=r[n.id];void 0===d&&(function(e){const t=e.uniforms;let n=0;for(let e=0,i=t.length;e<i;e++){const i=Array.isArray(t[e])?t[e]:[t[e]];for(let e=0,t=i.length;e<t;e++){const t=i[e],r=Array.isArray(t.value)?t.value:[t.value];for(let e=0,i=r.length;e<i;e++){const i=c(r[e]),s=n%16,a=s%i.boundary,o=s+a;n+=a,0!==o&&16-o<i.storage&&(n+=16-o),t.__data=new Float32Array(i.storage/Float32Array.BYTES_PER_ELEMENT),t.__offset=n,n+=i.storage}}}const i=n%16;i>0&&(n+=16-i),e.__size=n,e.__cache={}}(n),d=function(t){const n=function(){for(let e=0;e<o;e++)if(-1===a.indexOf(e))return a.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const i=e.createBuffer(),r=t.__size,s=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,r,s),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,i),i}(n),r[n.id]=d,n.addEventListener("dispose",u));const p=h.program;i.updateUBOMapping(n,p);const f=t.render.frame;s[n.id]!==f&&(function(t){const n=r[t.id],i=t.uniforms,s=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let t=0,n=i.length;t<n;t++){const n=Array.isArray(i[t])?i[t]:[i[t]];for(let i=0,r=n.length;i<r;i++){const r=n[i];if(!0===l(r,t,i,s)){const t=r.__offset,n=Array.isArray(r.value)?r.value:[r.value];let i=0;for(let s=0;s<n.length;s++){const a=n[s],o=c(a);"number"==typeof a||"boolean"==typeof a?(r.__data[0]=a,e.bufferSubData(e.UNIFORM_BUFFER,t+i,r.__data)):a.isMatrix3?(r.__data[0]=a.elements[0],r.__data[1]=a.elements[1],r.__data[2]=a.elements[2],r.__data[3]=0,r.__data[4]=a.elements[3],r.__data[5]=a.elements[4],r.__data[6]=a.elements[5],r.__data[7]=0,r.__data[8]=a.elements[6],r.__data[9]=a.elements[7],r.__data[10]=a.elements[8],r.__data[11]=0):(a.toArray(r.__data,i),i+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,r.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),s[n.id]=f)},dispose:function(){for(const t in r)e.deleteBuffer(r[t]);a=[],r={},s={}}}}class uT{constructor(e={}){const{canvas:t=To(),context:n=null,depth:i=!0,stencil:r=!1,alpha:s=!1,antialias:a=!1,premultipliedAlpha:o=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1}=e;let h;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!=typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");h=n.getContextAttributes().alpha}else h=s;const d=new Uint32Array(4),p=new Int32Array(4);let f=null,m=null;const g=[],v=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Gi,this.toneMapping=0,this.toneMappingExposure=1;const y=this;let b=!1,x=0,_=0,w=null,S=-1,M=null;const E=new Ba,T=new Ba;let A=null;const C=new po(0);let R=0,P=t.width,k=t.height,I=1,O=null,L=null;const N=new Ba(0,0,P,k),D=new Ba(0,0,P,k);let z=!1;const U=new vS;let F=!1,B=!1;const V=new ur,j=new ur,H=new an,G=new Ba,W={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let X=!1;function q(){return null===w?I:1}let Y,$,Z,K,J,Q,ee,te,ne,ie,re,se,ae,oe,le,ce,ue,he,de,pe,fe,me,ge,ve,ye=n;function be(e,n){return t.getContext(e,n)}try{const e={alpha:!0,depth:i,stencil:r,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r169"),t.addEventListener("webglcontextlost",we,!1),t.addEventListener("webglcontextrestored",Se,!1),t.addEventListener("webglcontextcreationerror",Me,!1),null===ye){const t="webgl2";if(ye=be(t,e),null===ye)throw be(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function xe(){Y=new eM(ye),Y.init(),me=new eT(ye,Y),$=new RS(ye,Y,e,me),Z=new KE(ye),$.reverseDepthBuffer&&Z.buffers.depth.setReversed(!0),K=new iM(ye),J=new DE,Q=new QE(ye,Y,Z,J,$,me,K),ee=new zS(y),te=new QS(y),ne=new bS(ye),ge=new AS(ye,ne),ie=new tM(ye,ne,K,ge),re=new aM(ye,ie,ne,K),de=new sM(ye,$,Q),ce=new PS(J),se=new NE(y,ee,te,Y,$,ge,ce),ae=new lT(y,J),oe=new BE,le=new XE(Y),he=new TS(y,ee,te,Z,re,h,o),ue=new $E(y,re,$),ve=new cT(ye,K,$,Z),pe=new CS(ye,Y,K),fe=new nM(ye,Y,K),K.programs=se.programs,y.capabilities=$,y.extensions=Y,y.properties=J,y.renderLists=oe,y.shadowMap=ue,y.state=Z,y.info=K}xe();const _e=new sT(y,ye);function we(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function Se(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const e=K.autoReset,t=ue.enabled,n=ue.autoUpdate,i=ue.needsUpdate,r=ue.type;xe(),K.autoReset=e,ue.enabled=t,ue.autoUpdate=n,ue.needsUpdate=i,ue.type=r}function Me(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Ee(e){const t=e.target;t.removeEventListener("dispose",Ee),function(e){(function(e){const t=J.get(e).programs;void 0!==t&&(t.forEach((function(e){se.releaseProgram(e)})),e.isShaderMaterial&&se.releaseShaderCache(e))})(e),J.remove(e)}(t)}function Te(e,t,n){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,De(e,t,n),e.side=0,e.needsUpdate=!0,De(e,t,n),e.side=2):De(e,t,n)}this.xr=_e,this.getContext=function(){return ye},this.getContextAttributes=function(){return ye.getContextAttributes()},this.forceContextLoss=function(){const e=Y.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=Y.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return I},this.setPixelRatio=function(e){void 0!==e&&(I=e,this.setSize(P,k,!1))},this.getSize=function(e){return e.set(P,k)},this.setSize=function(e,n,i=!0){_e.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(P=e,k=n,t.width=Math.floor(e*I),t.height=Math.floor(n*I),!0===i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(P*I,k*I).floor()},this.setDrawingBufferSize=function(e,n,i){P=e,k=n,I=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(E)},this.getViewport=function(e){return e.copy(N)},this.setViewport=function(e,t,n,i){e.isVector4?N.set(e.x,e.y,e.z,e.w):N.set(e,t,n,i),Z.viewport(E.copy(N).multiplyScalar(I).round())},this.getScissor=function(e){return e.copy(D)},this.setScissor=function(e,t,n,i){e.isVector4?D.set(e.x,e.y,e.z,e.w):D.set(e,t,n,i),Z.scissor(T.copy(D).multiplyScalar(I).round())},this.getScissorTest=function(){return z},this.setScissorTest=function(e){Z.setScissorTest(z=e)},this.setOpaqueSort=function(e){O=e},this.setTransparentSort=function(e){L=e},this.getClearColor=function(e){return e.copy(he.getClearColor())},this.setClearColor=function(){he.setClearColor.apply(he,arguments)},this.getClearAlpha=function(){return he.getClearAlpha()},this.setClearAlpha=function(){he.setClearAlpha.apply(he,arguments)},this.clear=function(e=!0,t=!0,n=!0){let i=0;if(e){let e=!1;if(null!==w){const t=w.texture.format;e=t===hi||t===ui||t===ci}if(e){const e=w.texture.type,t=e===Zn||e===Qn||e===Kn||e===ri||e===ni||e===ii,n=he.getClearColor(),i=he.getClearAlpha(),r=n.r,s=n.g,a=n.b;t?(d[0]=r,d[1]=s,d[2]=a,d[3]=i,ye.clearBufferuiv(ye.COLOR,0,d)):(p[0]=r,p[1]=s,p[2]=a,p[3]=i,ye.clearBufferiv(ye.COLOR,0,p))}else i|=ye.COLOR_BUFFER_BIT}t&&(i|=ye.DEPTH_BUFFER_BIT,ye.clearDepth(this.capabilities.reverseDepthBuffer?0:1)),n&&(i|=ye.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ye.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",we,!1),t.removeEventListener("webglcontextrestored",Se,!1),t.removeEventListener("webglcontextcreationerror",Me,!1),oe.dispose(),le.dispose(),J.dispose(),ee.dispose(),te.dispose(),re.dispose(),ge.dispose(),ve.dispose(),se.dispose(),_e.dispose(),_e.removeEventListener("sessionstart",Ce),_e.removeEventListener("sessionend",Re),Pe.stop()},this.renderBufferDirect=function(e,t,n,i,r,s){null===t&&(t=W);const a=r.isMesh&&r.matrixWorld.determinant()<0,o=function(e,t,n,i,r){!0!==t.isScene&&(t=W),Q.resetTextureUnits();const s=t.fog,a=i.isMeshStandardMaterial?t.environment:null,o=null===w?y.outputColorSpace:!0===w.isXRRenderTarget?w.texture.colorSpace:Wi,l=(i.isMeshStandardMaterial?te:ee).get(i.envMap||a),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let f=0;i.toneMapped&&(null!==w&&!0!==w.isXRRenderTarget||(f=y.toneMapping));const g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==g?g.length:0,b=J.get(i),x=m.state.lights;if(!0===F&&(!0===B||e!==M)){const t=e===M&&i.id===S;ce.setState(i,e,t)}let _=!1;i.version===b.__version?b.needsLights&&b.lightsStateVersion!==x.state.version||b.outputColorSpace!==o||r.isBatchedMesh&&!1===b.batching?_=!0:r.isBatchedMesh||!0!==b.batching?r.isBatchedMesh&&!0===b.batchingColor&&null===r.colorTexture||r.isBatchedMesh&&!1===b.batchingColor&&null!==r.colorTexture||r.isInstancedMesh&&!1===b.instancing?_=!0:r.isInstancedMesh||!0!==b.instancing?r.isSkinnedMesh&&!1===b.skinning?_=!0:r.isSkinnedMesh||!0!==b.skinning?r.isInstancedMesh&&!0===b.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===b.instancingColor&&null!==r.instanceColor||r.isInstancedMesh&&!0===b.instancingMorph&&null===r.morphTexture||r.isInstancedMesh&&!1===b.instancingMorph&&null!==r.morphTexture||b.envMap!==l||!0===i.fog&&b.fog!==s?_=!0:void 0===b.numClippingPlanes||b.numClippingPlanes===ce.numPlanes&&b.numIntersection===ce.numIntersection?(b.vertexAlphas!==c||b.vertexTangents!==u||b.morphTargets!==h||b.morphNormals!==d||b.morphColors!==p||b.toneMapping!==f||b.morphTargetsCount!==v)&&(_=!0):_=!0:_=!0:_=!0:_=!0:(_=!0,b.__version=i.version);let E=b.currentProgram;!0===_&&(E=De(i,t,r));let T=!1,A=!1,C=!1;const R=E.getUniforms(),P=b.uniforms;if(Z.useProgram(E.program)&&(T=!0,A=!0,C=!0),i.id!==S&&(S=i.id,A=!0),T||M!==e){$.reverseDepthBuffer?(V.copy(e.projectionMatrix),function(e){const t=e.elements;t[2]=.5*t[2]+.5*t[3],t[6]=.5*t[6]+.5*t[7],t[10]=.5*t[10]+.5*t[11],t[14]=.5*t[14]+.5*t[15]}(V),function(e){const t=e.elements;-1===t[11]?(t[10]=-t[10]-1,t[14]=-t[14]):(t[10]=-t[10],t[14]=1-t[14])}(V),R.setValue(ye,"projectionMatrix",V)):R.setValue(ye,"projectionMatrix",e.projectionMatrix),R.setValue(ye,"viewMatrix",e.matrixWorldInverse);const t=R.map.cameraPosition;void 0!==t&&t.setValue(ye,H.setFromMatrixPosition(e.matrixWorld)),$.logarithmicDepthBuffer&&R.setValue(ye,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&R.setValue(ye,"isOrthographic",!0===e.isOrthographicCamera),M!==e&&(M=e,A=!0,C=!0)}if(r.isSkinnedMesh){R.setOptional(ye,r,"bindMatrix"),R.setOptional(ye,r,"bindMatrixInverse");const e=r.skeleton;e&&(null===e.boneTexture&&e.computeBoneTexture(),R.setValue(ye,"boneTexture",e.boneTexture,Q))}r.isBatchedMesh&&(R.setOptional(ye,r,"batchingTexture"),R.setValue(ye,"batchingTexture",r._matricesTexture,Q),R.setOptional(ye,r,"batchingIdTexture"),R.setValue(ye,"batchingIdTexture",r._indirectTexture,Q),R.setOptional(ye,r,"batchingColorTexture"),null!==r._colorsTexture&&R.setValue(ye,"batchingColorTexture",r._colorsTexture,Q));const O=n.morphAttributes;var L,N;if(void 0===O.position&&void 0===O.normal&&void 0===O.color||de.update(r,n,E),(A||b.receiveShadow!==r.receiveShadow)&&(b.receiveShadow=r.receiveShadow,R.setValue(ye,"receiveShadow",r.receiveShadow)),i.isMeshGouraudMaterial&&null!==i.envMap&&(P.envMap.value=l,P.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),i.isMeshStandardMaterial&&null===i.envMap&&null!==t.environment&&(P.envMapIntensity.value=t.environmentIntensity),A&&(R.setValue(ye,"toneMappingExposure",y.toneMappingExposure),b.needsLights&&(N=C,(L=P).ambientLightColor.needsUpdate=N,L.lightProbe.needsUpdate=N,L.directionalLights.needsUpdate=N,L.directionalLightShadows.needsUpdate=N,L.pointLights.needsUpdate=N,L.pointLightShadows.needsUpdate=N,L.spotLights.needsUpdate=N,L.spotLightShadows.needsUpdate=N,L.rectAreaLights.needsUpdate=N,L.hemisphereLights.needsUpdate=N),s&&!0===i.fog&&ae.refreshFogUniforms(P,s),ae.refreshMaterialUniforms(P,i,I,k,m.state.transmissionRenderTarget[e.id]),pE.upload(ye,ze(b),P,Q)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(pE.upload(ye,ze(b),P,Q),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&R.setValue(ye,"center",r.center),R.setValue(ye,"modelViewMatrix",r.modelViewMatrix),R.setValue(ye,"normalMatrix",r.normalMatrix),R.setValue(ye,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const e=i.uniformsGroups;for(let t=0,n=e.length;t<n;t++){const n=e[t];ve.update(n,E),ve.bind(n,E)}}return E}(e,t,n,i,r);Z.setMaterial(i,a);let l=n.index,c=1;if(!0===i.wireframe){if(l=ie.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,h=n.attributes.position;let d=u.start*c,p=(u.start+u.count)*c;null!==s&&(d=Math.max(d,s.start*c),p=Math.min(p,(s.start+s.count)*c)),null!==l?(d=Math.max(d,0),p=Math.min(p,l.count)):null!=h&&(d=Math.max(d,0),p=Math.min(p,h.count));const f=p-d;if(f<0||f===1/0)return;let g;ge.setup(r,i,o,n,l);let v=pe;if(null!==l&&(g=ne.get(l),v=fe,v.setIndex(g)),r.isMesh)!0===i.wireframe?(Z.setLineWidth(i.wireframeLinewidth*q()),v.setMode(ye.LINES)):v.setMode(ye.TRIANGLES);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),Z.setLineWidth(e*q()),r.isLineSegments?v.setMode(ye.LINES):r.isLineLoop?v.setMode(ye.LINE_LOOP):v.setMode(ye.LINE_STRIP)}else r.isPoints?v.setMode(ye.POINTS):r.isSprite&&v.setMode(ye.TRIANGLES);if(r.isBatchedMesh)if(null!==r._multiDrawInstances)v.renderMultiDrawInstances(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount,r._multiDrawInstances);else if(Y.get("WEBGL_multi_draw"))v.renderMultiDraw(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount);else{const e=r._multiDrawStarts,t=r._multiDrawCounts,n=r._multiDrawCount,s=l?ne.get(l).bytesPerElement:1,a=J.get(i).currentProgram.getUniforms();for(let i=0;i<n;i++)a.setValue(ye,"_gl_DrawID",i),v.render(e[i]/s,t[i])}else if(r.isInstancedMesh)v.renderInstances(d,f,r.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);v.renderInstances(d,f,t)}else v.render(d,f)},this.compile=function(e,t,n=null){null===n&&(n=e),m=le.get(n),m.init(t),v.push(m),n.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))})),e!==n&&e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))})),m.setupLights();const i=new Set;return e.traverse((function(e){if(!(e.isMesh||e.isPoints||e.isLine||e.isSprite))return;const t=e.material;if(t)if(Array.isArray(t))for(let r=0;r<t.length;r++){const s=t[r];Te(s,n,e),i.add(s)}else Te(t,n,e),i.add(t)})),v.pop(),m=null,i},this.compileAsync=function(e,t,n=null){const i=this.compile(e,t,n);return new Promise((t=>{function n(){i.forEach((function(e){J.get(e).currentProgram.isReady()&&i.delete(e)})),0!==i.size?setTimeout(n,10):t(e)}null!==Y.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)}))};let Ae=null;function Ce(){Pe.stop()}function Re(){Pe.start()}const Pe=new yS;function ke(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)m.pushLight(e),e.castShadow&&m.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||U.intersectsSprite(e)){i&&G.setFromMatrixPosition(e.matrixWorld).applyMatrix4(j);const t=re.update(e),r=e.material;r.visible&&f.push(e,t,r,n,G.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||U.intersectsObject(e))){const t=re.update(e),r=e.material;if(i&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),G.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),G.copy(t.boundingSphere.center)),G.applyMatrix4(e.matrixWorld).applyMatrix4(j)),Array.isArray(r)){const i=t.groups;for(let s=0,a=i.length;s<a;s++){const a=i[s],o=r[a.materialIndex];o&&o.visible&&f.push(e,t,o,n,G.z,a)}}else r.visible&&f.push(e,t,r,n,G.z,null)}const r=e.children;for(let e=0,s=r.length;e<s;e++)ke(r[e],t,n,i)}function Ie(e,t,n,i){const r=e.opaque,s=e.transmissive,a=e.transparent;m.setupLightsView(n),!0===F&&ce.setGlobalState(y.clippingPlanes,n),i&&Z.viewport(E.copy(i)),r.length>0&&Le(r,t,n),s.length>0&&Le(s,t,n),a.length>0&&Le(a,t,n),Z.buffers.depth.setTest(!0),Z.buffers.depth.setMask(!0),Z.buffers.color.setMask(!0),Z.setPolygonOffset(!1)}function Oe(e,t,n,i){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;void 0===m.state.transmissionRenderTarget[i.id]&&(m.state.transmissionRenderTarget[i.id]=new IS(1,1,{generateMipmaps:!0,type:Y.has("EXT_color_buffer_half_float")||Y.has("EXT_color_buffer_float")?ti:Zn,minFilter:$n,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:so.workingColorSpace}));const s=m.state.transmissionRenderTarget[i.id],a=i.viewport||E;s.setSize(a.z,a.w);const o=y.getRenderTarget();y.setRenderTarget(s),y.getClearColor(C),R=y.getClearAlpha(),R<1&&y.setClearColor(16777215,.5),y.clear(),X&&he.render(n);const l=y.toneMapping;y.toneMapping=0;const c=i.viewport;if(void 0!==i.viewport&&(i.viewport=void 0),m.setupLightsView(i),!0===F&&ce.setGlobalState(y.clippingPlanes,i),Le(e,n,i),Q.updateMultisampleRenderTarget(s),Q.updateRenderTargetMipmap(s),!1===Y.has("WEBGL_multisampled_render_to_texture")){let e=!1;for(let r=0,s=t.length;r<s;r++){const s=t[r],a=s.object,o=s.geometry,l=s.material,c=s.group;if(2===l.side&&a.layers.test(i.layers)){const t=l.side;l.side=1,l.needsUpdate=!0,Ne(a,n,i,o,l,c),l.side=t,l.needsUpdate=!0,e=!0}}!0===e&&(Q.updateMultisampleRenderTarget(s),Q.updateRenderTargetMipmap(s))}y.setRenderTarget(o),y.setClearColor(C,R),void 0!==c&&(i.viewport=c),y.toneMapping=l}function Le(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,s=e.length;r<s;r++){const s=e[r],a=s.object,o=s.geometry,l=null===i?s.material:i,c=s.group;a.layers.test(n.layers)&&Ne(a,t,n,o,l,c)}}function Ne(e,t,n,i,r,s){e.onBeforeRender(y,t,n,i,r,s),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(y,t,n,i,e,s),!0===r.transparent&&2===r.side&&!1===r.forceSinglePass?(r.side=1,r.needsUpdate=!0,y.renderBufferDirect(n,t,i,r,e,s),r.side=0,r.needsUpdate=!0,y.renderBufferDirect(n,t,i,r,e,s),r.side=2):y.renderBufferDirect(n,t,i,r,e,s),e.onAfterRender(y,t,n,i,r,s)}function De(e,t,n){!0!==t.isScene&&(t=W);const i=J.get(e),r=m.state.lights,s=m.state.shadowsArray,a=r.state.version,o=se.getParameters(e,r.state,s,t,n),l=se.getProgramCacheKey(o);let c=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?te:ee).get(e.envMap||i.environment),i.envMapRotation=null!==i.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===c&&(e.addEventListener("dispose",Ee),c=new Map,i.programs=c);let u=c.get(l);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===a)return Ue(e,o),u}else o.uniforms=se.getUniforms(e),e.onBeforeCompile(o,y),u=se.acquireProgram(o,l),c.set(l,u),i.uniforms=o.uniforms;const h=i.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=ce.uniform),Ue(e,o),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=a,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotLightMatrix.value=r.state.spotLightMatrix,h.spotLightMap.value=r.state.spotLightMap,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix),i.currentProgram=u,i.uniformsList=null,u}function ze(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=pE.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function Ue(e,t){const n=J.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.batchingColor=t.batchingColor,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.instancingMorph=t.instancingMorph,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Pe.setAnimationLoop((function(e){Ae&&Ae(e)})),"undefined"!=typeof self&&Pe.setContext(self),this.setAnimationLoop=function(e){Ae=e,_e.setAnimationLoop(e),null===e?Pe.stop():Pe.start()},_e.addEventListener("sessionstart",Ce),_e.addEventListener("sessionend",Re),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===b)return;if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===_e.enabled&&!0===_e.isPresenting&&(!0===_e.cameraAutoUpdate&&_e.updateCamera(t),t=_e.getCamera()),!0===e.isScene&&e.onBeforeRender(y,e,t,w),m=le.get(e,v.length),m.init(t),v.push(m),j.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),U.setFromProjectionMatrix(j),B=this.localClippingEnabled,F=ce.init(this.clippingPlanes,B),f=oe.get(e,g.length),f.init(),g.push(f),!0===_e.enabled&&!0===_e.isPresenting){const e=y.xr.getDepthSensingMesh();null!==e&&ke(e,t,-1/0,y.sortObjects)}ke(e,t,0,y.sortObjects),f.finish(),!0===y.sortObjects&&f.sort(O,L),X=!1===_e.enabled||!1===_e.isPresenting||!1===_e.hasDepthSensing(),X&&he.addToRenderList(f,e),this.info.render.frame++,!0===F&&ce.beginShadows();const n=m.state.shadowsArray;ue.render(n,e,t),!0===F&&ce.endShadows(),!0===this.info.autoReset&&this.info.reset();const i=f.opaque,r=f.transmissive;if(m.setupLights(),t.isArrayCamera){const n=t.cameras;if(r.length>0)for(let t=0,s=n.length;t<s;t++)Oe(i,r,e,n[t]);X&&he.render(e);for(let t=0,i=n.length;t<i;t++){const i=n[t];Ie(f,e,i,i.viewport)}}else r.length>0&&Oe(i,r,e,t),X&&he.render(e),Ie(f,e,t);null!==w&&(Q.updateMultisampleRenderTarget(w),Q.updateRenderTargetMipmap(w)),!0===e.isScene&&e.onAfterRender(y,e,t),ge.resetDefaultState(),S=-1,M=null,v.pop(),v.length>0?(m=v[v.length-1],!0===F&&ce.setGlobalState(y.clippingPlanes,m.state.camera)):m=null,g.pop(),f=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return _},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(e,t,n){J.get(e.texture).__webglTexture=t,J.get(e.depthTexture).__webglTexture=n;const i=J.get(e);i.__hasExternalTextures=!0,i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===Y.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(e,t){const n=J.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){w=e,x=t,_=n;let i=!0,r=null,s=!1,a=!1;if(e){const o=J.get(e);if(void 0!==o.__useDefaultFramebuffer)Z.bindFramebuffer(ye.FRAMEBUFFER,null),i=!1;else if(void 0===o.__webglFramebuffer)Q.setupRenderTarget(e);else if(o.__hasExternalTextures)Q.rebindTextures(e,J.get(e.texture).__webglTexture,J.get(e.depthTexture).__webglTexture);else if(e.depthBuffer){const t=e.depthTexture;if(o.__boundDepthTexture!==t){if(null!==t&&J.has(t)&&(e.width!==t.image.width||e.height!==t.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Q.setupDepthRenderbuffer(e)}}const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(a=!0);const c=J.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=Array.isArray(c[t])?c[t][n]:c[t],s=!0):r=e.samples>0&&!1===Q.useMultisampledRTT(e)?J.get(e).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,E.copy(e.viewport),T.copy(e.scissor),A=e.scissorTest}else E.copy(N).multiplyScalar(I).floor(),T.copy(D).multiplyScalar(I).floor(),A=z;if(Z.bindFramebuffer(ye.FRAMEBUFFER,r)&&i&&Z.drawBuffers(e,r),Z.viewport(E),Z.scissor(T),Z.setScissorTest(A),s){const i=J.get(e.texture);ye.framebufferTexture2D(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.__webglTexture,n)}else if(a){const i=J.get(e.texture),r=t||0;ye.framebufferTextureLayer(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,i.__webglTexture,n||0,r)}S=-1},this.readRenderTargetPixels=function(e,t,n,i,r,s,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=J.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){Z.bindFramebuffer(ye.FRAMEBUFFER,o);try{const a=e.texture,o=a.format,l=a.type;if(!$.textureFormatReadable(o))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!$.textureTypeReadable(l))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&ye.readPixels(t,n,i,r,me.convert(o),me.convert(l),s)}finally{const e=null!==w?J.get(w).__webglFramebuffer:null;Z.bindFramebuffer(ye.FRAMEBUFFER,e)}}},this.readRenderTargetPixelsAsync=async function(e,t,n,i,r,s,a){if(!e||!e.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=J.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){const a=e.texture,l=a.format,c=a.type;if(!$.textureFormatReadable(l))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!$.textureTypeReadable(c))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r){Z.bindFramebuffer(ye.FRAMEBUFFER,o);const e=ye.createBuffer();ye.bindBuffer(ye.PIXEL_PACK_BUFFER,e),ye.bufferData(ye.PIXEL_PACK_BUFFER,s.byteLength,ye.STREAM_READ),ye.readPixels(t,n,i,r,me.convert(l),me.convert(c),0);const a=null!==w?J.get(w).__webglFramebuffer:null;Z.bindFramebuffer(ye.FRAMEBUFFER,a);const u=ye.fenceSync(ye.SYNC_GPU_COMMANDS_COMPLETE,0);return ye.flush(),await function(e,t){return new Promise((function(n,i){setTimeout((function r(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:i();break;case e.TIMEOUT_EXPIRED:setTimeout(r,4);break;default:n()}}),4)}))}(ye,u),ye.bindBuffer(ye.PIXEL_PACK_BUFFER,e),ye.getBufferSubData(ye.PIXEL_PACK_BUFFER,0,s),ye.deleteBuffer(e),ye.deleteSync(u),s}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(e,t=null,n=0){!0!==e.isTexture&&(Co("WebGLRenderer: copyFramebufferToTexture function signature has changed."),t=arguments[0]||null,e=arguments[1]);const i=Math.pow(2,-n),r=Math.floor(e.image.width*i),s=Math.floor(e.image.height*i),a=null!==t?t.x:0,o=null!==t?t.y:0;Q.setTexture2D(e,0),ye.copyTexSubImage2D(ye.TEXTURE_2D,n,0,0,a,o,r,s),Z.unbindTexture()},this.copyTextureToTexture=function(e,t,n=null,i=null,r=0){let s,a,o,l,c,u;!0!==e.isTexture&&(Co("WebGLRenderer: copyTextureToTexture function signature has changed."),i=arguments[0]||null,e=arguments[1],t=arguments[2],r=arguments[3]||0,n=null),null!==n?(s=n.max.x-n.min.x,a=n.max.y-n.min.y,o=n.min.x,l=n.min.y):(s=e.image.width,a=e.image.height,o=0,l=0),null!==i?(c=i.x,u=i.y):(c=0,u=0);const h=me.convert(t.format),d=me.convert(t.type);Q.setTexture2D(t,0),ye.pixelStorei(ye.UNPACK_FLIP_Y_WEBGL,t.flipY),ye.pixelStorei(ye.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),ye.pixelStorei(ye.UNPACK_ALIGNMENT,t.unpackAlignment);const p=ye.getParameter(ye.UNPACK_ROW_LENGTH),f=ye.getParameter(ye.UNPACK_IMAGE_HEIGHT),m=ye.getParameter(ye.UNPACK_SKIP_PIXELS),g=ye.getParameter(ye.UNPACK_SKIP_ROWS),v=ye.getParameter(ye.UNPACK_SKIP_IMAGES),y=e.isCompressedTexture?e.mipmaps[r]:e.image;ye.pixelStorei(ye.UNPACK_ROW_LENGTH,y.width),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,y.height),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,o),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,l),e.isDataTexture?ye.texSubImage2D(ye.TEXTURE_2D,r,c,u,s,a,h,d,y.data):e.isCompressedTexture?ye.compressedTexSubImage2D(ye.TEXTURE_2D,r,c,u,y.width,y.height,h,y.data):ye.texSubImage2D(ye.TEXTURE_2D,r,c,u,s,a,h,d,y),ye.pixelStorei(ye.UNPACK_ROW_LENGTH,p),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,f),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,m),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,g),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,v),0===r&&t.generateMipmaps&&ye.generateMipmap(ye.TEXTURE_2D),Z.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n=null,i=null,r=0){let s,a,o,l,c,u,h,d,p;!0!==e.isTexture&&(Co("WebGLRenderer: copyTextureToTexture3D function signature has changed."),n=arguments[0]||null,i=arguments[1]||null,e=arguments[2],t=arguments[3],r=arguments[4]||0);const f=e.isCompressedTexture?e.mipmaps[r]:e.image;null!==n?(s=n.max.x-n.min.x,a=n.max.y-n.min.y,o=n.max.z-n.min.z,l=n.min.x,c=n.min.y,u=n.min.z):(s=f.width,a=f.height,o=f.depth,l=0,c=0,u=0),null!==i?(h=i.x,d=i.y,p=i.z):(h=0,d=0,p=0);const m=me.convert(t.format),g=me.convert(t.type);let v;if(t.isData3DTexture)Q.setTexture3D(t,0),v=ye.TEXTURE_3D;else{if(!t.isDataArrayTexture&&!t.isCompressedArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Q.setTexture2DArray(t,0),v=ye.TEXTURE_2D_ARRAY}ye.pixelStorei(ye.UNPACK_FLIP_Y_WEBGL,t.flipY),ye.pixelStorei(ye.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),ye.pixelStorei(ye.UNPACK_ALIGNMENT,t.unpackAlignment);const y=ye.getParameter(ye.UNPACK_ROW_LENGTH),b=ye.getParameter(ye.UNPACK_IMAGE_HEIGHT),x=ye.getParameter(ye.UNPACK_SKIP_PIXELS),_=ye.getParameter(ye.UNPACK_SKIP_ROWS),w=ye.getParameter(ye.UNPACK_SKIP_IMAGES);ye.pixelStorei(ye.UNPACK_ROW_LENGTH,f.width),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,f.height),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,l),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,c),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,u),e.isDataTexture||e.isData3DTexture?ye.texSubImage3D(v,r,h,d,p,s,a,o,m,g,f.data):t.isCompressedArrayTexture?ye.compressedTexSubImage3D(v,r,h,d,p,s,a,o,m,f.data):ye.texSubImage3D(v,r,h,d,p,s,a,o,m,g,f),ye.pixelStorei(ye.UNPACK_ROW_LENGTH,y),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,b),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,x),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,_),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,w),0===r&&t.generateMipmaps&&ye.generateMipmap(v),Z.unbindTexture()},this.initRenderTarget=function(e){void 0===J.get(e).__webglFramebuffer&&Q.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?Q.setTextureCube(e,0):e.isData3DTexture?Q.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?Q.setTexture2DArray(e,0):Q.setTexture2D(e,0),Z.unbindTexture()},this.resetState=function(){x=0,_=0,w=null,Z.reset(),ge.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return lr}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===Xi?"display-p3":"srgb",t.unpackColorSpace=so.workingColorSpace===qi?"display-p3":"srgb"}}const hT={name:"TriangleBlurShader",uniforms:{texture:{value:null},delta:{value:new nu(1,1)}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\n\t\t#define ITERATIONS 10.0\n\n\t\tuniform sampler2D texture;\n\t\tuniform vec2 delta;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 color = vec4( 0.0 );\n\n\t\t\tfloat total = 0.0;\n\n\t\t// randomize the lookup values to hide the fixed number of samples\n\n\t\t\tfloat offset = rand( vUv );\n\n\t\t\tfor ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {\n\n\t\t\t\tfloat percent = ( t + offset - 0.5 ) / ITERATIONS;\n\t\t\t\tfloat weight = 1.0 - abs( percent );\n\n\t\t\t\tcolor += texture2D( texture, vUv + delta * percent ) * weight;\n\t\t\t\ttotal += weight;\n\n\t\t\t}\n\n\t\t\tgl_FragColor = color / total;\n\n\t\t}"};globalThis.navigator||(globalThis.navigator={});class dT{static createButton(e,t={}){const n=document.createElement("button");function i(){n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null}function r(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return n.id="VRButton",n.style.display="none",r(n),navigator.xr.isSessionSupported("immersive-vr").then((function(r){r?function(){let i=null;async function r(t){t.addEventListener("end",s),await e.xr.setSession(t),n.textContent="EXIT VR",i=t}function s(){i.removeEventListener("end",s),n.textContent="ENTER VR",i=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="ENTER VR";const a={...t,optionalFeatures:["local-floor","bounded-floor","layers",...t.optionalFeatures||[]]};n.onmouseenter=function(){n.style.opacity="1.0"},n.onmouseleave=function(){n.style.opacity="0.5"},n.onclick=function(){null===i?navigator.xr.requestSession("immersive-vr",a).then(r):(i.end(),void 0!==navigator.xr.offerSession&&navigator.xr.offerSession("immersive-vr",a).then(r).catch((e=>{console.warn(e)})))},void 0!==navigator.xr.offerSession&&navigator.xr.offerSession("immersive-vr",a).then(r).catch((e=>{console.warn(e)}))}():(i(),n.textContent="VR NOT SUPPORTED"),r&&dT.xrSessionIsGranted&&n.click()})).catch((function(e){i(),console.warn("Exception when trying to call xr.isSessionSupported",e),n.textContent="VR NOT ALLOWED"})),n;{const e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",r(e),e}}static registerSessionGrantedListener(){if("undefined"!=typeof navigator&&"xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",(()=>{dT.xrSessionIsGranted=!0}))}}}dT.xrSessionIsGranted=!1,dT.registerSessionGrantedListener();var pT=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},fT=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let mT=null,gT=!1,vT=(()=>{let e,t,n,i=[Ge],r=[],s=[],a=[];var o=class{static{t=this}static{const l="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;n=[Ue],pT(null,null,n,{kind:"field",name:"localClippingEnabled",static:!1,private:!1,access:{has:e=>"localClippingEnabled"in e,get:e=>e.localClippingEnabled,set:(e,t)=>{e.localClippingEnabled=t}},metadata:l},s,a),pT(null,e={value:t},i,{kind:"class",name:t.name,metadata:l},null,r),o=t=e.value,l&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:l}),fT(t,r)}static singleton(){if(mT)return mT;try{return gT=!0,mT=new o}catch(e){throw e}finally{gT=!1}}constructor(){if(!gT)throw new Error("class is a singleton, use the static .singleton() method to get an instance")}sceneStates=new WeakMap;localClippingEnabled=fT(this,s,!1);initialized(e){return this.sceneStates.has(e)}initialize(e){let t=this.sceneStates.get(e);if(t)return;const n=new uT({alpha:!0,premultipliedAlpha:!0,antialias:!0}),i=new qe;i.createEffect((()=>{n.localClippingEnabled=this.localClippingEnabled})),n.xr.enabled=!0,n.setPixelRatio(globalThis.devicePixelRatio),n.shadowMap.enabled=!0,n.shadowMap.type=2,this.sceneStates.set(e,t={renderer:n,effects:i}),e._glLayer.appendChild(n.domElement)}uninitialize(e){const t=this.sceneStates.get(e);t&&(e._glLayer?.removeChild(t.renderer.domElement),t.renderer.dispose(),t.pmremgen?.dispose(),t.effects.stopEffects(),this.sceneStates.delete(e))}drawScene(e){const t=this.sceneStates.get(e);if(!t)throw new ReferenceError("Can not draw scene. Scene state should be initialized first.");const{renderer:n}=t;n.render(e.three,e.threeCamera)}updateResolution(e,t,n){Kr.once((()=>{this.initialized(e)&&this.sceneStates.get(e).renderer.setSize(t,n)}),!1)}setClearColor(e,t,n){const i=this.sceneStates.get(e);if(!i)throw new ReferenceError("Unable to set clear color. Scene state should be initialized first.");i.renderer.setClearColor(t,n)}setClearAlpha(e,t){const n=this.sceneStates.get(e);if(!n)throw new ReferenceError("Unable to set clear alpha. Scene state should be initialized first.");n.renderer.setClearAlpha(t)}setShadowMapType(e,t){const n=this.sceneStates.get(e);if(!n)throw new ReferenceError("Unable to set clear alpha. Scene state should be initialized first.");t?"pcf"==(t=t.toLowerCase())?n.renderer.shadowMap.type=1:"pcfsoft"==t?n.renderer.shadowMap.type=2:"basic"==t&&(n.renderer.shadowMap.type=0):n.renderer.shadowMap.type=1}#En=(fT(this,a),0);enableBackground(e,t,n,i){const r=this.sceneStates.get(e);if(!r)throw new ReferenceError("Internal error: Scene not registered with WebGLRendererThree.");this.#En+=1,r.bgIsEquirectangular=t,t&&(r.pmremgen||(r.pmremgen=new YS(r.renderer),r.pmremgen.compileCubemapShader())),r.hasBg=!0,this.#Tn(e,n,i)}disableBackground(e){const t=this.sceneStates.get(e);if(!t)throw new ReferenceError("Internal error: Scene not registered with WebGLRendererThree.");this.#En+=1,t.hasBg||t.hasEnv||(t.pmremgen?.dispose(),t.pmremgen=void 0),t.bgTexture?.dispose(),t.hasBg=!1}#Tn(e,t,n){const i=this.sceneStates.get(e);if(!i)throw new ReferenceError("Internal error: Scene not registered with WebGLRendererThree.");const r=this.#En;(new Rv).load(e.background??"",(e=>{r===this.#En&&(t>0&&(i.bgTexture=function(e,t,n=.1,i=1,r=10){const s=t.image.width,a=t.image.height,o=new fy(-1,1,1,-1,0,1),l=new rx,c=new IS(s,a),u=new IS(s,a),h=function(e=10){const{texture:t,...n}=hT.uniforms,i={...hT,name:"TriangleBlurShader2",uniforms:{...n,blurTexture:{value:null}}};return i.fragmentShader=i.fragmentShader.replace("uniform sampler2D texture;","uniform sampler2D blurTexture;"),i.fragmentShader=i.fragmentShader.replace("texture2D( texture","texture2D( blurTexture"),i.fragmentShader=i.fragmentShader.replace("#define ITERATIONS 10.0","#define ITERATIONS "+e+".0"),i}(r),d=new Py({vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,uniforms:Ay.clone(h.uniforms)});d.uniforms.delta.value=new da(1,1);const p=new bc(2,2),f=new Yo(p,d);l.add(f);let m=t;for(;i--;)d.uniforms.blurTexture.value=m,d.uniforms.delta.value=new da(n,0),e.setRenderTarget(c),e.render(l,o),e.setRenderTarget(null),m=c.texture,d.uniforms.blurTexture.value=m,d.uniforms.delta.value=new da(0,n),e.setRenderTarget(u),e.render(l,o),e.setRenderTarget(null),m=u.texture;return m}(i.renderer,e,t,2),e.dispose(),e=i.bgTexture),i.bgIsEquirectangular?(i.bgTexture=i.pmremgen.fromEquirectangular(e).texture,e.dispose()):i.bgTexture=e,n(i.bgTexture))}))}#An=0;enableEnvironment(e,t){const n=this.sceneStates.get(e);if(!n)throw new ReferenceError("Internal error: Scene not registered with WebGLRendererThree.");this.#An+=1,n.pmremgen||(n.pmremgen=new YS(n.renderer),n.pmremgen.compileCubemapShader()),n.hasEnv=!0,this.#Cn(e,t)}disableEnvironment(e){const t=this.sceneStates.get(e);if(!t)throw new ReferenceError("Internal error: Scene not registered with WebGLRendererThree.");this.#An+=1,t.hasBg||t.hasEnv||(t.pmremgen?.dispose(),t.pmremgen=void 0),t.envTexture?.dispose(),t.hasEnv=!1}#Cn(e,t){const n=this.sceneStates.get(e);if(!n)throw new ReferenceError("Internal error: Scene not registered with WebGLRendererThree.");const i=this.#An;(new Rv).load(e.environment??"",(e=>{i===this.#An&&(n.envTexture=n.pmremgen.fromEquirectangular(e).texture,e.dispose(),t(n.envTexture))}))}requestFrame(e,t){const n=this.sceneStates.get(e);if(!n)throw new ReferenceError("Unable to request frame. Scene state should be initialized first.");const{renderer:i}=n;i.setAnimationLoop?i.setAnimationLoop(t):i.animate&&i.animate(t)}enableVR(e,t){const n=this.sceneStates.get(e);if(!n)throw new ReferenceError("Unable to enable XR. Scene state should be initialized first.");const{renderer:i}=n;i.xr.enabled=t}createDefaultVRButton(e){const t=this.sceneStates.get(e);if(!t)throw new ReferenceError("Unable to create XR button. Scene state should be initialized first.");const{renderer:n}=t;return dT.createButton(n)}};return o=t})(),yT=null,bT=!1;class xT{static singleton(){if(yT)return yT;try{return bT=!0,yT=new xT}catch(e){throw e}finally{bT=!1}}constructor(){if(!bT)throw new Error("class is a singleton, use the static .singleton() method to get an instance")}sceneStates=new WeakMap;initialized(e){return this.sceneStates.has(e)}initialize(e){let t=this.sceneStates.get(e);if(t)return;this.sceneStates.set(e,t={renderer:new Us});const{renderer:n}=t;e._cssLayer.appendChild(n.domElement)}uninitialize(e){const t=this.sceneStates.get(e);t&&(e._cssLayer?.removeChild(t.renderer.domElement),this.sceneStates.delete(e))}drawScene(e){const t=this.sceneStates.get(e);if(!t)throw new ReferenceError("Can not draw scene. Scene state should be initialized first.");const{renderer:n}=t;n.render(e.threeCSS,e.threeCamera)}updateResolution(e,t,n){Kr.once((()=>{this.initialized(e)&&this.sceneStates.get(e).renderer.setSize(t,n)}))}requestFrame(e,t){requestAnimationFrame(t)}}const _T=parseFloat("169");var wT=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0},ST=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},MT=function(e,t,n){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})};const ET=()=>` LUME ✨ v${JA} 👉 https://github.com/lume/lume `,TT=aa;let AT=(()=>{let e,t,n,i,r,s,a,o,l,c,u,h,d,p,f,m,g,v,y,b,x,_,w,S,M,E,T,A,C,R,k,I=[pt("lume-scene",oa)],N=[],D=TT,z=[],U=[],F=[],B=[],V=[],j=[],H=[],G=[],W=[],X=[],q=[],Y=[],$=[],Z=[],K=[],J=[],Q=[],ee=[],te=[],ne=[],ie=[],re=[],se=[],ae=[],oe=[],le=[],ce=[],ue=[],he=[],de=[],pe=[],fe=[],me=[],ge=[],ve=[],ye=[],be=[],xe=[],_e=[],we=[],Se=[],Me=[],Ee=[],Te=[],Ae=[],Ce=[],Re=[],Pe=[],ke=[];return class extends D{static{t=this}static{const P="function"==typeof Symbol&&Symbol.metadata?Object.create(D[Symbol.metadata]??null):void 0;n=[ht],i=[ht],r=[ht],s=[et],a=[et,tt],o=[et],l=[ht],c=[et],u=[ct],h=[et],d=[ct],p=[ct],f=[ht],m=[et],g=[ot],v=[ct],y=[ct],b=[ot],x=[ct],_=[ct],w=[ct],S=[ct],M=[Ue],T=[Ue],C=[Ue],R=[Ue],ST(this,null,a,{kind:"getter",name:"shadowmapType",static:!1,private:!1,access:{has:e=>"shadowmapType"in e,get:e=>e.shadowmapType},metadata:P},null,z),ST(this,null,o,{kind:"setter",name:"shadowmapType",static:!1,private:!1,access:{has:e=>"shadowmapType"in e,set:(e,t)=>{e.shadowmapType=t}},metadata:P},null,z),ST(this,E={get:MT((function(){return this.#Rn}),"#defaultThreeCamera","get"),set:MT((function(e){this.#Rn=e}),"#defaultThreeCamera","set")},M,{kind:"accessor",name:"#defaultThreeCamera",static:!1,private:!0,access:{has:e=>#Pn in e,get:e=>e.#Pn,set:(e,t)=>{e.#Pn=t}},metadata:P},Me,Ee),ST(this,A={get:MT((function(){return this.#kn}),"#camera","get"),set:MT((function(e){this.#kn=e}),"#camera","set")},T,{kind:"accessor",name:"#camera",static:!1,private:!0,access:{has:e=>#Lt in e,get:e=>e.#Lt,set:(e,t)=>{e.#Lt=t}},metadata:P},Te,Ae),ST(this,k={get:MT((function(){return this.#In}),"#elementParentSize","get"),set:MT((function(e){this.#In=e}),"#elementParentSize","set")},R,{kind:"accessor",name:"#elementParentSize",static:!1,private:!0,access:{has:e=>#On in e,get:e=>e.#On,set:(e,t)=>{e.#On=t}},metadata:P},Pe,ke),ST(null,null,n,{kind:"field",name:"enableCss",static:!1,private:!1,access:{has:e=>"enableCss"in e,get:e=>e.enableCss,set:(e,t)=>{e.enableCss=t}},metadata:P},U,F),ST(null,null,i,{kind:"field",name:"webgl",static:!1,private:!1,access:{has:e=>"webgl"in e,get:e=>e.webgl,set:(e,t)=>{e.webgl=t}},metadata:P},B,V),ST(null,null,r,{kind:"field",name:"swapLayers",static:!1,private:!1,access:{has:e=>"swapLayers"in e,get:e=>e.swapLayers,set:(e,t)=>{e.swapLayers=t}},metadata:P},j,H),ST(null,null,s,{kind:"field",name:"shadowMode",static:!1,private:!1,access:{has:e=>"shadowMode"in e,get:e=>e.shadowMode,set:(e,t)=>{e.shadowMode=t}},metadata:P},G,W),ST(null,null,l,{kind:"field",name:"vr",static:!1,private:!1,access:{has:e=>"vr"in e,get:e=>e.vr,set:(e,t)=>{e.vr=t}},metadata:P},X,q),ST(null,null,c,{kind:"field",name:"backgroundColor",static:!1,private:!1,access:{has:e=>"backgroundColor"in e,get:e=>e.backgroundColor,set:(e,t)=>{e.backgroundColor=t}},metadata:P},Y,$),ST(null,null,u,{kind:"field",name:"backgroundOpacity",static:!1,private:!1,access:{has:e=>"backgroundOpacity"in e,get:e=>e.backgroundOpacity,set:(e,t)=>{e.backgroundOpacity=t}},metadata:P},Z,K),ST(null,null,h,{kind:"field",name:"background",static:!1,private:!1,access:{has:e=>"background"in e,get:e=>e.background,set:(e,t)=>{e.background=t}},metadata:P},J,Q),ST(null,null,d,{kind:"field",name:"backgroundIntensity",static:!1,private:!1,access:{has:e=>"backgroundIntensity"in e,get:e=>e.backgroundIntensity,set:(e,t)=>{e.backgroundIntensity=t}},metadata:P},ee,te),ST(null,null,p,{kind:"field",name:"backgroundBlur",static:!1,private:!1,access:{has:e=>"backgroundBlur"in e,get:e=>e.backgroundBlur,set:(e,t)=>{e.backgroundBlur=t}},metadata:P},ne,ie),ST(null,null,f,{kind:"field",name:"equirectangularBackground",static:!1,private:!1,access:{has:e=>"equirectangularBackground"in e,get:e=>e.equirectangularBackground,set:(e,t)=>{e.equirectangularBackground=t}},metadata:P},re,se),ST(null,null,m,{kind:"field",name:"environment",static:!1,private:!1,access:{has:e=>"environment"in e,get:e=>e.environment,set:(e,t)=>{e.environment=t}},metadata:P},ae,oe),ST(null,null,g,{kind:"field",name:"fogMode",static:!1,private:!1,access:{has:e=>"fogMode"in e,get:e=>e.fogMode,set:(e,t)=>{e.fogMode=t}},metadata:P},le,ce),ST(null,null,v,{kind:"field",name:"fogNear",static:!1,private:!1,access:{has:e=>"fogNear"in e,get:e=>e.fogNear,set:(e,t)=>{e.fogNear=t}},metadata:P},ue,he),ST(null,null,y,{kind:"field",name:"fogFar",static:!1,private:!1,access:{has:e=>"fogFar"in e,get:e=>e.fogFar,set:(e,t)=>{e.fogFar=t}},metadata:P},de,pe),ST(null,null,b,{kind:"field",name:"fogColor",static:!1,private:!1,access:{has:e=>"fogColor"in e,get:e=>e.fogColor,set:(e,t)=>{e.fogColor=t}},metadata:P},fe,me),ST(null,null,x,{kind:"field",name:"fogDensity",static:!1,private:!1,access:{has:e=>"fogDensity"in e,get:e=>e.fogDensity,set:(e,t)=>{e.fogDensity=t}},metadata:P},ge,ve),ST(null,null,_,{kind:"field",name:"cameraNear",static:!1,private:!1,access:{has:e=>"cameraNear"in e,get:e=>e.cameraNear,set:(e,t)=>{e.cameraNear=t}},metadata:P},ye,be),ST(null,null,w,{kind:"field",name:"cameraFar",static:!1,private:!1,access:{has:e=>"cameraFar"in e,get:e=>e.cameraFar,set:(e,t)=>{e.cameraFar=t}},metadata:P},xe,_e),ST(null,null,S,{kind:"field",name:"perspective",static:!1,private:!1,access:{has:e=>"perspective"in e,get:e=>e.perspective,set:(e,t)=>{e.perspective=t}},metadata:P},we,Se),ST(null,null,C,{kind:"field",name:"localClipping",static:!1,private:!1,access:{has:e=>"localClipping"in e,get:e=>e.localClipping,set:(e,t)=>{e.localClipping=t}},metadata:P},Ce,Re),ST(null,e={value:t},I,{kind:"class",name:t.name,metadata:P},null,N),t=e.value,P&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:P})}isScene=(wT(this,z),!0);skipShadowObservation=this.isScene;enableCss=wT(this,U,!0);webgl=(wT(this,F),wT(this,B,!1));swapLayers=(wT(this,V),wT(this,j,!1));shadowMode=(wT(this,H),wT(this,G,"basic"));get shadowmapType(){return this.shadowMode}set shadowmapType(e){this.shadowMode=e}vr=(wT(this,W),wT(this,X,!1));backgroundColor=(wT(this,q),wT(this,Y,new po("white")));backgroundOpacity=(wT(this,$),wT(this,Z,0));background=(wT(this,K),wT(this,J,null));backgroundIntensity=(wT(this,Q),wT(this,ee,1));backgroundBlur=(wT(this,te),wT(this,ne,0));equirectangularBackground=(wT(this,ie),wT(this,re,!1));environment=(wT(this,se),wT(this,ae,null));fogMode=(wT(this,oe),wT(this,le,"none"));fogNear=(wT(this,ce),wT(this,ue,0));fogFar=(wT(this,he),wT(this,de,1e3));fogColor=(wT(this,pe),wT(this,fe,"gray"));fogDensity=(wT(this,me),wT(this,ge,.0025));cameraNear=(wT(this,ve),wT(this,ye,.1));cameraFar=(wT(this,be),wT(this,xe,1e4));perspective=(wT(this,_e),wT(this,we,iS));#Rn=(wT(this,Se),wT(this,Me,null));get#Pn(){return E.get.call(this)}set#Pn(e){return E.set.call(this,e)}get threeCamera(){return this.#Ln}#Ln=wT(this,Ee);get camera(){return this.#Lt}#Nn=null;get glRenderer(){return this.#Nn?.sceneStates.get(this)?.renderer}#Dn=null;get cssRenderer(){return this.#Dn?.sceneStates.get(this)?.renderer}#kn=wT(this,Te,null);get#Lt(){return A.get.call(this)}set#Lt(e){return A.set.call(this,e)}localClipping=(wT(this,Ae),wT(this,Ce,!1));get scene(){return this}constructor(){super(),this.sizeMode.set("proportional","proportional","literal"),this.size.set(1,1,0),this._elementOperations.shouldRender=!0,this._createDefaultCamera(),this._calcSize(),this.needsUpdate()}_glLayer=(wT(this,Re),null);_cssLayer=null;_miscLayer=null;drawScene(){this.#Nn?.drawScene(this),this.#Dn?.drawScene(this)}connectedCallback(){super.connectedCallback(),_T<144&&(this.three.autoUpdate=!1),this.three.matrixWorldAutoUpdate=!1,this.createEffect(this.glRendererEffect),this.createEffect(this.fogEffect),this.createEffect(this.cameraNearFarEffect),this.createEffect(this.cameraEffect),this.createEffect(this.cssRendererEffect),this.createEffect(this.parentSizeEffect),queueMicrotask((()=>this.shadowRoot.prepend(new Comment(ET()))))}glRendererEffect=()=>{this.webgl&&(this.#Nn=vT.singleton(),this.#Nn.initialize(this),L((()=>{this.#Nn.uninitialize(this),this.#Nn=null})),P((()=>{this.#Nn.localClippingEnabled=this.localClipping,this.needsUpdate()})),P((()=>{this.#Nn.setClearColor(this,this.backgroundColor,this.backgroundOpacity),this.needsUpdate()})),P((()=>{this.#Nn.setClearAlpha(this,this.backgroundOpacity),this.needsUpdate()})),P((()=>{this.#Nn.setShadowMapType(this,this.shadowMode),this.needsUpdate()})),P((()=>{if(this.#Nn.enableVR(this,this.vr),this.vr){Kr.setFrameRequester((e=>(this.#Nn.requestFrame(this,e),0)));const e=this.#Nn.createDefaultVRButton(this);e.classList.add("vrButton"),this._miscLayer.appendChild(e)}else this.xr;this.needsUpdate()})),P((()=>{this.webgl&&this.background&&(this.#Nn.enableBackground(this,this.equirectangularBackground,this.backgroundBlur,(e=>{this.three.background=e||null,this.needsUpdate()})),L((()=>{this.#Nn.disableBackground(this),this.needsUpdate()})))})),P((()=>{this.three.backgroundIntensity=this.backgroundIntensity,this.needsUpdate()})),P((()=>{this.webgl&&this.environment&&(this.environment.match(/\.(jpg|jpeg|png)$/)?(this.#Nn.enableEnvironment(this,(e=>{this.three.environment=e,this.needsUpdate()})),L((()=>{this.#Nn.disableEnvironment(this),this.needsUpdate()}))):console.warn(`<${this.tagName.toLowerCase()}> environment attribute ignored, the given image type is not currently supported.`))})),P((()=>{const{x:e,y:t}=this.calculatedSize;this.#Nn.updateResolution(this,e,t)})))};fogEffect=()=>{if("none"===this.fogMode)this.three.fog=null;else if("linear"===this.fogMode){const e=this.three.fog=new pS("deeppink");e.near=this.fogNear,e.far=this.fogFar,e.color.set(this.fogColor)}else if("expo2"===this.fogMode){const e=this.three.fog=new fS(new po("deeppink").getHex());e.color.set(this.fogColor),e.density=this.fogDensity}this.needsUpdate()};cameraNearFarEffect=()=>{const{cameraNear:e,cameraFar:t}=this;this.#Pn instanceof ly&&(this.#Pn.near=e,this.#Pn.far=t,this.needsUpdate())};cameraEffect=()=>{this._updateCameraAspect(),this._updateCameraPerspective(),this._updateCameraProjection(),this.needsUpdate()};parentSizeEffect=()=>{if(!this.webgl&&!this.enableCss)return;const{x:e,y:t}=this.sizeMode;"proportional"!==e&&"p"!==e&&"proportional"!==t&&"p"!==t||(this.#zn(),L((()=>{this.#Un()})))};cssRendererEffect=()=>{this.enableCss&&(this.#Dn=xT.singleton(),this.#Dn.initialize(this),L((()=>{this.#Dn.uninitialize(this),this.#Dn=null})),P((()=>{const{x:e,y:t}=this.calculatedSize;this.#Dn.updateResolution(this,e,t)})))};static observedAttributes=[...TT.observedAttributes||[],"slot"];attributeChangedCallback(e,t,n){super.attributeChangedCallback(e,t,n),"slot"===e&&queueMicrotask((()=>{throw new Error(`Assigning a <lume-scene> to a slot (slot="${n}") is not currently supported and may not work as expected. Instead, wrap the <lume-scene> in another element like a <div>, then assign the wrapper to the slot.`)}))}makeThreeObject3d(){return new rx}makeThreeCSSObject(){return new rx}traverseSceneGraph(e,t=!1){if(!t){for(const n of this.composedLumeChildren)n.traverseSceneGraph(e,t);return}let n=Promise.resolve();for(const i of this.composedLumeChildren)n=i.matches(":defined")?n.then((()=>i.traverseSceneGraph(e,t))):n.then((()=>customElements.whenDefined(i.tagName.toLowerCase()))).then((()=>i.traverseSceneGraph(e,t)));return n}_createDefaultCamera(){O((()=>{const e=this.calculatedSize;this.#Pn=this.#Ln=new ly(this.#Fn,e.x/e.y||1,.1,1e4),this.#Ln.name=`${this.tagName}${this.id?"#"+this.id:""} DEFAULT CAMERA (webgl, ${this.#Ln.type})`,this.perspective=this.perspective}))}get#Fn(){return 2*Math.atan(this.calculatedSize.y/2/this.perspective)*180/Math.PI}_updateCameraPerspective(){const e=this.perspective;this.#Pn instanceof ly&&(this.#Pn.fov=this.#Fn,this.#Pn.position.z=e)}_updateCameraAspect(){this.#Pn instanceof ly&&(this.#Pn.aspect=this.calculatedSize.x/this.calculatedSize.y||1)}_updateCameraProjection(){this.#Pn instanceof ly&&this.#Pn.updateProjectionMatrix()}#Bn;_addCamera(e){this.#Bn||(this.#Bn=new Set),this.#Bn.add(e),this.#Vn(e)}_removeCamera(e){this.#Bn&&(this.#Bn.delete(e),this.#Bn.size?(this.#Bn.forEach((t=>e=t)),this.#Vn(e)):(this.#Bn=void 0,this.#Vn()))}get parentSize(){return this.composedLumeParent?.calculatedSize??this.#On}#Vn(e){e?(this.#Pn=null,this.#Ln=e.three,this.#Lt=e,this._updateCameraAspect(),this._updateCameraProjection(),this.needsUpdate()):(this._createDefaultCamera(),this.#Lt=null)}#In=wT(this,Pe,{x:0,y:0,z:0});get#On(){return k.get.call(this)}set#On(e){return k.set.call(this,e)}#jn=(wT(this,ke),null);#zn(){const e=this.composedParent;if(!e)throw new Error("A Scene can only be child of HTMLElement or ShadowRoot (f.e. not an SVGElement).");this.#jn=new ResizeObserver((t=>{for(const n of t)if(n.contentBoxSize){const t=n.contentBoxSize[0]||n.contentBoxSize,{inlineSize:i,blockSize:r}=t;getComputedStyle(e).writingMode.includes("horizontal")?this.#Hn(i,r):this.#Hn(r,i)}else{const{width:e,height:t}=n.contentRect;this.#Hn(e,t)}})),this.#jn.observe(e)}#Un(){this.#jn?.disconnect(),this.#jn=null}#Hn(e,t){const n=this.#On;n.x==e&&n.y==t||(n.x=e,n.y=t,this.#On=n)}template=()=>Vw`
		<div class="container">
			<div
				ref=${e=>this._cssLayer=e}
				class="CSS3DLayer"
				style=${()=>this.swapLayers?"z-index: 1":""}
			>
				${""}
			</div>

			<div ref=${e=>this._glLayer=e} class="WebGLLayer">
				${""}
			</div>

			<div ref=${e=>this._miscLayer=e} class="MiscellaneousLayer">
				${""}
				<slot name="misc"></slot>
			</div>
		</div>
	`;static css=`\n\t\t${Reflect.get(D,"css",t)}\n\n\t\t:host {\n\t\t\t/*\n\t\t\t * A Scene is strict: it does not leak content, its rendering is not\n\t\t\t * affected by external layout, and its size is not affected by its\n\t\t\t * content. It is an absolutely contained drawing area.\n\t\t\t */\n\t\t\tcontain: size layout paint; /*fallback, TODO remove once Safari is caught up*/\n\t\t\tcontain: strict; /*override*/\n\t\t\toverflow: hidden;\n\n\t\t\t/* Prevent default browser behaviors like drag-and-drop to avoid pointercancel interfering with interaction features. */\n\t\t\ttouch-action: none;\n\t\t}\n\n\t\t/* The purpose of this is to contain the position:absolute layers so they don't break out of the Scene layout. */\n\t\t.container {\n\t\t\tposition: relative\n\t\t}\n\n\t\t.container,\n\t\t.CSS3DLayer,\n\t\t.MiscellaneousLayer,\n\t\t.WebGLLayer,\n\t\t.WebGLLayer > canvas  {\n\t\t\tmargin: 0; padding: 0;\n\t\t\twidth: 100%; height: 100%;\n\t\t\tdisplay: block;\n\t\t}\n\n\t\t.CSS3DLayer,\n\t\t.MiscellaneousLayer,\n\t\t.WebGLLayer {\n\t\t\t/* make sure all layers are stacked on top of each other */\n\t\t\tposition: absolute; top: 0; left: 0;\n\t\t}\n\n\t\t.CSS3DLayer {\n\t\t\ttransform-style: preserve-3d;\n\t\t}\n\n\t\t.container {\n\t\t\tpointer-events: none;\n\t\t}\n\n\t\t.MiscellaneousLayer > * {\n\t\t\t/* Allow children of the Misc layer to have pointer events.\tNeeded for the WebXR button, for example */\n\t\t\tpointer-events: auto;\n\t\t}\n\n\t\t/*\n\t\t * This trick is needed in Firefox to remove pointer events from the\n\t\t * transparent cameraElement from interfering with pointer events on the\n\t\t * scene objects. We do not wish to interact with this element anyway, as\n\t\t * it serves only for positioning the view.\n\t\t */\n\t\t.cameraElement > * {\n\t\t\tpointer-events: auto;\n\t\t}\n\n\t\t.vrButton {\n\t\t\tcolor: black;\n\t\t\tborder-color: black;\n\t\t}\n\t`;static{wT(t,N)}},t})();AT.prototype.isScene=!0,queueMicrotask((()=>{try{console.info(ET())}catch(e){}}));var CT=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},RT=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};(()=>{let e,t,n,i,r,s,a,o,l=[pt("flickering-orb",oa)],c=[],u=ua,h=[],d=[],p=[],f=[],m=[],g=[],v=[],y=[],b=[],x=[],_=[],w=[];(class extends u{static{t=this}static{const S="function"==typeof Symbol&&Symbol.metadata?Object.create(u[Symbol.metadata]??null):void 0;n=[ot],i=[ct],r=[ct],s=[ct],a=[ct],o=[ct],CT(null,null,n,{kind:"field",name:"color",static:!1,private:!1,access:{has:e=>"color"in e,get:e=>e.color,set:(e,t)=>{e.color=t}},metadata:S},h,d),CT(null,null,i,{kind:"field",name:"intensity",static:!1,private:!1,access:{has:e=>"intensity"in e,get:e=>e.intensity,set:(e,t)=>{e.intensity=t}},metadata:S},p,f),CT(null,null,r,{kind:"field",name:"shadowBias",static:!1,private:!1,access:{has:e=>"shadowBias"in e,get:e=>e.shadowBias,set:(e,t)=>{e.shadowBias=t}},metadata:S},m,g),CT(null,null,s,{kind:"field",name:"flickerRange",static:!1,private:!1,access:{has:e=>"flickerRange"in e,get:e=>e.flickerRange,set:(e,t)=>{e.flickerRange=t}},metadata:S},v,y),CT(null,null,a,{kind:"field",name:"shadowMapWidth",static:!1,private:!1,access:{has:e=>"shadowMapWidth"in e,get:e=>e.shadowMapWidth,set:(e,t)=>{e.shadowMapWidth=t}},metadata:S},b,x),CT(null,null,o,{kind:"field",name:"shadowMapHeight",static:!1,private:!1,access:{has:e=>"shadowMapHeight"in e,get:e=>e.shadowMapHeight,set:(e,t)=>{e.shadowMapHeight=t}},metadata:S},_,w),CT(null,e={value:t},l,{kind:"class",name:t.name,metadata:S},null,c),t=e.value,S&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:S}),RT(t,c)}color=RT(this,h,"royalblue");intensity=(RT(this,d),RT(this,p,1.3));shadowBias=(RT(this,f),RT(this,m,0));flickerRange=(RT(this,g),RT(this,v,.4));shadowMapWidth=(RT(this,y),RT(this,b,512));shadowMapHeight=(RT(this,x),RT(this,_,512));light=RT(this,w);sphere;template=()=>Vw`
		<lume-point-light
			ref=${e=>this.light=e}
			color=${()=>this.color}
			intensity=${()=>this.intensity}
			shadow-bias=${()=>this.shadowBias}
			shadow-map-width=${()=>this.shadowMapWidth}
			shadow-map-height=${()=>this.shadowMapHeight}
		>
			<lume-sphere
				ref=${e=>this.sphere=e}
				has="basic-material"
				color=${()=>this.color}
				opacity="0.5"
				mount-point="0.5 0.5 0.5"
				size="10 10 10"
				cast-shadow="false"
				receive-shadow="false"
			></lume-sphere>
		</lume-point-light>
	`;connectedCallback(){super.connectedCallback();const e=this.intensity,t=this.opacity,n=()=>{const i=Math.random()-1;this.light.intensity=e+i*this.flickerRange,this.sphere.opacity=t+.4*i,setTimeout((()=>Kr.once(n)),100*Math.random())};Kr.once(n)}})})();var PT=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},kT=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};(()=>{let e,t,n,i,r,s,a=[pt("flickering-orbs",oa)],o=[],l=ua,c=[],u=[],h=[],d=[],p=[],f=[],m=[],g=[];(class extends l{static{t=this}static{const v="function"==typeof Symbol&&Symbol.metadata?Object.create(l[Symbol.metadata]??null):void 0;n=[ct],i=[ct],r=[ct],s=[et],PT(null,null,n,{kind:"field",name:"shadowBias",static:!1,private:!1,access:{has:e=>"shadowBias"in e,get:e=>e.shadowBias,set:(e,t)=>{e.shadowBias=t}},metadata:v},c,u),PT(null,null,i,{kind:"field",name:"intensity",static:!1,private:!1,access:{has:e=>"intensity"in e,get:e=>e.intensity,set:(e,t)=>{e.intensity=t}},metadata:v},h,d),PT(null,null,r,{kind:"field",name:"flickerRange",static:!1,private:!1,access:{has:e=>"flickerRange"in e,get:e=>e.flickerRange,set:(e,t)=>{e.flickerRange=t}},metadata:v},p,f),PT(null,null,s,{kind:"field",name:"color",static:!1,private:!1,access:{has:e=>"color"in e,get:e=>e.color,set:(e,t)=>{e.color=t}},metadata:v},m,g),PT(null,e={value:t},a,{kind:"class",name:t.name,metadata:v},null,o),t=e.value,v&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:v}),kT(t,o)}shadowBias=kT(this,c,0);intensity=(kT(this,u),kT(this,h,1.3));flickerRange=(kT(this,d),kT(this,p,.4));color=(kT(this,f),kT(this,m,null));template=(kT(this,g),()=>Vw`
		<flickering-orb flicker-range=${()=>this.flickerRange} intensity=${()=>this.intensity} shadow-bias=${()=>this.shadowBias} color=${()=>this.color??"yellow"} position="500 0 0"></flickering-orb>
		<flickering-orb flicker-range=${()=>this.flickerRange} intensity=${()=>this.intensity} shadow-bias=${()=>this.shadowBias} color=${()=>this.color??"deeppink"} position="-500 0 0"></flickering-orb>
		<flickering-orb flicker-range=${()=>this.flickerRange} intensity=${()=>this.intensity} shadow-bias=${()=>this.shadowBias} color=${()=>this.color??"cyan"} position="0 0 500"></flickering-orb>
		<flickering-orb flicker-range=${()=>this.flickerRange} intensity=${()=>this.intensity} shadow-bias=${()=>this.shadowBias} color=${()=>this.color??"limegreen"} position="0 0 -500"></flickering-orb>
		<flickering-orb flicker-range=${()=>this.flickerRange} intensity=${()=>this.intensity} shadow-bias=${()=>this.shadowBias} color=${()=>this.color??"white"} position="0 -500 0"></flickering-orb>
		<flickering-orb flicker-range=${()=>this.flickerRange} intensity=${()=>this.intensity} shadow-bias=${()=>this.shadowBias} color=${()=>this.color??"white"} position="0 250 0"></flickering-orb>
	`)})})();class IT extends(globalThis.window?.HTMLElement??null){connectedCallback(){this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML='\n\t\t\t<div class="top"></div>\n\t\t\t<div class="right"></div>\n\t\t\t<div class="bottom"></div>\n\t\t\t<div class="left"></div>\n\n\t\t\t<style>\n\t\t\t\t:host {\n\t\t\t\t\t--loading-icon-color: 120,130,140;\n\t\t\t\t\t--loading-icon-outer-radius: 20px;\n\t\t\t\t\t/**\n\t\t\t\t\t * @cssproperty --loading-icon-inner-radius - The size of the inner hole.\n\t\t\t\t\t *\n\t\t\t\t\t * Default: \'0.7 * --loading-icon-outer-radius\'\n\t\t\t\t\t */\n\t\t\t\t\t--loading-icon-inner-radius: calc(0.7 * var(--loading-icon-outer-radius));\n\n\t\t\t\t\twidth: var(--loading-icon-outer-radius);\n\t\t\t\t\theight: var(--loading-icon-outer-radius);\n\t\t\t\t}\n\n\t\t\t\t.top, .right, .bottom, .left {\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\topacity: 0;\n\t\t\t\t\tborder: calc(var(--loading-icon-outer-radius) - var(--loading-icon-inner-radius)) solid rgba(var(--loading-icon-color), 0);\n\t\t\t\t}\n\t\t\t\t.top {\n\t\t\t\t\tborder-top-color: rgba(var(--loading-icon-color), 1);\n\t\t\t\t\tanimation: fade 1s 0s infinite;\n\t\t\t\t}\n\t\t\t\t.right {\n\t\t\t\t\tborder-right-color: rgba(var(--loading-icon-color), 1);\n\t\t\t\t\tanimation: fade 1s 0.25s infinite;\n\t\t\t\t}\n\t\t\t\t.bottom {\n\t\t\t\t\tborder-bottom-color: rgba(var(--loading-icon-color), 1);\n\t\t\t\t\tanimation: fade 1s 0.5s infinite;\n\t\t\t\t}\n\t\t\t\t.left {\n\t\t\t\t\tborder-left-color: rgba(var(--loading-icon-color), 1);\n\t\t\t\t\tanimation: fade 1s 0.75s infinite;\n\t\t\t\t}\n\t\t\t\t@keyframes fade {\n\t\t\t\t\t0% { opacity: 0; }\n\t\t\t\t\t50% { opacity: 1; }\n\t\t\t\t\t100% { opacity: 0; }\n\t\t\t\t}\n\t\t\t</style>\n\t\t'}}globalThis.window?.customElements?.define("loading-icon",IT);const OT={CONST:"const",NOTANATTRIBUTE:"const",VARIABLE:"var",LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom",WIDTH:"width",HEIGHT:"height",CENTERX:"centerX",CENTERY:"centerY",ZINDEX:"zIndex"},LT={LEQ:"leq",EQU:"equ",GEQ:"geq"},NT=function(){function e(e,t,n,i,r,s){this.message=e,this.expected=t,this.found=n,this.offset=i,this.line=r,this.column=s,this.name="SyntaxError"}return function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(e,Error),{SyntaxError:e,parse:function(t){var n,i=arguments.length>1?arguments[1]:{},r={},s={visualFormatString:be},a=be,o=r,l=null,c=":",u={type:"literal",value:":",description:'":"'},h=function(e,t,n,i,r){return{orientation:e?e[0]:"horizontal",cascade:(t||[]).concat([n],[].concat.apply([],i),r||[])}},d="H",p={type:"literal",value:"H",description:'"H"'},f="V",m={type:"literal",value:"V",description:'"V"'},g=function(e){return"H"==e?"horizontal":"vertical"},v="|",y={type:"literal",value:"|",description:'"|"'},b=function(){return{view:null}},x="[",_={type:"literal",value:"[",description:'"["'},w="]",S={type:"literal",value:"]",description:'"]"'},M=function(e,t){return Ae(e,t?{constraints:t}:{})},E="-",T={type:"literal",value:"-",description:'"-"'},A=function(e){return e},C=function(){return[{relation:"equ",constant:"default",$parserOffset:ve()}]},R="",P=function(){return[{relation:"equ",constant:0,$parserOffset:ve()}]},k=function(e){return[{relation:"equ",constant:e,$parserOffset:ve()}]},I="(",O={type:"literal",value:"(",description:'"("'},L=",",N={type:"literal",value:",",description:'","'},D=")",z={type:"literal",value:")",description:'")"'},U=function(e,t){return[e].concat(t.map((function(e){return e[1]})))},F="@",B={type:"literal",value:"@",description:'"@"'},V=function(e,t,n){return Ae({relation:"equ"},e||{},t,n?n[1]:{})},j="==",H={type:"literal",value:"==",description:'"=="'},G=function(){return{relation:"equ",$parserOffset:ve()}},W="<=",X={type:"literal",value:"<=",description:'"<="'},q=function(){return{relation:"leq",$parserOffset:ve()}},Y=">=",$={type:"literal",value:">=",description:'">="'},Z=function(){return{relation:"geq",$parserOffset:ve()}},K=/^[0-9]/,J={type:"class",value:"[0-9]",description:"[0-9]"},Q=function(e){return{priority:parseInt(e.join(""),10)}},ee=function(e){return{constant:e}},te=/^[a-zA-Z_]/,ne={type:"class",value:"[a-zA-Z_]",description:"[a-zA-Z_]"},ie=/^[a-zA-Z0-9_]/,re={type:"class",value:"[a-zA-Z0-9_]",description:"[a-zA-Z0-9_]"},se=function(e,t){return{view:e+t}},ae=".",oe={type:"literal",value:".",description:'"."'},le=function(e,t){return parseFloat(e.concat(".").concat(t).join(""),10)},ce=function(e){return parseInt(e.join(""),10)},ue=0,he=0,de=0,pe={line:1,column:1,seenCR:!1},fe=0,me=[],ge=0;if("startRule"in i){if(!(i.startRule in s))throw new Error("Can't start parsing from rule \""+i.startRule+'".');a=s[i.startRule]}function ve(){return he}function ye(e){ue<fe||(ue>fe&&(fe=ue,me=[]),me.push(e))}function be(){var e,n,i,s,a,v,y,b;if(e=ue,n=ue,i=function(){var e,n;return e=ue,72===t.charCodeAt(ue)?(n=d,ue++):(n=r,0===ge&&ye(p)),n===r&&(86===t.charCodeAt(ue)?(n=f,ue++):(n=r,0===ge&&ye(m))),n!==r&&(he=e,n=g(n)),e=n}(),i!==r?(58===t.charCodeAt(ue)?(s=c,ue++):(s=r,0===ge&&ye(u)),s!==r?n=i=[i,s]:(ue=n,n=o)):(ue=n,n=o),n===r&&(n=l),n!==r)if(i=ue,(s=xe())!==r&&(a=we())!==r?i=s=[s,a]:(ue=i,i=o),i===r&&(i=l),i!==r)if((s=_e())!==r){for(a=[],v=ue,(y=we())!==r&&(b=_e())!==r?v=y=[y,b]:(ue=v,v=o);v!==r;)a.push(v),v=ue,(y=we())!==r&&(b=_e())!==r?v=y=[y,b]:(ue=v,v=o);a!==r?(v=ue,(y=we())!==r&&(b=xe())!==r?v=y=[y,b]:(ue=v,v=o),v===r&&(v=l),v!==r?(he=e,e=n=h(n,i,s,a,v)):(ue=e,e=o)):(ue=e,e=o)}else ue=e,e=o;else ue=e,e=o;else ue=e,e=o;return e}function xe(){var e,n;return e=ue,124===t.charCodeAt(ue)?(n=v,ue++):(n=r,0===ge&&ye(y)),n!==r&&(he=e,n=b()),n}function _e(){var e,n,i,s,a;return e=ue,91===t.charCodeAt(ue)?(n=x,ue++):(n=r,0===ge&&ye(_)),n!==r&&(i=Ee())!==r?((s=Se())===r&&(s=l),s!==r?(93===t.charCodeAt(ue)?(a=w,ue++):(a=r,0===ge&&ye(S)),a!==r?(he=e,e=n=M(i,s)):(ue=e,e=o)):(ue=e,e=o)):(ue=e,e=o),e}function we(){var e,n,i,s;return e=ue,45===t.charCodeAt(ue)?(n=E,ue++):(n=r,0===ge&&ye(T)),n!==r?(i=function(){var e;return e=function(){var e,t;return e=ue,(t=Te())!==r&&(he=e,t=k(t)),e=t}(),e===r&&(e=Se()),e}(),i!==r?(45===t.charCodeAt(ue)?(s=E,ue++):(s=r,0===ge&&ye(T)),s!==r?(he=e,e=n=A(i)):(ue=e,e=o)):(ue=e,e=o)):(ue=e,e=o),e===r&&(e=ue,45===t.charCodeAt(ue)?(n=E,ue++):(n=r,0===ge&&ye(T)),n!==r&&(he=e,n=C()),(e=n)===r&&(e=ue,(n=R)!==r&&(he=e,n=P()),e=n)),e}function Se(){var e,n,i,s,a,l,c;if(e=ue,40===t.charCodeAt(ue)?(n=I,ue++):(n=r,0===ge&&ye(O)),n!==r)if((i=Me())!==r){for(s=[],a=ue,44===t.charCodeAt(ue)?(l=L,ue++):(l=r,0===ge&&ye(N)),l!==r&&(c=Me())!==r?a=l=[l,c]:(ue=a,a=o);a!==r;)s.push(a),a=ue,44===t.charCodeAt(ue)?(l=L,ue++):(l=r,0===ge&&ye(N)),l!==r&&(c=Me())!==r?a=l=[l,c]:(ue=a,a=o);s!==r?(41===t.charCodeAt(ue)?(a=D,ue++):(a=r,0===ge&&ye(z)),a!==r?(he=e,e=n=U(i,s)):(ue=e,e=o)):(ue=e,e=o)}else ue=e,e=o;else ue=e,e=o;return e}function Me(){var e,n,i,s,a,c;return e=ue,n=function(){var e,n;return e=ue,t.substr(ue,2)===j?(n=j,ue+=2):(n=r,0===ge&&ye(H)),n!==r&&(he=e,n=G()),(e=n)===r&&(e=ue,t.substr(ue,2)===W?(n=W,ue+=2):(n=r,0===ge&&ye(X)),n!==r&&(he=e,n=q()),(e=n)===r&&(e=ue,t.substr(ue,2)===Y?(n=Y,ue+=2):(n=r,0===ge&&ye($)),n!==r&&(he=e,n=Z()),e=n)),e}(),n===r&&(n=l),n!==r?(i=function(){var e;return e=function(){var e,t;return e=ue,(t=Te())!==r&&(he=e,t=ee(t)),e=t}(),e===r&&(e=Ee()),e}(),i!==r?(s=ue,64===t.charCodeAt(ue)?(a=F,ue++):(a=r,0===ge&&ye(B)),a!==r?(c=function(){var e,n,i;if(e=ue,n=[],K.test(t.charAt(ue))?(i=t.charAt(ue),ue++):(i=r,0===ge&&ye(J)),i!==r)for(;i!==r;)n.push(i),K.test(t.charAt(ue))?(i=t.charAt(ue),ue++):(i=r,0===ge&&ye(J));else n=o;return n!==r&&(he=e,n=Q(n)),e=n}(),c!==r?s=a=[a,c]:(ue=s,s=o)):(ue=s,s=o),s===r&&(s=l),s!==r?(he=e,e=n=V(n,i,s)):(ue=e,e=o)):(ue=e,e=o)):(ue=e,e=o),e}function Ee(){var e,n,i,s,a;if(e=ue,n=ue,i=[],te.test(t.charAt(ue))?(s=t.charAt(ue),ue++):(s=r,0===ge&&ye(ne)),s!==r)for(;s!==r;)i.push(s),te.test(t.charAt(ue))?(s=t.charAt(ue),ue++):(s=r,0===ge&&ye(ne));else i=o;if(i!==r&&(i=t.substring(n,ue)),(n=i)!==r){for(i=ue,s=[],ie.test(t.charAt(ue))?(a=t.charAt(ue),ue++):(a=r,0===ge&&ye(re));a!==r;)s.push(a),ie.test(t.charAt(ue))?(a=t.charAt(ue),ue++):(a=r,0===ge&&ye(re));s!==r&&(s=t.substring(i,ue)),(i=s)!==r?(he=e,e=n=se(n,i)):(ue=e,e=o)}else ue=e,e=o;return e}function Te(){var e,n,i,s,a;if(e=ue,n=[],K.test(t.charAt(ue))?(i=t.charAt(ue),ue++):(i=r,0===ge&&ye(J)),i!==r)for(;i!==r;)n.push(i),K.test(t.charAt(ue))?(i=t.charAt(ue),ue++):(i=r,0===ge&&ye(J));else n=o;if(n!==r)if(46===t.charCodeAt(ue)?(i=ae,ue++):(i=r,0===ge&&ye(oe)),i!==r){if(s=[],K.test(t.charAt(ue))?(a=t.charAt(ue),ue++):(a=r,0===ge&&ye(J)),a!==r)for(;a!==r;)s.push(a),K.test(t.charAt(ue))?(a=t.charAt(ue),ue++):(a=r,0===ge&&ye(J));else s=o;s!==r?(he=e,e=n=le(n,s)):(ue=e,e=o)}else ue=e,e=o;else ue=e,e=o;if(e===r){if(e=ue,n=[],K.test(t.charAt(ue))?(i=t.charAt(ue),ue++):(i=r,0===ge&&ye(J)),i!==r)for(;i!==r;)n.push(i),K.test(t.charAt(ue))?(i=t.charAt(ue),ue++):(i=r,0===ge&&ye(J));else n=o;n!==r&&(he=e,n=ce(n)),e=n}return e}function Ae(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])e[n]=arguments[t][n];return e}if((n=a())!==r&&ue===t.length)return n;throw n!==r&&ue<t.length&&ye({type:"end",description:"end of input"}),function(n,i,r){var s=function(e){return de!==e&&(de>e&&(de=0,pe={line:1,column:1,seenCR:!1}),function(e,n,i){var r,s;for(r=n;r<i;r++)"\n"===(s=t.charAt(r))?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):"\r"===s||"\u2028"===s||"\u2029"===s?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1)}(pe,de,e),de=e),pe}(r),a=r<t.length?t.charAt(r):null;return null!==i&&function(e){var t=1;for(e.sort((function(e,t){return e.description<t.description?-1:e.description>t.description?1:0}));t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}(i),new e(null!==n?n:function(e,t){var n,i=new Array(e.length);for(n=0;n<e.length;n++)i[n]=e[n].description;return"Expected "+(e.length>1?i.slice(0,-1).join(", ")+" or "+i[e.length-1]:i[0])+" but "+(t?'"'+function(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,(function(e){return"\\x0"+t(e)})).replace(/[\x10-\x1F\x80-\xFF]/g,(function(e){return"\\x"+t(e)})).replace(/[\u0180-\u0FFF]/g,(function(e){return"\\u0"+t(e)})).replace(/[\u1080-\uFFFF]/g,(function(e){return"\\u"+t(e)}))}(t)+'"':"end of input")+" found."}(i,a),i,a,r,s.line,s.column)}(null,me,fe)}}}(),DT=function(){function e(e,t,n,i,r,s){this.message=e,this.expected=t,this.found=n,this.offset=i,this.line=r,this.column=s,this.name="SyntaxError"}return function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(e,Error),{SyntaxError:e,parse:function(t){var n,i=arguments.length>1?arguments[1]:{},r={},s={visualFormatStringExt:Ht},a=Ht,o=r,l="C:",c={type:"literal",value:"C:",description:'"C:"'},u=null,h=function(e,t,n,i){return{type:"attribute",view:e.view,attributes:[t].concat(n)}},d=function(e,t){return{attr:e,predicates:t}},p=":",f={type:"literal",value:":",description:'":"'},m=function(e,t,n,i,r,s){return{type:"vfl",orientation:e?e[0]:"horizontal",cascade:(t||[]).concat(n,[].concat.apply([],i),r||[])}},g="HV",v={type:"literal",value:"HV",description:'"HV"'},y=function(){return"horzvert"},b="H",x={type:"literal",value:"H",description:'"H"'},_=function(){return"horizontal"},w="V",S={type:"literal",value:"V",description:'"V"'},M=function(){return"vertical"},E="Z",T={type:"literal",value:"Z",description:'"Z"'},A=function(){return"zIndex"},C=" ",R={type:"literal",value:" ",description:'" "'},P="//",k={type:"literal",value:"//",description:'"//"'},I={type:"any",description:"any character"},O="|",L={type:"literal",value:"|",description:'"|"'},N=function(){return{view:null}},D="[",z={type:"literal",value:"[",description:'"["'},U=",",F={type:"literal",value:",",description:'","'},B="]",V={type:"literal",value:"]",description:'"]"'},j=function(e,t){return t.length?[e].concat([].concat.apply([],t)):e},H=function(e,t,n){return on(on(e,t?{constraints:t}:{}),n?{cascade:n}:{})},G=function(e,t){return[].concat([].concat.apply([],e),[t])},W="->",X={type:"literal",value:"->",description:'"->"'},q=function(){return[{relation:"none"}]},Y="-",$={type:"literal",value:"-",description:'"-"'},Z=function(e){return e},K=function(){return[{relation:"equ",constant:"default"}]},J="~",Q={type:"literal",value:"~",description:'"~"'},ee=function(){return[{relation:"equ",equalSpacing:!0}]},te="",ne=function(){return[{relation:"equ",constant:0}]},ie=function(e){return[{relation:"equ",multiplier:e.multiplier}]},re=function(e){return[{relation:"equ",constant:e}]},se="(",ae={type:"literal",value:"(",description:'"("'},oe=")",le={type:"literal",value:")",description:'")"'},ce=function(e,t){return[e].concat(t.map((function(e){return e[1]})))},ue="@",he={type:"literal",value:"@",description:'"@"'},de=function(e,t,n){return on({relation:"equ"},e||{},t,n?n[1]:{})},pe=function(e,t,n){return on({relation:"equ",equalSpacing:!0},e||{},t,n?n[1]:{})},fe="==",me={type:"literal",value:"==",description:'"=="'},ge=function(){return{relation:"equ"}},ve="<=",ye={type:"literal",value:"<=",description:'"<="'},be=function(){return{relation:"leq"}},xe=">=",_e={type:"literal",value:">=",description:'">="'},we=function(){return{relation:"geq"}},Se=/^[0-9]/,Me={type:"class",value:"[0-9]",description:"[0-9]"},Ee=function(e){return{priority:parseInt(e.join(""),10)}},Te=function(e){return{constant:e}},Ae=function(e){return{constant:-e}},Ce="+",Re={type:"literal",value:"+",description:'"+"'},Pe="%",ke={type:"literal",value:"%",description:'"%"'},Ie=function(e){return{view:null,multiplier:e/100}},Oe=function(e){return{view:null,multiplier:e/-100}},Le=function(e,t,n,i){return{view:e.view,attribute:t||void 0,multiplier:n||1,constant:i||void 0}},Ne=".left",De={type:"literal",value:".left",description:'".left"'},ze=function(){return"left"},Ue=".right",Fe={type:"literal",value:".right",description:'".right"'},Be=function(){return"right"},Ve=".top",je={type:"literal",value:".top",description:'".top"'},He=function(){return"top"},Ge=".bottom",We={type:"literal",value:".bottom",description:'".bottom"'},Xe=function(){return"bottom"},qe=".width",Ye={type:"literal",value:".width",description:'".width"'},$e=function(){return"width"},Ze=".height",Ke={type:"literal",value:".height",description:'".height"'},Je=function(){return"height"},Qe=".centerX",et={type:"literal",value:".centerX",description:'".centerX"'},tt=function(){return"centerX"},nt=".centerY",it={type:"literal",value:".centerY",description:'".centerY"'},rt=function(){return"centerY"},st="/",at={type:"literal",value:"/",description:'"/"'},ot=function(e){return 1/e},lt="/+",ct={type:"literal",value:"/+",description:'"/+"'},ut="/-",ht={type:"literal",value:"/-",description:'"/-"'},dt=function(e){return-1/e},pt="*",ft={type:"literal",value:"*",description:'"*"'},mt=function(e){return e},gt="*+",vt={type:"literal",value:"*+",description:'"*+"'},yt="*-",bt={type:"literal",value:"*-",description:'"*-"'},xt=function(e){return-e},_t=/^[a-zA-Z_]/,wt={type:"class",value:"[a-zA-Z_]",description:"[a-zA-Z_]"},St=/^[a-zA-Z0-9_]/,Mt={type:"class",value:"[a-zA-Z0-9_]",description:"[a-zA-Z0-9_]"},Et=function(e,t,n){return{view:e+t,range:n,$parserOffset:Vt()}},Tt=function(e,t){return{view:e+t,$parserOffset:Vt()}},At="..",Ct={type:"literal",value:"..",description:'".."'},Rt=function(e){return parseInt(e)},Pt=".",kt={type:"literal",value:".",description:'"."'},It=function(e,t){return parseFloat(e.concat(".").concat(t).join(""),10)},Ot=function(e){return parseInt(e.join(""),10)},Lt=0,Nt=0,Dt=0,zt={line:1,column:1,seenCR:!1},Ut=0,Ft=[],Bt=0;if("startRule"in i){if(!(i.startRule in s))throw new Error("Can't start parsing from rule \""+i.startRule+'".');a=s[i.startRule]}function Vt(){return Nt}function jt(e){Lt<Ut||(Lt>Ut&&(Ut=Lt,Ft=[]),Ft.push(e))}function Ht(){var e;return(e=function(){var e,n,i,s,a,l,c,h;if(e=Lt,n=Lt,i=function(){var e,n;return e=Lt,t.substr(Lt,2)===g?(n=g,Lt+=2):(n=r,0===Bt&&jt(v)),n!==r&&(Nt=e,n=y()),(e=n)===r&&(e=Lt,72===t.charCodeAt(Lt)?(n=b,Lt++):(n=r,0===Bt&&jt(x)),n!==r&&(Nt=e,n=_()),(e=n)===r&&(e=Lt,86===t.charCodeAt(Lt)?(n=w,Lt++):(n=r,0===Bt&&jt(S)),n!==r&&(Nt=e,n=M()),(e=n)===r&&(e=Lt,90===t.charCodeAt(Lt)?(n=E,Lt++):(n=r,0===Bt&&jt(T)),n!==r&&(Nt=e,n=A()),e=n))),e}(),i!==r?(58===t.charCodeAt(Lt)?(s=p,Lt++):(s=r,0===Bt&&jt(f)),s!==r?n=i=[i,s]:(Lt=n,n=o)):(Lt=n,n=o),n===r&&(n=u),n!==r)if(i=Lt,(s=Xt())!==r&&(a=$t())!==r?i=s=[s,a]:(Lt=i,i=o),i===r&&(i=u),i!==r)if((s=qt())!==r){for(a=[],l=Lt,(c=$t())!==r&&(h=qt())!==r?l=c=[c,h]:(Lt=l,l=o);l!==r;)a.push(l),l=Lt,(c=$t())!==r&&(h=qt())!==r?l=c=[c,h]:(Lt=l,l=o);a!==r?(l=Lt,(c=$t())!==r&&(h=Xt())!==r?l=c=[c,h]:(Lt=l,l=o),l===r&&(l=u),l!==r?((c=Wt())===r&&(c=u),c!==r?(Nt=e,e=n=m(n,i,s,a,l,c)):(Lt=e,e=o)):(Lt=e,e=o)):(Lt=e,e=o)}else Lt=e,e=o;else Lt=e,e=o;else Lt=e,e=o;return e}())===r&&(e=function(){var e,n,i,s,a,d;if(e=Lt,t.substr(Lt,2)===l?(n=l,Lt+=2):(n=r,0===Bt&&jt(c)),n!==r)if((i=sn())!==r)if((s=Gt())!==r){for(a=[],d=Gt();d!==r;)a.push(d),d=Gt();a!==r?((d=Wt())===r&&(d=u),d!==r?(Nt=e,e=n=h(i,s,a,d)):(Lt=e,e=o)):(Lt=e,e=o)}else Lt=e,e=o;else Lt=e,e=o;else Lt=e,e=o;return e}()),e}function Gt(){var e,t,n;return e=Lt,(t=rn())!==r&&(n=Zt())!==r?(Nt=e,e=t=d(t,n)):(Lt=e,e=o),e}function Wt(){var e,n,i,s,a;for(e=Lt,n=[],32===t.charCodeAt(Lt)?(i=C,Lt++):(i=r,0===Bt&&jt(R));i!==r;)n.push(i),32===t.charCodeAt(Lt)?(i=C,Lt++):(i=r,0===Bt&&jt(R));if(n!==r)if(t.substr(Lt,2)===P?(i=P,Lt+=2):(i=r,0===Bt&&jt(k)),i!==r){for(s=[],t.length>Lt?(a=t.charAt(Lt),Lt++):(a=r,0===Bt&&jt(I));a!==r;)s.push(a),t.length>Lt?(a=t.charAt(Lt),Lt++):(a=r,0===Bt&&jt(I));s!==r?e=n=[n,i,s]:(Lt=e,e=o)}else Lt=e,e=o;else Lt=e,e=o;return e}function Xt(){var e,n;return e=Lt,124===t.charCodeAt(Lt)?(n=O,Lt++):(n=r,0===Bt&&jt(L)),n!==r&&(Nt=e,n=N()),n}function qt(){var e,n,i,s,a,l,c;if(e=Lt,91===t.charCodeAt(Lt)?(n=D,Lt++):(n=r,0===Bt&&jt(z)),n!==r)if((i=Yt())!==r){for(s=[],a=Lt,44===t.charCodeAt(Lt)?(l=U,Lt++):(l=r,0===Bt&&jt(F)),l!==r&&(c=Yt())!==r?a=l=[l,c]:(Lt=a,a=o);a!==r;)s.push(a),a=Lt,44===t.charCodeAt(Lt)?(l=U,Lt++):(l=r,0===Bt&&jt(F)),l!==r&&(c=Yt())!==r?a=l=[l,c]:(Lt=a,a=o);s!==r?(93===t.charCodeAt(Lt)?(a=B,Lt++):(a=r,0===Bt&&jt(V)),a!==r?(Nt=e,e=n=j(i,s)):(Lt=e,e=o)):(Lt=e,e=o)}else Lt=e,e=o;else Lt=e,e=o;return e}function Yt(){var e,n,i,s;return e=Lt,n=function(){var e,n,i,s,a;if(e=Lt,n=Lt,i=[],_t.test(t.charAt(Lt))?(s=t.charAt(Lt),Lt++):(s=r,0===Bt&&jt(wt)),s!==r)for(;s!==r;)i.push(s),_t.test(t.charAt(Lt))?(s=t.charAt(Lt),Lt++):(s=r,0===Bt&&jt(wt));else i=o;if(i!==r&&(i=t.substring(n,Lt)),(n=i)!==r){for(i=Lt,s=[],St.test(t.charAt(Lt))?(a=t.charAt(Lt),Lt++):(a=r,0===Bt&&jt(Mt));a!==r;)s.push(a),St.test(t.charAt(Lt))?(a=t.charAt(Lt),Lt++):(a=r,0===Bt&&jt(Mt));s!==r&&(s=t.substring(i,Lt)),(i=s)!==r?(s=function(){var e,n,i,s;if(e=Lt,t.substr(Lt,2)===At?(n=At,Lt+=2):(n=r,0===Bt&&jt(Ct)),n!==r){if(i=[],Se.test(t.charAt(Lt))?(s=t.charAt(Lt),Lt++):(s=r,0===Bt&&jt(Me)),s!==r)for(;s!==r;)i.push(s),Se.test(t.charAt(Lt))?(s=t.charAt(Lt),Lt++):(s=r,0===Bt&&jt(Me));else i=o;i!==r?(Nt=e,e=n=Rt(i)):(Lt=e,e=o)}else Lt=e,e=o;return e}(),s!==r?(Nt=e,e=n=Et(n,i,s)):(Lt=e,e=o)):(Lt=e,e=o)}else Lt=e,e=o;if(e===r){if(e=Lt,n=Lt,i=[],_t.test(t.charAt(Lt))?(s=t.charAt(Lt),Lt++):(s=r,0===Bt&&jt(wt)),s!==r)for(;s!==r;)i.push(s),_t.test(t.charAt(Lt))?(s=t.charAt(Lt),Lt++):(s=r,0===Bt&&jt(wt));else i=o;if(i!==r&&(i=t.substring(n,Lt)),(n=i)!==r){for(i=Lt,s=[],St.test(t.charAt(Lt))?(a=t.charAt(Lt),Lt++):(a=r,0===Bt&&jt(Mt));a!==r;)s.push(a),St.test(t.charAt(Lt))?(a=t.charAt(Lt),Lt++):(a=r,0===Bt&&jt(Mt));s!==r&&(s=t.substring(i,Lt)),(i=s)!==r?(Nt=e,e=n=Tt(n,i)):(Lt=e,e=o)}else Lt=e,e=o}return e}(),n!==r?((i=Zt())===r&&(i=u),i!==r?(s=function(){var e,n,i,s,a,l;if(e=Lt,58===t.charCodeAt(Lt)?(n=p,Lt++):(n=r,0===Bt&&jt(f)),n!==r){if(i=[],s=Lt,(a=$t())!==r&&(l=qt())!==r?s=a=[a,l]:(Lt=s,s=o),s!==r)for(;s!==r;)i.push(s),s=Lt,(a=$t())!==r&&(l=qt())!==r?s=a=[a,l]:(Lt=s,s=o);else i=o;i!==r&&(s=$t())!==r?(Nt=e,e=n=G(i,s)):(Lt=e,e=o)}else Lt=e,e=o;return e}(),s===r&&(s=u),s!==r?(Nt=e,e=n=H(n,i,s)):(Lt=e,e=o)):(Lt=e,e=o)):(Lt=e,e=o),e}function $t(){var e,n,i,s;return e=Lt,t.substr(Lt,2)===W?(n=W,Lt+=2):(n=r,0===Bt&&jt(X)),n!==r&&(Nt=e,n=q()),(e=n)===r&&(e=Lt,45===t.charCodeAt(Lt)?(n=Y,Lt++):(n=r,0===Bt&&jt($)),n!==r?(i=function(){var e;return e=function(){var e,t;return e=Lt,(t=nn())!==r&&(Nt=e,t=ie(t)),(e=t)===r&&(e=Lt,(t=an())!==r&&(Nt=e,t=re(t)),e=t),e}(),e===r&&(e=Zt()),e}(),i!==r?(45===t.charCodeAt(Lt)?(s=Y,Lt++):(s=r,0===Bt&&jt($)),s!==r?(Nt=e,e=n=Z(i)):(Lt=e,e=o)):(Lt=e,e=o)):(Lt=e,e=o),e===r&&(e=Lt,45===t.charCodeAt(Lt)?(n=Y,Lt++):(n=r,0===Bt&&jt($)),n!==r&&(Nt=e,n=K()),(e=n)===r&&(e=Lt,126===t.charCodeAt(Lt)?(n=J,Lt++):(n=r,0===Bt&&jt(Q)),n!==r?(i=function(){var e,n,i,s,a,l,c;if(e=Lt,40===t.charCodeAt(Lt)?(n=se,Lt++):(n=r,0===Bt&&jt(ae)),n!==r)if((i=Jt())!==r){for(s=[],a=Lt,44===t.charCodeAt(Lt)?(l=U,Lt++):(l=r,0===Bt&&jt(F)),l!==r&&(c=Jt())!==r?a=l=[l,c]:(Lt=a,a=o);a!==r;)s.push(a),a=Lt,44===t.charCodeAt(Lt)?(l=U,Lt++):(l=r,0===Bt&&jt(F)),l!==r&&(c=Jt())!==r?a=l=[l,c]:(Lt=a,a=o);s!==r?(41===t.charCodeAt(Lt)?(a=oe,Lt++):(a=r,0===Bt&&jt(le)),a!==r?(Nt=e,e=n=ce(i,s)):(Lt=e,e=o)):(Lt=e,e=o)}else Lt=e,e=o;else Lt=e,e=o;return e}(),i!==r?(126===t.charCodeAt(Lt)?(s=J,Lt++):(s=r,0===Bt&&jt(Q)),s!==r?(Nt=e,e=n=Z(i)):(Lt=e,e=o)):(Lt=e,e=o)):(Lt=e,e=o),e===r&&(e=Lt,126===t.charCodeAt(Lt)?(n=J,Lt++):(n=r,0===Bt&&jt(Q)),n!==r&&(Nt=e,n=ee()),(e=n)===r&&(e=Lt,(n=te)!==r&&(Nt=e,n=ne()),e=n))))),e}function Zt(){var e,n,i,s,a,l,c;if(e=Lt,40===t.charCodeAt(Lt)?(n=se,Lt++):(n=r,0===Bt&&jt(ae)),n!==r)if((i=Kt())!==r){for(s=[],a=Lt,44===t.charCodeAt(Lt)?(l=U,Lt++):(l=r,0===Bt&&jt(F)),l!==r&&(c=Kt())!==r?a=l=[l,c]:(Lt=a,a=o);a!==r;)s.push(a),a=Lt,44===t.charCodeAt(Lt)?(l=U,Lt++):(l=r,0===Bt&&jt(F)),l!==r&&(c=Kt())!==r?a=l=[l,c]:(Lt=a,a=o);s!==r?(41===t.charCodeAt(Lt)?(a=oe,Lt++):(a=r,0===Bt&&jt(le)),a!==r?(Nt=e,e=n=ce(i,s)):(Lt=e,e=o)):(Lt=e,e=o)}else Lt=e,e=o;else Lt=e,e=o;return e}function Kt(){var e,n,i,s,a,l;return e=Lt,(n=Qt())===r&&(n=u),n!==r&&(i=en())!==r?(s=Lt,64===t.charCodeAt(Lt)?(a=ue,Lt++):(a=r,0===Bt&&jt(he)),a!==r&&(l=tn())!==r?s=a=[a,l]:(Lt=s,s=o),s===r&&(s=u),s!==r?(Nt=e,e=n=de(n,i,s)):(Lt=e,e=o)):(Lt=e,e=o),e}function Jt(){var e,n,i,s,a,l;return e=Lt,(n=Qt())===r&&(n=u),n!==r&&(i=en())!==r?(s=Lt,64===t.charCodeAt(Lt)?(a=ue,Lt++):(a=r,0===Bt&&jt(he)),a!==r&&(l=tn())!==r?s=a=[a,l]:(Lt=s,s=o),s===r&&(s=u),s!==r?(Nt=e,e=n=pe(n,i,s)):(Lt=e,e=o)):(Lt=e,e=o),e}function Qt(){var e,n;return e=Lt,t.substr(Lt,2)===fe?(n=fe,Lt+=2):(n=r,0===Bt&&jt(me)),n!==r&&(Nt=e,n=ge()),(e=n)===r&&(e=Lt,t.substr(Lt,2)===ve?(n=ve,Lt+=2):(n=r,0===Bt&&jt(ye)),n!==r&&(Nt=e,n=be()),(e=n)===r&&(e=Lt,t.substr(Lt,2)===xe?(n=xe,Lt+=2):(n=r,0===Bt&&jt(_e)),n!==r&&(Nt=e,n=we()),e=n)),e}function en(){var e;return(e=nn())===r&&(e=function(){var e,n,i;return e=Lt,(n=an())!==r&&(Nt=e,n=Te(n)),(e=n)===r&&(e=Lt,45===t.charCodeAt(Lt)?(n=Y,Lt++):(n=r,0===Bt&&jt($)),n!==r&&(i=an())!==r?(Nt=e,e=n=Ae(i)):(Lt=e,e=o),e===r&&(e=Lt,43===t.charCodeAt(Lt)?(n=Ce,Lt++):(n=r,0===Bt&&jt(Re)),n!==r&&(i=an())!==r?(Nt=e,e=n=Te(i)):(Lt=e,e=o))),e}())===r&&(e=function(){var e,n,i,s,a;return e=Lt,(n=sn())!==r?((i=rn())===r&&(i=u),i!==r?(s=function(){var e,n,i;return e=Lt,47===t.charCodeAt(Lt)?(n=st,Lt++):(n=r,0===Bt&&jt(at)),n!==r&&(i=an())!==r?(Nt=e,e=n=ot(i)):(Lt=e,e=o),e===r&&(e=Lt,t.substr(Lt,2)===lt?(n=lt,Lt+=2):(n=r,0===Bt&&jt(ct)),n!==r&&(i=an())!==r?(Nt=e,e=n=ot(i)):(Lt=e,e=o),e===r&&(e=Lt,t.substr(Lt,2)===ut?(n=ut,Lt+=2):(n=r,0===Bt&&jt(ht)),n!==r&&(i=an())!==r?(Nt=e,e=n=dt(i)):(Lt=e,e=o),e===r&&(e=Lt,42===t.charCodeAt(Lt)?(n=pt,Lt++):(n=r,0===Bt&&jt(ft)),n!==r&&(i=an())!==r?(Nt=e,e=n=mt(i)):(Lt=e,e=o),e===r&&(e=Lt,t.substr(Lt,2)===gt?(n=gt,Lt+=2):(n=r,0===Bt&&jt(vt)),n!==r&&(i=an())!==r?(Nt=e,e=n=mt(i)):(Lt=e,e=o),e===r&&(e=Lt,t.substr(Lt,2)===yt?(n=yt,Lt+=2):(n=r,0===Bt&&jt(bt)),n!==r&&(i=an())!==r?(Nt=e,e=n=xt(i)):(Lt=e,e=o)))))),e}(),s===r&&(s=u),s!==r?(a=function(){var e,n,i;return e=Lt,45===t.charCodeAt(Lt)?(n=Y,Lt++):(n=r,0===Bt&&jt($)),n!==r&&(i=an())!==r?(Nt=e,e=n=xt(i)):(Lt=e,e=o),e===r&&(e=Lt,43===t.charCodeAt(Lt)?(n=Ce,Lt++):(n=r,0===Bt&&jt(Re)),n!==r&&(i=an())!==r?(Nt=e,e=n=mt(i)):(Lt=e,e=o)),e}(),a===r&&(a=u),a!==r?(Nt=e,e=n=Le(n,i,s,a)):(Lt=e,e=o)):(Lt=e,e=o)):(Lt=e,e=o)):(Lt=e,e=o),e}()),e}function tn(){var e,n,i;if(e=Lt,n=[],Se.test(t.charAt(Lt))?(i=t.charAt(Lt),Lt++):(i=r,0===Bt&&jt(Me)),i!==r)for(;i!==r;)n.push(i),Se.test(t.charAt(Lt))?(i=t.charAt(Lt),Lt++):(i=r,0===Bt&&jt(Me));else n=o;return n!==r&&(Nt=e,n=Ee(n)),n}function nn(){var e,n,i,s;return e=Lt,(n=an())!==r?(37===t.charCodeAt(Lt)?(i=Pe,Lt++):(i=r,0===Bt&&jt(ke)),i!==r?(Nt=e,e=n=Ie(n)):(Lt=e,e=o)):(Lt=e,e=o),e===r&&(e=Lt,45===t.charCodeAt(Lt)?(n=Y,Lt++):(n=r,0===Bt&&jt($)),n!==r&&(i=an())!==r?(37===t.charCodeAt(Lt)?(s=Pe,Lt++):(s=r,0===Bt&&jt(ke)),s!==r?(Nt=e,e=n=Oe(i)):(Lt=e,e=o)):(Lt=e,e=o),e===r&&(e=Lt,43===t.charCodeAt(Lt)?(n=Ce,Lt++):(n=r,0===Bt&&jt(Re)),n!==r&&(i=an())!==r?(37===t.charCodeAt(Lt)?(s=Pe,Lt++):(s=r,0===Bt&&jt(ke)),s!==r?(Nt=e,e=n=Ie(i)):(Lt=e,e=o)):(Lt=e,e=o))),e}function rn(){var e,n;return e=Lt,t.substr(Lt,5)===Ne?(n=Ne,Lt+=5):(n=r,0===Bt&&jt(De)),n!==r&&(Nt=e,n=ze()),(e=n)===r&&(e=Lt,t.substr(Lt,6)===Ue?(n=Ue,Lt+=6):(n=r,0===Bt&&jt(Fe)),n!==r&&(Nt=e,n=Be()),(e=n)===r&&(e=Lt,t.substr(Lt,4)===Ve?(n=Ve,Lt+=4):(n=r,0===Bt&&jt(je)),n!==r&&(Nt=e,n=He()),(e=n)===r&&(e=Lt,t.substr(Lt,7)===Ge?(n=Ge,Lt+=7):(n=r,0===Bt&&jt(We)),n!==r&&(Nt=e,n=Xe()),(e=n)===r&&(e=Lt,t.substr(Lt,6)===qe?(n=qe,Lt+=6):(n=r,0===Bt&&jt(Ye)),n!==r&&(Nt=e,n=$e()),(e=n)===r&&(e=Lt,t.substr(Lt,7)===Ze?(n=Ze,Lt+=7):(n=r,0===Bt&&jt(Ke)),n!==r&&(Nt=e,n=Je()),(e=n)===r&&(e=Lt,t.substr(Lt,8)===Qe?(n=Qe,Lt+=8):(n=r,0===Bt&&jt(et)),n!==r&&(Nt=e,n=tt()),(e=n)===r&&(e=Lt,t.substr(Lt,8)===nt?(n=nt,Lt+=8):(n=r,0===Bt&&jt(it)),n!==r&&(Nt=e,n=rt()),e=n))))))),e}function sn(){var e,n,i,s,a;if(e=Lt,n=Lt,i=[],_t.test(t.charAt(Lt))?(s=t.charAt(Lt),Lt++):(s=r,0===Bt&&jt(wt)),s!==r)for(;s!==r;)i.push(s),_t.test(t.charAt(Lt))?(s=t.charAt(Lt),Lt++):(s=r,0===Bt&&jt(wt));else i=o;if(i!==r&&(i=t.substring(n,Lt)),(n=i)!==r){for(i=Lt,s=[],St.test(t.charAt(Lt))?(a=t.charAt(Lt),Lt++):(a=r,0===Bt&&jt(Mt));a!==r;)s.push(a),St.test(t.charAt(Lt))?(a=t.charAt(Lt),Lt++):(a=r,0===Bt&&jt(Mt));s!==r&&(s=t.substring(i,Lt)),(i=s)!==r?(Nt=e,e=n=Tt(n,i)):(Lt=e,e=o)}else Lt=e,e=o;return e}function an(){var e,n,i,s,a;if(e=Lt,n=[],Se.test(t.charAt(Lt))?(i=t.charAt(Lt),Lt++):(i=r,0===Bt&&jt(Me)),i!==r)for(;i!==r;)n.push(i),Se.test(t.charAt(Lt))?(i=t.charAt(Lt),Lt++):(i=r,0===Bt&&jt(Me));else n=o;if(n!==r)if(46===t.charCodeAt(Lt)?(i=Pt,Lt++):(i=r,0===Bt&&jt(kt)),i!==r){if(s=[],Se.test(t.charAt(Lt))?(a=t.charAt(Lt),Lt++):(a=r,0===Bt&&jt(Me)),a!==r)for(;a!==r;)s.push(a),Se.test(t.charAt(Lt))?(a=t.charAt(Lt),Lt++):(a=r,0===Bt&&jt(Me));else s=o;s!==r?(Nt=e,e=n=It(n,s)):(Lt=e,e=o)}else Lt=e,e=o;else Lt=e,e=o;if(e===r){if(e=Lt,n=[],Se.test(t.charAt(Lt))?(i=t.charAt(Lt),Lt++):(i=r,0===Bt&&jt(Me)),i!==r)for(;i!==r;)n.push(i),Se.test(t.charAt(Lt))?(i=t.charAt(Lt),Lt++):(i=r,0===Bt&&jt(Me));else n=o;n!==r&&(Nt=e,n=Ot(n)),e=n}return e}function on(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])e[n]=arguments[t][n];return e}if((n=a())!==r&&Lt===t.length)return n;throw n!==r&&Lt<t.length&&jt({type:"end",description:"end of input"}),function(n,i,r){var s=function(e){return Dt!==e&&(Dt>e&&(Dt=0,zt={line:1,column:1,seenCR:!1}),function(e,n,i){var r,s;for(r=n;r<i;r++)"\n"===(s=t.charAt(r))?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):"\r"===s||"\u2028"===s||"\u2029"===s?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1)}(zt,Dt,e),Dt=e),zt}(r),a=r<t.length?t.charAt(r):null;return null!==i&&function(e){var t=1;for(e.sort((function(e,t){return e.description<t.description?-1:e.description>t.description?1:0}));t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}(i),new e(null!==n?n:function(e,t){var n,i=new Array(e.length);for(n=0;n<e.length;n++)i[n]=e[n].description;return"Expected "+(e.length>1?i.slice(0,-1).join(", ")+" or "+i[e.length-1]:i[0])+" but "+(t?'"'+function(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,(function(e){return"\\x0"+t(e)})).replace(/[\x10-\x1F\x80-\xFF]/g,(function(e){return"\\x"+t(e)})).replace(/[\u0180-\u0FFF]/g,(function(e){return"\\u0"+t(e)})).replace(/[\u1080-\uFFFF]/g,(function(e){return"\\u"+t(e)}))}(t)+'"':"end of input")+" found."}(i,a),i,a,r,s.line,s.column)}(null,Ft,Ut)}}}();function zT(e,t){e.equalSpacerIndex=e.equalSpacerIndex||1;const n="_~"+e.lineIndex+":"+e.equalSpacerIndex+"~";e.equalSpacerIndex>1&&e.constraints.push({view1:"_~"+e.lineIndex+":1~",attr1:e.horizontal?OT.WIDTH:OT.HEIGHT,relation:e.relation.relation||LT.EQU,view2:n,attr2:e.horizontal?OT.WIDTH:OT.HEIGHT,priority:e.relation.priority}),e.equalSpacerIndex++,e.relation.view||e.relation.multiplier&&1!==e.relation.multiplier?(e.constraints.push({view1:n,attr1:e.horizontal?OT.WIDTH:OT.HEIGHT,relation:e.relation.relation||LT.EQU,view2:e.relation.view,attr2:e.horizontal?OT.WIDTH:OT.HEIGHT,priority:e.relation.priority,multiplier:e.relation.multiplier}),e.relation.multiplier=void 0):e.relation.constant&&(e.constraints.push({view1:n,attr1:e.horizontal?OT.WIDTH:OT.HEIGHT,relation:LT.EQU,view2:null,attr2:OT.CONST,priority:e.relation.priority,constant:e.relation.constant}),e.relation.constant=void 0);for(var i=0;i<e.prevViews.length;i++){const r=e.prevViews[i];switch(e.orientation){case 1:e.prevAttr=r!==t?OT.RIGHT:OT.LEFT,e.curAttr=OT.LEFT;break;case 2:e.prevAttr=r!==t?OT.BOTTOM:OT.TOP,e.curAttr=OT.TOP;break;case 4:e.prevAttr=OT.ZINDEX,e.curAttr=OT.ZINDEX,e.relation.constant=r!==t?"default":0}e.constraints.push({view1:r,attr1:e.prevAttr,relation:e.relation.relation,view2:n,attr2:e.curAttr,priority:e.relation.priority})}e.prevViews=[n]}function UT(e,t){e.proportionalSpacerIndex=e.proportionalSpacerIndex||1;const n="_-"+e.lineIndex+":"+e.proportionalSpacerIndex+"-";e.proportionalSpacerIndex++,e.constraints.push({view1:n,attr1:e.horizontal?OT.WIDTH:OT.HEIGHT,relation:e.relation.relation||LT.EQU,view2:e.relation.view,attr2:e.horizontal?OT.WIDTH:OT.HEIGHT,priority:e.relation.priority,multiplier:e.relation.multiplier}),e.relation.multiplier=void 0;for(var i=0;i<e.prevViews.length;i++){const r=e.prevViews[i];switch(e.orientation){case 1:e.prevAttr=r!==t?OT.RIGHT:OT.LEFT,e.curAttr=OT.LEFT;break;case 2:e.prevAttr=r!==t?OT.BOTTOM:OT.TOP,e.curAttr=OT.TOP;break;case 4:e.prevAttr=OT.ZINDEX,e.curAttr=OT.ZINDEX,e.relation.constant=r!==t?"default":0}e.constraints.push({view1:r,attr1:e.prevAttr,relation:e.relation.relation,view2:n,attr2:e.curAttr,priority:e.relation.priority})}e.prevViews=[n]}function FT(e,t,n){let i;for(var r=1;r<=4;r*=2)if(n.orientations&r&&n.stack.orientation!==r&&!(n.stack.processedOrientations&r)){n.stack.processedOrientations=n.stack.processedOrientations|r,i=i||{name:t,type:"stack"};for(var s=0,a=n.stack.subViews.length;s<a;s++)4===r?e.constraints.push({view1:i,attr1:OT.ZINDEX,relation:LT.EQU,view2:n.stack.subViews[s],attr2:OT.ZINDEX}):(e.constraints.push({view1:i,attr1:2===r?OT.HEIGHT:OT.WIDTH,relation:LT.EQU,view2:n.stack.subViews[s],attr2:2===r?OT.HEIGHT:OT.WIDTH}),e.constraints.push({view1:i,attr1:2===r?OT.TOP:OT.LEFT,relation:LT.EQU,view2:n.stack.subViews[s],attr2:2===r?OT.TOP:OT.LEFT}))}}function BT(e,t){if(!0===t&&(t=e.match(/\.\.\d+$/))&&(e=e.substring(0,e.length-t[0].length),t=parseInt(t[0].substring(2))),!t)return[e];var n,i=e.match(/\d+$/),r=[];if(i)for(e=e.substring(0,e.length-i[0].length),n=parseInt(i);n<=t;n++)r.push(e+n);else for(r.push(e),n=2;n<=t;n++)r.push(e+n);return r}function VT(e,t,n){const i=n?n.view:null,r=[];let s,a=[];i&&(t.push({view:i}),a.push(i));for(var o=0;o<t.length;o++){let n=t[o];if(!Array.isArray(n)&&n.hasOwnProperty("view")||Array.isArray(n)&&n[0].view&&!n[0].relation){const t=Array.isArray(n)?n:[n];for(var l=0;l<t.length;l++){n=t[l];const o=","===n?[]:n.view?BT(n.view,n.range):[null];for(var c=0;c<o.length;c++){const t=o[c];if(a.push(t),t!==i&&(r.push(t),s=e.subViews[t],s||(s={orientations:0},e.subViews[t]=s),s.orientations=s.orientations|e.orientation,s.stack&&FT(e,t,s)),void 0!==e.prevViews&&void 0!==t&&e.relation&&"none"!==e.relation.relation)for(var u=0;u<e.prevViews.length;u++){const n=e.prevViews[u];switch(e.orientation){case 1:e.prevAttr=n!==i?OT.RIGHT:OT.LEFT,e.curAttr=t!==i?OT.LEFT:OT.RIGHT;break;case 2:e.prevAttr=n!==i?OT.BOTTOM:OT.TOP,e.curAttr=t!==i?OT.TOP:OT.BOTTOM;break;case 4:e.prevAttr=OT.ZINDEX,e.curAttr=OT.ZINDEX,e.relation.constant=n?e.relation.constant||"default":0}e.constraints.push({view1:n,attr1:e.prevAttr,relation:e.relation.relation,view2:t,attr2:e.curAttr,multiplier:e.relation.multiplier,constant:"default"!==e.relation.constant&&e.relation.constant?-e.relation.constant:e.relation.constant,priority:e.relation.priority})}const l=n.constraints;if(l)for(var h=0;h<l.length;h++)e.prevAttr=e.horizontal?OT.WIDTH:OT.HEIGHT,e.curAttr=l[h].view||l[h].multiplier?l[h].attribute||e.prevAttr:l[h].variable?OT.VARIABLE:OT.CONST,e.constraints.push({view1:t,attr1:e.prevAttr,relation:l[h].relation,view2:l[h].view,attr2:e.curAttr,multiplier:l[h].multiplier,constant:l[h].constant,priority:l[h].priority});n.cascade&&VT(e,n.cascade,n)}}}else","!==n&&(e.prevViews=a,a=[],e.relation=n[0],void 0!==e.prevViews&&(e.relation.equalSpacing&&zT(e,i),e.relation.multiplier&&UT(e,i)))}if(i){if(s=e.subViews[i],s){if(s.stack){const e=new Error('A stack named "'+i+'" has already been created');throw e.column=n.$parserOffset+1,e}}else s={orientations:e.orientation},e.subViews[i]=s;s.stack={orientation:e.orientation,processedOrientations:e.orientation,subViews:r},FT(e,i,s)}}const jT=["viewport","spacing","colors","shapes","widths","heights"];function HT(){return new GT}class GT{index={};array=[];size(){return this.array.length}empty(){return 0===this.array.length}itemAt(e){return this.array[e]}contains(e){return void 0!==this.index[e.id()]}find(e){const t=this.index[e.id()];return void 0===t?void 0:this.array[t]}setDefault(e,t){const n=this.index[e.id()];if(void 0===n){const n=new WT(e,t());return this.index[e.id()]=this.array.length,this.array.push(n),n}return this.array[n]}insert(e,t){const n=new WT(e,t),i=this.index[e.id()];return void 0===i?(this.index[e.id()]=this.array.length,this.array.push(n)):this.array[i]=n,n}erase(e){const t=this.index[e.id()];if(void 0===t)return;this.index[e.id()]=void 0;const n=this.array[t],i=this.array.pop();return n!==i&&(this.array[t]=i,this.index[i.first.id()]=t),n}copy(){const e=new GT;for(let t=0;t<this.array.length;t++){const n=this.array[t].copy();e.array[t]=n,e.index[n.first.id()]=t}return e}}class WT{first;second;constructor(e,t){this.first=e,this.second=t}copy(){return new WT(this.first,this.second)}}class XT{constructor(e=""){this._name=e}id(){return this._id}name(){return this._name}setName(e){this._name=e}context(){return this._context}setContext(e){this._context=e}value(){return this._value}setValue(e){this._value=e}plus(e){return new YT(this,e)}minus(e){return new YT(this,"number"==typeof e?-e:[-1,e])}multiply(e){return new YT([e,this])}divide(e){return new YT([1/e,this])}toJSON(){return{name:this._name,value:this._value}}toString(){return this._context+"["+this._name+":"+this._value+"]"}_name;_value=0;_context=null;_id=qT++}let qT=0;class YT{constructor(){let e=function(e){let t=0,n=()=>0,i=HT();for(let r=0,s=e.length;r<s;++r){let s=e[r];if("number"==typeof s)t+=s;else if(s instanceof XT)i.setDefault(s,n).second+=1;else if(s instanceof YT){t+=s.constant();let e=s.terms();for(let t=0,r=e.size();t<r;t++){let r=e.itemAt(t);i.setDefault(r.first,n).second+=r.second}}else{if(!(s instanceof Array))throw new Error("invalid Expression argument: "+s);{if(2!==s.length)throw new Error("array must have length 2");let e=s[0],r=s[1];if("number"!=typeof e)throw new Error("array item 0 must be a number");if(r instanceof XT)i.setDefault(r,n).second+=e;else{if(!(r instanceof YT))throw new Error("array item 1 must be a variable or expression");{t+=r.constant()*e;let s=r.terms();for(let t=0,r=s.size();t<r;t++){let r=s.itemAt(t);i.setDefault(r.first,n).second+=r.second*e}}}}}}return{terms:i,constant:t}}(arguments);this._terms=e.terms,this._constant=e.constant}terms(){return this._terms}constant(){return this._constant}value(){let e=this._constant;for(let t=0,n=this._terms.size();t<n;t++){let n=this._terms.itemAt(t);e+=n.first.value()*n.second}return e}plus(e){return new YT(this,e)}minus(e){return new YT(this,"number"==typeof e?-e:[-1,e])}multiply(e){return new YT([e,this])}divide(e){return new YT([1/e,this])}isConstant(){return 0==this._terms.size()}toString(){let e=this._terms.array.map((function(e){return e.second+"*"+e.first.toString()})).join(" + ");return this.isConstant()||0===this._constant||(e+=" + "),e+=this._constant,e}_terms;_constant}class $T{static create(e,t,n,i=1){let r=0;return r+=1e6*Math.max(0,Math.min(1e3,e*i)),r+=1e3*Math.max(0,Math.min(1e3,t*i)),r+=Math.max(0,Math.min(1e3,n*i)),r}static required=$T.create(1e3,1e3,1e3);static strong=$T.create(1,0,0);static medium=$T.create(0,1,0);static weak=$T.create(0,0,1);static clip(e){return Math.max(0,Math.min($T.required,e))}}var ZT;!function(e){e[e.Le=0]="Le",e[e.Ge=1]="Ge",e[e.Eq=2]="Eq"}(ZT||(ZT={}));class KT{constructor(e,t,n,i=$T.required){this._operator=t,this._strength=$T.clip(i),this._expression=void 0===n&&e instanceof YT?e:e.minus(n)}id(){return this._id}expression(){return this._expression}op(){return this._operator}strength(){return this._strength}toString(){return this._expression.toString()+" "+["<=",">=","="][this._operator]+" 0 ("+this._strength.toString()+")"}_expression;_operator;_strength;_id=JT++}let JT=0;class QT{maxIterations=1e3;constructor(){}createConstraint(e,t,n,i=$T.required){let r=new KT(e,t,n,i);return this.addConstraint(r),r}addConstraint(e){if(void 0!==this._cnMap.find(e))throw new Error("duplicate constraint");let t=this._createRow(e),n=t.row,i=t.tag,r=this._chooseSubject(n,i);if(r.type()===tA.Invalid&&n.allDummies()){if(!eA(n.constant()))throw new Error("unsatisfiable constraint");r=i.marker}if(r.type()===tA.Invalid){if(!this._addWithArtificialVariable(n))throw new Error("unsatisfiable constraint")}else n.solveFor(r),this._substitute(r,n),this._rowMap.insert(r,n);this._cnMap.insert(e,i),this._optimize(this._objective)}removeConstraint(e){let t=this._cnMap.erase(e);if(void 0===t)throw new Error("unknown constraint");this._removeConstraintEffects(e,t.second);let n=t.second.marker,i=this._rowMap.erase(n);if(void 0===i){let e=this._getMarkerLeavingSymbol(n);if(e.type()===tA.Invalid)throw new Error("failed to find leaving row");i=this._rowMap.erase(e),i.second.solveForEx(e,n),this._substitute(n,i.second)}this._optimize(this._objective)}hasConstraint(e){return this._cnMap.contains(e)}getConstraints(){return this._cnMap.array.map((({first:e})=>e))}addEditVariable(e,t){if(void 0!==this._editMap.find(e))throw new Error("duplicate edit variable");if((t=$T.clip(t))===$T.required)throw new Error("bad required strength");let n=new YT(e),i=new KT(n,ZT.Eq,void 0,t);this.addConstraint(i);let r={tag:this._cnMap.find(i).second,constraint:i,constant:0};this._editMap.insert(e,r)}removeEditVariable(e){let t=this._editMap.erase(e);if(void 0===t)throw new Error("unknown edit variable");this.removeConstraint(t.second.constraint)}hasEditVariable(e){return this._editMap.contains(e)}suggestValue(e,t){let n=this._editMap.find(e);if(void 0===n)throw new Error("unknown edit variable");let i=this._rowMap,r=n.second,s=t-r.constant;r.constant=t;let a=r.tag.marker,o=i.find(a);if(void 0!==o)return o.second.add(-s)<0&&this._infeasibleRows.push(a),void this._dualOptimize();let l=r.tag.other;if(o=i.find(l),void 0!==o)return o.second.add(s)<0&&this._infeasibleRows.push(l),void this._dualOptimize();for(let e=0,t=i.size();e<t;++e){let t=i.itemAt(e),n=t.second,r=n.coefficientFor(a);0!==r&&n.add(s*r)<0&&t.first.type()!==tA.External&&this._infeasibleRows.push(t.first)}this._dualOptimize()}updateVariables(){let e=this._varMap,t=this._rowMap;for(let n=0,i=e.size();n<i;++n){let i=e.itemAt(n),r=t.find(i.second);void 0!==r?i.first.setValue(r.second.constant()):i.first.setValue(0)}}_getVarSymbol(e){return this._varMap.setDefault(e,(()=>this._makeSymbol(tA.External))).second}_createRow(e){let t=e.expression(),n=new rA(t.constant()),i=t.terms();for(let e=0,t=i.size();e<t;++e){let t=i.itemAt(e);if(!eA(t.second)){let e=this._getVarSymbol(t.first),i=this._rowMap.find(e);void 0!==i?n.insertRow(i.second,t.second):n.insertSymbol(e,t.second)}}let r=this._objective,s=e.strength(),a={marker:iA,other:iA};switch(e.op()){case ZT.Le:case ZT.Ge:{let t=e.op()===ZT.Le?1:-1,i=this._makeSymbol(tA.Slack);if(a.marker=i,n.insertSymbol(i,t),s<$T.required){let e=this._makeSymbol(tA.Error);a.other=e,n.insertSymbol(e,-t),r.insertSymbol(e,s)}break}case ZT.Eq:if(s<$T.required){let e=this._makeSymbol(tA.Error),t=this._makeSymbol(tA.Error);a.marker=e,a.other=t,n.insertSymbol(e,-1),n.insertSymbol(t,1),r.insertSymbol(e,s),r.insertSymbol(t,s)}else{let e=this._makeSymbol(tA.Dummy);a.marker=e,n.insertSymbol(e)}}return n.constant()<0&&n.reverseSign(),{row:n,tag:a}}_chooseSubject(e,t){let n=e.cells();for(let e=0,t=n.size();e<t;++e){let t=n.itemAt(e);if(t.first.type()===tA.External)return t.first}let i=t.marker.type();return(i===tA.Slack||i===tA.Error)&&e.coefficientFor(t.marker)<0?t.marker:(i=t.other.type(),(i===tA.Slack||i===tA.Error)&&e.coefficientFor(t.other)<0?t.other:iA)}_addWithArtificialVariable(e){let t=this._makeSymbol(tA.Slack);this._rowMap.insert(t,e.copy()),this._artificial=e.copy(),this._optimize(this._artificial);let n=eA(this._artificial.constant());this._artificial=null;let i=this._rowMap.erase(t);if(void 0!==i){let e=i.second;if(e.isConstant())return n;let r=this._anyPivotableSymbol(e);if(r.type()===tA.Invalid)return!1;e.solveForEx(t,r),this._substitute(r,e),this._rowMap.insert(r,e)}let r=this._rowMap;for(let e=0,n=r.size();e<n;++e)r.itemAt(e).second.removeSymbol(t);return this._objective.removeSymbol(t),n}_substitute(e,t){let n=this._rowMap;for(let i=0,r=n.size();i<r;++i){let r=n.itemAt(i);r.second.substitute(e,t),r.second.constant()<0&&r.first.type()!==tA.External&&this._infeasibleRows.push(r.first)}this._objective.substitute(e,t),this._artificial&&this._artificial.substitute(e,t)}_optimize(e){let t=0;for(;t<this.maxIterations;){let n=this._getEnteringSymbol(e);if(n.type()===tA.Invalid)return;let i=this._getLeavingSymbol(n);if(i.type()===tA.Invalid)throw new Error("the objective is unbounded");let r=this._rowMap.erase(i).second;r.solveForEx(i,n),this._substitute(n,r),this._rowMap.insert(n,r),t++}throw new Error("solver iterations exceeded")}_dualOptimize(){let e=this._rowMap,t=this._infeasibleRows;for(;0!==t.length;){let n=t.pop(),i=e.find(n);if(void 0!==i&&i.second.constant()<0){let t=this._getDualEnteringSymbol(i.second);if(t.type()===tA.Invalid)throw new Error("dual optimize failed");let r=i.second;e.erase(n),r.solveForEx(n,t),this._substitute(t,r),e.insert(t,r)}}}_getEnteringSymbol(e){let t=e.cells();for(let e=0,n=t.size();e<n;++e){let n=t.itemAt(e),i=n.first;if(n.second<0&&i.type()!==tA.Dummy)return i}return iA}_getDualEnteringSymbol(e){let t=Number.MAX_VALUE,n=iA,i=e.cells();for(let e=0,r=i.size();e<r;++e){let r=i.itemAt(e),s=r.first,a=r.second;if(a>0&&s.type()!==tA.Dummy){let e=this._objective.coefficientFor(s)/a;e<t&&(t=e,n=s)}}return n}_getLeavingSymbol(e){let t=Number.MAX_VALUE,n=iA,i=this._rowMap;for(let r=0,s=i.size();r<s;++r){let s=i.itemAt(r),a=s.first;if(a.type()!==tA.External){let i=s.second,r=i.coefficientFor(e);if(r<0){let e=-i.constant()/r;e<t&&(t=e,n=a)}}}return n}_getMarkerLeavingSymbol(e){let t=Number.MAX_VALUE,n=t,i=t,r=iA,s=r,a=r,o=r,l=this._rowMap;for(let t=0,r=l.size();t<r;++t){let r=l.itemAt(t),c=r.second,u=c.coefficientFor(e);if(0===u)continue;let h=r.first;if(h.type()===tA.External)o=h;else if(u<0){let e=-c.constant()/u;e<n&&(n=e,s=h)}else{let e=c.constant()/u;e<i&&(i=e,a=h)}}return s!==r?s:a!==r?a:o}_removeConstraintEffects(e,t){t.marker.type()===tA.Error&&this._removeMarkerEffects(t.marker,e.strength()),t.other.type()===tA.Error&&this._removeMarkerEffects(t.other,e.strength())}_removeMarkerEffects(e,t){let n=this._rowMap.find(e);void 0!==n?this._objective.insertRow(n.second,-t):this._objective.insertSymbol(e,-t)}_anyPivotableSymbol(e){let t=e.cells();for(let e=0,n=t.size();e<n;++e){let n=t.itemAt(e),i=n.first.type();if(i===tA.Slack||i===tA.Error)return n.first}return iA}_makeSymbol(e){return new nA(e,this._idTick++)}_cnMap=function(){return HT()}();_rowMap=function(){return HT()}();_varMap=function(){return HT()}();_editMap=function(){return HT()}();_infeasibleRows=[];_objective=new rA;_artificial=null;_idTick=0}function eA(e){return e<0?-e<1e-8:e<1e-8}var tA;!function(e){e[e.Invalid=0]="Invalid",e[e.External=1]="External",e[e.Slack=2]="Slack",e[e.Error=3]="Error",e[e.Dummy=4]="Dummy"}(tA||(tA={}));class nA{constructor(e,t){this._id=t,this._type=e}id(){return this._id}type(){return this._type}_id;_type}let iA=new nA(tA.Invalid,-1);class rA{constructor(e=0){this._constant=e}cells(){return this._cellMap}constant(){return this._constant}isConstant(){return this._cellMap.empty()}allDummies(){let e=this._cellMap;for(let t=0,n=e.size();t<n;++t)if(e.itemAt(t).first.type()!==tA.Dummy)return!1;return!0}copy(){let e=new rA(this._constant);return e._cellMap=this._cellMap.copy(),e}add(e){return this._constant+=e}insertSymbol(e,t=1){eA(this._cellMap.setDefault(e,(()=>0)).second+=t)&&this._cellMap.erase(e)}insertRow(e,t=1){this._constant+=e._constant*t;let n=e._cellMap;for(let e=0,i=n.size();e<i;++e){let i=n.itemAt(e);this.insertSymbol(i.first,i.second*t)}}removeSymbol(e){this._cellMap.erase(e)}reverseSign(){this._constant=-this._constant;let e=this._cellMap;for(let t=0,n=e.size();t<n;++t){let n=e.itemAt(t);n.second=-n.second}}solveFor(e){let t=this._cellMap,n=-1/t.erase(e).second;this._constant*=n;for(let e=0,i=t.size();e<i;++e)t.itemAt(e).second*=n}solveForEx(e,t){this.insertSymbol(e,-1),this.solveFor(t)}coefficientFor(e){let t=this._cellMap.find(e);return void 0!==t?t.second:0}substitute(e,t){let n=this._cellMap.erase(e);void 0!==n&&this.insertRow(t,n.second)}_cellMap=HT();_constant}const sA=class{constructor(e){this._name=e.name,this._type=e.type,this._solver=e.solver,this._attr={},e.name||(this._attr[OT.LEFT]=new XT,this._solver.addConstraint(new KT(this._attr[OT.LEFT],ZT.Eq,0)),this._attr[OT.TOP]=new XT,this._solver.addConstraint(new KT(this._attr[OT.TOP],ZT.Eq,0)),this._attr[OT.ZINDEX]=new XT,this._solver.addConstraint(new KT(this._attr[OT.ZINDEX],ZT.Eq,0)))}toJSON(){return{name:this.name,left:this.left,top:this.top,width:this.width,height:this.height}}toString(){JSON.stringify(this.toJSON(),void 0,2)}get name(){return this._name}get left(){return this._getAttrValue(OT.LEFT)}get right(){return this._getAttrValue(OT.RIGHT)}get width(){return this._getAttrValue(OT.WIDTH)}get height(){return this._getAttrValue(OT.HEIGHT)}get intrinsicWidth(){return this._intrinsicWidth}set intrinsicWidth(e){if(void 0!==e&&e!==this._intrinsicWidth){const t=this._getAttr(OT.WIDTH);void 0===this._intrinsicWidth&&this._solver.addEditVariable(t,$T.create(this._name?998:999,1e3,1e3)),this._intrinsicWidth=e,this._solver.suggestValue(t,e),this._solver.updateVariables()}}get intrinsicHeight(){return this._intrinsicHeight}set intrinsicHeight(e){if(void 0!==e&&e!==this._intrinsicHeight){const t=this._getAttr(OT.HEIGHT);void 0===this._intrinsicHeight&&this._solver.addEditVariable(t,$T.create(this._name?998:999,1e3,1e3)),this._intrinsicHeight=e,this._solver.suggestValue(t,e),this._solver.updateVariables()}}get top(){return this._getAttrValue(OT.TOP)}get bottom(){return this._getAttrValue(OT.BOTTOM)}get centerX(){return this._getAttrValue(OT.CENTERX)}get centerY(){return this._getAttrValue(OT.CENTERY)}get zIndex(){return this._getAttrValue(OT.ZINDEX)}get type(){return this._type}getValue(e){return this._attr[e]?this._attr[e].value():void 0}_getAttr(e){if(this._attr[e])return this._attr[e];switch(this._attr[e]=new XT,e){case OT.RIGHT:this._getAttr(OT.LEFT),this._getAttr(OT.WIDTH),this._solver.addConstraint(new KT(this._attr[e],ZT.Eq,this._attr[OT.LEFT].plus(this._attr[OT.WIDTH])));break;case OT.BOTTOM:this._getAttr(OT.TOP),this._getAttr(OT.HEIGHT),this._solver.addConstraint(new KT(this._attr[e],ZT.Eq,this._attr[OT.TOP].plus(this._attr[OT.HEIGHT])));break;case OT.CENTERX:this._getAttr(OT.LEFT),this._getAttr(OT.WIDTH),this._solver.addConstraint(new KT(this._attr[e],ZT.Eq,this._attr[OT.LEFT].plus(this._attr[OT.WIDTH].divide(2))));break;case OT.CENTERY:this._getAttr(OT.TOP),this._getAttr(OT.HEIGHT),this._solver.addConstraint(new KT(this._attr[e],ZT.Eq,this._attr[OT.TOP].plus(this._attr[OT.HEIGHT].divide(2))))}return this._solver.updateVariables(),this._attr[e]}_getAttrValue(e){return this._getAttr(e).value()}},aA=$T.create(0,1e3,1e3),oA={Attribute:OT,Relation:LT,Priority:{REQUIRED:1e3,DEFAULTHIGH:750,DEFAULTLOW:250},VisualFormat:class{static parseLine(e,t){if(0===e.length||t&&t.extended&&0===e.indexOf("//"))return[];const n=t&&t.extended?DT.parse(e):NT.parse(e);if(t&&"raw"===t.outFormat)return[n];let i={constraints:[],lineIndex:(t?t.lineIndex:void 0)||1,subViews:(t?t.subViews:void 0)||{}};if("attribute"===n.type)for(let e=0;e<n.attributes.length;e++){const t=n.attributes[e];for(let e=0;e<t.predicates.length;e++){const r=t.predicates[e];i.constraints.push({view1:n.view,attr1:t.attr,relation:r.relation,view2:r.view,attr2:r.attribute||t.attr,multiplier:r.multiplier,constant:r.constant,priority:r.priority})}}else switch(n.orientation){case"horizontal":i.orientation=1,i.horizontal=!0,VT(i,n.cascade,null);break;case"vertical":i.orientation=2,VT(i,n.cascade,null);break;case"horzvert":i.orientation=1,i.horizontal=!0,VT(i,n.cascade,null),i={constraints:i.constraints,lineIndex:i.lineIndex,subViews:i.subViews,orientation:2},VT(i,n.cascade,null);break;case"zIndex":i.orientation=4,VT(i,n.cascade,null)}return i.constraints}static parse(e,t){const n=t&&t.lineSeparator?t.lineSeparator:"\n";if(!Array.isArray(e)&&e.indexOf(n)<0)try{return this.parseLine(e,t)}catch(t){throw t.source=e,t}let i;e=Array.isArray(e)?e:[e];let r,s=[],a=0;const o={lineIndex:a,extended:t&&t.extended,strict:!t||void 0===t.strict||t.strict,outFormat:t?t.outFormat:void 0,subViews:{}};try{for(var l=0;l<e.length;l++){i=e[l].split(n);for(var c=0;c<i.length;c++)r=i[c],a++,o.lineIndex=a,o.strict||(r=r.trim()),(o.strict||r.length)&&(s=s.concat(this.parseLine(r,o)))}}catch(e){throw e.source=r,e.line=a,e}return s}static parseMetaInfo(e,t){const n=t&&t.lineSeparator?t.lineSeparator:"\n",i=t?t.prefix:void 0;e=Array.isArray(e)?e:[e];const r={};for(var s,a=0;a<e.length;a++){const t=e[a].split(n);for(var o=0;o<t.length;o++){const e=t[o];for(var l=0;l<jT.length;l++)for(var c=0;c<(i?2:1);c++){const t=jT[l],n=(0===c?"":i)+t;if(0===e.indexOf("//"+n+" ")){const i=e.substring(3+n.length).split(" ");for(var u=0;u<i.length;u++){r[t]=r[t]||{};const e=i[u].split(":"),n=BT(e[0],!0);for(var h=0;h<n.length;h++)r[t][n[h]]=e.length>1?e[1]:""}}else 0===e.indexOf("//"+n+":")&&(r[t]=e.substring(3+n.length))}}}if(r.viewport){const e=r.viewport;var d=e["aspect-ratio"];d&&(d=d.split("/"),e["aspect-ratio"]=parseInt(d[0])/parseInt(d[1])),void 0!==e.height&&(e.height="intrinsic"===e.height||parseInt(e.height)),void 0!==e.width&&(e.width="intrinsic"===e.width||parseInt(e.width)),void 0!==e["max-height"]&&(e["max-height"]=parseInt(e["max-height"])),void 0!==e["max-width"]&&(e["max-width"]=parseInt(e["max-width"])),void 0!==e["min-height"]&&(e["min-height"]=parseInt(e["min-height"])),void 0!==e["min-width"]&&(e["min-width"]=parseInt(e["min-width"]))}if(r.widths)for(s in r.widths){const e="intrinsic"===r.widths[s]||parseInt(r.widths[s]);r.widths[s]=e,(void 0===e||isNaN(e))&&delete r.widths[s]}if(r.heights)for(s in r.heights){const e="intrinsic"===r.heights[s]||parseInt(r.heights[s]);r.heights[s]=e,(void 0===e||isNaN(e))&&delete r.heights[s]}if(r.spacing){const e=JSON.parse(r.spacing);if(r.spacing=e,Array.isArray(e)){for(var p=0,f=e.length;p<f;p++)if(isNaN(e[p])){delete r.spacing;break}}else(void 0===e||isNaN(e))&&delete r.spacing}return r}},View:class{constructor(e){this._solver=new QT,this._subViews={},this._parentSubView=new sA({solver:this._solver}),this.setSpacing(e&&void 0!==e.spacing?e.spacing:8),e&&(void 0===e.width&&void 0===e.height||this.setSize(e.width,e.height),e.constraints&&this.addConstraints(e.constraints))}setSize(e,t){return this._parentSubView.intrinsicWidth=e,this._parentSubView.intrinsicHeight=t,this}get width(){return this._parentSubView.intrinsicWidth}get height(){return this._parentSubView.intrinsicHeight}get fittingWidth(){return this._parentSubView.width}get fittingHeight(){return this._parentSubView.height}setSpacing(e){if(Array.isArray(e))switch(e.length){case 1:e=[e[0],e[0],e[0],e[0],e[0],e[0],1];break;case 2:e=[e[1],e[0],e[1],e[0],e[0],e[1],1];break;case 3:e=[e[1],e[0],e[1],e[0],e[0],e[1],e[2]];break;case 6:e=[e[0],e[1],e[2],e[3],e[4],e[5],1];break;case 7:break;default:throw"Invalid spacing syntax"}else e=[e,e,e,e,e,e,1];if(!this._compareSpacing(this._spacing,e)&&(this._spacing=e,this._spacingVars)){for(var t=0;t<this._spacingVars.length;t++)this._spacingVars[t]&&this._solver.suggestValue(this._spacingVars[t],this._spacing[t]);this._solver.updateVariables()}return this}_compareSpacing(e,t){if(e===t)return!0;if(!e||!t)return!1;for(var n=0;n<7;n++)if(e[n]!==t[n])return!1;return!0}addConstraint(e){return this._addConstraint(e),this._solver.updateVariables(),this}addConstraints(e){for(var t=0;t<e.length;t++)this._addConstraint(e[t]);return this._solver.updateVariables(),this}_addConstraint(e){let t;const n=void 0!==e.multiplier?e.multiplier:1;let i=void 0!==e.constant?e.constant:0;"default"===i&&(i=this._getSpacing(e));const r=this._getSubView(e.view1)._getAttr(e.attr1);let s;e.attr2===OT.CONST?s=this._getConst(void 0,e.constant):(s=this._getSubView(e.view2)._getAttr(e.attr2),1!==n&&i?s=s.multiply(n).plus(i):i?s=s.plus(i):1!==n&&(s=s.multiply(n)));const a=void 0!==e.priority&&e.priority<1e3?$T.create(0,e.priority,1e3):aA;switch(e.relation){case LT.EQU:t=new KT(r,ZT.Eq,s,a);break;case LT.GEQ:t=new KT(r,ZT.Ge,s,a);break;case LT.LEQ:t=new KT(r,ZT.Le,s,a);break;default:throw"Invalid relation specified: "+e.relation}this._solver.addConstraint(t)}_getSpacing(e){let t=4;if(e.view1||"left"!==e.attr1)if(e.view1||"top"!==e.attr1)if(e.view2||"right"!==e.attr2)if(e.view2||"bottom"!==e.attr2)switch(e.attr1){case"left":case"right":case"centerX":case"leading":case"trailing":t=4;break;case"zIndex":t=6;break;default:t=5}else t=2;else t=1;else t=0;else t=3;return this._spacingVars=this._spacingVars||new Array(7),this._spacingExpr=this._spacingExpr||new Array(7),this._spacingVars[t]||(this._spacingVars[t]=new XT,this._solver.addEditVariable(this._spacingVars[t],$T.create(999,1e3,1e3)),this._spacingExpr[t]=this._spacingVars[t].multiply(-1),this._solver.suggestValue(this._spacingVars[t],this._spacing[t])),this._spacingExpr[t]}_getSubView(e){return e?e.name?(this._subViews[e.name]=this._subViews[e.name]||new sA({name:e.name,solver:this._solver}),this._subViews[e.name]._type=this._subViews[e.name]._type||e.type,this._subViews[e.name]):(this._subViews[e]=this._subViews[e]||new sA({name:e,solver:this._solver}),this._subViews[e]):this._parentSubView}_getConst(e,t){const n=new XT;return this._solver.addConstraint(new KT(n,ZT.Eq,t)),n}get subViews(){return this._subViews}},SubView:sA};var lA=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},cA=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let uA=(()=>{let e,t,n,i=[pt("lume-autolayout",oa)],r=[],s=ua,a=[],o=[];var l=class extends s{static{t=this}static{const c="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;n=[et],lA(null,null,n,{kind:"field",name:"visualFormat",static:!1,private:!1,access:{has:e=>"visualFormat"in e,get:e=>e.visualFormat,set:(e,t)=>{e.visualFormat=t}},metadata:c},a,o),lA(null,e={value:t},i,{kind:"class",name:t.name,metadata:c},null,r),l=t=e.value,c&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:c})}static DEFAULT_PARSE_OPTIONS={extended:!0,strict:!1};visualFormat=cA(this,a,"");constructor(e){super(),this.addEventListener("sizechange",this.#Gn),this.addEventListener("reflow",this.#Gn),e&&(e.visualFormat&&this.setVisualFormat(e.visualFormat),e.layoutOptions&&this.setLayoutOptions(e.layoutOptions))}connectedCallback(){super.connectedCallback(),this.createEffect((()=>{this.setVisualFormat(this.visualFormat||"")}))}#Wn=cA(this,o);childConnectedCallback(e){if(!(e instanceof ua))throw new Error("Child elements of Autolayout must be instances of LUME.Element3D.");super.childConnectedCallback(e),this.#Wn&&this.#Xn()}childDisconnectedCallback(e){if(!(e instanceof ua))throw new Error("Child elements of Autolayout must be instances of LUME.Element3D.");if(super.childDisconnectedCallback(e),!this.#Wn)return;const t=this.#qn;for(const n in t)if(t[n]===e){delete t[n];break}this.#Xn()}#Yn=new Event("reflow");reflowLayout(){return this.#$n||(this.#$n=!0,Kr.once((()=>(this.emit("reflow"),this.dispatchEvent(this.#Yn))))),this}setVisualFormat(e,t){this._visualFormat=e;var n=oA.VisualFormat.parse(e,t||l.DEFAULT_PARSE_OPTIONS);return this.#Zn=oA.VisualFormat.parseMetaInfo(e),this.#Wn=new oA.View({constraints:n}),this.#Xn(),this.reflowLayout(),this}setLayoutOptions(e){return this.#Kn=e||{},this.reflowLayout(),this}addToLayout(e,t){return this.append(e),t&&(this.#qn[t]=e),this.reflowLayout(),e}removeFromLayout(e,t){if(e&&t)this.removeChild(e),delete this.#qn[t];else if(e){for(t in this.#qn)if(this.#qn[t]===e){delete this.#qn[t];break}this.removeChild(e)}else t&&(this.removeChild(this.#qn[t]),delete this.#qn[t]);this.reflowLayout()}#Kn={};#qn={};#$n=!1;#Zn;#Jn(e){for(var t in e){var n=this.#Wn.subViews[t],i=this.#qn[t];n&&i&&(n.intrinsicWidth=i.calculatedSize.x)}}#Qn(e){for(var t in e){var n=this.#Wn.subViews[t],i=this.#qn[t];n&&i&&(n.intrinsicHeight=i.calculatedSize.y)}}#ei(e,t){return e=[void 0!==t.width&&!0!==t.width?t.width:Math.max(Math.min(e[0],t["max-width"]||e[0]),t["min-width"]||0),void 0!==t.height&&!0!==t.height?t.height:Math.max(Math.min(e[1],t["max-height"]||e[1]),t["min-height"]||0)],!0===t.width&&!0===t.height?(e[0]=this.#Wn.fittingWidth,e[1]=this.#Wn.fittingHeight):!0===t.width?(this.#Wn.setSize(void 0,e[1]),e[0]=this.#Wn.fittingWidth):!0===t.height?(this.#Wn.setSize(e[0],void 0),e[1]=this.#Wn.fittingHeight):(e=t["aspect-ratio"]?[Math.min(e[0],e[1]*t["aspect-ratio"]),Math.min(e[1],e[0]/t["aspect-ratio"])]:e,this.#Wn.setSize(e[0],e[1])),e}#Gn=()=>{if(this.#Wn){var e,t,n=this.size.toArray();(this.#Kn.spacing||this.#Zn.spacing)&&this.#Wn.setSpacing(this.#Kn.spacing||this.#Zn.spacing);var i=this.#Kn.widths||this.#Zn.widths;i&&this.#Jn(i);var r=this.#Kn.heights||this.#Zn.heights;if(r&&this.#Qn(r),this.#Kn.viewport||this.#Zn.viewport){var s=this.#ei(n,this.#Kn.viewport||this.#Zn.viewport);e=(n[0]-s[0])/2,t=(n[1]-s[1])/2}else this.#Wn.setSize(n[0],n[1]),e=0,t=0;for(var a in this.#Wn.subViews){var o=this.#Wn.subViews[a];if(0!==a.indexOf("_")&&"stack"!==o.type){var l=this.#qn[a];l&&this.#ti(l,o,e,t,i,r)}}this.#$n&&(this.#$n=!1)}};#ti(e,t,n,i,r,s){e.sizeMode=[r&&!0===r[key]?"proportional":"literal",s&&!0===s[key]?"proportional":"literal"],e.size=[r&&!0===r[key]?1:t.width,s&&!0===s[key]?1:t.height],e.position=[n+t.left,i+t.top,5*t.zIndex]}#Xn(){const e=this.#Wn.subViews,t=Object.keys(e),n=this.#qn;for(var i of t){var r=e[i];if(0!==i.indexOf("_")&&"stack"!==r.type){var s=n[i];s||(s=this.querySelector("."+i))&&s.parentElement===this&&(n[i]=s)}}this.#ni()}#ni(){const e=this.#Wn.subViews,t=Object.keys(e),n=this.#qn,i=Object.keys(n);for(const e of i)t.includes(e)?n[e].visible=!0:n[e].visible=!1}static{cA(t,r)}};return l=t})();(()=>{let e,t,n=[pt("lume-autolayout-node",oa)],i=[],r=uA;(class extends r{static{t=this}static{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(r[Symbol.metadata]??null):void 0;(function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0})(null,e={value:t},n,{kind:"class",name:t.name,metadata:s},null,i),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e)}(t,i)}})})();(()=>{let e,t,n=[pt("lume-cube-layout",oa)],i=[],r=ua;(class extends r{static{t=this}static{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(r[Symbol.metadata]??null):void 0;(function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0})(null,e={value:t},n,{kind:"class",name:t.name,metadata:s},null,i),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e)}(t,i)}#ii=[];hasShadow=!0;#ri=!1;connectedCallback(){if(super.connectedCallback(),this.#ri)return;for(let e=0;e<6;e+=1)this.#si(e);const e=document.createElement("slot");this.root.appendChild(e)}#si(e){const t=(new ua).set({alignPoint:new Zr(.5,.5,.5)}),n=(new ua).set({mountPoint:new Zr(.5,.5),size:new ts(this.size.x,this.size.x)});this.#ii.push(n),t.append(n);const i=document.createElement("slot");n.append(i),i.name=0===e?"front":1===e?"right":2===e?"back":3===e?"left":4===e?"top":"bottom",e<4?t.rotation.y=90*e:t.rotation.x=90*(e%2?-1:1),n.position.z=this.size.x/2,this.root.appendChild(t)}setContent(e){for(let t=0;t<6;t+=1)this.#ii[t].innerHTML="",this.#ii[t].append(e[t]);return this}})})();(()=>{let e,t,n=[pt("lume-push-pane-layout",oa)],i=[],r=dS;(class extends r{static{t=this}static{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(r[Symbol.metadata]??null):void 0;(function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0})(null,e={value:t},n,{kind:"class",name:t.name,metadata:s},null,i),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e)}(t,i)}})})();class hA extends Br{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new po(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(t.object.target=this.target.uuid),t}}var dA=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},pA=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let fA=(()=>{let e,t,n,i,r=[pt],s=[],a=ua,o=[],l=[],c=[],u=[];return class extends a{static{t=this}static{const h="function"==typeof Symbol&&Symbol.metadata?Object.create(a[Symbol.metadata]??null):void 0;n=[et],i=[ct],dA(null,null,n,{kind:"field",name:"color",static:!1,private:!1,access:{has:e=>"color"in e,get:e=>e.color,set:(e,t)=>{e.color=t}},metadata:h},o,l),dA(null,null,i,{kind:"field",name:"intensity",static:!1,private:!1,access:{has:e=>"intensity"in e,get:e=>e.intensity,set:(e,t)=>{e.intensity=t}},metadata:h},c,u),dA(null,e={value:t},r,{kind:"class",name:t.name,metadata:h},null,s),t=e.value,h&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:h}),pA(t,s)}color=pA(this,o,"white");intensity=(pA(this,l),pA(this,c,1));makeThreeObject3d(){return new hA}connectedCallback(){super.connectedCallback(),this.createEffect((()=>{"object"==typeof this.color&&(this.three.color=this.color),this.three.color=new po(this.color),this.needsUpdate()})),this.createEffect((()=>{this.three.intensity=this.intensity,this.needsUpdate()}))}constructor(){super(...arguments),pA(this,u)}},t})();class mA extends hA{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}var gA=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},vA=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};(()=>{let e,t,n,i=[pt("lume-ambient-light",oa)],r=[],s=fA,a=[],o=[];(class extends s{static{t=this}static{const l="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;n=[ct],gA(null,null,n,{kind:"field",name:"intensity",static:!1,private:!1,access:{has:e=>"intensity"in e,get:e=>e.intensity,set:(e,t)=>{e.intensity=t}},metadata:l},a,o),gA(null,e={value:t},i,{kind:"class",name:t.name,metadata:l},null,r),t=e.value,l&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:l}),vA(t,r)}intensity=vA(this,a,1);makeThreeObject3d(){return new mA}constructor(){super(...arguments),vA(this,o)}})})();const yA=new ur,bA=new an,xA=new an;class _A{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new da(512,512),this.map=null,this.mapPass=null,this.matrix=new ur,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new vS,this._frameExtents=new da(1,1),this._viewportCount=1,this._viewports=[new Ba(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;bA.setFromMatrixPosition(e.matrixWorld),t.position.copy(bA),xA.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(xA),t.updateMatrixWorld(),yA.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(yA),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(yA)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class wA extends _A{constructor(){super(new fy(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class SA extends hA{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Br.DEFAULT_UP),this.updateMatrix(),this.target=new Br,this.shadow=new wA}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const MA=new an,EA=new an,TA=new an;class AA extends Br{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===t&&(t=1);let i=new Do;i.setAttribute("position",new So([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new Vl({fog:!1,toneMapped:!1});this.lightPlane=new $l(i,r),this.add(this.lightPlane),i=new Do,i.setAttribute("position",new So([0,0,0,0,0,1],3)),this.targetLine=new $l(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),MA.setFromMatrixPosition(this.light.matrixWorld),EA.setFromMatrixPosition(this.light.target.matrixWorld),TA.subVectors(EA,MA),this.lightPlane.lookAt(EA),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(EA),this.targetLine.scale.z=TA.length()}}const CA=new an,RA=new ry;class PA extends Uy{constructor(e){const t=new Do,n=new Vl({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],s={};function a(e,t){o(e),o(t)}function o(e){i.push(0,0,0),r.push(0,0,0),void 0===s[e]&&(s[e]=[]),s[e].push(i.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),t.setAttribute("position",new So(i,3)),t.setAttribute("color",new So(r,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const l=new po(16755200),c=new po(16711680),u=new po(43775),h=new po(16777215),d=new po(3355443);this.setColors(l,c,u,h,d)}setColors(e,t,n,i,r){const s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,n.r,n.g,n.b),s.setXYZ(33,n.r,n.g,n.b),s.setXYZ(34,n.r,n.g,n.b),s.setXYZ(35,n.r,n.g,n.b),s.setXYZ(36,n.r,n.g,n.b),s.setXYZ(37,n.r,n.g,n.b),s.setXYZ(38,i.r,i.g,i.b),s.setXYZ(39,i.r,i.g,i.b),s.setXYZ(40,r.r,r.g,r.b),s.setXYZ(41,r.r,r.g,r.b),s.setXYZ(42,r.r,r.g,r.b),s.setXYZ(43,r.r,r.g,r.b),s.setXYZ(44,r.r,r.g,r.b),s.setXYZ(45,r.r,r.g,r.b),s.setXYZ(46,r.r,r.g,r.b),s.setXYZ(47,r.r,r.g,r.b),s.setXYZ(48,r.r,r.g,r.b),s.setXYZ(49,r.r,r.g,r.b),s.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap;RA.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),kA("c",t,e,RA,0,0,-1),kA("t",t,e,RA,0,0,1),kA("n1",t,e,RA,-1,-1,-1),kA("n2",t,e,RA,1,-1,-1),kA("n3",t,e,RA,-1,1,-1),kA("n4",t,e,RA,1,1,-1),kA("f1",t,e,RA,-1,-1,1),kA("f2",t,e,RA,1,-1,1),kA("f3",t,e,RA,-1,1,1),kA("f4",t,e,RA,1,1,1),kA("u1",t,e,RA,.7,1.1,-1),kA("u2",t,e,RA,-.7,1.1,-1),kA("u3",t,e,RA,0,2,-1),kA("cf1",t,e,RA,-1,0,1),kA("cf2",t,e,RA,1,0,1),kA("cf3",t,e,RA,0,-1,1),kA("cf4",t,e,RA,0,1,1),kA("cn1",t,e,RA,-1,0,-1),kA("cn2",t,e,RA,1,0,-1),kA("cn3",t,e,RA,0,-1,-1),kA("cn4",t,e,RA,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function kA(e,t,n,i,r,s,a){CA.set(r,s,a).unproject(i);const o=t[e];if(void 0!==o){const e=n.getAttribute("position");for(let t=0,n=o.length;t<n;t++)e.setXYZ(o[t],CA.x,CA.y,CA.z)}}var IA=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},OA=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};let LA=(()=>{let e,t,n,i,r,s,a,o,l,c,u=[pt],h=[],d=fA,p=[],f=[],m=[],g=[],v=[],y=[],b=[],x=[],_=[],w=[],S=[],M=[],E=[],T=[],A=[],C=[];return class extends d{static{t=this}static{const R="function"==typeof Symbol&&Symbol.metadata?Object.create(d[Symbol.metadata]??null):void 0;n=[ht],i=[ct],r=[ct],s=[ct],a=[ct],o=[ct],l=[ct],c=[ct],IA(null,null,n,{kind:"field",name:"castShadow",static:!1,private:!1,access:{has:e=>"castShadow"in e,get:e=>e.castShadow,set:(e,t)=>{e.castShadow=t}},metadata:R},p,f),IA(null,null,i,{kind:"field",name:"shadowMapWidth",static:!1,private:!1,access:{has:e=>"shadowMapWidth"in e,get:e=>e.shadowMapWidth,set:(e,t)=>{e.shadowMapWidth=t}},metadata:R},m,g),IA(null,null,r,{kind:"field",name:"shadowMapHeight",static:!1,private:!1,access:{has:e=>"shadowMapHeight"in e,get:e=>e.shadowMapHeight,set:(e,t)=>{e.shadowMapHeight=t}},metadata:R},v,y),IA(null,null,s,{kind:"field",name:"shadowRadius",static:!1,private:!1,access:{has:e=>"shadowRadius"in e,get:e=>e.shadowRadius,set:(e,t)=>{e.shadowRadius=t}},metadata:R},b,x),IA(null,null,a,{kind:"field",name:"shadowBias",static:!1,private:!1,access:{has:e=>"shadowBias"in e,get:e=>e.shadowBias,set:(e,t)=>{e.shadowBias=t}},metadata:R},_,w),IA(null,null,o,{kind:"field",name:"shadowNormalBias",static:!1,private:!1,access:{has:e=>"shadowNormalBias"in e,get:e=>e.shadowNormalBias,set:(e,t)=>{e.shadowNormalBias=t}},metadata:R},S,M),IA(null,null,l,{kind:"field",name:"shadowCameraNear",static:!1,private:!1,access:{has:e=>"shadowCameraNear"in e,get:e=>e.shadowCameraNear,set:(e,t)=>{e.shadowCameraNear=t}},metadata:R},E,T),IA(null,null,c,{kind:"field",name:"shadowCameraFar",static:!1,private:!1,access:{has:e=>"shadowCameraFar"in e,get:e=>e.shadowCameraFar,set:(e,t)=>{e.shadowCameraFar=t}},metadata:R},A,C),IA(null,e={value:t},u,{kind:"class",name:t.name,metadata:R},null,h),t=e.value,R&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:R}),OA(t,h)}castShadow=OA(this,p,!0);shadowMapWidth=(OA(this,f),OA(this,m,512));shadowMapHeight=(OA(this,g),OA(this,v,512));shadowRadius=(OA(this,y),OA(this,b,3));shadowBias=(OA(this,x),OA(this,_,0));shadowNormalBias=(OA(this,w),OA(this,S,0));shadowCameraNear=(OA(this,M),OA(this,E,1));shadowCameraFar=(OA(this,T),OA(this,A,2e3));connectedCallback(){super.connectedCallback(),this.createEffect((()=>{this.three.castShadow=this.castShadow;const e=this.three.shadow;e.mapSize.width=this.shadowMapWidth,e.mapSize.height=this.shadowMapHeight,e.radius=this.shadowRadius,e.bias=this.shadowBias,e.normalBias=this.shadowNormalBias;const t=e.camera;t.near=this.shadowCameraNear,t.far=this.shadowCameraFar,e.needsUpdate=!0,this.needsUpdate()}))}constructor(){super(...arguments),OA(this,C)}},t})();var NA=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0},DA=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0};(()=>{let e,t,n,i,r,s,a,o=[pt("lume-directional-light",oa)],l=[],c=LA,u=[],h=[],d=[],p=[],f=[],m=[],g=[],v=[],y=[],b=[];(class extends c{static{t=this}static{const x="function"==typeof Symbol&&Symbol.metadata?Object.create(c[Symbol.metadata]??null):void 0;n=[ct],i=[ct],r=[ct],s=[ct],a=[ct],NA(null,null,n,{kind:"field",name:"intensity",static:!1,private:!1,access:{has:e=>"intensity"in e,get:e=>e.intensity,set:(e,t)=>{e.intensity=t}},metadata:x},u,h),NA(null,null,i,{kind:"field",name:"shadowCameraTop",static:!1,private:!1,access:{has:e=>"shadowCameraTop"in e,get:e=>e.shadowCameraTop,set:(e,t)=>{e.shadowCameraTop=t}},metadata:x},d,p),NA(null,null,r,{kind:"field",name:"shadowCameraRight",static:!1,private:!1,access:{has:e=>"shadowCameraRight"in e,get:e=>e.shadowCameraRight,set:(e,t)=>{e.shadowCameraRight=t}},metadata:x},f,m),NA(null,null,s,{kind:"field",name:"shadowCameraBottom",static:!1,private:!1,access:{has:e=>"shadowCameraBottom"in e,get:e=>e.shadowCameraBottom,set:(e,t)=>{e.shadowCameraBottom=t}},metadata:x},g,v),NA(null,null,a,{kind:"field",name:"shadowCameraLeft",static:!1,private:!1,access:{has:e=>"shadowCameraLeft"in e,get:e=>e.shadowCameraLeft,set:(e,t)=>{e.shadowCameraLeft=t}},metadata:x},y,b),NA(null,e={value:t},o,{kind:"class",name:t.name,metadata:x},null,l),t=e.value,x&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:x}),DA(t,l)}intensity=DA(this,u,1);shadowCameraTop=(DA(this,h),DA(this,d,1e3));shadowCameraRight=(DA(this,p),DA(this,f,1e3));shadowCameraBottom=(DA(this,m),DA(this,g,-1e3));shadowCameraLeft=(DA(this,v),DA(this,y,-1e3));connectedCallback(){super.connectedCallback(),this.three.castShadow=!0,this.createEffect((()=>{const e=this.three.shadow;e.camera.top=this.shadowCameraTop,e.camera.right=this.shadowCameraRight,e.camera.bottom=this.shadowCameraBottom,e.camera.left=this.shadowCameraLeft,e.needsUpdate=!0,this.needsUpdate()})),this.createEffect((()=>{if(!this.debug)return;if(!this.scene)return;const e=new AA(this.three,this.shadowCameraTop-this.shadowCameraBottom);this.scene.three.add(e);const t=new PA(this.three.shadow.camera);this.scene.three.add(t);const n=Kr.addRenderTask((()=>{e.update(),t.update(),this.scene.needsUpdate()}));L((()=>{Kr.removeRenderTask(n),e.dispose(),this.scene.three.remove(e),t.dispose(),this.scene.three.remove(t)}))}))}makeThreeObject3d(){return new SA}constructor(){super(...arguments),DA(this,b)}})})();const zA=new ur,UA=new an,FA=new an;class BA extends _A{constructor(){super(new ly(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new da(4,2),this._viewportCount=6,this._viewports=[new Ba(2,1,1,1),new Ba(0,1,1,1),new Ba(3,1,1,1),new Ba(1,1,1,1),new Ba(3,0,1,1),new Ba(1,0,1,1)],this._cubeDirections=[new an(1,0,0),new an(-1,0,0),new an(0,0,1),new an(0,0,-1),new an(0,1,0),new an(0,-1,0)],this._cubeUps=[new an(0,1,0),new an(0,1,0),new an(0,1,0),new an(0,1,0),new an(0,0,1),new an(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),UA.setFromMatrixPosition(e.matrixWorld),n.position.copy(UA),FA.copy(n.position),FA.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(FA),n.updateMatrixWorld(),i.makeTranslation(-UA.x,-UA.y,-UA.z),zA.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(zA)}}class VA extends hA{constructor(e,t,n=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new BA}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class jA extends Yo{constructor(e,t,n){super(new gv(t,4,2),new vo({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}var HA=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0},GA=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0};let WA=(()=>{let e,t,n,i,r,s,a,o,l=[pt("lume-point-light",oa)],c=[],u=LA,h=[],d=[],p=[],f=[],m=[],g=[],v=[],y=[],b=[];return class extends u{static{t=this}static{const x="function"==typeof Symbol&&Symbol.metadata?Object.create(u[Symbol.metadata]??null):void 0;n=[ct],i=[ct],r=[ct],s=[ct],a=[ct],o=[ct],GA(this,null,a,{kind:"getter",name:"power",static:!1,private:!1,access:{has:e=>"power"in e,get:e=>e.power},metadata:x},null,h),GA(this,null,o,{kind:"setter",name:"power",static:!1,private:!1,access:{has:e=>"power"in e,set:(e,t)=>{e.power=t}},metadata:x},null,h),GA(null,null,n,{kind:"field",name:"intensity",static:!1,private:!1,access:{has:e=>"intensity"in e,get:e=>e.intensity,set:(e,t)=>{e.intensity=t}},metadata:x},d,p),GA(null,null,i,{kind:"field",name:"shadowCameraFov",static:!1,private:!1,access:{has:e=>"shadowCameraFov"in e,get:e=>e.shadowCameraFov,set:(e,t)=>{e.shadowCameraFov=t}},metadata:x},f,m),GA(null,null,r,{kind:"field",name:"distance",static:!1,private:!1,access:{has:e=>"distance"in e,get:e=>e.distance,set:(e,t)=>{e.distance=t}},metadata:x},g,v),GA(null,null,s,{kind:"field",name:"decay",static:!1,private:!1,access:{has:e=>"decay"in e,get:e=>e.decay,set:(e,t)=>{e.decay=t}},metadata:x},y,b),GA(null,e={value:t},l,{kind:"class",name:t.name,metadata:x},null,c),t=e.value,x&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:x}),HA(t,c)}intensity=(HA(this,h),HA(this,d,1));shadowCameraFov=(HA(this,p),HA(this,f,90));distance=(HA(this,m),HA(this,g,0));decay=(HA(this,v),HA(this,y,1));get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}connectedCallback(){super.connectedCallback(),this.createEffect((()=>{const e=this.three;e.distance=this.distance,e.decay=this.decay,this.needsUpdate()})),this.createEffect((()=>{if(!this.debug)return;if(!this.scene)return;const e=new jA(this.three,this.calculatedSize.x||100);this.scene.three.add(e);const t=Kr.addRenderTask((()=>e.update()));L((()=>{e.dispose(),this.scene.three.remove(e),Kr.removeRenderTask(t)}))}))}makeThreeObject3d(){return new VA}constructor(){super(...arguments),HA(this,b)}},t})();class XA extends _A{constructor(){super(new ly(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=2*Jt*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class qA extends hA{constructor(e,t,n=0,i=Math.PI/3,r=0,s=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Br.DEFAULT_UP),this.updateMatrix(),this.target=new Br,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new XA}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const YA=new an;class $A extends Br{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new Do,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,n=32;e<n;e++,t++){const r=e/n*Math.PI*2,s=t/n*Math.PI*2;i.push(Math.cos(r),Math.sin(r),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new So(i,3));const r=new Vl({fog:!1,toneMapped:!1});this.cone=new Uy(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),YA.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(YA),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}var ZA=function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0},KA=function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0};(()=>{let e,t,n,i,r,s,a=[pt("lume-spot-light",oa)],o=[],l=WA,c=[],u=[],h=[],d=[],p=[];(class extends l{static{t=this}static{const f="function"==typeof Symbol&&Symbol.metadata?Object.create(l[Symbol.metadata]??null):void 0;n=[ct],i=[ct],r=[ot],s=[ot],KA(this,null,r,{kind:"getter",name:"target",static:!1,private:!1,access:{has:e=>"target"in e,get:e=>e.target},metadata:f},null,c),KA(this,null,s,{kind:"setter",name:"target",static:!1,private:!1,access:{has:e=>"target"in e,set:(e,t)=>{e.target=t}},metadata:f},null,c),KA(null,null,n,{kind:"field",name:"angle",static:!1,private:!1,access:{has:e=>"angle"in e,get:e=>e.angle,set:(e,t)=>{e.angle=t}},metadata:f},u,h),KA(null,null,i,{kind:"field",name:"penumbra",static:!1,private:!1,access:{has:e=>"penumbra"in e,get:e=>e.penumbra,set:(e,t)=>{e.penumbra=t}},metadata:f},d,p),KA(null,e={value:t},a,{kind:"class",name:t.name,metadata:f},null,o),t=e.value,f&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:f}),ZA(t,o)}angle=(ZA(this,c),ZA(this,u,60));penumbra=(ZA(this,h),ZA(this,d,1));#ai=(ZA(this,p),[]);#oi="";#S=null;get target(){return this.#ai[0]??null}set target(e){this.#oi=e;let t=[];if("string"==typeof e)t.push(e.trim());else if(Array.isArray(e))t=e;else{if("object"!=typeof e)throw new TypeError("Invalid value for target");e&&t.push(e)}this.#ai=[];for(const e of t){if("string"!=typeof e){e instanceof ua&&e.scene&&this.#ai.push(e);continue}if(!e)continue;let t=this.getRootNode();for(;t;){const n=t.querySelectorAll(e);for(let e=0,t=n.length;e<t;e+=1){const t=n.item(e);t&&t instanceof ua&&t.scene&&this.#ai.push(t)}t=t instanceof ShadowRoot?t.host.getRootNode():null}}}updateWorldMatrices(e=!0){super.updateWorldMatrices(e),this.#li?.update(),this.#ci?.update()}#li=null;#ci=null;connectedCallback(){super.connectedCallback(),this.createEffect((()=>{if(!this.scene||!this.debug)return;const e=this.scene;this.#li=new $A(this.three),e.three.add(this.#li),this.#ci=new PA(this.three.shadow.camera),e.three.add(this.#ci),this.needsUpdate(),L((()=>{this.#li.dispose(),e.three.remove(this.#li),this.#li=null,this.#ci.dispose(),e.three.remove(this.#ci),this.#ci=null}))})),this.createEffect((()=>{const e=this.three;e.angle=qs(this.angle),e.penumbra=this.penumbra,this.#li?.update(),this.needsUpdate()})),this.createEffect((()=>{if(this.scene){this.target=this.#oi,this.#S=new MutationObserver((()=>{this.target=this.#oi}));for(const e of cc(this))this.#S.observe(e,{childList:!0,subtree:!0});P((()=>{const e=this.target;this.three.target=e?e.three:new Br,this.needsUpdate()})),L((()=>{this.#S?.disconnect(),this.#S=null}))}}))}makeThreeObject3d(){return new qA}})})();(()=>{let e,t,n=[pt("lume-box",oa)],i=[],r=Jo;(class extends r{static{t=this}static{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(r[Symbol.metadata]??null):void 0;(function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0})(null,e={value:t},n,{kind:"class",name:t.name,metadata:s},null,i),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e)}(t,i)}initialBehaviors={geometry:"box",material:"physical"}})})();(()=>{let e,t,n=[pt("lume-mixed-plane",oa)],i=[],r=Jo;(class extends r{static{t=this}static{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(r[Symbol.metadata]??null):void 0;(function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0})(null,e={value:t},n,{kind:"class",name:t.name,metadata:s},null,i),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e)}(t,i)}initialBehaviors={geometry:"mixedplane",material:"mixedplane"}})})();(()=>{let e,t,n=[pt("lume-plane",oa)],i=[],r=Jo;(class extends r{static{t=this}static{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(r[Symbol.metadata]??null):void 0;(function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0})(null,e={value:t},n,{kind:"class",name:t.name,metadata:s},null,i),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e)}(t,i)}initialBehaviors={geometry:"plane",material:"physical"}})})();(()=>{let e,t,n=[pt("lume-rounded-rectangle",oa)],i=[],r=Jo;(class extends r{static{t=this}static{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(r[Symbol.metadata]??null):void 0;(function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0})(null,e={value:t},n,{kind:"class",name:t.name,metadata:s},null,i),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e)}(t,i)}initialBehaviors={geometry:"rounded-rectangle",material:"physical"}})})();(()=>{let e,t,n=[pt("lume-shape",oa)],i=[],r=Jo;(class extends r{static{t=this}static{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(r[Symbol.metadata]??null):void 0;(function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0})(null,e={value:t},n,{kind:"class",name:t.name,metadata:s},null,i),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e)}(t,i)}initialBehaviors={geometry:"shape",material:"physical"}})})();(()=>{let e,t,n=[pt("lume-sphere",oa)],i=[],r=Jo;(class extends r{static{t=this}static{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(r[Symbol.metadata]??null):void 0;(function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0})(null,e={value:t},n,{kind:"class",name:t.name,metadata:s},null,i),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e)}(t,i)}initialBehaviors={geometry:"sphere",material:"physical"}})})();(()=>{let e,t,n=[pt("lume-torus",oa)],i=[],r=Jo;(class extends r{static{t=this}static{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(r[Symbol.metadata]??null):void 0;(function(e,t,n,i,r,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?i.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),d=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,n[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&r.unshift(o)}else(o=a(g))&&("field"===l?r.unshift(o):h[c]=o)}u&&Object.defineProperty(u,i.name,h),d=!0})(null,e={value:t},n,{kind:"class",name:t.name,metadata:s},null,i),t=e.value,s&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),function(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e)}(t,i)}initialBehaviors={geometry:"torus",material:"physical"}})})();const JA="0.3.0-alpha.44",QA="https://docs.lume.io/examples/nasa-astrobee-robot/astrobee/pmc.dae",eC="https://docs.lume.io/examples/nasa-astrobee-robot/astrobee/pmc_skin_.dae",tC="https://docs.lume.io/examples/nasa-astrobee-robot/astrobee/pmc_bumper.dae",nC="https://docs.lume.io/examples/nasa-astrobee-robot/luna-station.jpg";class iC extends r.Component{state={rotationDirection:1,rotationAmount:.2,rotationEnabled:!0,view:"free"};astrobee=(0,r.createRef)();rig=(0,r.createRef)();cam=(0,r.createRef)();render=()=>r.createElement(r.Fragment,null,r.createElement("lume-scene",{webgl:!0,environment:nC},r.createElement("lume-camera-rig",{ref:this.rig,active:"free"===this.state.view,"vertical-angle":"30","min-distance":"0.4","max-distance":"2","dolly-speed":"0.002",distance:"1"}),r.createElement("lume-element3d",{rotation:String(["top"===this.state.view?-90:0,0,0])},r.createElement("lume-perspective-camera",{ref:this.cam,active:"free"!==this.state.view,position:"0 0 0.7"})),r.createElement("lume-point-light",{intensity:"20",color:"#a3ffff",position:"0 9 0"}),r.createElement("lume-point-light",{intensity:"20",color:"#a3ffff",position:"0 -9 0"}),r.createElement("lume-point-light",{intensity:"20",color:"#a3ffff",position:"0 0 9"}),r.createElement("lume-point-light",{intensity:"20",color:"#a3ffff",position:"0 0 -9"}),r.createElement("lume-point-light",{intensity:"20",color:"#a3ffff",position:"9 8 0"}),r.createElement("lume-point-light",{intensity:"20",color:"#a3ffff",position:"9 -8 0"}),r.createElement("lume-point-light",{intensity:"20",color:"#a3ffff",position:"-9 8 0"}),r.createElement("lume-point-light",{intensity:"20",color:"#a3ffff",position:"-9 -8 0"}),r.createElement("lume-element3d",{ref:this.astrobee},r.createElement("lume-collada-model",{src:"https://docs.lume.io/examples/nasa-astrobee-robot/astrobee/body.dae",onLoad:this.#ui,onProgress:()=>console.log()}),r.createElement("lume-collada-model",{src:QA}),r.createElement("lume-collada-model",{src:eC}),r.createElement("lume-collada-model",{src:tC}),r.createElement("lume-element3d",{scale:"1 1 -1"},r.createElement("lume-collada-model",{src:QA}),r.createElement("lume-collada-model",{src:eC}),r.createElement("lume-collada-model",{src:tC}))),r.createElement("lume-sphere",{has:"basic-material",texture:nC,color:"white","mount-point":"0.5 0.5 0.5",size:"100 100 100",sidedness:"double","cast-shadow":"false","receive-shadow":"false"})),r.createElement("div",{style:rC.ui},r.createElement("fieldset",{style:rC.fieldset},r.createElement("legend",{style:rC.legend},"Rotation"),r.createElement("label",null,r.createElement("input",{type:"checkbox",checked:this.state.rotationEnabled,onChange:this.toggleRotation})," Enable rotation."),r.createElement("br",null),r.createElement("label",null,r.createElement("input",{type:"checkbox",checked:this.state.rotationDirection<0,onChange:this.toggleRotationDirection})," ","Clockwise rotation.")),r.createElement("fieldset",{style:rC.fieldset2},r.createElement("legend",{style:rC.legend2},"View"),r.createElement("label",null,r.createElement("input",{type:"radio",name:"side",checked:"side"===this.state.view,onChange:this.changeView})," Side view."),r.createElement("br",null),r.createElement("label",null,r.createElement("input",{type:"radio",name:"top",checked:"top"===this.state.view,onChange:this.changeView})," Top view"),r.createElement("br",null),r.createElement("label",null,r.createElement("input",{type:"radio",name:"free",checked:"free"===this.state.view,onChange:this.changeView})," Free view"))));#ui=e=>{const t=e.target;t.three.traverse((e=>{e.type.includes("Light")&&(e.intensity=0)})),t.needsUpdate()};componentDidMount(){this.astrobee.current.rotation=this.astrobeeRotation,queueMicrotask((()=>{const e=this.rig.current.shadowRoot.querySelector("lume-perspective-camera");e.near=this.cam.current.near=.1,e.far=this.cam.current.far=110}))}astrobeeRotation=(e,t,n,i)=>[e,t+this.state.rotationAmount*this.state.rotationDirection,n];toggleRotation=()=>{const e=!this.state.rotationEnabled;this.setState({rotationEnabled:e}),this.astrobee.current.rotation=e?this.astrobeeRotation:()=>!1};toggleRotationDirection=()=>{this.setState({rotationDirection:this.state.rotationDirection*=-1})};changeView=e=>{const t=e.target;t.checked&&this.setState({view:t.name}),t.checked&&this.setState({view:t.name})}}const rC={ui:{position:"absolute",margin:15,padding:10,top:0,left:0,color:"white",fontFamily:"sans-serif",background:"rgba(0, 0, 0, 0.6)",borderRadius:7},legend:{color:"#75c7c7"},fieldset:{borderColor:"#75c7c7",borderRadius:4},legend2:{color:"#c595c9"},fieldset2:{borderColor:"#c595c9",borderRadius:4}};(0,s.createRoot)(document.getElementById("root")).render(r.createElement(iC,null))})();